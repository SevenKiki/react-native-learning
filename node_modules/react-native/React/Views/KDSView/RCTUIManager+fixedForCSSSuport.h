//
//  RCTUIManager+fixedForCSSSuport.h
//  React-Core
//
//  Created by joyo on 2021/8/24.
//

#import "RCTUIManager.h"

NS_ASSUME_NONNULL_BEGIN

@interface RCTUIManager (fixedForCSSSuport)

// setChildren: 根据当前容器的fixed，创建虚拟节点并替换
- (NSArray<NSNumber *> *)replaceFixedWithVirtualViewToContainer:(NSNumber *)containerTag
                                                      reactTags:(NSArray<NSNumber *> *)reactTags
                                             shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

// 判断是否需要删除关联的Fixed节点，有可能已经移出RootNode
- (BOOL)shouldRemoveBindingFixedChild:(NSNumber *)virtualChildTag
                   shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

// 创建空的虚拟节点(其reactTag为负数)
- (void)createVirtualChild:(NSNumber *)reactTag
                 className:(NSString *)className
                   rootTag:(NSNumber *)rootTag
        shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

// 删除节点保存移出的fixed节点tag
- (void)removeMovedOutFixedChildTag:(RCTShadowView *)containerView
                          removeTag:(NSNumber *)removeTag;

// 父亲移除时同步移除曾移到RootView下的fixed节点
- (void)removeAllFixedChildrenRecursive:(RCTShadowView *)shadowView
                     shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

// 虚拟节点移除时，同步移除关联的fixed节点，通常是通过index来删除的场景
- (void)removeFixedChildRecursive:(RCTShadowView *)virtualNode
               shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

// 把当前View作为fixed节点，并插入到 rootView 节点最上面(在rootView的视图顶部插入)
- (void)interceptFixedChildToRootView:(RCTShadowView *)child
                    fromContainerView:(RCTShadowView *)containerView;

// 把当前View作为fixed节点，并插入到 rootView 节点最上面(在rootView的视图顶部插入),并返回虚拟节点
- (id<RCTComponent>)interceptFixedChildToRootView:(id<RCTComponent>)view
                                         registry:(NSMutableDictionary<NSNumber *, RCTShadowView *> *)registry;

// 先删除originalParent下虚拟空节点，再从rootView移动到originalParent下
- (void)moveFixedChildFromRootViewToOriginalParent:(RCTShadowView *)fixedChild
                                shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

// 先创建虚拟空节点并插入到originalParent下，再从originalParent下把fixed节点移动到rootView下
- (void)moveFixedChildFromParentToRootView:(RCTShadowView *)child
                                    parent:(RCTShadowView *)parent
                        shadowViewRegistry:(NSDictionary<NSNumber *, id<RCTComponent>> *)_shadowViewRegistry;

@end

NS_ASSUME_NONNULL_END
