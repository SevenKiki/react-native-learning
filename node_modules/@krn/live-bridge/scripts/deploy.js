const chalk = require('chalk');
const path = require('path');
const { run } = require('./utils');

const PROJECT_ROOT = path.resolve(__dirname, '..');
const DIST_DIR = 'docs';
const PROJECT_DIR = 'ks-frontend-live-krn-bridge-doc';
const deployKProxy = () => {
    try {
        if (!PROJECT_DIR) {
            throw new Error('PROJECT_DIR is required!');
        }
        const cmd = `rsync -az ${DIST_DIR}/ kproxysite:/home/sites/${PROJECT_DIR}`;
        console.log(chalk.green(`[deploy-kproxy] ${cmd}`));
        run(cmd, {
            cwd: PROJECT_ROOT,
        });

        console.log(chalk.green('[deploy-kproxy] deploy over'));
        console.log(
            chalk.green(
                `[deploy-kproxy] visit: https://${PROJECT_DIR}.kproxy.corp.kuaishou.com/`,
            ),
        );
    } catch (error) {
        console.error('[deploy-kproxy]:', error);
    }
};

deployKProxy();
