import { addEventListener, removeEventListener, subscribeChannel, } from './subscribeChannel';
const CHANNEL_MULTI_ONLINE_INTERACTIVE_USERS = 'onlineInteractiveUsers';
const onlineInteractiveUsersCallbacks = new Map();
const channelCallback = (data) => {
    if (typeof data === 'string') {
        data = JSON.parse(data);
    }
    const onlineUsersInfo = data;
    if (onlineUsersInfo && onlineUsersInfo.onlineUsers) {
        onlineInteractiveUsersCallbacks?.forEach((cb) => {
            cb(onlineUsersInfo.onlineUsers);
        });
    }
};
// 订阅多人互动框架在线人数
export async function subscribeOnlineInteractiveUsers(callback) {
    if (callback == null) {
        throw new Error('callback must not be null');
    }
    const subscribeId = await subscribeChannel(CHANNEL_MULTI_ONLINE_INTERACTIVE_USERS, {});
    onlineInteractiveUsersCallbacks.set(subscribeId, callback);
    addEventListener(CHANNEL_MULTI_ONLINE_INTERACTIVE_USERS, channelCallback);
    return subscribeId;
}
export async function unsubscribeOnlineInteractiveUsers(subscribeId) {
    if (subscribeId == null || subscribeId.length === 0) {
        throw new Error('subscribeId must not be null or empty');
    }
    onlineInteractiveUsersCallbacks.delete(subscribeId);
    if (onlineInteractiveUsersCallbacks.size === 0) {
        removeEventListener(CHANNEL_MULTI_ONLINE_INTERACTIVE_USERS);
    }
}
