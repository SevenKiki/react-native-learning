"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// @ts-nocheck
const assert_1 = tslib_1.__importDefault(require("assert"));
const Plugin_1 = tslib_1.__importDefault(require("./Plugin"));
const options_1 = tslib_1.__importDefault(require("./options"));
function default_1({ types }) {
    let plugins = null;
    // Only for test
    // eslint-disable-next-line no-underscore-dangle
    global.__clearBabelAntdPlugin = () => {
        plugins = null;
    };
    function applyInstance(method, args, context) {
        // eslint-disable-next-line no-restricted-syntax
        for (const plugin of plugins) {
            if (plugin[method]) {
                plugin[method].apply(plugin, [...args, context]);
            }
        }
    }
    const Program = {
        enter() {
            const opts = options_1.default;
            // Init plugin instances once.
            if (!plugins) {
                if (Array.isArray(opts)) {
                    plugins = opts.map(({ libraryName, libraryDirectory, style, styleLibraryDirectory, customStyleName, camel2DashComponentName, camel2UnderlineComponentName, fileName, customName, transformToDefaultImport, }, index) => {
                        (0, assert_1.default)(libraryName, 'libraryName should be provided');
                        return new Plugin_1.default(libraryName, libraryDirectory, style, styleLibraryDirectory, customStyleName, camel2DashComponentName, camel2UnderlineComponentName, fileName, customName, transformToDefaultImport, types, index);
                    });
                }
                else {
                    (0, assert_1.default)(opts.libraryName, 'libraryName should be provided');
                    plugins = [
                        new Plugin_1.default(opts.libraryName, opts.libraryDirectory, opts.style, opts.styleLibraryDirectory, opts.customStyleName, opts.camel2DashComponentName, opts.camel2UnderlineComponentName, opts.fileName, opts.customName, opts.transformToDefaultImport, types),
                    ];
                }
            }
            applyInstance('ProgramEnter', arguments, this); // eslint-disable-line
        },
        exit() {
            applyInstance('ProgramExit', arguments, this); // eslint-disable-line
        },
    };
    const methods = [
        'ImportDeclaration',
        'CallExpression',
        'MemberExpression',
        'Property',
        'VariableDeclarator',
        'ArrayExpression',
        'LogicalExpression',
        'ConditionalExpression',
        'IfStatement',
        'ExpressionStatement',
        'ReturnStatement',
        'ExportDefaultDeclaration',
        'BinaryExpression',
        'NewExpression',
        'ClassDeclaration',
        'SwitchStatement',
        'SwitchCase',
    ];
    const ret = {
        visitor: { Program },
    };
    // eslint-disable-next-line no-restricted-syntax
    for (const method of methods) {
        ret.visitor[method] = function () {
            // eslint-disable-line
            applyInstance(method, arguments, ret.visitor); // eslint-disable-line
        };
    }
    return ret;
}
exports.default = default_1;
