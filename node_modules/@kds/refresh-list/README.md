# @kds/refresh-list

基于 react-native-rk-pull-to-refresh 改造，支持自定义下拉刷新和上拉加载组件

## 安装

```shell
npm install @kds/refresh-list
```

## use

```js
import PullRefresh from '@kds/refresh-list';
```

## 无代码入侵

可以包裹，ScrollView、Flatlist、SectionList 等

简单用法

```jsx
<PullRefresh
  isRefreshing={isRefreshing}
  onRequest={this.onRequest.bind(this)}
  pullAnimHeight={70}>
  <SectionList
    ref={this.setRef.bind(this)}
    overScrollMode={'never'}
    nestedScrollEnabled={true}
    bounces={false}
    onScroll={this.onScroll.bind(this)}
    scrollEventThrottle={1}
    stickyHeaderIndices={[0]}
    sections={DATA}
    keyExtractor={(item, index) => item + index}
    renderItem={({item}) => <Item title={item} />}
    renderSectionHeader={({section: {title}}) => (
      <Text style={styles.header}>{title}</Text>
    )}></SectionList>
</PullRefresh>
```

## 使用快手、快影的下拉样式

下拉样式依赖 svg 组件，请先安装 react-native-svg

```shell
npm install react-native-svg
```

简单用法

```js
import PullRefresh from '@kds/refresh-list';
// 快手
import getKsLoading, {
  LoadingType,
} from '@kds/refresh-list/dist/refresh-control/ks';

// LoadingType有三个值 {
//   highlight = 'url(#c)',
//   light = '#ffffff',
//   gray = '#C6C6C6',
// }
const RefreshControl = getKsLoading(LoadingType.light);

// 快影
// import getKyLoading from '@kds/refresh-list/dist/refresh-control/ky';
// const RefreshControl = getKyLoading('上热门为您推荐了新的教程！');

<PullRefresh
  RefreshControl={RefreshControl}
  isRefreshing={isRefreshing}
  onRequest={this.onRequest.bind(this)}
  pullAnimHeight={70}>
  <SectionList
    ref={this.setRef.bind(this)}
    overScrollMode={'never'}
    nestedScrollEnabled={true}
    bounces={false}
    onScroll={this.onScroll.bind(this)}
    scrollEventThrottle={1}
    stickyHeaderIndices={[0]}
    sections={DATA}
    keyExtractor={(item, index) => item + index}
    renderItem={({item}) => <Item title={item} />}
    renderSectionHeader={({section: {title}}) => (
      <Text style={styles.header}>{title}</Text>
    )}></SectionList>
</PullRefresh>;
```

# 参数

```jsx
export interface PullRefreshProps {
  RefreshControl?: React.ComponentClass;
  children: React.ReactNode;
  pullAnimHeight?: number;
  minPullDistance?: number;
  isContentScroll?: boolean;
  onRequest: () => void;
  updateOnPullChange?: boolean;
  isRefreshing: boolean;
  msHoldingTime?: number;
  refreshLayoutStyle?: StyleProp<ViewStyle>
  refreshControlStyle?: StyleProp<ViewStyle>
  useStateChildren?: boolean;
}
```

isRefreshing: 必需

onRequest: 必需 请求，需要在请求开始设置 isRefreshing 为 true,结束设置为 false

pullAnimHeight: android 必需， 下拉控制内容高度

msHoldingTime: 请求结束，holding 内容展示时间，默认 1000ms

isContentScroll: 内容是否跟着一起下拉，默认值为 true

refreshLayoutStyle: 更改下拉刷新最外层容器样式

refreshControlStyle： 更改下拉刷新控制组件容器样式

useStateChildren：控制Android端，children是由state控制还是props控制，如果代码有显式更改children，可以设置为false。默认值为true，防止children内容过多更新频繁时导致下拉刷新卡顿。

refreshControl： 下拉刷新控制组件，需实现 setRefreshControlParams 方法接收下拉状态变化。默认值如下：

```jsx
class DefaultRefreshControl extends Component<
  DefaultRefreshControlProps,
  DefaultRefreshControlState
> {
  constructor(props: DefaultRefreshControlProps) {
    super(props);
    this.state = {
      text: '下拉刷新',
    };
  }
  setRefreshControlParams(refreshControlParams: RefreshControlParams) {
    if (refreshControlParams.pullState === PullState.INIT) {
      this.setState({
        text: '下拉刷新',
      });
    } else if (refreshControlParams.pullState === PullState.PULLING) {
      this.setState({
        text: refreshControlParams.movePercent >= 100 ? '松开加载' : '下拉刷新',
      });
    } else if (refreshControlParams.pullState === PullState.LOADING) {
      this.setState({
        text: '拼命加载中...',
      });
    } else if (refreshControlParams.pullState === PullState.HOLDING) {
      this.setState({
        text: '加载成功',
      });
    }
  }
  render() {
    return <Text>{this.state.text}</Text>;
  }
}
```

RefreshControlParams 的属性有

```jsx
export interface RefreshControlParams {
  moveHeight: number; // 下拉高度
  movePercent: number; // 下拉占比
  pullAnimHeight: number; // 下拉总高度
  minPullDistance: number; // 触发刷新的最小高度
  pullState: PullState; // 下拉状态
}
```

# 注意事项

1. example 里模块可以这样引入："@kds/refresh-list": "file:../"
