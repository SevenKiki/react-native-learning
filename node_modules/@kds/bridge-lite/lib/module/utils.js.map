{"version":3,"names":["globalConfig","NativeModules","delay","timeout","Promise","resolve","setTimeout","dealRejectErrorInfo","err","message","error_msg","userInfo","code","codeStr","substr","indexOf","e","__DEV__","console","warn","normalParams","params","rootTag","JSON","stringify","normalNamespace","name","replace","generateUUID","d","Date","getTime","performance","now","pattern","c","r","Math","random","floor","toString","VersionIs","versionCompare","current","other","cp","String","split","op","depth","min","length","cn","Number","on","GreaterThan","LessThan","isNaN","EqualTo","appVersion","getAppVersion","data","version","KRNBasic","getDeviceInfoSync","match"],"sources":["utils.ts"],"sourcesContent":["/* eslint-disable camelcase */\nimport { globalConfig } from './global-config';\nimport { NativeModules } from 'react-native';\n\nexport const delay = (timeout: number) =>\n    new Promise<void>((resolve) => setTimeout(resolve, timeout));\n\n// 加工处理reject的errorInfo，在10.1.10版本之前，IOS并未传递code 只能通过msg解析\nexport const dealRejectErrorInfo = (err: {\n    code: any;\n    message: string;\n    error_msg?: string;\n    userInfo?: { error_msg: string };\n}): any => {\n    err.message = err.error_msg =\n        err.userInfo?.error_msg || err.error_msg || err.message || '';\n    if (err.code !== 'EUNSPECIFIED') {\n        return err;\n    }\n    // 尝试从 message中提取Code\n    try {\n        var codeStr = err.message.substr(err.message.indexOf('Code=') + 5);\n        codeStr = codeStr.substr(0, codeStr.indexOf(' '));\n        err.code = codeStr;\n    } catch (e) {\n        if (__DEV__) {\n            console.warn('[dealRejectErrorInfo]', err);\n        }\n    }\n    return err;\n};\n\nexport const normalParams = (params: any) => {\n    if (\n        __DEV__ &&\n        !globalConfig.rootTag &&\n        (!params || (typeof params === 'object' && !('rootTag' in params)))\n    ) {\n        console.warn(\n            '[@kds/bridge-lite]: 请在根组件渲染的时候先调用 setGlobalConfig 方法设置 rootTag，避免调用报错',\n        );\n    }\n    if (params == null) {\n        return '';\n    }\n    if (\n        typeof params === 'object' &&\n        !('rootTag' in params) &&\n        globalConfig.rootTag != null\n    ) {\n        params.rootTag = globalConfig.rootTag;\n    }\n    return JSON.stringify(params);\n};\n\nexport const normalNamespace = (name: string) => {\n    return name.replace(/^kwai/u, 'Kwai');\n};\n\nexport function generateUUID() {\n    let d = new Date().getTime();\n    if (\n        typeof performance !== 'undefined' &&\n        // eslint-disable-next-line no-undef\n        typeof performance.now === 'function'\n    ) {\n        // eslint-disable-next-line no-undef\n        d += performance.now(); // use high-precision timer if available\n    }\n    let pattern = 'xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx';\n    return pattern.replace(/[xy]/g, function (c) {\n        // eslint-disable-next-line no-bitwise\n        var r = (d + Math.random() * 16) % 16 | 0;\n        d = Math.floor(d / 16);\n        // eslint-disable-next-line no-bitwise\n        return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16);\n    });\n}\n\nexport type Version = string | number;\nexport enum VersionIs {\n    LessThan = -1,\n    EqualTo = 0,\n    GreaterThan = 1,\n}\n\n/**\n * Compare two versions quickly.\n * @param current Is this version greater, equal to, or less than the other?\n * @param other The version to compare against the current version\n * @return 1 if current is greater than other, 0 if they are equal or equivalent, and -1 if current is less than other\n */\nexport function versionCompare(current: Version, other: Version): VersionIs {\n    const cp = String(current).split('.');\n    const op = String(other).split('.');\n    for (let depth = 0; depth < Math.min(cp.length, op.length); depth++) {\n        const cn = Number(cp[depth]);\n        const on = Number(op[depth]);\n        if (cn > on) {\n            return VersionIs.GreaterThan;\n        }\n        if (on > cn) {\n            return VersionIs.LessThan;\n        }\n        if (!isNaN(cn) && isNaN(on)) {\n            return VersionIs.GreaterThan;\n        }\n        if (isNaN(cn) && !isNaN(on)) {\n            return VersionIs.LessThan;\n        }\n    }\n    return VersionIs.EqualTo;\n}\n\nlet appVersion = '';\nexport function getAppVersion() {\n    if (appVersion) {\n        return appVersion;\n    }\n    const {\n        data: { appVersion: version },\n    } = NativeModules.KRNBasic?.getDeviceInfoSync?.() || {\n        data: {\n            appVersion: '',\n        },\n    };\n\n    appVersion = (version as string)?.match(/\\d+\\.\\d+\\.\\d+/)?.[0] || '';\n    return appVersion;\n}\n"],"mappings":"AAAA;AACA,SAASA,YAAT,QAA6B,iBAA7B;AACA,SAASC,aAAT,QAA8B,cAA9B;AAEA,OAAO,MAAMC,KAAK,GAAIC,OAAD,IACjB,IAAIC,OAAJ,CAAmBC,OAAD,IAAaC,UAAU,CAACD,OAAD,EAAUF,OAAV,CAAzC,CADG,C,CAGP;;AACA,OAAO,MAAMI,mBAAmB,GAAIC,GAAD,IAKxB;EAAA;;EACPA,GAAG,CAACC,OAAJ,GAAcD,GAAG,CAACE,SAAJ,GACV,kBAAAF,GAAG,CAACG,QAAJ,gEAAcD,SAAd,KAA2BF,GAAG,CAACE,SAA/B,IAA4CF,GAAG,CAACC,OAAhD,IAA2D,EAD/D;;EAEA,IAAID,GAAG,CAACI,IAAJ,KAAa,cAAjB,EAAiC;IAC7B,OAAOJ,GAAP;EACH,CALM,CAMP;;;EACA,IAAI;IACA,IAAIK,OAAO,GAAGL,GAAG,CAACC,OAAJ,CAAYK,MAAZ,CAAmBN,GAAG,CAACC,OAAJ,CAAYM,OAAZ,CAAoB,OAApB,IAA+B,CAAlD,CAAd;IACAF,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe,CAAf,EAAkBD,OAAO,CAACE,OAAR,CAAgB,GAAhB,CAAlB,CAAV;IACAP,GAAG,CAACI,IAAJ,GAAWC,OAAX;EACH,CAJD,CAIE,OAAOG,CAAP,EAAU;IACR,IAAIC,OAAJ,EAAa;MACTC,OAAO,CAACC,IAAR,CAAa,uBAAb,EAAsCX,GAAtC;IACH;EACJ;;EACD,OAAOA,GAAP;AACH,CAtBM;AAwBP,OAAO,MAAMY,YAAY,GAAIC,MAAD,IAAiB;EACzC,IACIJ,OAAO,IACP,CAACjB,YAAY,CAACsB,OADd,KAEC,CAACD,MAAD,IAAY,OAAOA,MAAP,KAAkB,QAAlB,IAA8B,EAAE,aAAaA,MAAf,CAF3C,CADJ,EAIE;IACEH,OAAO,CAACC,IAAR,CACI,uEADJ;EAGH;;EACD,IAAIE,MAAM,IAAI,IAAd,EAAoB;IAChB,OAAO,EAAP;EACH;;EACD,IACI,OAAOA,MAAP,KAAkB,QAAlB,IACA,EAAE,aAAaA,MAAf,CADA,IAEArB,YAAY,CAACsB,OAAb,IAAwB,IAH5B,EAIE;IACED,MAAM,CAACC,OAAP,GAAiBtB,YAAY,CAACsB,OAA9B;EACH;;EACD,OAAOC,IAAI,CAACC,SAAL,CAAeH,MAAf,CAAP;AACH,CArBM;AAuBP,OAAO,MAAMI,eAAe,GAAIC,IAAD,IAAkB;EAC7C,OAAOA,IAAI,CAACC,OAAL,CAAa,QAAb,EAAuB,MAAvB,CAAP;AACH,CAFM;AAIP,OAAO,SAASC,YAAT,GAAwB;EAC3B,IAAIC,CAAC,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAR;;EACA,IACI,OAAOC,WAAP,KAAuB,WAAvB,IACA;EACA,OAAOA,WAAW,CAACC,GAAnB,KAA2B,UAH/B,EAIE;IACE;IACAJ,CAAC,IAAIG,WAAW,CAACC,GAAZ,EAAL,CAFF,CAE0B;EAC3B;;EACD,IAAIC,OAAO,GAAG,sCAAd;EACA,OAAOA,OAAO,CAACP,OAAR,CAAgB,OAAhB,EAAyB,UAAUQ,CAAV,EAAa;IACzC;IACA,IAAIC,CAAC,GAAG,CAACP,CAAC,GAAGQ,IAAI,CAACC,MAAL,KAAgB,EAArB,IAA2B,EAA3B,GAAgC,CAAxC;IACAT,CAAC,GAAGQ,IAAI,CAACE,KAAL,CAAWV,CAAC,GAAG,EAAf,CAAJ,CAHyC,CAIzC;;IACA,OAAO,CAACM,CAAC,KAAK,GAAN,GAAYC,CAAZ,GAAiBA,CAAC,GAAG,GAAL,GAAY,GAA7B,EAAkCI,QAAlC,CAA2C,EAA3C,CAAP;EACH,CANM,CAAP;AAOH;AAGD,WAAYC,SAAZ;AAMA;AACA;AACA;AACA;AACA;AACA;;WAXYA,S;EAAAA,S,CAAAA,S;EAAAA,S,CAAAA,S;EAAAA,S,CAAAA,S;GAAAA,S,KAAAA,S;;AAYZ,OAAO,SAASC,cAAT,CAAwBC,OAAxB,EAA0CC,KAA1C,EAAqE;EACxE,MAAMC,EAAE,GAAGC,MAAM,CAACH,OAAD,CAAN,CAAgBI,KAAhB,CAAsB,GAAtB,CAAX;EACA,MAAMC,EAAE,GAAGF,MAAM,CAACF,KAAD,CAAN,CAAcG,KAAd,CAAoB,GAApB,CAAX;;EACA,KAAK,IAAIE,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGZ,IAAI,CAACa,GAAL,CAASL,EAAE,CAACM,MAAZ,EAAoBH,EAAE,CAACG,MAAvB,CAA5B,EAA4DF,KAAK,EAAjE,EAAqE;IACjE,MAAMG,EAAE,GAAGC,MAAM,CAACR,EAAE,CAACI,KAAD,CAAH,CAAjB;IACA,MAAMK,EAAE,GAAGD,MAAM,CAACL,EAAE,CAACC,KAAD,CAAH,CAAjB;;IACA,IAAIG,EAAE,GAAGE,EAAT,EAAa;MACT,OAAOb,SAAS,CAACc,WAAjB;IACH;;IACD,IAAID,EAAE,GAAGF,EAAT,EAAa;MACT,OAAOX,SAAS,CAACe,QAAjB;IACH;;IACD,IAAI,CAACC,KAAK,CAACL,EAAD,CAAN,IAAcK,KAAK,CAACH,EAAD,CAAvB,EAA6B;MACzB,OAAOb,SAAS,CAACc,WAAjB;IACH;;IACD,IAAIE,KAAK,CAACL,EAAD,CAAL,IAAa,CAACK,KAAK,CAACH,EAAD,CAAvB,EAA6B;MACzB,OAAOb,SAAS,CAACe,QAAjB;IACH;EACJ;;EACD,OAAOf,SAAS,CAACiB,OAAjB;AACH;AAED,IAAIC,UAAU,GAAG,EAAjB;AACA,OAAO,SAASC,aAAT,GAAyB;EAAA;;EAC5B,IAAID,UAAJ,EAAgB;IACZ,OAAOA,UAAP;EACH;;EACD,MAAM;IACFE,IAAI,EAAE;MAAEF,UAAU,EAAEG;IAAd;EADJ,IAEF,0BAAA7D,aAAa,CAAC8D,QAAd,0GAAwBC,iBAAxB,kHAAiD;IACjDH,IAAI,EAAE;MACFF,UAAU,EAAE;IADV;EAD2C,CAFrD;EAQAA,UAAU,GAAG,CAACG,OAAD,aAACA,OAAD,iCAACA,OAAD,CAAqBG,KAArB,CAA2B,eAA3B,mDAA8C,CAA9C,MAAoD,EAAjE;EACA,OAAON,UAAP;AACH"}