{"version":3,"names":["BridgeError","callbackOnlyBridgeSet","globalConfig","dealRejectErrorInfo","delay","generateUUID","normalParams","normalNamespace","getAppVersion","versionCompare","VersionIs","BatchedBridge","NativeModules","Platform","getKswitchData","loadUri","getSlideBack","setSlideBack","exitPageWithInfo","callbacks","Map","KdsCallback","callback","callbackId","result","get","registerCallableModule","getInvocationConfig","args","bridge","params","optionsOrCallback","options","initialBridge","invoke","config","timeout","namespace","method","split","OS","url","startsWith","appVersion","LessThan","JSON","parse","has","set","data","isSetSerializer","serializer","Kds","invokeWithArgs","rootTag","nameSpace","multiCallback","callbackType","undefined","invokeWithMultiCallback","baseInvoking","Promise","resolve","reject","baseInvokingSuccessHandle","stringify","error_msg","message","restData","baseInvokingFailHandle","err","then","res","invoking","Number","isFinite","race","invokeSync","unSupported","syncInvokeWithReturnStr","syncInvoke","supportedNamespaces","supportedMethodNames","system","platform","tool","social","indexOf","resultOrError","withReturnStrResultOrErrorString","code","errorCode","errorMsg"],"sources":["invoke.ts"],"sourcesContent":["import { BridgeError } from './bridge-error';\nimport { callbackOnlyBridgeSet } from './constants';\nimport { globalConfig } from './global-config';\nimport type {\n    YodaBridges,\n    InvocationParameters,\n    InvocationPromise,\n    InvocationOptions,\n    InvocationConfig,\n    InvocationBridgeNamespace,\n    InvocationBridgeName,\n    YodaSupportSyncBridges,\n    InvocationResponse,\n    InvocationParams,\n} from './types';\nimport {\n    dealRejectErrorInfo,\n    delay,\n    generateUUID,\n    normalParams,\n    normalNamespace,\n    getAppVersion,\n    versionCompare,\n    VersionIs,\n} from './utils';\nimport BatchedBridge from 'react-native/Libraries/BatchedBridge/BatchedBridge';\nimport { NativeModules, Platform } from 'react-native';\nimport getKswitchData from './legency/get-kswitch-data';\nimport loadUri from './legency/load-uri';\nimport getSlideBack from './legency/get-slide-back';\nimport setSlideBack from './legency/set-slide-back';\nimport exitPageWithInfo from './legency/exit-page-with-info';\n\n// 支持多次callback回调的简单实现\nconst callbacks = new Map();\nconst KdsCallback = {\n    callback(callbackId: String, result: any) {\n        let callback = callbacks.get(callbackId);\n        if (callback) {\n            callback(result);\n        }\n    },\n};\nBatchedBridge.registerCallableModule('KdsCallback', KdsCallback);\n\nconst getInvocationConfig = <T extends keyof YodaBridges>(\n    args: InvocationParameters<T>,\n) => {\n    const [bridge, params = {}, optionsOrCallback] = args;\n    const [options, callback] =\n        typeof optionsOrCallback === 'function'\n            ? [{} as InvocationOptions, optionsOrCallback]\n            : [optionsOrCallback ?? {}];\n\n    return {\n        initialBridge: bridge,\n        bridge,\n        params,\n        options,\n        callback,\n    } as InvocationConfig<T>;\n};\n\nexport const invoke = <T extends keyof YodaBridges>(\n    ...args: InvocationParameters<T>\n): InvocationPromise<T> => {\n    const config = getInvocationConfig(args);\n    const {\n        bridge,\n        params,\n        callback,\n        options: { timeout = globalConfig.timeout ?? 0 },\n    } = config;\n    const [namespace, method] = bridge.split('.') as [\n        InvocationBridgeNamespace<T>,\n        InvocationBridgeName<T>,\n    ];\n\n    // 基于 10.5.10 之前版本 如果url 以 market://开头 调用NativeModules.KRNBasic.open方法.\n    // https://team.corp.kuaishou.com/task/T2502723\n    if (\n        method === 'loadUri' &&\n        namespace === 'platform' &&\n        Platform.OS === 'android' &&\n        (params as InvocationParams<'platform.loadUri'>)?.url?.startsWith(\n            'market://',\n        )\n    ) {\n        const appVersion = getAppVersion();\n        if (versionCompare(appVersion, '10.5.20') === VersionIs.LessThan) {\n            return loadUri(params as any);\n        }\n    }\n\n    // @ts-ignore 类型声明中暂时没有这个 bridge\n    if (method === 'getSlideBack' && namespace === 'tool') {\n        return getSlideBack(JSON.parse(normalParams(params || {})));\n    }\n    // @ts-ignore 类型声明中暂时没有这个 bridge\n    if (method === 'setSlideBack' && namespace === 'tool') {\n        return setSlideBack(JSON.parse(normalParams(params || {})));\n    }\n\n    // https://team.corp.kuaishou.com/task/T3494368\n    if (method === 'exitPageWithInfo' && namespace === 'ui') {\n        return exitPageWithInfo(JSON.parse(normalParams(params || {})));\n    }\n\n    if (callbackOnlyBridgeSet.has(bridge)) {\n        // 只支持多次回调的 bridge，需要注册 callbackId\n        const callbackId = generateUUID();\n        callbacks.set(callbackId, (result: any) => {\n            const data = globalConfig.isSetSerializer\n                ? globalConfig.serializer.parse(result)\n                : result;\n            callback?.(data);\n        });\n        if (globalConfig.isSetSerializer && NativeModules.Kds?.invokeWithArgs) {\n            NativeModules.Kds.invokeWithArgs({\n                rootTag: params?.rootTag || globalConfig.rootTag,\n                nameSpace: normalNamespace(namespace),\n                method,\n                params: normalParams(params),\n                callbackId,\n                multiCallback: true,\n                callbackType: 'str',\n            });\n            return undefined;\n        }\n        NativeModules.Kds.invokeWithMultiCallback(\n            normalNamespace(namespace),\n            method,\n            normalParams(params),\n            callbackId,\n        );\n        return undefined;\n    }\n\n    const baseInvoking = new Promise((resolve, reject) => {\n        const baseInvokingSuccessHandle = (data: any) => {\n            // 返回的结果中如果有 result 字段时且不为 1，则按照错误处理，进入 reject\n            if (\n                data &&\n                'result' in data &&\n                typeof data.result === 'number' &&\n                data.result !== 1\n            ) {\n                reject(\n                    new BridgeError(\n                        `bridge：${bridge} 调用出错，调用参数为：${JSON.stringify(\n                            params,\n                        )}，错误信息为：${\n                            data.error_msg || data.message || ''\n                        }`,\n                        data.result,\n                        {\n                            bridge,\n                            params,\n                        },\n                    ),\n                );\n                return;\n            }\n            if (data && data.result === 1) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                const { result, ...restData } = data;\n                resolve(restData);\n                return;\n            }\n            resolve(data);\n        };\n        const baseInvokingFailHandle = (err: any) => {\n            reject(dealRejectErrorInfo(err));\n        };\n        if (globalConfig.isSetSerializer && NativeModules.Kds?.invokeWithArgs) {\n            NativeModules.Kds.invokeWithArgs({\n                rootTag: params?.rootTag || globalConfig.rootTag,\n                nameSpace: normalNamespace(namespace),\n                method,\n                params: normalParams(params),\n                callbackType: 'str',\n            }).then((res: any) => {\n                const data = globalConfig.serializer.parse(res);\n                baseInvokingSuccessHandle(data);\n            }, baseInvokingFailHandle);\n            return;\n        }\n        NativeModules.Kds.invoke(\n            normalNamespace(namespace),\n            method,\n            normalParams(params),\n        ).then(baseInvokingSuccessHandle, baseInvokingFailHandle);\n    }) as InvocationPromise<T>;\n\n    const invoking =\n        timeout > 0 && Number.isFinite(timeout)\n            ? Promise.race([\n                  baseInvoking,\n                  delay(timeout).then(() =>\n                      Promise.reject(\n                          new BridgeError('timeout', 125010, {\n                              bridge,\n                              params: config.params,\n                          }),\n                      ),\n                  ),\n              ])\n            : baseInvoking;\n\n    return invoking;\n};\n\nexport const invokeSync = <T extends keyof YodaSupportSyncBridges>(\n    ...args: InvocationParameters<T>\n): InvocationResponse<T> => {\n    const config = getInvocationConfig(args);\n    const { bridge, params } = config;\n\n    const unSupported = globalConfig.isSetSerializer\n        ? !NativeModules.Kds?.syncInvokeWithReturnStr\n        : !NativeModules.Kds?.syncInvoke;\n    if (unSupported) {\n        throw new BridgeError('当前客户端版本不支持同步调用', -1, {\n            bridge,\n            params,\n        });\n    }\n\n    const [namespace, method] = bridge.split('.') as [\n        InvocationBridgeNamespace<T>,\n        InvocationBridgeName<T>,\n    ];\n\n    // 修改支持同步调用的列表时，请先修改 api/index.ts 下面的 SupportSyncAPI 和 SupportSyncAPIMethodName\n    const supportedNamespaces = [\n        'platform' as const,\n        'system' as const,\n        'tool' as const,\n        'social' as const,\n    ];\n    const supportedMethodNames = {\n        system: [\n            'isNetworkConnected',\n            'getServerTime',\n            'isBottomNavigationBarShown',\n            'getNetworkType',\n            'getPushPermission',\n            'isPad',\n            'getDisplaySetting',\n            'getNavigationBarHeight',\n            'deviceIsLandscape',\n        ],\n        platform: ['getDarkMode'],\n        tool: [\n            'getClipBoard',\n            'getKswitchData',\n            'canIUse',\n            'getABTestInfo',\n            'getStartUpData',\n        ],\n        social: [\n            'getNoticeRecoTextSync',\n            'getPymkRecoTextSync',\n            'getRemarkNameSync',\n            'getSocialMultiStringLangsSync',\n        ],\n    };\n    // 不支持的命名空间\n    if (supportedNamespaces.indexOf(namespace) === -1) {\n        throw new BridgeError(`${namespace} 命名空间不支持同步调用`, -1, {\n            bridge,\n            params,\n        });\n    }\n    // 不支持的方法名\n    if (supportedMethodNames[namespace].indexOf(method as any) === -1) {\n        throw new BridgeError(\n            `${namespace} 命名空间的 ${method} 方法不支持同步调用`,\n            -1,\n            {\n                bridge,\n                params,\n            },\n        );\n    }\n\n    // 如果调用 tool.getKswitchData，在 10.4.40 之前使用 NativeModules.SwitchBridge.getKswitchDataSync 调用\n    if (method === 'getKswitchData' && namespace === 'tool') {\n        const appVersion = getAppVersion();\n        if (versionCompare(appVersion, '10.4.40') === VersionIs.LessThan) {\n            return getKswitchData(params as any);\n        }\n    }\n    let resultOrError;\n    // 如果自定义了 serializer 就走新方法\n    if (globalConfig.isSetSerializer) {\n        const withReturnStrResultOrErrorString =\n            NativeModules.Kds.syncInvokeWithReturnStr({\n                rootTag: params?.rootTag || globalConfig.rootTag,\n                nameSpace: normalNamespace(namespace),\n                method,\n                params: normalParams(params),\n                callbackType: 'str',\n            });\n        resultOrError = globalConfig.serializer.parse(\n            withReturnStrResultOrErrorString,\n        );\n    } else {\n        // 否则走旧方法\n        resultOrError = NativeModules.Kds.syncInvoke({\n            nameSpace: normalNamespace(namespace),\n            method,\n            params: normalParams(params),\n        });\n    }\n    if (resultOrError && 'errorCode' in resultOrError) {\n        resultOrError.code = resultOrError.errorCode;\n        resultOrError.message = resultOrError.errorMsg;\n        // 删除掉原来的错误码及错误信息字段\n        delete resultOrError.errorCode;\n        delete resultOrError.errorMsg;\n\n        throw dealRejectErrorInfo(resultOrError);\n    }\n    return resultOrError;\n};\n"],"mappings":"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"}