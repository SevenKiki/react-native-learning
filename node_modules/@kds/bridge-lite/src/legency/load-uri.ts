import type { InvocationParams } from '../types';
import { NativeModules } from 'react-native';

export default (params: InvocationParams<'platform.loadUri'>): any => {
    return new Promise((resolve, reject) => {
        try {
            let timer: any = null!;
            NativeModules.KRNBasic.open(
                params?.url,
                (res: { result: number }) => {
                    clearTimeout(timer);
                    resolve({
                        result: res?.result ?? 0,
                        success: res?.result === 1,
                    });
                },
            );
            timer = setTimeout(() => {
                reject({
                    code: -1,
                    message: 'timeout',
                    success: false,
                });
            }, 5000);
        } catch (err) {
            reject({
                success: false,
                code: -1,
                message: `failed to loadUri: ${err}`,
            });
        }
    });
};
