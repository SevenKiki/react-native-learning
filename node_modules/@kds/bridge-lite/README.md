# @kds/bridge-lite

KRN React Native Library Template

## 安装

```sh
npm install @kds/bridge-lite
```

## 基本使用
```js
import {
    setGlobalConfig,
    invoke,
    invokeSync,
} from '@kds/bridge-lite';
import React, { useEffect } from 'react';

const App = (props: { rootTag: number }) => {
    // 设置全局 rootTag，因为某些 bridge 调用需要 rootTag 参数，为了方便使用，可以在根组件渲染时将传入的 rootTag传递个此方法
    useEffect(() => {
      setGlobalConfig({
          rootTag: props.rootTag,
      });
    }, [props.rootTag]);

    // 正常调用
    invoke('ui.showBottomSheet', {
      title: 'Kds BottomSheet',
      options: [
          { text: '1', value: '1', type: 0 },
          { text: '2', value: '2', type: 0 },
      ],
    })
      .then((res) => {
          console.log('ui.showBottomSheet', res);
      })
      .catch((err) => {
          console.log('ui.showBottomSheet err', err);
      });

    // 同步调用
    const result = invokeSync('tool.getKswitchData', {
        keys: [
            {
                project: undefined,
                key: 'yoda_web_enable_wk_checkBlank',
            },
            {
                project: undefined,
                key: 'yoda_enable_js_file_inject_white_list',
            },
        ],
    });
    console.log(result)
    // ...
};
AppRegistry.registerComponent('demo', () => App);

```

## 处理含 bigInt 类型的返回值
第一步：安装 `json-bigint` 包

```sh
yarn add json-bigint
```

第二步：使用

```js
import {
    setGlobalConfig,
    invoke,
    invokeSync,
} from '@kds/bridge-lite';
import React, { useEffect } from 'react';
import JSONbig from 'json-bigint';


const App = (props: { rootTag: number }) => {
    useEffect(() => {
      setGlobalConfig({
          // 设置全局 rootTag，因为某些 bridge 调用需要 rootTag 参数，为了方便使用，可以在根组件渲染时将传入的 rootTag传递个此方法
          rootTag: props.rootTag,
          // 设置序列化函数处理 bigInt 数据类型问题
          serializer: {
              stringify: JSONbig.stringify,
              parse: JSONbig.parse,
          },
      });
    }, [props.rootTag]);

    // 正常调用
    invoke('namespace.method', params)
      .then((res) => {
          // 这里的 res 若含有 bigInt 数据类型，则会被转换成特殊的 object 类型，以保证精度不丢失
          console.log(res);
      })
      .catch((err) => {
          console.log(err);
      });

    // 同步调用
    const result = invokeSync('namespace.method', params);
    // ...
};
AppRegistry.registerComponent('demo', () => App);

```

## Contributing

See the [contributing guide](CONTRIBUTING.md) to learn how to contribute to the repository and the development workflow.

## License

MIT
