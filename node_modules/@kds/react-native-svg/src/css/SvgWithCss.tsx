import React, { Component } from 'react';
import { XmlProps, XmlState } from '../xml/common';
import parse from '../xml/parse';
import inlineStyles from './inlineStyles';
import { SvgAst } from '../xml/SvgAst';

export class SvgWithCss extends Component<XmlProps, XmlState> {
    state = { ast: null };
    componentDidMount() {
        this.parse(this.props.xml);
    }
    componentDidUpdate(prevProps: { xml: string | null }) {
        const { xml } = this.props;
        if (xml !== prevProps.xml) {
            this.parse(xml);
        }
    }
    parse(xml: string | null) {
        try {
            this.setState({ ast: xml ? parse(xml, inlineStyles) : null });
        } catch (e) {
            console.error(e);
        }
    }
    render() {
        const {
            props,
            state: { ast },
        } = this;
        return <SvgAst ast={ast} override={props.override || props} />;
    }
}

export default SvgWithCss;