import { Platform, PixelRatio } from 'react-native';
import rem from '../rem/index';

const radio = PixelRatio.get() || 1;
const SYSTEM = Platform.OS;

export type Params = {
    url: string;
    originWidth: number;
    originHeight: number;
};

export default function cdnCut({ url, originWidth, originHeight }: Params) {
    if (!url) return '';
    const width = parseInt(String(rem(originWidth) * radio), 10);
    const height = parseInt(String(rem(originHeight || originWidth) * radio), 10);
    let flag = '';
    if (url.indexOf('?') > 0) {
        flag = '&';
    } else {
        flag = '?';
    }
    if (url.indexOf('ali-ad') > -1 || url.indexOf('ali-ec') > -1) {
        return (
            url +
            (`${flag}x-oss-process=image/resize,m_fill,w_${width},h_${height}` +
                (SYSTEM === 'android' ? '/format,webp' : '/format,jpg/interlace,1'))
        );
    }
    if (url.indexOf('tx-ad') > -1 || url.indexOf('tx-ec') > -1) {
        return (
            url +
            (`${flag}imageView2/1/w/${width}/h/${height}` +
                (SYSTEM === 'android' ? '/format/webp' : '/format/jpg/interlace/1'))
        );
    }
    if (url.indexOf('s1.') > -1 || url.indexOf('s2.') > -1) {
        return (
            url + `${flag}x-oss-process=image/resize,w_${width},h_${height},m_lfit,limit_0/auto-orient,0/quality,q_85`
        );
    }
    return url;
}
