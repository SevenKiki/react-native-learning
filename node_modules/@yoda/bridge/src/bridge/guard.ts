const getMultiInstanceError = () =>
    new Error('当前环境存在 Yoda 多实例问题，详细请参考 https://docs.corp.kuaishou.com/k/home/VbQx2ulc6v3M/fcADLOKqHyHpSr7hiCKKQVtVM');

export const setupMultiInstanceGuard = () => {
    let { __yodaBridgeCallback__ } = window;

    if (typeof __yodaBridgeCallback__ === 'function') {
        throw getMultiInstanceError();
    }

    Object.defineProperty(window, '__yodaBridgeCallback__', {
        get() {
            return __yodaBridgeCallback__;
        },
        set(value: typeof __yodaBridgeCallback__) {
            if (__yodaBridgeCallback__) {
                throw getMultiInstanceError();
            }

            __yodaBridgeCallback__ = value;
        },
    });
};
