import { getPlatformVersion, type Platform } from './platform-version';

type System = 'Android' | 'iOS' | 'unknown';

const system = ((): System => {
    if (typeof navigator === 'undefined') {
        return 'unknown';
    }

    const { userAgent, maxTouchPoints } = navigator;

    if (/android/iu.test(userAgent)) {
        return 'Android';
    }

    if (/iPhone|iPad|iPod/u.test(userAgent) || userAgent.includes('Mac') && maxTouchPoints > 1) {
        return 'iOS';
    }

    return 'unknown';
})();

export const isAndroid = system === 'Android';

export const isIOS = system === 'iOS';

export const isYoda = () => typeof window !== 'undefined' && typeof window.__yodaBridge__?.invoke === 'function';

export const isApp = (app: Exclude<Platform, 'Yoda'>): boolean => !!getPlatformVersion(app);

export const isKwaiApp = isApp('Kwai|ksNebula');
