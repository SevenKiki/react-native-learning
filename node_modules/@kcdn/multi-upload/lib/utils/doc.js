const chalk = require('chalk');

/**
 * å‘½ä»¤è¡Œå¸®åŠ©æ–‡æ¡£ï¼Œå½“æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ—¶æç¤ºï¼š
 *     kcdn-upload
 *     kcdn-upload --help æˆ– kcdn-upload -h
 *     kcdn-upload --version æˆ– kcdn-upload -v
 */
exports.initHelpDoc = () => {
  const argv = process.argv || [];
  const hl = (...args) => chalk.cyan(...args);

  const argvList = argv
    .slice(2, argv.length)
    .map(i => i && i.trim())
    .filter(i => i);

  const argvListLen = argvList.length;
  const firstArg = argvList[0];
  if (argvListLen >= 2) return;

  // æ‰“å°ç‰ˆæœ¬
  const isVersionMode = ['-v', '--version'].includes(firstArg);
  if (isVersionMode) {
    const packageJson = require('../package.json');
    const { version } = packageJson || {};
    console.log(version);
    return process.exit(100);
  }

  // å¸®åŠ©æ–‡æ¡£
  const isHelpMode = ['-h', '--help'].includes(firstArg);
  if (isHelpMode) {
    const docUrl = 'https://kcdn2.corp.kuaishou.com/doc/#4_npmbao_shangchuanwenjian__v1'; // æ–‡æ¡£é“¾æ¥
    const projectInfoUrl = 'https://kcdn.corp.kuaishou.com/dashboard/project-info'; // é¡¹ç›®è¯¦æƒ…
    console.log(
      'ğŸ‘‰ ä½¿ç”¨: \n' +
        `kcdn-upload ${hl('<files>')}` +
        ` --cdn-dir=${hl('<ç›®æ ‡CDNè·¯å¾„>')}` +
        ` --pid=${hl('<é¡¹ç›®Pid>')}` +
        ` --token=${hl('<é¡¹ç›®Token>')}` +
        ` --allow-rewrite=${hl('<æ˜¯å¦å¼€å¯åŒåæ›´æ–°>')}` +
        ` --allow-hash=${hl('<æ˜¯å¦æ”¯æŒæ–‡ä»¶åHash>')}` +
        ` --exit-on-api-error=${hl('<æ¥å£é”™è¯¯æ—¶æ˜¯å¦é€€å‡ºè¿›ç¨‹>')}` +
        '\n'
    );

    console.log(
      `ğŸ‘‰ ç¤ºä¾‹ï¼š\n` +
        `kcdn-upload debug-files --cdn-dir=test --pid=test-dzr002 --token=12228_xxx --uid=dengzhirong` +
        `\n`
    );

    console.log(
      `ğŸ‘‰ å‚æ•°è¯´æ˜ï¼š\n` +
        `   ${hl('pid')}: [å¿…å¡«] é¡¹ç›®pidï¼Œåœ¨${projectInfoUrl}é¡µé¢è·å–;\n` +
        `   ${hl('token')}: [å¿…å¡«] é¡¹ç›®tokenï¼Œåœ¨${projectInfoUrl}é¡µé¢è·å–;\n` +
        `   ${hl('cdn-dir')}: [å¿…å¡«] æŒ‡å®šç›®æ ‡çš„CDNè·¯å¾„;\n` +
        `   ${hl('files')}: [å¿…å¡«] æœ¬åœ°æ–‡ä»¶ç›®å½•/æ–‡ä»¶;\n` +
        `   ${hl('uid')}: ä¸Šä¼ ç”¨æˆ·åï¼Œå»ºè®®ä½¿ç”¨å¿«æ‰‹é‚®ç®±å‰ç¼€;\n` +
        `   ${hl('allow-rewrite')}: æ˜¯å¦å¼€å¯åŒåæ–‡ä»¶æ›´æ–°åŠŸèƒ½ã€‚é»˜è®¤å€¼: false;\n` +
        `   ${hl('allow-hash')}: æ˜¯å¦æ”¯æŒæ–‡ä»¶åhashã€‚é»˜è®¤å€¼: false;\n` +
        `   ${hl('exit-on-api-error')}: å½“æ¥å£é”™è¯¯æ—¶æ˜¯å¦é€€å‡ºè¿›ç¨‹ã€‚é»˜è®¤å€¼: unknown;` +
        '\n'
    );

    console.log(`â­ æ›´å¤šæ–‡æ¡£è¯´æ˜è¯·è¯¦çœ‹: ${hl(docUrl)}`);
    return process.exit(100);
  }
};
