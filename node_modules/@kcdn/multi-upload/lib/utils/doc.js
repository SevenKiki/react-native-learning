const chalk = require('chalk');

/**
 * 命令行帮助文档，当执行以下命令时提示：
 *     kcdn-upload
 *     kcdn-upload --help 或 kcdn-upload -h
 *     kcdn-upload --version 或 kcdn-upload -v
 */
exports.initHelpDoc = () => {
  const argv = process.argv || [];
  const hl = (...args) => chalk.cyan(...args);

  const argvList = argv
    .slice(2, argv.length)
    .map(i => i && i.trim())
    .filter(i => i);

  const argvListLen = argvList.length;
  const firstArg = argvList[0];
  if (argvListLen >= 2) return;

  // 打印版本
  const isVersionMode = ['-v', '--version'].includes(firstArg);
  if (isVersionMode) {
    const packageJson = require('../package.json');
    const { version } = packageJson || {};
    console.log(version);
    return process.exit(100);
  }

  // 帮助文档
  const isHelpMode = ['-h', '--help'].includes(firstArg);
  if (isHelpMode) {
    const docUrl = 'https://kcdn2.corp.kuaishou.com/doc/#4_npmbao_shangchuanwenjian__v1'; // 文档链接
    const projectInfoUrl = 'https://kcdn.corp.kuaishou.com/dashboard/project-info'; // 项目详情
    console.log(
      '👉 使用: \n' +
        `kcdn-upload ${hl('<files>')}` +
        ` --cdn-dir=${hl('<目标CDN路径>')}` +
        ` --pid=${hl('<项目Pid>')}` +
        ` --token=${hl('<项目Token>')}` +
        ` --allow-rewrite=${hl('<是否开启同名更新>')}` +
        ` --allow-hash=${hl('<是否支持文件名Hash>')}` +
        ` --exit-on-api-error=${hl('<接口错误时是否退出进程>')}` +
        '\n'
    );

    console.log(
      `👉 示例：\n` +
        `kcdn-upload debug-files --cdn-dir=test --pid=test-dzr002 --token=12228_xxx --uid=dengzhirong` +
        `\n`
    );

    console.log(
      `👉 参数说明：\n` +
        `   ${hl('pid')}: [必填] 项目pid，在${projectInfoUrl}页面获取;\n` +
        `   ${hl('token')}: [必填] 项目token，在${projectInfoUrl}页面获取;\n` +
        `   ${hl('cdn-dir')}: [必填] 指定目标的CDN路径;\n` +
        `   ${hl('files')}: [必填] 本地文件目录/文件;\n` +
        `   ${hl('uid')}: 上传用户名，建议使用快手邮箱前缀;\n` +
        `   ${hl('allow-rewrite')}: 是否开启同名文件更新功能。默认值: false;\n` +
        `   ${hl('allow-hash')}: 是否支持文件名hash。默认值: false;\n` +
        `   ${hl('exit-on-api-error')}: 当接口错误时是否退出进程。默认值: unknown;` +
        '\n'
    );

    console.log(`⭐ 更多文档说明请详看: ${hl(docUrl)}`);
    return process.exit(100);
  }
};
