"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const pkgInfo_1 = require("./utils/pkgInfo");
const report_1 = require("./utils/report");
const util_1 = require("./utils/util");
// const packageInfo = require('../package.json')
const prepareHandler = () => {
    var _a;
    const pkgInfo = (0, pkgInfo_1.getPkgInfo)();
    /**
     * 获取上报工程信息
     */
    if (!pkgInfo) {
        (0, util_1.log)('get package json failed');
        return;
    }
    /**
     * 根据环境变量 and 上报工程package.json中
     * disableReport 开关进行上报控制
     */
    if (((_a = process === null || process === void 0 ? void 0 : process.env) === null || _a === void 0 ? void 0 : _a.disableReport) || pkgInfo.disableReport) {
        (0, util_1.log)('report disable, user set "disableReport" in env, or "package.json" include the "disableReport" config');
        return;
    }
    // if (!pkgInfo.scripts) {
    //   pkgInfo.scripts = {}
    // }
    (0, util_1.debug)('report start running...');
    (0, report_1.report)(pkgInfo);
};
prepareHandler();
