/**
 *
 * @param krnUrl krn 链接
 * @param rootProps rootProps
 * @param source 来源 预留参数
 * @returns 给客户端rn链接拼接参数返回url
 */

export interface rootPropsParamsDTO {
    businessHalfScreen: boolean;
    heightratio: number;
};

export default (krnUrl: string, rootProps: rootPropsParamsDTO, source?: string) => {
    // 前置params
    const preParams = ['bundledId', 'componentName'];
    // 拼接参数
    const addParams = Object.entries({
        businessHalfScreen: rootProps?.businessHalfScreen,
        heightratio: rootProps?.heightratio,
    });
    // 切割url
    const URL = krnUrl.split(/\?(.+)/);
    const params =
        URL?.[1]
            ?.split('&')
            ?.reduce((prev, next) => {
                if (preParams.length === 0 && addParams.length > 0) {
                    const param = addParams.shift();
                    prev.push(`${param[0]}=${param[1]}`);
                } else {
                    const index = preParams.indexOf(next.split('=')[0]);
                    if (index > -1) {
                        preParams.splice(index, 1);
                    }
                    prev.push(next);
                }
                return prev;
            }, [])
            .join('&') || '';
    return `${URL?.[0]}?${params}`;
};
