/**
 * 去除掉头部和尾部无用的'\n'
 * 用于格式化传入的带'\n'的字符串
 * @param str {string} 操作的字符
 * @return {Array}
 */
export function newLineFormat(str: string) {
    if (!str) {
        return [];
    }
    const arr = str.split(/\n/);
    const result = arr.filter((item) => {
        return item;
    });
    return result;
}

const transformTimeYear = (timestamp: number) => {
    if (timestamp) {
        const time = new Date(timestamp);
        const y = time.getFullYear();
        const M = time.getMonth() + 1;
        const d = time.getDate();
        return y + '年' + M + '月' + d + '日';
    }
    return '';
};
const transformTimeMonth = (timestamp: number) => {
    if (timestamp) {
        const time = new Date(timestamp);
        const M = time.getMonth() + 1;
        const d = time.getDate();
        return M + '月' + d + '日';
    }
    return '';
};

/**
 *
 * @param time 时间戳
 * 1、不是本年，直接展示时间
 * 2、大于两个月，直接展示 月/ 天
 * 3、大于一个月，且大于七天展示 年/月/日
 * 4、小于 7 填，展示 n 天前
 * @return string
 */
export const formatTimeToDays = (time: number): string => {
    if (!time) {
        return '';
    }
    const nowTime = new Date();
    const formatTime = new Date(time);
    // 判断不是本年，直接展示时间
    const nY = nowTime.getFullYear();
    const fY = formatTime.getFullYear();
    if (nY !== fY) {
        return transformTimeYear(time);
    }
    // 判断是否同一个月，大于两个月，直接展示 月/ 天  大于一个月，再判断是否大于七天
    const nM = nowTime.getMonth() + 1;
    const fM = formatTime.getMonth() + 1;
    const nd = nowTime.getUTCDate();
    const fd = formatTime.getUTCDate();

    if (nM !== fM) {
        if (nM - fM > 1) {
            return transformTimeMonth(time);
        }
        if (nM - fM === 1) {
            // 上个月最后一天
            const lastDay = formatTime.setDate(0);
            const difference = lastDay - fd + nd;
            if (difference > 7) {
                return transformTimeMonth(time);
            }
        }
    }
    if (nd - fd > 7) {
        return transformTimeMonth(time);
    }

    if (nd === fd) {
        return '今天';
    }
    // 同一个月，判断同一天  差一天   差两天  差三天 ...
    return nd - fd + '天前';
};
