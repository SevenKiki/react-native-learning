{"version":3,"names":["useSafeMemo","factory","deps","value","oldDeps","current","length","some","dep","index"],"sources":["index.tsx"],"sourcesContent":["import type { DependencyList } from 'react';\nimport { useRef } from 'react';\n\n/** useMemo 的安全版本\n *\n * 仅在需要**确保** memo 值在 deps 未发生变化时，factory 不会重新执行的情况下使用。\n * 其他情况还是正常使用原始的 useMemo 即可。\n *\n * Why?\n *\n * useMemo 可以作为优化手段，它返回一个“记忆值”，仅在 deps 发生变化时，才会重新计算新的数据。\n *\n * 但是官方文档中说：\n * **You may rely on useMemo as a performance optimization, not as a semantic guarantee.**\n * In the future, React may choose to “forget” some previously memoized values and recalculate them on next render,\n * e.g. to free memory for offscreen components.\n * Write your code so that it still works without useMemo — and then add it to optimize performance.\n *\n * 所以，在某些条件下，即便 deps 未发生变化，useMemo 也可能会选择性的“忘记”一些数据，并重新计算。\n *\n * useSafeMemo 使用 useRef 来记忆旧值，并且没有实现任何“忘记”逻辑，以此来防数据的重新计算。\n */\nconst useSafeMemo = <T,>(factory: () => T, deps?: DependencyList): T => {\n    const value = useRef<T>();\n    const oldDeps = useRef<DependencyList>();\n\n    if (\n        !(oldDeps.current && deps) ||\n        oldDeps.current.length !== deps.length ||\n        oldDeps.current.some((dep, index) => dep !== deps[index])\n    ) {\n        oldDeps.current = deps;\n        value.current = factory();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return value.current!;\n};\n\nexport default useSafeMemo;\n"],"mappings":";;;;;;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,WAAW,GAAG,CAAKC,OAAL,EAAuBC,IAAvB,KAAoD;EACpE,MAAMC,KAAK,GAAG,oBAAd;EACA,MAAMC,OAAO,GAAG,oBAAhB;;EAEA,IACI,EAAEA,OAAO,CAACC,OAAR,IAAmBH,IAArB,KACAE,OAAO,CAACC,OAAR,CAAgBC,MAAhB,KAA2BJ,IAAI,CAACI,MADhC,IAEAF,OAAO,CAACC,OAAR,CAAgBE,IAAhB,CAAqB,CAACC,GAAD,EAAMC,KAAN,KAAgBD,GAAG,KAAKN,IAAI,CAACO,KAAD,CAAjD,CAHJ,EAIE;IACEL,OAAO,CAACC,OAAR,GAAkBH,IAAlB;IACAC,KAAK,CAACE,OAAN,GAAgBJ,OAAO,EAAvB;EACH,CAXmE,CAapE;;;EACA,OAAOE,KAAK,CAACE,OAAb;AACH,CAfD;;eAiBeL,W"}