import { useRef } from 'react';

/**
 * 处理列表item被加载的逻辑，一般用于item展现的打点上报，只会上报一次
 *
 * @param idProvider    获取id的方法
 * @param func          执行的方法
 * @returns             列表item被加载的回调引用
 */
export default function useFeedMount<T>(
    idProvider: (item: T) => string,
    func: (feed: T, index: number) => void,
) {
    const itemShowedMap = useRef(new Map<string, boolean>()).current;
    return useRef((item: T, index: number) => {
        const id = idProvider(item);
        if (!itemShowedMap.get(id)) {
            itemShowedMap.set(id, true);
            func(item, index);
        }
    }).current;
}
