import { useState, useEffect } from 'react';
import { NativeModules } from 'react-native';

interface IABParams {
    /** 字段key, AB平台上申请的key */
    key: string;
    /** 仅Android，目前只支持: string、numner、boolean */
    type?: string;
}

/**
 * 获取AB信息
 * https://kds.corp.kuaishou.com/kds-react/api/000-BridgeCenterAPIS.html?platform=krn&namespace=tool&name=getABTestInfo
 */
const getABTestInfo = async (params: IABParams) => {
    try {
        const result = await NativeModules.Kds.invoke(
            'tool',
            'getABTestInfo',
            JSON.stringify({
                ...params,
            }),
        );
        return result?.value;
    } catch (err) {
        console.warn(err);
        return '';
    }
};

/**
 * AB实验hooks，需要传入实验参数名
 * 参数名查找方法：实验管理->实验详情->分组参数设置->参数设置中的key
 * @param { string } key 实验参数名
 * @param { string } type 返回值类型，支持'string' | 'bool' | 'int'，默认'bool'
 * @returns { boolean }
 */
const useABTest = (key: string, type: 'string' | 'bool' | 'int' = 'bool') => {
    const [abResult, setABResult] = useState(false);
    const getABResult = async () => {
        const abresult: any = await getABTestInfo({
            key,
            type,
        });
        setABResult(abresult);
    };

    useEffect(() => {
        getABResult();
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    return abResult;
};

export default useABTest;
