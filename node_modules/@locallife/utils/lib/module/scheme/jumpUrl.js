import isString from 'lodash/isString';
import liveBridge from '@krn/live-bridge';
import { NativeModules } from 'react-native';
import { utilsGlobalConfig } from '../globalConfig';
import { LocalLifeInitLogger, LocalLifeUrlLogger } from '@locallife/log';
import { logException } from '../log/logException';
/**
 * 打开某个快链（bottom_sheet半屏、h5、直播）
 * @param url 快链链接
 * @param exceptionCallback 异常时的回调
 * @returns
 */

export function jumpUrl(url, exceptionCallback) {
  if (isString(url)) {
    if (url.startsWith('kwailive')) {
      liveBridge.liveCommon.liveRouter({
        url: url
      });
      return;
    } else {
      if (url.startsWith('http')) {
        url = 'kwai://yodaweb?url=' + encodeURIComponent(url);
      }

      if (!utilsGlobalConfig.rootTag) {
        logException('请在入口先设置setUtilsGlobalConfig');
      }

      NativeModules.Kds.invoke('platform', 'loadUri', JSON.stringify({
        url,
        rootTag: utilsGlobalConfig.rootTag
      })).then(() => {}, e => {
        exceptionCallback && exceptionCallback(e);
      }).catch(e => {
        exceptionCallback && exceptionCallback(e);
      });
    }
  }

  const appModel = LocalLifeInitLogger.getAppModel();

  if (appModel) {
    LocalLifeUrlLogger.logUrl('utils_jumpUrl', url, `${appModel.bundleId}_${appModel.componentName}`);
  }
}
//# sourceMappingURL=jumpUrl.js.map