import { LocalLifeInitLogger, LocalLifeUrlLogger } from '@locallife/log';
import { NativeModules, Platform } from 'react-native';
import { jumpUrl, logException } from '..';
/**
 * 用来打开小程序
 * @param url 小程序快链
 * @param bundleId 打开小程序的bundleId
 * @param exceptionCallback 异常时的回调
 */

export function openMiniApplet(url, exceptionCallback) {
  const data = {
    action: 'start',
    data: {
      url
    }
  };
  NativeModules.Kds.invoke('mini', 'startMini', JSON.stringify(data)).then(data => {
    console.log('启动小程序成功=>', data);
  }).catch(e => {
    exceptionCallback && exceptionCallback(e);

    if (Platform.OS === 'ios' && (e === null || e === void 0 ? void 0 : e.code) === -1) {
      logException('启动小程序失败code=-1=>', e);
    } else {
      logException('小程序打开失败', JSON.stringify(e));
      jumpUrl(url, exceptionCallback);
    }
  });
  const appModel = LocalLifeInitLogger.getAppModel();

  if (appModel) {
    LocalLifeUrlLogger.logUrl('utils_openMiniApplet', url, `${appModel.bundleId}_${appModel.componentName}`);
  }
}
//# sourceMappingURL=openMiniApplet.js.map