import { Interceptor, InterceptorModel } from '@locallife/base-request';
import {
    REQUEST_PATH,
    REQUEST_START,
    RequestRubas,
} from '../../util/RequestRubas';

export default class RequestTimeCostInterceptor extends Interceptor {
    proceed(): (model: InterceptorModel) => Promise<InterceptorModel> {
        return function (model: InterceptorModel) {
            RequestRubas.setDimension(
                REQUEST_PATH,
                model.requestParams?.url ?? '',
            );
            RequestRubas.publish(REQUEST_START);
            return Promise.resolve({
                ...model,
                extra: { ...model.extra, sysTimeRequestStart: Date.now() },
            });
        };
    }
}
