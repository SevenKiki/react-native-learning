{"version":3,"names":["LocalLifeKrnBaseLogger","Weblog","constructor","options","weblogExtraInfo","baseInfo","useRadar","biz","pageMap","appModel","LocalLifeFmpLogger","handleT2","handleT3","sessionId","bundleId","componentName","bundleVersionCode","bundleVersion","radar","RadarKrn","weblog","LocalLifeInitLogger","initWithAppModel","pvEventOptions","params","setBizInfo","pv","handleT1","that","LocalLifeTaskLogger","setTaskLogFn","name","extra_info","other","event","sendLog","key","value","setErrorLogFn","error","update","url","referUrl","commonPackage","updateCurrentUrlPackage","updateReferUrlPackage","Object","keys","length","updateCommonPackage","type","sendImmediately","option","localLifeBizLogger","pageShow","show","action","contentPackage","click","err","captureException","task","isAsync","maxLifeTimeBetweenSteps","asyncTask","krnLogger","LocalLifeKrnLogger","args"],"sources":["index.ts"],"sourcesContent":["/* eslint-disable camelcase */\nimport { Weblog } from '@ks/weblogger/lib/log.krnbridge';\nimport RadarKrn from '@ks-radar/radar/krn';\nimport LoggerError from '../types';\nimport LocalLifeTaskLogger from '../LocalLifeTaskLogger';\nimport LocalLifeFmpLogger from '../LocalLifeFmpLogger';\nimport { localLifeBizLogger } from '../LocalLifeBizLogger';\nimport LocalLifeInitLogger, { _IAppInitProps } from '../LocalLifeInitLogger';\n\ninterface Options extends _IAppInitProps {\n    /** 是否启用radar，默认启用 */\n    useRadar?: boolean;\n    /** 业务标识，默认'LOCALLIFE' */\n    biz?: string;\n    /** 获取PV参数 */\n    pageMap?: any;\n    /** 其他 */\n    [key: string]: any;\n}\n\nexport class LocalLifeKrnBaseLogger extends Weblog {\n    radar = null;\n\n    /**\n     * @param options 基本配置参数\n     * @param weblogExtraInfo 补充配置参数，将会与基本配置完成weblogger的初始化\n     * @param baseInfo 埋点基础信息配置\n     */\n    constructor(options: Options, weblogExtraInfo = {}, baseInfo) {\n        let {\n            useRadar = true,\n            biz = 'LOCALLIFE',\n            pageMap,\n            ...appModel\n        } = options;\n\n        // weblogger实例\n        super(\n            {\n                biz,\n                ...weblogExtraInfo,\n            },\n            baseInfo,\n        );\n\n        //radar\n        if (useRadar) {\n            const {\n                sessionId,\n                bundleId,\n                componentName,\n                bundleVersionCode,\n                bundleVersion,\n            } = appModel;\n            this.radar = new RadarKrn({\n                weblog: this,\n                sessionId,\n                bundleId,\n                componentName,\n                bundleVersionCode,\n                bundleVersion,\n            });\n        }\n\n        // init appModel\n        LocalLifeInitLogger.initWithAppModel(appModel, this);\n        // 取链接参数及PV参数\n        const pvEventOptions = pageMap(pageMap({ params: appModel }));\n        LocalLifeInitLogger.setBizInfo(pvEventOptions);\n\n        // 自动上报PV\n        this.pv();\n\n        // 自动上报T1 白屏时间\n        LocalLifeFmpLogger.handleT1();\n\n        // 榜单task所需打点事件\n        const that = this;\n        LocalLifeTaskLogger.setTaskLogFn(\n            this.radar\n                ? ({ name, extra_info, ...other }) =>\n                      that.radar.event({ name, extra_info, ...other })\n                : ({ name, extra_info, ...other }) =>\n                      that.sendLog('CUSTOM_EVENT', {\n                          biz,\n                          key: name,\n                          value: { extra_info, ...other },\n                      }),\n        );\n        LocalLifeTaskLogger.setErrorLogFn(this.error);\n    }\n\n    // 第一次接口上报时间(T2)\n    handleT2 = LocalLifeFmpLogger.handleT2;\n\n    // 首屏时间（T3）\n    handleT3 = LocalLifeFmpLogger.handleT3;\n\n    // 更新上报信息\n    update({ url, referUrl, ...commonPackage }) {\n        url && this.updateCurrentUrlPackage(url);\n        referUrl && this.updateReferUrlPackage(referUrl);\n        if (Object.keys(commonPackage).length) {\n            this.updateCommonPackage(commonPackage);\n        }\n    }\n\n    // 发埋点\n    private sendLog(type: any, options: any) {\n        this.sendImmediately(type, options);\n    }\n\n    // 页面PV事件用这个\n    pv(option = {}) {\n        localLifeBizLogger.pageShow(option);\n    }\n\n    // 元素SHOW事件用这个\n    show({ action, params, contentPackage, ...other }: any) {\n        localLifeBizLogger.show(action, params, contentPackage, other);\n    }\n\n    // 点击事件用这个\n    click({ action, params, contentPackage, ...other }: any) {\n        localLifeBizLogger.click(action, params, contentPackage, other);\n    }\n\n    error(err: Error | LoggerError | string) {\n        this.radar?.captureException?.(err);\n    }\n\n    /**\n     * options第一层可包含status，若options.extra_info无status字段，外层status字段将会包含在options.extra_info进行埋点发送\n     * @param options: {name: string, extra_info: any, status?: string, ...other}\n     * @param isAsync\n     * @param maxLifeTimeBetweenSteps 如果异步，两次任务之间最大保留时间，默认30s\n     * @returns\n     */\n    task(options, isAsync?: boolean, maxLifeTimeBetweenSteps?: number) {\n        return LocalLifeTaskLogger.task(\n            options,\n            isAsync,\n            maxLifeTimeBetweenSteps,\n        );\n    }\n\n    asyncTask(options, maxLifeTimeBetweenSteps?: number) {\n        return this.task(options, true, maxLifeTimeBetweenSteps);\n    }\n}\n\nlet krnLogger: LocalLifeKrnBaseLogger;\n/**\n * bizLogger/fmpLogger/taskLogger的功能集成版\n * bizLogger需业务方手动进行weblogger实例化传入initLogger，方可进行click等埋点上报。weblogger示例由使用方自行管理。\n * KrnLogger无需提前weblogger实例化，传入appProps即可（若页面需要指定PV参数，需传入pageMap）。将会返回logger实例单例，使用实例对象函数进行埋点上报。\n * 默认开启雷达，默认上报T1。\n * 普通打点bizLogger上报为weblogger的后台任务的任务事件，KrnLogger上报至radar\n */\nexport default function LocalLifeKrnLogger(...args: [Options?, any?, any?]) {\n    return krnLogger || (krnLogger = new LocalLifeKrnBaseLogger(...args));\n}\n"],"mappings":";;;;;;;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;;;;;AAaO,MAAMA,sBAAN,SAAqCC,WAArC,CAA4C;EAG/C;AACJ;AACA;AACA;AACA;EACIC,WAAW,CAACC,OAAD,EAAmD;IAAA,IAAhCC,eAAgC,uEAAd,EAAc;IAAA,IAAVC,QAAU;IAC1D,IAAI;MACAC,QAAQ,GAAG,IADX;MAEAC,GAAG,GAAG,WAFN;MAGAC,OAHA;MAIA,GAAGC;IAJH,IAKAN,OALJ,CAD0D,CAQ1D;;IACA,MACI;MACII,GADJ;MAEI,GAAGH;IAFP,CADJ,EAKIC,QALJ,EAT0D,CAiB1D;;IAjB0D,+BAPtD,IAOsD;;IAAA,kCAiEnDK,4BAAmBC,QAjEgC;;IAAA,kCAoEnDD,4BAAmBE,QApEgC;;IAkB1D,IAAIN,QAAJ,EAAc;MACV,MAAM;QACFO,SADE;QAEFC,QAFE;QAGFC,aAHE;QAIFC,iBAJE;QAKFC;MALE,IAMFR,QANJ;MAOA,KAAKS,KAAL,GAAa,IAAIC,YAAJ,CAAa;QACtBC,MAAM,EAAE,IADc;QAEtBP,SAFsB;QAGtBC,QAHsB;QAItBC,aAJsB;QAKtBC,iBALsB;QAMtBC;MANsB,CAAb,CAAb;IAQH,CAlCyD,CAoC1D;;;IACAI,6BAAoBC,gBAApB,CAAqCb,QAArC,EAA+C,IAA/C,EArC0D,CAsC1D;;;IACA,MAAMc,cAAc,GAAGf,OAAO,CAACA,OAAO,CAAC;MAAEgB,MAAM,EAAEf;IAAV,CAAD,CAAR,CAA9B;;IACAY,6BAAoBI,UAApB,CAA+BF,cAA/B,EAxC0D,CA0C1D;;;IACA,KAAKG,EAAL,GA3C0D,CA6C1D;;IACAhB,4BAAmBiB,QAAnB,GA9C0D,CAgD1D;;;IACA,MAAMC,IAAI,GAAG,IAAb;;IACAC,6BAAoBC,YAApB,CACI,KAAKZ,KAAL,GACM;MAAA,IAAC;QAAEa,IAAF;QAAQC,UAAR;QAAoB,GAAGC;MAAvB,CAAD;MAAA,OACIL,IAAI,CAACV,KAAL,CAAWgB,KAAX,CAAiB;QAAEH,IAAF;QAAQC,UAAR;QAAoB,GAAGC;MAAvB,CAAjB,CADJ;IAAA,CADN,GAGM;MAAA,IAAC;QAAEF,IAAF;QAAQC,UAAR;QAAoB,GAAGC;MAAvB,CAAD;MAAA,OACIL,IAAI,CAACO,OAAL,CAAa,cAAb,EAA6B;QACzB5B,GADyB;QAEzB6B,GAAG,EAAEL,IAFoB;QAGzBM,KAAK,EAAE;UAAEL,UAAF;UAAc,GAAGC;QAAjB;MAHkB,CAA7B,CADJ;IAAA,CAJV;;IAWAJ,6BAAoBS,aAApB,CAAkC,KAAKC,KAAvC;EACH,CAtE8C,CAwE/C;;;EAMA;EACAC,MAAM,QAAsC;IAAA,IAArC;MAAEC,GAAF;MAAOC,QAAP;MAAiB,GAAGC;IAApB,CAAqC;IACxCF,GAAG,IAAI,KAAKG,uBAAL,CAA6BH,GAA7B,CAAP;IACAC,QAAQ,IAAI,KAAKG,qBAAL,CAA2BH,QAA3B,CAAZ;;IACA,IAAII,MAAM,CAACC,IAAP,CAAYJ,aAAZ,EAA2BK,MAA/B,EAAuC;MACnC,KAAKC,mBAAL,CAAyBN,aAAzB;IACH;EACJ,CArF8C,CAuF/C;;;EACQR,OAAO,CAACe,IAAD,EAAY/C,OAAZ,EAA0B;IACrC,KAAKgD,eAAL,CAAqBD,IAArB,EAA2B/C,OAA3B;EACH,CA1F8C,CA4F/C;;;EACAuB,EAAE,GAAc;IAAA,IAAb0B,MAAa,uEAAJ,EAAI;;IACZC,uCAAmBC,QAAnB,CAA4BF,MAA5B;EACH,CA/F8C,CAiG/C;;;EACAG,IAAI,QAAoD;IAAA,IAAnD;MAAEC,MAAF;MAAUhC,MAAV;MAAkBiC,cAAlB;MAAkC,GAAGxB;IAArC,CAAmD;;IACpDoB,uCAAmBE,IAAnB,CAAwBC,MAAxB,EAAgChC,MAAhC,EAAwCiC,cAAxC,EAAwDxB,KAAxD;EACH,CApG8C,CAsG/C;;;EACAyB,KAAK,QAAoD;IAAA,IAAnD;MAAEF,MAAF;MAAUhC,MAAV;MAAkBiC,cAAlB;MAAkC,GAAGxB;IAArC,CAAmD;;IACrDoB,uCAAmBK,KAAnB,CAAyBF,MAAzB,EAAiChC,MAAjC,EAAyCiC,cAAzC,EAAyDxB,KAAzD;EACH;;EAEDM,KAAK,CAACoB,GAAD,EAAoC;IAAA;;IACrC,oBAAKzC,KAAL,qFAAY0C,gBAAZ,kGAA+BD,GAA/B;EACH;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;EACIE,IAAI,CAAC1D,OAAD,EAAU2D,OAAV,EAA6BC,uBAA7B,EAA+D;IAC/D,OAAOlC,6BAAoBgC,IAApB,CACH1D,OADG,EAEH2D,OAFG,EAGHC,uBAHG,CAAP;EAKH;;EAEDC,SAAS,CAAC7D,OAAD,EAAU4D,uBAAV,EAA4C;IACjD,OAAO,KAAKF,IAAL,CAAU1D,OAAV,EAAmB,IAAnB,EAAyB4D,uBAAzB,CAAP;EACH;;AAhI8C;;;AAmInD,IAAIE,SAAJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACe,SAASC,kBAAT,GAA6D;EAAA,kCAA9BC,IAA8B;IAA9BA,IAA8B;EAAA;;EACxE,OAAOF,SAAS,KAAKA,SAAS,GAAG,IAAIjE,sBAAJ,CAA2B,GAAGmE,IAA9B,CAAjB,CAAhB;AACH"}