{"version":3,"names":["useEffect","useMemo","useRef","NativeEventEmitter","NativeModules","publishRubas","getRubasTime","useLcpCollect","lcpImages","isCollectFinish","collectLPCEvent","current","renderTimestamp","maxRenderTimestamp","maxSize","idx","image","imageSize","event","payload","listener","KRNAppState","addListener","appState","remove"],"sources":["useLcpCollect.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef } from 'react';\nimport { NativeEventEmitter, NativeModules } from 'react-native';\nimport { ILCPImageContextProps } from '../pageContext';\nimport { publishRubas } from '../log';\nimport { getRubasTime } from '../utils';\n\nexport const useLcpCollect = () => {\n    const lcpImages = useMemo(() => [], []);\n    const isCollectFinish = useRef(false);\n    const collectLPCEvent = () => {\n        if (isCollectFinish.current === false) {\n            let renderTimestamp = 0;\n            let maxRenderTimestamp = 0;\n            let maxSize = 0;\n            for (const idx in lcpImages) {\n                const image: ILCPImageContextProps = lcpImages[idx];\n                if (image) {\n                    if (maxSize < image.imageSize) {\n                        maxSize = image.imageSize;\n                        renderTimestamp = image.renderTimestamp;\n                    }\n                    if (maxRenderTimestamp < image.renderTimestamp) {\n                        maxRenderTimestamp = image.renderTimestamp;\n                    }\n                }\n            }\n            if (renderTimestamp !== 0 && maxSize > 0) {\n                publishRubas({\n                    event: 'local_life_page_lcp_render',\n                    payload: getRubasTime(renderTimestamp),\n                });\n                publishRubas({\n                    event: 'local_life_page_llt_render',\n                    payload: getRubasTime(maxRenderTimestamp),\n                });\n                isCollectFinish.current = true;\n            }\n        }\n    };\n    useEffect(() => {\n        // 监听页面可见\n        const listener = new NativeEventEmitter(\n            NativeModules.KRNAppState,\n        ).addListener('krnAppStateDidChange', ({ appState }) => {\n            if (\n                appState === 'hide' ||\n                appState === 'inactive' ||\n                appState === 'background' ||\n                appState === 'destroy'\n            ) {\n                collectLPCEvent();\n            }\n        });\n        return () => {\n            collectLPCEvent();\n            listener.remove();\n        };\n    }, [lcpImages]);\n    return { lcpImages };\n};\n"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,OAApB,EAA6BC,MAA7B,QAA2C,OAA3C;AACA,SAASC,kBAAT,EAA6BC,aAA7B,QAAkD,cAAlD;AAEA,SAASC,YAAT,QAA6B,QAA7B;AACA,SAASC,YAAT,QAA6B,UAA7B;AAEA,OAAO,MAAMC,aAAa,GAAG,MAAM;EAC/B,MAAMC,SAAS,GAAGP,OAAO,CAAC,MAAM,EAAP,EAAW,EAAX,CAAzB;EACA,MAAMQ,eAAe,GAAGP,MAAM,CAAC,KAAD,CAA9B;;EACA,MAAMQ,eAAe,GAAG,MAAM;IAC1B,IAAID,eAAe,CAACE,OAAhB,KAA4B,KAAhC,EAAuC;MACnC,IAAIC,eAAe,GAAG,CAAtB;MACA,IAAIC,kBAAkB,GAAG,CAAzB;MACA,IAAIC,OAAO,GAAG,CAAd;;MACA,KAAK,MAAMC,GAAX,IAAkBP,SAAlB,EAA6B;QACzB,MAAMQ,KAA4B,GAAGR,SAAS,CAACO,GAAD,CAA9C;;QACA,IAAIC,KAAJ,EAAW;UACP,IAAIF,OAAO,GAAGE,KAAK,CAACC,SAApB,EAA+B;YAC3BH,OAAO,GAAGE,KAAK,CAACC,SAAhB;YACAL,eAAe,GAAGI,KAAK,CAACJ,eAAxB;UACH;;UACD,IAAIC,kBAAkB,GAAGG,KAAK,CAACJ,eAA/B,EAAgD;YAC5CC,kBAAkB,GAAGG,KAAK,CAACJ,eAA3B;UACH;QACJ;MACJ;;MACD,IAAIA,eAAe,KAAK,CAApB,IAAyBE,OAAO,GAAG,CAAvC,EAA0C;QACtCT,YAAY,CAAC;UACTa,KAAK,EAAE,4BADE;UAETC,OAAO,EAAEb,YAAY,CAACM,eAAD;QAFZ,CAAD,CAAZ;QAIAP,YAAY,CAAC;UACTa,KAAK,EAAE,4BADE;UAETC,OAAO,EAAEb,YAAY,CAACO,kBAAD;QAFZ,CAAD,CAAZ;QAIAJ,eAAe,CAACE,OAAhB,GAA0B,IAA1B;MACH;IACJ;EACJ,CA7BD;;EA8BAX,SAAS,CAAC,MAAM;IACZ;IACA,MAAMoB,QAAQ,GAAG,IAAIjB,kBAAJ,CACbC,aAAa,CAACiB,WADD,EAEfC,WAFe,CAEH,sBAFG,EAEqB,QAAkB;MAAA,IAAjB;QAAEC;MAAF,CAAiB;;MACpD,IACIA,QAAQ,KAAK,MAAb,IACAA,QAAQ,KAAK,UADb,IAEAA,QAAQ,KAAK,YAFb,IAGAA,QAAQ,KAAK,SAJjB,EAKE;QACEb,eAAe;MAClB;IACJ,CAXgB,CAAjB;IAYA,OAAO,MAAM;MACTA,eAAe;MACfU,QAAQ,CAACI,MAAT;IACH,CAHD;EAIH,CAlBQ,EAkBN,CAAChB,SAAD,CAlBM,CAAT;EAmBA,OAAO;IAAEA;EAAF,CAAP;AACH,CArDM"}