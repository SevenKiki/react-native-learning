{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","NativeModules","View","StyleSheet","Alpha","OP_INLINE","CustomQueryClient","QueryClientProvider","PageContext","getPageRubasKey","pageLog","PageRubasRule","publishRubas","useReportContainer","getErrorCode","getErrorMessage","getRubasTime","useLcpCollect","_AppPropsProvider","styles","create","container","flex","PageNoOpt","props","init","appProps","t2TimeStampRef","Date","now","loadedData","setLoadedData","requestData","noReport","onCreateTimestamp","RootViewPageBridge","rootViewDidMountWith","rootTag","event","payload","queryKey","onRequest","then","queryState","get","getQueryState","status","current","dataUpdatedAt","errorUpdateCount","apiRetrySuccess","apiSuccess","onSuccess","apiFailed","local_life_network_error_code","error","local_life_network_error_message","onError","catch","time2","reportPageRenderTime","lcpImages","t3","t2","pageRender","renderContent","noOpt","contentPager"],"sources":["pageNoOpt.tsx"],"sourcesContent":["import React, {\n    useCallback,\n    useEffect,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\nimport { NativeModules, View, StyleSheet } from 'react-native';\nimport { Alpha, OP_INLINE } from './alpha';\nimport { CustomQueryClient } from './customQueryClient';\nimport { QueryClientProvider } from 'react-query';\nimport { PageContext } from './pageContext';\nimport {\n    getPageRubasKey,\n    pageLog,\n    PageRubasRule,\n    publishRubas,\n    useReportContainer,\n} from './log';\nimport { getErrorCode, getErrorMessage, getRubasTime } from './utils';\nimport { TAppProps, TPageProps } from './page';\nimport { useLcpCollect } from './hooks/useLcpCollect';\nimport { _AppPropsProvider } from './_AppPropsProvider';\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n    },\n});\n\n// 工程脚手架\nexport const PageNoOpt = <T extends TAppProps, U extends any>(\n    props: TPageProps<T, U>,\n) => {\n    _AppPropsProvider.init(props.appProps);\n    useReportContainer(props);\n    const t2TimeStampRef = useRef(Date.now());\n    const [loadedData, setLoadedData] = useState(false);\n    // 请求数据\n    const requestData = useCallback(() => {\n        // t1上报\n        if (!props.noReport) {\n            pageLog(\n                '分阶段耗时',\n                `t1=${Date.now() - props.appProps.onCreateTimestamp}`,\n            );\n            NativeModules.RootViewPageBridge.rootViewDidMountWith(\n                props.appProps.rootTag,\n                {},\n            );\n            publishRubas({\n                event: 'local_life_page_on_load_view_t1',\n                payload: getRubasTime(Date.now()),\n            });\n        }\n        if (props.queryKey && props.onRequest) {\n            props\n                .onRequest()\n                .then(() => {\n                    const queryState = CustomQueryClient.get().getQueryState(\n                        props.queryKey,\n                    );\n                    if (queryState.status === 'success') {\n                        t2TimeStampRef.current = queryState.dataUpdatedAt;\n                        publishRubas({\n                            event: getPageRubasKey(\n                                props,\n                                queryState.errorUpdateCount\n                                    ? PageRubasRule.apiRetrySuccess\n                                    : PageRubasRule.apiSuccess,\n                            ),\n                        });\n                        setLoadedData(true);\n                        props.onSuccess?.();\n                    } else if (queryState.status === 'error') {\n                        if (queryState.errorUpdateCount === 1) {\n                            publishRubas({\n                                event: getPageRubasKey(\n                                    props,\n                                    PageRubasRule.apiFailed,\n                                ),\n                                payload: {\n                                    local_life_network_error_code: getErrorCode(\n                                        queryState?.error,\n                                    ),\n                                    local_life_network_error_message:\n                                        getErrorMessage(queryState?.error),\n                                },\n                            });\n                        }\n                        props.onError?.();\n                    }\n                })\n                .catch(() => {\n                    props.onError?.();\n                    publishRubas({\n                        event: getPageRubasKey(props, PageRubasRule.apiFailed),\n                    });\n                });\n        } else if (!props.noReport) {\n            // 无网络请求或者数据处理时，t2、t3上报\n            const time2 = Date.now() - props.appProps.onCreateTimestamp;\n            NativeModules.RootViewPageBridge.reportPageRenderTime(\n                props.appProps.rootTag,\n                time2,\n                time2,\n                {},\n            );\n            publishRubas({\n                event: 'local_life_page_request_t2',\n                payload: getRubasTime(Date.now()),\n            });\n            publishRubas({\n                event: 'local_life_page_render_t3',\n                payload: getRubasTime(Date.now()),\n            });\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    useMemo(requestData, []);\n    const { lcpImages } = useLcpCollect();\n\n    useEffect(() => {\n        if (loadedData) {\n            // 有网络请求或者数据处理时，t2、t3上报\n            if (!props.noReport) {\n                const t3 = Date.now() - props.appProps.onCreateTimestamp;\n                const t2 =\n                    t2TimeStampRef.current - props.appProps.onCreateTimestamp;\n                NativeModules.RootViewPageBridge.reportPageRenderTime(\n                    props.appProps.rootTag,\n                    t2,\n                    t3,\n                    {},\n                );\n                pageLog('分阶段耗时', `t2=${t2},t3=${t3}`);\n            }\n            publishRubas({\n                event: getPageRubasKey(props, PageRubasRule.pageRender),\n            });\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [loadedData]);\n\n    // 渲染组件\n    function renderContent() {\n        return (\n            <QueryClientProvider client={CustomQueryClient.get()}>\n                <PageContext.Provider\n                    value={{\n                        loadedData: true,\n                        noOpt: true,\n                        lcpImages: lcpImages,\n                    }}\n                >\n                    <View style={styles.container}>\n                        <Alpha\n                            target={props.contentPager}\n                            schedule={OP_INLINE}\n                            data={props.appProps}\n                        />\n                    </View>\n                </PageContext.Provider>\n            </QueryClientProvider>\n        );\n    }\n\n    return renderContent();\n};\n"],"mappings":"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"}