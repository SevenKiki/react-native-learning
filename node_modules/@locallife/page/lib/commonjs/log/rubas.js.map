{"version":3,"names":["publishRubas","rubasPublishParams","NativeModules","Kds","invoke","JSON","stringify","rootTag","_AppPropsProvider","appProps","catch","e","console","log","setRubasDimension","dimensionKey","value","key","PageRubasRule","enterPage","apiSuccess","apiRetrySuccess","apiFailed","pageRender","exitPage","getPageRubasKey","pageProps","rule","navigationKey","bundleId","componentName","useReportContainer","event","requestAnimationFrame","onShowLoading","payload","onCreateTimestamp"],"sources":["rubas.ts"],"sourcesContent":["import { TPageProps } from '@locallife/page';\nimport { useEffect } from 'react';\nimport { pageLog } from './console';\nimport { NativeModules } from 'react-native';\nimport { _AppPropsProvider } from '../_AppPropsProvider';\nimport { getRubasTime } from '../utils';\n\ninterface RubasPublishParam {\n    event: string;\n    payload?: number | string | object;\n    token?: any;\n}\nexport function publishRubas(rubasPublishParams: RubasPublishParam) {\n    pageLog('PublishRubas', rubasPublishParams);\n    NativeModules.Kds.invoke(\n        'tool',\n        'publishRubas',\n        JSON.stringify({\n            rootTag: _AppPropsProvider.appProps.rootTag,\n            ...rubasPublishParams,\n        }),\n    ).catch((e) => {\n        console.log('Rubas error', e);\n    });\n}\n\nexport function setRubasDimension(dimensionKey: string, value: string) {\n    pageLog('dimensionKey:', dimensionKey + 'dimensionValue:' + value);\n    NativeModules.Kds.invoke(\n        'tool',\n        'setRubasDimension',\n        JSON.stringify({\n            rootTag: _AppPropsProvider.appProps.rootTag,\n            ...{\n                key: dimensionKey,\n                value: value,\n            },\n        }),\n    ).catch((e) => {\n        console.log('Rubas Dimension error', e);\n    });\n}\n\nexport const PageRubasRule = {\n    enterPage: 'enter_page',\n    apiSuccess: 'api_success',\n    apiRetrySuccess: 'api_retry_success',\n    apiFailed: 'api_failed',\n    pageRender: 'page_render',\n    exitPage: 'exit_page',\n};\n\nexport function getPageRubasKey(\n    pageProps: TPageProps<any, any>,\n    rule: typeof PageRubasRule[keyof typeof PageRubasRule],\n) {\n    const { navigationKey, appProps } = pageProps;\n    return `${appProps.bundleId}_${appProps.componentName}${\n        appProps[navigationKey] ? '_' + appProps[navigationKey] : ''\n    }_${rule}`;\n}\n\nexport function useReportContainer(pageProps: TPageProps<any, any>) {\n    useEffect(() => {\n        publishRubas({\n            event: getPageRubasKey(pageProps, PageRubasRule.enterPage),\n        });\n        requestAnimationFrame(() => {\n            pageProps?.onShowLoading?.();\n        });\n        return () =>\n            publishRubas({\n                event: getPageRubasKey(pageProps, PageRubasRule.exitPage),\n            });\n    }, []);\n    useEffect(() => {\n        setRubasDimension(\n            'local_life_page_bundleid',\n            pageProps.appProps?.bundleId ?? '',\n        );\n        setRubasDimension(\n            'local_life_page_componentname',\n            pageProps.appProps?.componentName ?? '',\n        );\n        publishRubas({\n            event: 'local_life_page_on_create',\n            payload: getRubasTime(pageProps.appProps.onCreateTimestamp),\n        });\n    }, []);\n}\n"],"mappings":";;;;;;;;;;;AACA;;AACA;;AACA;;AACA;;AACA;;AAOO,SAASA,YAAT,CAAsBC,kBAAtB,EAA6D;EAChE,sBAAQ,cAAR,EAAwBA,kBAAxB;;EACAC,2BAAcC,GAAd,CAAkBC,MAAlB,CACI,MADJ,EAEI,cAFJ,EAGIC,IAAI,CAACC,SAAL,CAAe;IACXC,OAAO,EAAEC,qCAAkBC,QAAlB,CAA2BF,OADzB;IAEX,GAAGN;EAFQ,CAAf,CAHJ,EAOES,KAPF,CAOSC,CAAD,IAAO;IACXC,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BF,CAA3B;EACH,CATD;AAUH;;AAEM,SAASG,iBAAT,CAA2BC,YAA3B,EAAiDC,KAAjD,EAAgE;EACnE,sBAAQ,eAAR,EAAyBD,YAAY,GAAG,iBAAf,GAAmCC,KAA5D;;EACAd,2BAAcC,GAAd,CAAkBC,MAAlB,CACI,MADJ,EAEI,mBAFJ,EAGIC,IAAI,CAACC,SAAL,CAAe;IACXC,OAAO,EAAEC,qCAAkBC,QAAlB,CAA2BF,OADzB;IAEX,GAAG;MACCU,GAAG,EAAEF,YADN;MAECC,KAAK,EAAEA;IAFR;EAFQ,CAAf,CAHJ,EAUEN,KAVF,CAUSC,CAAD,IAAO;IACXC,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCF,CAArC;EACH,CAZD;AAaH;;AAEM,MAAMO,aAAa,GAAG;EACzBC,SAAS,EAAE,YADc;EAEzBC,UAAU,EAAE,aAFa;EAGzBC,eAAe,EAAE,mBAHQ;EAIzBC,SAAS,EAAE,YAJc;EAKzBC,UAAU,EAAE,aALa;EAMzBC,QAAQ,EAAE;AANe,CAAtB;;;AASA,SAASC,eAAT,CACHC,SADG,EAEHC,IAFG,EAGL;EACE,MAAM;IAAEC,aAAF;IAAiBnB;EAAjB,IAA8BiB,SAApC;EACA,OAAQ,GAAEjB,QAAQ,CAACoB,QAAS,IAAGpB,QAAQ,CAACqB,aAAc,GAClDrB,QAAQ,CAACmB,aAAD,CAAR,GAA0B,MAAMnB,QAAQ,CAACmB,aAAD,CAAxC,GAA0D,EAC7D,IAAGD,IAAK,EAFT;AAGH;;AAEM,SAASI,kBAAT,CAA4BL,SAA5B,EAA6D;EAChE,sBAAU,MAAM;IACZ1B,YAAY,CAAC;MACTgC,KAAK,EAAEP,eAAe,CAACC,SAAD,EAAYR,aAAa,CAACC,SAA1B;IADb,CAAD,CAAZ;IAGAc,qBAAqB,CAAC,MAAM;MAAA;;MACxBP,SAAS,SAAT,IAAAA,SAAS,WAAT,qCAAAA,SAAS,CAAEQ,aAAX,qFAAAR,SAAS;IACZ,CAFoB,CAArB;IAGA,OAAO,MACH1B,YAAY,CAAC;MACTgC,KAAK,EAAEP,eAAe,CAACC,SAAD,EAAYR,aAAa,CAACM,QAA1B;IADb,CAAD,CADhB;EAIH,CAXD,EAWG,EAXH;EAYA,sBAAU,MAAM;IAAA;;IACZV,iBAAiB,CACb,0BADa,kDAEbY,SAAS,CAACjB,QAFG,wDAEb,oBAAoBoB,QAFP,yEAEmB,EAFnB,CAAjB;IAIAf,iBAAiB,CACb,+BADa,mDAEbY,SAAS,CAACjB,QAFG,yDAEb,qBAAoBqB,aAFP,yEAEwB,EAFxB,CAAjB;IAIA9B,YAAY,CAAC;MACTgC,KAAK,EAAE,2BADE;MAETG,OAAO,EAAE,yBAAaT,SAAS,CAACjB,QAAV,CAAmB2B,iBAAhC;IAFA,CAAD,CAAZ;EAIH,CAbD,EAaG,EAbH;AAcH"}