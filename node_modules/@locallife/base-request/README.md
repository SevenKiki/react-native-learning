[@locallife/base-request](https://git.corp.kuaishou.com/localkrn/locallife/base-request)

## 介绍
KRN网络库(基础库)

[【技术方案】请求库下沉](https://docs.corp.kuaishou.com/k/home/VDqa-GtBR9Qc/fcAATKrTxQAnuEkBoJ8ZveWQQ)

## 安装

```sh
yarn add @locallife/base-request
```

## 引入

```typescript
import { request } from '@locallife/base-request';
```

## 用法

1. 初始化

   用途：可以设置一些公共参数，避免每个接口都需要传，按需调用

   用法：

```typescript
import { request } from '@locallife/base-request';

useEffect(() => {
    baseRequest.init({
        params: { bundleVersionCode: -1 },
        headers: {},
    } as CommonRequestParams);
}, []);
```

   初始化时设置的公共参数值可以在执行具体请求的时候去覆盖，如下：

```typescript
request({
   // ...
   params: {
      ..., // 可以在 params 中覆盖对应参数值
   },
   commonRequestParams: {} as CommonRequestParams, // 也可以在 commonRequestParams 中覆盖对应参数值
   // ...
})
```

2. 已有代码接入，需要在原因参数上有选择的补充一下参数：queryParams、commonParams、businessName

```typescript
import { request } from '@locallife/base-request';
import { RequestMethod } from './IRequestParam';

request({
    url: '/rest/op/vc/xxx',
    method: RequestMethod.POST, // 可以不设置，默认是 GET
    params: {
        ...,
    },
    queryParams: {},
    commonRequestParams: {},
    businessName: 'lbs',
});
```

3. 在 base-request 库中，除了可以和原来一样直接通过 request 进行请求，还可以通过 request.get(params)、request.post(params) 方式执行，此外可以通过 config 方式传入一些其他配置信息

```typescript
import { request } from '@locallife/base-request';
import { RequestConfig } from './RequestConfig';

request
    .get({
        url: '/rest/op/vc/xxx',
        params: {
            poiId: 'xxx',
        },
    });

request
    .post({
        url: '/rest/op/vc/xxx',
        queryParams: {},
        params: {
            poiId: 'xxx',
        },
        businessName: 'lbs',
    }, {
        requestInterceptors: xxx,
        responseInterceptros: xxx,
        ...
    } as RequestConfig);
```

## 使用样例

1. 见根目录下 example 子目录

```typescript
request
    .post({
      url: '/rest/n/nearby/localfood/topcard',
      params: {},
      commonParams: appModel,
      businessName: 'api',
    })
    .then((response) => {
      setContent(JSON.stringify(response));
    })
    .catch((reason) => {
      setContent(JSON.stringify(reason));
    });
```

2. 运行demo

```sh
cd example
yarn
yarn start
```

## 方法说明

| 方法名     | 说明                           | 传入参数                                                                                                                                     |返回类型|
|---------|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------| ----------- |
| request | 执行请求的方法，和现有的request 类似       | IRequestParam、RequestConfig                                                                                                                            |Promise|
| config  | 设置配置信息                       | { <br> requestInterceptors: array,  // 请求拦截器 <br>responseInterceptros: array,  // 响应 拦截器 <br>needLogin: boolean, // 接口是否有登录限制 <br>}<br/> |Request|
| get     | 	发起 get 请求                   | 	IRequestParam、RequestConfig	                                                                                                            |Promise|
| post	   | 发起 post 请求	                  | IRequestParam、RequestConfig                                                                                                                            |	Promise|
| call	      | 发起请求，请求方式由 Params.method 决定	 | IRequestParam、RequestConfig                                                                                                                            |	Promise|

## 参数说明

1. IRequestParam

|参数名	| 说明	                                  | 类型	     |必填	|默认值|
| ----------- |--------------------------------------|---------| ----------- | --------- |
|url	| 请求path，类似 /rest/o/xxx	               | string	 |是	|-|
|method	| 请求类型	                                | string	 |否	|POST|
|queryParams| 	当请求类型是 ‘POST’ 时，方 query 里的参数	       | object	 |否	|-|
|params	| 参数，post 接口放在body 里，get 接口放在 query 里	 | string	 |否	|-|
|commonParams| 	公共参数，和params类似	                     | object	 |否	|-|
|headers	| 参数，放在 header 里	                      | object	 |否|	-|
|businessName	| 业务标识	                                | string	 |否	|-|
|timeout	| 请求超时时间，单位 s，必须是整数	                   | int	    |否	|-|

2. CommonRequestParams

|参数名	|说明	|类型	|必填	|默认值|
| ----------- | ----------- | ----------- | ----------- | ----------- |
|params	|参数，post 接口放在body 里，get 接口放在 query 里	|object	|否	|-|
|headers	|header 参数	|string	|否	|-|

3. CommonRequestParams.params

|参数名	|说明	|类型	|必填	|默认值|
| ----------- | ----------- | ----------- | ----------- | ----------- |
|bundleVersionCode|	版本号|	number	|否|	-|
|extend|	快链里拼的 extend 参数|	string|	否	|-|
|channelPage	|用于标识属于那个页面，一般和bundle的 pageName保持一致，比如 poi 统一使用 'POI_DETAIL'，nearbyFood 统一使用 POI_FOODS_CHANNEL	|string	|是	|-|

4. CommonRequestParams.headers

|参数名	|说明	|类型	|必填	|默认值|
| ----------- | ----------- | ----------- | ----------- | ----------- |
|contentType|	无	|string	|否	|'application/json'|
|XPhotoId	|无	|string	|否	|-|
|XAuthorId|	无	|string|	否|	-|
|XSource	|无	|string|	否	|-|
|XSessionId	|无|	string|	否	|-|
