{"version":3,"names":["BaseRequestImpl","RequestMethod","bind","fn","thisArg","wrap","apply","arguments","forEach","obj","allOwnKeys","i","l","Array","isArray","length","call","keys","Object","getOwnPropertyNames","len","key","extend","a","b","val","Request","configRequestImpl","request","requestImpl","init","commonRequestParams","__DEV__","Error","param","config","get","method","GET","post","POST","createInstance","context","instance","prototype"],"sources":["index.ts"],"sourcesContent":["import { IRequest } from './IRequest';\nimport {\n    CommonRequestParams,\n    IRequestParam,\n    KSBaseResponse,\n    RequestConfig,\n} from '@locallife/base-request';\nimport { BaseRequestImpl } from './BaseRequestImpl';\nimport { RequestMethod } from '../model/IRequestParam';\n\nfunction bind(fn, thisArg) {\n    return function wrap() {\n        return fn.apply(thisArg, arguments);\n    };\n}\n\nfunction forEach(obj, fn, { allOwnKeys = true } = {}) {\n    // Don't bother if no value provided\n    if (obj === null || typeof obj === 'undefined') {\n        return;\n    }\n\n    let i;\n    let l;\n\n    // Force an array if not already something iterable\n    if (typeof obj !== 'object') {\n        /*eslint no-param-reassign:0*/\n        obj = [obj];\n    }\n\n    if (Array.isArray(obj)) {\n        // Iterate over array values\n        for (i = 0, l = obj.length; i < l; i++) {\n            fn.call(null, obj[i], i, obj);\n        }\n    } else {\n        // Iterate over object keys\n        const keys = allOwnKeys\n            ? Object.getOwnPropertyNames(obj)\n            : Object.keys(obj);\n        const len = keys.length;\n        let key;\n\n        for (i = 0; i < len; i++) {\n            key = keys[i];\n            fn.call(null, obj[key], key, obj);\n        }\n    }\n}\n\nconst extend = (a, b, thisArg?: Request, { allOwnKeys = true } = {}) => {\n    forEach(\n        b,\n        (val, key) => {\n            if (thisArg && typeof val === 'function') {\n                a[key] = bind(val, thisArg);\n            } else {\n                a[key] = val;\n            }\n        },\n        { allOwnKeys },\n    );\n    return a;\n};\n\nclass Request {\n    requestImpl: IRequest<KSBaseResponse> = new BaseRequestImpl();\n    commonRequestParams?: CommonRequestParams;\n\n    configRequestImpl(request: IRequest<KSBaseResponse>) {\n        this.requestImpl = request;\n    }\n\n    init(commonRequestParams?: CommonRequestParams) {\n        if (__DEV__ && this.commonRequestParams) {\n            throw Error('Request.init 不可以重复初始化');\n        }\n        this.commonRequestParams = commonRequestParams;\n    }\n\n    request(param: IRequestParam, config?: RequestConfig) {\n        param.commonRequestParams =\n            param.commonRequestParams ?? this.commonRequestParams;\n        return this.requestImpl.request(param, config);\n    }\n\n    get(param: IRequestParam, config?: RequestConfig) {\n        param.method = RequestMethod.GET;\n        return this.request(param, config);\n    }\n\n    post(param: IRequestParam, config?: RequestConfig) {\n        param.method = RequestMethod.POST;\n        return this.request(param, config);\n    }\n}\n\nfunction createInstance() {\n    // 根据默认配置构建个上下文对象，包括默认配置和请求、响应拦截器对象\n    const context = new Request();\n    // 创建实例 bind后返回的是一个函数，并且上下文指向context\n    const instance = bind(Request.prototype.request, context);\n    // 拷贝prototype到实例上 (例如: request、get、post...)继承到实例上，this指向为context\n    extend(instance, Request.prototype, context);\n    // 拷贝上下文对象属性(默认配置和请求、相应拦截器对象)到实例上， this指向为context\n    extend(instance, context);\n\n    return instance;\n}\n\nexport interface IExposedRequest {\n    /**\n     * 初始化阶段执行一次即可\n     */\n    init(commonRequestParams?: CommonRequestParams);\n\n    request<T extends KSBaseResponse>(\n        param: IRequestParam,\n        config?: RequestConfig,\n    ): Promise<T>;\n\n    get<T extends KSBaseResponse>(\n        param: IRequestParam,\n        config?: RequestConfig,\n    ): Promise<T>;\n\n    post<T extends KSBaseResponse>(\n        param: IRequestParam,\n        config?: RequestConfig,\n    ): Promise<T>;\n}\n\nexport type RequestInstance = IExposedRequest;\n\n// Create the default instance to be exported\n// @ts-ignore\nexport const request: RequestInstance = createInstance();\n"],"mappings":"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"}