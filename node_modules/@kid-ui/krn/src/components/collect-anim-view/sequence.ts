import { Animated } from 'react-native';

/**
 * 修复原生animation call两次start会崩溃问题
 * https://stackoverflow.com/questions/59208840/react-native-start-animated-twice-an-error-start-of-undefined
 */
export function sequence(
    animations: Array<Animated.CompositeAnimation>,
): Animated.CompositeAnimation {
    let current = 0;
    return {
        start: function (callback?: Animated.EndCallback) {
            const onComplete = function (result: any) {
                if (!result.finished) {
                    current = 0;
                    callback && callback(result);
                    return;
                }

                current++;

                if (current === animations.length) {
                    current = 0;
                    callback && callback(result);
                    return;
                }

                animations[current].start(onComplete);
            };

            if (animations.length === 0) {
                current = 0;
                callback && callback({ finished: true });
            } else {
                animations[current].start(onComplete);
            }
        },

        stop: function () {
            if (current < animations.length) {
                animations[current].stop();
            }
        },
    };
}
