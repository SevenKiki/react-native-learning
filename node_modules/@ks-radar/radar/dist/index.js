!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Radar=e()}(this,function(){"use strict";var u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function c(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}var s,t="ksurl.cn/csHfgepO",e=console,N=e.log.bind(e,t+", radar:"),y=e.warn.bind(e,t+", radar:"),b=e.error.bind(e,t+", radar:"),M=(r.prototype.use=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this.middlewares.pop();(t=this.middlewares).push.apply(t,c([],p(e),!1)),this.middlewares.push(r)},r.prototype.invoke=function(t){return a=this.middlewares,r=t,i=-1,function t(e){if(e<=i)return new Error("`next` 被重复调用");var n=a[i=e];if(n=e===a.length?o:n)try{return n(r,t.bind(null,e+1))}catch(e){return e}}(0);var r,o,i,a},r),t=((e=s={}).LOAD="load",e.RES="resource",e.API="api",e.ERROR="error",e.SDK_ERROR="sdk_error",e.CUSTOM="custom",e.BATCH="batch",e.EVENT="event",e.BLOOD="blood",n.prototype.updateCore=function(t){var e;"object"==typeof t.sampleData&&"function"==typeof t.collect||_("121"),null!=(e=this.core)&&e.broadcastSample.off(this.broadcastSampleFb),this.core=t,this.sampling=this.getSample(this.baseOptions.sampling),this.sampling&&(this.isHit=this.samplingControl(this.sampling)),null!=(t=null==(e=this.core)?void 0:e.broadcastSample)&&t.on(this.broadcastSampleFb)},n.prototype.getSample=function(t){var e=null!=(e=null==(e=this.core)?void 0:e.sampleData.core)?e:1;if(this.key===s.LOAD)return e;if("number"!=typeof(t=void 0===t?1:t)||t<0||1<t)return y("102","".concat(this.key,"，采用Core的采样率").concat(null==(n=this.core)?void 0:n.sampleData.core)),e;var n=null!=(n=this.core)&&n.isInYoda?void 0===(null==(n=this.core)?void 0:n.sampleData[this.key])?1:this.core.sampleData[this.key]:t;return e&&e<n?(y("115","".concat(this.key)),e):n},n.prototype.samplingControl=function(t){var e;return!(null==(e=this.core)||!e.sampleData.isHit)&&(null==(e=this.core)?void 0:e.samplingControl(t/this.core.sampleData.core))},n.prototype.baseCollect=function(t){if(this.core){if(this.isHit){var n=t.value||{},n=Object.keys(n).filter(function(t){return null!==n[t]&&void 0!==n[t]}).reduce(function(t,e){return u(u({},t),((t={})[e]=n[e],t))},{});try{this.core.collect(t.key||this.key,u(u({collect_version:this.version,collect_name:this.name},t.dimension),{sample_rate:this.sampling}),n)}catch(t){y("126")}}}else y("110","".concat(this.key))},n);function n(t){void 0===t&&(t={});var e=this;this.broadcastSampleFb=function(){var t=e.getSample(e.baseOptions.sampling);t!==e.sampling&&(e.sampling=t,e.sampling&&(e.isHit=e.samplingControl(e.sampling)))},void 0===t&&_("100"),t.key||_("101"),!t.core||"object"==typeof t.core.sampleData&&"function"==typeof t.core.collect||_("121"),this.baseOptions=t,this.key=t.key,this.version=t.version,this.name=t.name,this.isHit=!1,t.core&&this.updateCore(t.core)}function r(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middlewares=[],(t=this.middlewares).push.apply(t,c([],p(e),!1))}var H=["//wlog.kuaishou.com/rest/n/log/web/collect","/rest/wd/common/log/collect/misc2","/rest/wd/common/log/collect/radar","/rest/kd/log/collect"],o=window,i="__radarSeedStore__",J="isCoreReady",q="isRuning",e="Queue",U="error"+e,F="resource"+e,z="event"+e,e={start_time:{custom:function(t,e){return Math.round(e.startTime)}},fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0,crossOriginSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0,crossOriginSkip:!0},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0,crossOriginSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0,crossOriginSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0,crossOriginSkip:!0},total:{end:"responseEnd",start:"fetchStart"},size:{custom:function(t,e){return e.encodedBodySize},cachedSkip:!0,crossOriginSkip:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name}},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||0===e.duration||null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart)},crossOriginSkip:!0},has_timing_allow:{custom:function(t,e){return Q(e)}}},B=/^(https?:)?\/\//;function a(t,e){var n;if(t)return n=t.replace(B,""),e.some(function(t){return 0<=n.indexOf(t.replace(B,""))})}function l(t){if("string"!=typeof t)return"";try{var e=t.lastIndexOf(".");return t.substr(e+1)}catch(t){return""}}function d(e){return"object"==typeof e&&Object.keys(e).every(function(t){return"number"==typeof e[t]})}function S(t){return"function"==typeof t}function Q(t){return void 0===t.nextHopProtocol?null:""!==t.nextHopProtocol}function X(t){return"resource"===t.entryType?"fetch"!==(null==t?void 0:t.initiatorType)&&"xmlhttprequest"!==(null==t?void 0:t.initiatorType)||"js"===l(t.name)||"css"===l(t.name)?"resource":"api":"other"}function f(n,r){var o={};return Object.keys(n).forEach(function(t){var e=function t(e,n,r){var o=n[e];if(o||_("129，".concat(e)),(!o.crossOriginSkip||Q(r))&&(!o.cachedSkip||!t("cached",n,r)))return"function"==typeof o.custom?o.custom(e,r):(n=o.end,e=o.start,!o.notCatchIfUndefined||void 0!==r[n]&&void 0!==r[e]?(+r[n]||0)-(+r[e]||0):void 0)}(t,n,r);null!=e&&(o[t]=e)}),o}function m(t,e,n,r){t.addEventListener(e,n,r)}function h(t,e,n,r){t.removeEventListener(e,n,r)}var W=["ktrace-str"];function V(t){return"__radar_".concat(t=void 0===t?"":t).concat(Math.random().toString(36).substring(2,8))}function Y(n,r){var t=function(t){if("function"!=typeof t.fetch)return null;var n,e=t.fetch;return t.fetch=(n=t.fetch,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=g.reduce(function(t,e){return[e].concat(t)},[]),i="string"==typeof n[0]?new Request(n[0],n[1]):n[0],l=(i.id=V(),o.forEach(function(t){t=t.request,i=t(i)||i}),i.clone()),t=t.apply(void 0,c([],p(n),!1)),a=null,u=null,s=!1;return t.then(function(t){var e,n=null==(e=t.headers)?void 0:e.get("content-type");return n&&K.some(function(t){return-1<n.indexOf(t)})?(s=!0,e=t.clone(),a=e.clone(),e.clone().text()):(a=t,"[object Object]")}).then(function(n){return t=e,c=function(){return r=this,o=function(t){switch(t.label){case 0:u=n,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,l.text()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,"Radar: Request.text()失败"];case 4:return[2]}},c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(t){var e=[n,t];if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(s=2&e[0]?a.return:e[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,a=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){c.label=e[1];break}if(6===e[0]&&c.label<s[1]){c.label=s[1],s=e;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(e);break}s[2]&&c.ops.pop(),c.trys.pop();continue}e=o.call(r,c)}catch(t){e=[6,t],a=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}var r,o,i,a,s,c,e},new(s=(s=a=void 0)||Promise)(function(n,e){function r(t){try{i(c.next(t))}catch(t){e(t)}}function o(t){try{i(c.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(r,o)}i((c=c.apply(t,a||[])).next())});var t,a,s,c}).then(function(t){i._config=t;var e=null;return s?(e=a.clone()).data=u:e=a,o.forEach(function(t){(t=t.response)&&(e=t(e,i)||e)}),a},function(e){throw o.forEach(function(t){(t=t.responseError)&&(e=t(e,i)||e)}),e})}.apply(void 0,c([n],p(t),!1))}),{register:function(e){return g.push(e),function(){var t=g.indexOf(e);0<=t&&g.splice(t,1)}},clear:function(){g=[]},unRegister:function(){e&&(t.fetch=e)}}}("function"==typeof importScripts?self:window);return t&&t.register({request:function(t,e){"function"==typeof n&&n(t)},response:function(t,e){"function"==typeof r&&r(e,t)},responseError:function(t,e){"function"==typeof r&&r(e,{status:0,statusText:t})}}),null==t?void 0:t.unRegister}var g=[],K=["application/json","text/html","text/plain"];function G(){var n=[];function e(t){-1!==(t=n.indexOf(t))&&n.splice(t,1)}function t(t){return n.push(t),e.bind(void 0,t)}return{on:t,off:e,once:function(e){var n=t(function(t){e(t),n()});return n},emit:function(e){n.forEach(function(t){return t(e)})}}}function $(t){return(t=new RegExp("(?:^|; ?)".concat(t,"=(1|0)(;|$)")).exec(document.cookie))&&t[1]}var Z=["radar_init","h5_load","fmp","main_api","h5_custom_metric"];var tt={load:function(t){var e=t.dimension,n=t.value;if(t=e.event_name,Z.indexOf(t)<0)return!1;if(!d(n))return!1;switch(t){case"fmp":var r=n.fmp_time;return!(!n.fmp||!r);case"h5_load":return r=n.total,!(!n.load_event_time||!r);case"h5_custom_metric":return r=n.custom_metric_timestamp,!(!e.custom_metric_name||!r)}return!0},api:function(t){var e=t.dimension,n=(t=t.value,e.custom_failed),r=e.api,o=e.status,i=e.res_type,a=e.protocol,s=(e=e.cached,t.duration),c=t.size;return"boolean"==typeof(void 0!==n&&n)&&"string"==typeof(void 0===r?"":r)&&"number"==typeof(void 0===o?0:o)&&"string"==typeof(void 0===i?"":i)&&"string"==typeof(void 0===a?"":a)&&"boolean"==typeof(void 0!==e&&e)&&"number"==typeof(void 0===s?0:s)&&"number"==typeof(void 0===c?0:c)&&d(t)},resource:function(t){var e=t.dimension,n=(t=t.value,e.failed);if("boolean"!=typeof n)return!1;if(n){var r=e.res_path;if("string"!=typeof e.file||"string"!=typeof r)return!1}return!!n||"string"==typeof e.file&&d(t)},error:function(t){var e=(t=t.dimension).error_type;if([t.error_cons_type,e,t.msg].some(function(t){return null==t}))return!1;var n,e=t.col,r=t.line;return t.sample_rate,t.event_client_timestamp,t=function(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(t,["col","line","sample_rate","event_client_timestamp"]),!(e&&"number"!=typeof e||r&&"number"!=typeof r)&&("object"==typeof(n=t)&&Object.keys(n).every(function(t){return void 0===n[t]||"string"==typeof n[t]}))},event:function(t){var e=t.value;return t=t.dimension.name,!(void 0!==e&&!d(e)||!t)},blood:function(t){var e=!0;if((t=t.dimension.data)instanceof Array){if(0===t.length)return!1;t.forEach(function(t){"string"!=typeof t.com&&(e=!1)})}return e}};function et(n){function r(){n=n.replace(/^\s*/,"")}function t(t){return r(),n[0]===t&&(n=n.slice(1),1)}function o(){r();var t=/^([^\s,;=\\]+)(.*)/.exec(n);if(t)return n=t[2],t[1]}if(n&&"string"==typeof n){for(var e,i=[];e=o();){for(var a={name:e},s={};t(";");){var c,l,u=void 0;(u=o())&&(c=void 0,t("=")&&(c=function(){if(r(),'"'!==n[0])return o();n=n.slice(1);for(var t="";n.length;){var e=/^([^"\\]*)(.*)/.exec(n);if(e){if(t+=e[1],'"'===e[2][0])return n=e[2].slice(1),t;t+=e[2][1],n=e[2].slice(2)}}}(),l=void 0,(l=/([,;].*)/.exec(n))&&(n=l[1])),s[l=u.toLowerCase()]||(s[l]=1,"dur"===l?a.duration=parseFloat(c)||0:"desc"===l?a.description=c||"":a[u]=c))}if("sec"===a.unit&&a.duration&&(a.duration*=1e3),delete a.unit,i.push(a),!t(","))break}return i.length?i:void 0}}function v(t,e){var n;return null!=(n=null==o?void 0:o[i])&&n[t],null!=(n=null==o?void 0:o[i])&&n[q]?o[i][t]:void 0===e?null:e}function nt(t,e){try{o[i][t]=e}catch(t){b("1000")}}function w(t){return JSON.parse(JSON.stringify(t))}function rt(t){try{var e;if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage)return function(t,e){try{if(window&&window.localStorage)window.localStorage.setItem(t,JSON.stringify(e))}catch(t){return}}(t,(e=1e8<(e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0)+1?0:e)+1),e}catch(t){}}function ot(t){var e,n,r={};t=t.split("&");try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i=o.next();!i.done;i=o.next()){var a=p(i.value.split("="),2),s=a[0],c=a[1];s in r?r[s]instanceof Array?r[s].push(c):r[s]=[r[s],c]:r[s]=c}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function _(t){throw new Error("radar error "+t)}var O=function(){return(O=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var it=["c_dimension1","c_dimension2","c_dimension3","release_tag","product_version","sub_app"],at=(E.prototype.genSessionIncreaseId=function(t){return this.runtimeIdMap[t]||(this.runtimeIdMap[t]=0),this.runtimeIdMap[t]++},E.prototype.bindWeblogger=function(t){var e,s=this;if(null!=t&&"object"!=typeof t)_("106");else{if(this.weblog)return void y("122");this.weblog=t,this.updateUrlPackage(),void 0!==(null==(e=null==t?void 0:t.logger)?void 0:e.radarUrl)&&this.ignoreList.push(null==(e=null==t?void 0:t.logger)?void 0:e.radarUrl),void 0!==(null==(e=null==t?void 0:t.logger)?void 0:e.url)&&this.ignoreList.push(null==(e=null==t?void 0:t.logger)?void 0:e.url),this.isInYoda=!(null==(e=null==(t=this.weblog)?void 0:t.Utils)||!e.yoda),this.getSampleData()}0<this.preStoredLogQueue.length&&(this.preStoredLogQueue.forEach(function(t){if(void 0!==(e=s.sampleData["load"===t.key?"core":t.key])&&(t.dimension.sample_rate=e),"load"===t.key?s.sampleData.core:t.dimension.sample_rate*s.sampleData.core>=s.randomSampling){var e=s.getCommonData(),n=(t.dimension.app_version_name=e.app_version_name,t.h5_extra_attr=JSON.stringify(O(O({},null==(e=s.weblog.commonPackage)?void 0:e.getH5ExtraAttr()),JSON.parse(t.h5_extra_attr))),function(t){if(-1===(n=(t=void 0===t?location.href:t).lastIndexOf("?")))return{page:t};var e=t.slice(0,n),n=t.slice(n+1);return{url:t,page:e,params:ot(n)}}(t.base_href)),r=null==(e=s.weblog.logConfig)?void 0:e.urlMap,e={};if("function"==typeof r)try{var o=r(n);"string"==typeof o?e={page:o}:"object"==typeof o&&(e={page:o.page,params:o.params})}catch(t){}else if("object"==typeof r){var i,a="";for(i in r)if(-1<(n.page||n.url||"").indexOf(i)){a=r[i];break}a&&(e={page:a})}t.url_package={page:e&&e.page||n.page},o=s.referUrlPackage&&s.referUrlPackage.toJSON(),t.refer_url_package=o,delete t.base_href,s.logQueue.push(t)}}),this.preStoredLogQueue=[],this.flush())},E.prototype.getSampleData=function(){var t,e,n=this;this.isInYoda?(this.sampleData={isHit:!0,core:this.sampling,api:1,resource:.1,error:1,event:1},e=window.updateYodaSampleRateWithParams,window.updateYodaSampleRateWithParams=function(t){N("104",t),n.updateYodaSampleRate(t),n.broadcastSample.emit(n.sampleData),e&&e(t)},window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.sampleData?(this.updateYodaSampleRate(window.__yodaCommonDataObject__.sampleData),this.collect(s.EVENT,{name:"客户端采样率注入成功",event_type:"radar_sample_inject_success"},{})):"function"==typeof(null==(t=null==(t=null==(t=this.weblog)?void 0:t.Utils)?void 0:t.yoda)?void 0:t.getWebviewLoadPerf)&&null!=(t=this.weblog)&&t.Utils.yoda.getWebviewLoadPerf().then(function(t){null!=t&&t.sampleData&&n.updateYodaSampleRate(t.sampleData)})):this.sampleData={isHit:this.samplingControl(this.sampling),core:this.sampling}},E.prototype.updateYodaSampleRate=function(t){var e=this,n=null;try{var r=t,n="string"==typeof r?JSON.parse(r):r}catch(t){return void N("error: ",t)}n&&Object.keys(n).forEach(function(t){"load"===t?e.sampleData.core=n[t]:"did_rate"===t?e.didRate=n[t]:e.sampleData[t]=n[t]})},E.prototype.updateUrlPackage=function(){var t;null!=(t=this.weblog)&&t.currentUrlPackage&&(this.currentUrlPackage=this.weblog.currentUrlPackage,this.referUrlPackage=this.weblog.referUrlPackage)},E.prototype.setDimensions=function(e){var n=this,t=Object.keys(e);t.some(function(t){return-1===it.indexOf(t)})&&b("113","".concat(t.join("、"))),t.forEach(function(t){null==e[t]?delete n.customDimension[t]:n.customDimension[t]=e[t]})},E.prototype.setCommonDimension=function(t,e,n){this.commonDimension[t]=(n=void 0===n||n)||null==(n=this.commonDimension[t])?e:n},E.prototype.decorateLog=function(t){this.currentUrlPackage||this.updateUrlPackage(),0<Object.keys(this.customDimension).length&&Object.assign(t.dimension,this.customDimension),0<Object.keys(this.commonDimension).length&&Object.assign(t.dimension,this.commonDimension),this.currentUrlPackage&&this.currentUrlPackage.page!==(null==(t=null==(t=this.weblog)?void 0:t.currentUrlPackage)?void 0:t.page)&&(this.flush(),this.updateUrlPackage())},E.prototype.samplingControl=function(t){return null!==t&&"number"==typeof t&&this.randomSampling<t},E.prototype.getCommonData=function(){var t,e=null==(e=null==(e=null==(e=this.weblog)?void 0:e.commonPackage)?void 0:e.app_package)?void 0:e.version_name,e={h5_extra_attr:JSON.stringify(O(O({},null==(t=null==(t=this.weblog)?void 0:t.commonPackage)?void 0:t.getH5ExtraAttr()),{app_version_name:e,url:location.href,hash:location.hash,online:null===navigator||void 0===navigator?void 0:navigator.onLine,downlink:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.downlink,rtt:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.rtt})),url_package:this.currentUrlPackage&&this.currentUrlPackage.toJSON(),refer_url_package:this.referUrlPackage&&this.referUrlPackage.toJSON(),app_version_name:e,project_id:null==(t=this.config)?void 0:t.projectId};return"1"===$("radar_report_test")&&(e.is_report_test=!0),e},E.prototype.reportByHttp=function(){var t=this.getCommonData(),e=(t={project_id:this.config.projectId,radar_session_id:this.radarSessionId,h5_extra_attr:t.h5_extra_attr},this.logQueue.filter(function(t){return"load"===t.key})),n=this.logQueue.filter(function(t){return"load"!==t.key});Array.isArray(e)&&e.length&&this.collectLog(t,e,"radarSDK"),Array.isArray(n)&&n.length&&this.collectLog(t,n,"radarSDKSupplement")},E.prototype.collectLog=function(t,e,n){var r;"function"!=typeof(null==(r=this.weblog)?void 0:r.collect)&&"function"!=typeof(null==(r=this.weblog)?void 0:r.sendByHttp)?b("114"):(this.weblog.sendByHttp||this.weblog.collect).call(this.weblog,"RADAR",{name:"radar_log",params:O(O({},t),{data:function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(e),!1)}),serviceName:n})},E.prototype.reportByBridge=function(){var e=null==(n=null==(n=this.weblog)?void 0:n.Utils)?void 0:n.yoda;if(!e)return!1;var t,n=this.logQueue.filter(function(t){return"load"===t.key}),r=this.logQueue.filter(function(t){return"load"!==t.key});try{return n.forEach(function(t){"function"==typeof(null==(t=e.sendSummarizedLog({key:"h5_load",data:t}))?void 0:t.catch)&&t.catch(function(t){b("123",t)})}),r.length&&"function"==typeof(null==(t=e.sendRadarLog({data:r}))?void 0:t.catch)&&t.catch(function(t){b("124",t)}),!0}catch(t){return!1}},E);function E(t){var e,a=this,n=(this.queueConfig={wait:1e3,maxBatchLength:200},this.logQueue=[],this.preStoredLogQueue=[],this.batchTimer=0,this.eventName="onpagehide"in window?"pagehide":"beforeunload",this.customDimension={},this.runtimeIdMap={},this.randomSampling=Math.random(),this.commonDimension={},this.isInYoda=!1,this.sampleData={isHit:!0,core:1},this.ignoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],this.broadcastSample=G(),this.didRate=void 0,this.collect=function(t,e,n){var r=w({key:t,dimension:e=void 0===e?{}:e,value:n=void 0===n?{}:n});if(!a.sampleData||!1!==a.sampleData.isHit){if(!((n=r)?Object.keys(s).map(function(t){return s[t]}).indexOf(n.key)<0?(b("117"),0):tt[n.key](n):(b("116"),0)))return b("107","key: ".concat(r.key)),void a.collect(s.EVENT,{sample_rate:e.sample_rate,message:"radar上报日志类型错误",name:"radar_log_error",extra_info:JSON.stringify(r)},{});Object.keys(r.value).forEach(function(t){r.value[t]=r.value[t].toString()}),a.decorateLog(r);var o=a.getCommonData(),i=o.app_version_name;if(delete o.app_version_name,(t=new M(function(t,e){t.dimension.app_version_name=i,t.dimension.did_rate=a.didRate;var n=(null==(n=null==t?void 0:t.dimension)?void 0:n.event_client_timestamp)||Date.now(),r=(null==(r=null==t?void 0:t.dimension)?void 0:r.radar_session_id)||a.radarSessionId;return O(O(O({},t),o),{event_client_timestamp:n,event_trigger_source:"H5",radar_session_id:r})})).use(function(t,e){return t.key&&"load"===t.key&&(t.dimension=O(O({},t.dimension),{load_device_increase_id:rt("LOAD_DEVICE_INCREASE_ID"),load_session_increase_id:a.genSessionIncreaseId("LOAD_SESSION_INCREASE_ID")})),t.key&&"load"!==t.key&&(t.dimension=O(O({},t.dimension),{other_device_increase_id:rt("OTHER_DEVICE_INCREASE_ID"),other_session_increase_id:a.genSessionIncreaseId("OTHER_SESSION_INCREASE_ID")})),e()}),(r=t.invoke(r))instanceof Error)throw r;try{window.dispatchEvent(new CustomEvent("get-radar-next-data",{detail:{kv:w(r)}}))}catch(t){}if(delete r.dimension.broadcast_info,a.weblog?a.logQueue.push(r):(r.base_href=location.href,a.preStoredLogQueue.push(r)),function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];1==+ot(location.search.slice(1)).debug&&y.apply(void 0,c(["[radar] ".concat(t,": ")],p(e),!1))}("radarLogNext",JSON.parse(JSON.stringify(r))),a.logQueue.length>a.queueConfig.maxBatchLength-1)return a.flush(),clearTimeout(a.batchTimer),void(a.batchTimer=0);a.batchTimer||(a.batchTimer=window.setTimeout(function(){a.flush(),clearTimeout(a.batchTimer),a.batchTimer=0},a.queueConfig.wait))}},this.flush=function(){var t;a.logQueue.length<=0||(t=null,(t=a.config.httpReportFirst?t:a.reportByBridge())&&!a.config.httpReportFirst||a.reportByHttp(),a.logQueue=[])},"object"==typeof t&&null!==t||_("108"),"string"!=typeof t.projectId&&_("109"),v("radarSessionId"));this.radarSessionId=null!=n?n:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),this.config=t,this.sampling="number"==typeof(e=null!=(n=this.config.sampling)?n:1)&&0<=e&&e<=1?e:(b("110"),1),this.bindWeblogger(t.weblogger),null!=(n=this.config)&&n.ignoreList&&Array.isArray(null==(t=this.config)?void 0:t.ignoreList)&&(this.ignoreList=this.ignoreList.concat(this.config.ignoreList.map(function(t){return t.replace(/^(https?:)?\/\//,"")}))),this.queueConfig=O(O({},this.queueConfig),null!=(n=this.config)&&n.queueConfig?this.config.queueConfig:{}),null!=(t=this.config)&&t.customDimensions&&this.setDimensions(null==(n=this.config)?void 0:n.customDimensions),m(window,this.eventName,this.flush),"undefined"!=typeof window&&window.yodaCollectErrorDataDestroy&&window.yodaCollectErrorDataDestroy()}var st=function(t,e){return(st=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},k=function(){return(k=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function ct(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}var lt={redirect:{end:"redirectEnd",start:"redirectStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(t,e){return e.redirectCount}},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ssl_start:{custom:function(t,e){return e.secureConnectionStart&&e.navigationStart?e.secureConnectionStart-e.navigationStart:null}},ttfb:{end:"responseStart",start:"requestStart"},request_start:{end:"requestStart",start:"navigationStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domInteractive"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=performance.getEntries().filter(function(t){return"first-paint"===t.name})[0];return t?Math.ceil(t.startTime+t.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=(e="undefined"!=typeof window?window.performance:null)&&e.timing?"function"==typeof e.timing.toJSON?((t=e.timing.toJSON())&&!t.redirectStart&&(t.redirectStart=t.navigationStart),t):e.timing:null,e=performance.getEntries(),n=performance.getEntries().filter(function(t){return"navigation"===t.initiatorType})[0],e=e.filter(function(t){return"script"===t.initiatorType})[0],n=n?n.domComplete:t.domComplete-t.navigationStart;return e&&n?n-e.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(t,e){return e.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document&&void 0!==document.all?document.all.length:null}}},ut={main_api:{end:"apiEnd",start:"apiStart",notCatchIfUndefined:!0},main_api_offset:{end:"apiStart",start:"responseEnd",notCatchIfUndefined:!0},fmp:{end:"fmp_time",start:"navigationStart",notCatchIfUndefined:!0}},pt={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connectStart",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",connect_end_time:"connectEnd",load_event_end:"loadEventEnd",dom_complete:"domComplete",dom_content_loaded_event_start:"domContentLoadedEventStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",radar_init_time:"radar_init_time",fmp_time:"fmp_time"};function dt(n,t){if(!Array.isArray(t))return-1;var r=-1;return t.forEach(function(t,e){new RegExp(t).test(n)&&(r=e)}),r}var ft=function(e){function t(t){var v=this;return(v=e.call(this,{core:null==t?void 0:t.core,key:s.LOAD,version:"1.2.5",name:"RadarNavigationCollect"})||this).hasFMP=!1,v.syncMetricNum=0,v.customKeys=[],v.custom_metric={},v.optionsMainAPI=[],v.mainAPIList=[],v.radarMainApiList=[],v.mainJSList=[],v.radarMainJSList=[],v.radarTiming={radar_init_time:void 0,fmp_time:void 0,fmp:void 0,apiStart:void 0,apiEnd:void 0},v.h5Load=function(){var t=v.getPerformanceData();v.collect(k({event_name:"h5_load"},t))},v.dealAPI=function(t){return v.cacheAndCalculateMainAPI(t),v.addMainApiResult(t),v.mainAPIList.filter(function(t){return!!t.url}).length!==v.mainAPIList.length||void 0===v.radarTiming.fmp},v.addMainJSResult=function(t){if(!v.mainJSList||0===v.mainJSList.length)return!1;var e,n,r,o,i,a,s,c,l,u,p,d,f,m,h,g=dt((t.file||"").replace(/\?.+$/,""),v.mainJSList);return-1<g&&!v.radarMainJSList[g].file&&(e=t.file,n=t.cached,r=t.size,o=t.failed,i=t.res_type,a=t.protocol,s=t.fb,c=t.dns,l=t.tcp,u=t.ssl,p=t.ttfb,d=t.trans,f=t.total,m=t.fetch_start,h=t.duration,t=t.start_time,v.radarMainJSList[g]={file:e,cached:n,size:r,failed:o,res_type:i,protocol:a,fb:s,dns:c,tcp:l,ssl:u,ttfb:p,trans:d,total:f,fetch_start:m,duration:h,start_time:t,reg:v.mainJSList[g]}),v.radarMainJSList.filter(function(t){return!!t.file}).length!==v.mainJSList.length},t.core||_("212"),"string"==typeof t.mainApi?(v.optionsMainAPI.push(t.mainApi),v.mainAPIList.push({}),v.radarMainApiList.push({})):Array.isArray(t.mainApi)&&(3<t.mainApi.length&&y("207"),v.optionsMainAPI=t.mainApi.slice(0,3),v.optionsMainAPI.forEach(function(){v.mainAPIList.push({}),v.radarMainApiList.push({})})),"string"==typeof t.mainJs?(v.mainJSList.push(t.mainJs),v.radarMainJSList.push({})):Array.isArray(t.mainJs)&&(3<t.mainJs.length&&y("211"),v.mainJSList=t.mainJs.slice(0,3),v.mainJSList.forEach(function(){return v.radarMainJSList.push({})})),performance.timing?v.init():(null!=(t=v.core)&&t.collect("event",{name:"radar_error",message:"performance.timing 不存在无法收集数据",category:s.LOAD}),b("208")),v}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return st(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.init=function(){this.radarTiming.radar_init_time=Date.now();var t,e=this.getPerformanceData();this.collect(k({event_name:"radar_init"},e)),null!=(t=null==(e=this.core)?void 0:e.setCommonDimension)&&t.call(e,"happen_stage","during_fmp"),0<performance.timing.loadEventStart?this.h5Load():m(window,"load",this.h5Load)},t.prototype.customStage=function(t,e){var n,r;void 0===e&&(e={sendTimeline:!0}),this.isHit?(void 0!==t&&"string"==typeof t&&""!==t||_("206"),this.isValidTimestamp(e.timestamp,"custom_stage "+t)&&(n=e.timestamp||Date.now(),r=this.customKeys.length-this.syncMetricNum,this.customKeys.includes(t)?b("204",t):e.sendTimeline&&2<this.syncMetricNum||!e.sendTimeline&&5<r?b("205",t):n&&(this.custom_metric[t+"_time"]=n,this.customKeys.push(t),!e||!0!==e.sendTimeline&&null!=e.sendTimeline||(r=this.getPerformanceData(),this.collect(k(k({},r),{stack:(new Error).stack,event_name:"h5_custom_metric",custom_metric_name:t,custom_metric_timestamp:n})),this.syncMetricNum++)))):b("200")},t.prototype.isValidTimestamp=function(t,e){var n;if(void 0===e&&(e="fmp"),void 0!==t&&"number"!=typeof t)_("201");else if(void 0!==t&&t<performance.timing.navigationStart)return y("210","".concat(e)),null!=(n=this.core)&&n.collect("event",{name:"radar_error",message:"【210】".concat(e),extra_info:{timestamp:t,navigationStart:performance.timing.navigationStart}}),!1;return!0},t.prototype.fmp=function(t){var e,n;this.isHit?this.isValidTimestamp(t)&&(t=t||Date.now(),this.hasFMP?y("202"):t&&performance.timing&&(null!=(n=null==(e=this.core)?void 0:e.setCommonDimension)&&n.call(e,"happen_stage","after_fmp"),this.hasFMP=!0,this.radarTiming.fmp_time=t,performance.timing.radarFmp=t,n=this.getPerformanceData(),performance.timing.fmp=this.radarTiming.fmp=n.fmp,this.collect(k({event_name:"fmp",stack:(new Error).stack},n)))):y("200")},t.prototype.getPerformanceData=function(){var e=k(k({},w(performance.timing)),this.radarTiming),n=f(k(k({},lt),ut),e);return Object.keys(pt).forEach(function(t){0<=e[pt[t]]&&(n[t]=e[pt[t]])}),["radar_main_js_start","lcp","cls","fid","fcp"].forEach(function(t){var e=window.__RADAR_PERFORMANCE_TIMING_&&window.__RADAR_PERFORMANCE_TIMING_[t];!e&&0!==e||(n[t]=e)}),n},t.prototype.cacheAndCalculateMainAPI=function(t){var e;void 0===this.radarTiming.fmp&&(t.before_hook_time&&(e=this.radarTiming.apiStart,this.radarTiming.apiStart=e?Math.min(e,t.before_hook_time):t.before_hook_time),t.after_hook_time&&(e=this.radarTiming.apiEnd,this.radarTiming.apiEnd=e?Math.max(e,t.after_hook_time):t.after_hook_time))},t.prototype.addMainApiResult=function(t){var e,n,r,o,i,a,s,c,l,u,p,d,f,m,h,g,v,_,y=dt((t.api||"").replace(/\?.+$/,""),this.optionsMainAPI);-1<y&&(null==(_=this.mainAPIList[y])||!_.url)&&(_=t.api,e=t.status,n=t.size,r=t.cached,o=t.method,c=t.perfTime,i=t.protocol,a=t.custom_failed,s=t.res_type,v=ct(t,["api","status","size","cached","method","perfTime","protocol","custom_failed","res_type"]),this.mainAPIList[y]=k({url:_,status:e,size_radar:n,cached:r,method:o,perfTime:c,protocol:i,res_type:s,custom_failed:a},v),c=v.fb,l=v.dns,u=v.tcp,p=v.ssl,d=v.ttfb,f=v.trans,m=v.total,h=v.fetch_start,g=v.duration,v=v.start_time,this.radarMainApiList[y]={api:_,status:e,size:n,cached:r,method:o,protocol:i,fb:c,dns:l,tcp:u,ssl:p,ttfb:d,trans:f,total:m,fetch_start:h,duration:g,custom_failed:a,res_type:s,reg:this.optionsMainAPI[y],start_time:v},this.radarTiming.fmp_time&&t.after_hook_time&&t.after_hook_time<this.radarTiming.fmp_time&&(_=this.getPerformanceData(),this.collect(k({event_name:"main_api"},_))))},t.prototype.destroy=function(){h(window,"load",this.h5Load),this.customStage=this.fmp=function(){y("213")}},t.prototype.collect=function(t){var e=t.protocol,n=t.event_name,r=(t.custom_metric,t.custom_metric_name),o=t.stack;t.main_api_list,t=ct(t,["protocol","event_name","custom_metric","custom_metric_name","stack","main_api_list"]),this.baseCollect({value:t,dimension:{protocol:e,event_name:n,custom_metric_name:r,custom_metric:JSON.stringify(this.custom_metric),main_api_list:this.mainAPIList,radar_main_api_list:this.radarMainApiList,radar_main_js_list:this.radarMainJSList,is_official:1,stack:o}}),null!=(t=this.core)&&t.flush()},t}(t),mt=function(t,e){return(mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},L=function(){return(L=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function ht(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}var gt=e,vt={navigation_start:"startTime",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function _t(t,e){if(t)return"function"==typeof t.get?t.get(e):t[e.toLowerCase()]}function yt(t){var e="";if("string"==typeof t)e=t;else try{e=JSON.stringify(t)}catch(n){e=String(t)}for(var n=0,r=0;r<e.length;r++){var o=e.charCodeAt(r);n+=o<128?1:o<2048?2:o<65536?3:o<1<<21?4:o<1<<26?5:o<1<<31?6:Number.NaN}return n}var bt=function(e){function t(t){var p=e.call(this,{core:null==(t=void 0===t?{}:t)?void 0:t.core,sampling:null==t?void 0:t.sampling,key:s.API,version:"1.2.5",name:"RadarAPICollect"})||this;return p.ignoreList=H,p.queue=[],p.logList=[],p.perfList=[],p.broadcastApi=G(),p.initiatorTypeList=[],p.beforeHook=function(t){var e,n,r,o;0===(null==(e=t.url)?void 0:e.indexOf("data:"))||a(t.url,p.ignoreList)||a(t.url,(null==(e=p.core)?void 0:e.ignoreList)||[])||"js"===l(t.url)||"css"===l(t.url)||(e={api:(n=t.url,r=(o=document.location).protocol,o=o.host,0===n.indexOf("//")?r+n:0===n.indexOf("/")?"".concat(r,"//").concat(o).concat(n):n),method:t.method,request:t,startTime:Date.now()},p.queue.push(e))},p.afterHook=function(e,t){var n,r=p.queue.find(function(t){return t.request===e});if(r){delete r.request;var o=r.startTime,i=(r=ht(r,["startTime"]),Date.now()),a=i-o,s=t.status;if("function"==typeof p.customizeRadarStatus)try{s=p.customizeRadarStatus(t)}catch(t){console.error(t)}var c=p.customHook({request:e,response:t,duration:a}),l=+_t(t.headers,"Content-Length")||0,u=et(_t(t.headers,"Server-Timing")),a=L(L(L({duration:a,logTime:Date.now(),status:s,size:+l,content_type:(n=t.headers)?"function"==typeof n.get?n.get("Content-Type"):n["content-type"]:null,custom_failed:!(200<=s&&s<300)},r),c),{before_hook_time:o,after_hook_time:i,trace_id:e.trace_id,server_timing:u});2===(null==(s=null==(l=_t(t.headers,"Intercept-Result"))?void 0:l.split(";"))?void 0:s.length)&&null!=(r=p.core)&&r.setCommonDimension&&(p.core.setCommonDimension("intercept_result",s[0],!1),p.core.setCommonDimension("intercept_result_code",s[1],!1),a.api_intercept_result=s[0],a.api_intercept_result_code=s[1]),t.finalUrl&&(a.api=t.finalUrl),"string"==typeof t.text&&(a.responseData=t.text),0!==L(L({},t),{status:a.status}).status||c.intercept_report?p.mergeAPIPerf(void 0,a)||p.logList.push(a):(a.size&&0!=a.size||!a.responseData||(a.size=yt(a.responseData)),delete a.responseData,delete a.server_timing,p.collect(a)),p.queue=p.queue.filter(function(t){return t.request&&t.request!==e})}},void 0!==(p.option=t)&&null!=t&&t.core||_("310"),void 0!==t.ignoreList&&(Array.isArray(t.ignoreList)||_("309"),t.ignoreList.forEach(function(t){"string"!=typeof t&&_("309")}),p.ignoreList=p.ignoreList.concat(t.ignoreList)),p.APIHook=t.APIHook,p.customizeRadarStatus=t.customizeRadarStatus,p.init(),p}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return mt(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.init=function(){var e,r,l,o,n=this;try{this.observer=new PerformanceObserver(function(t){return n.observeAPI(t)}),this.observer.observe({entryTypes:["resource"]}),this.initiatorTypeList=[],!0!==this.option.ignoreXHR&&(this.initiatorTypeList.push("xmlhttprequest"),this.unhookXML=(r=function(t){return n.beforeHook(t)},l=function(t,e){return n.afterHook(t,e)},(o=window.XMLHttpRequest)?(window.XMLHttpRequest=function(){var n,a,e,s=new o,t=(s._radarRequest={},s._radarResponse={},V()),c=(s._radarRequest.id=t,{});return s.addEventListener("readystatechange",function(){if(4===s.readyState&&"function"==typeof l){s._radarResponse.status=s.status,s._radarResponse.statusText=s.statusText;var t,e,n,r,o,i=function(t,e){switch(null==e&&(e={}),typeof t){case"object":var n,r=[];for(n in t){var o=t[n],i=n.toLowerCase();r.push("".concat(i,":\t").concat(o))}return r.join("\n")+"\n";case"string":for(var a=0,s=(r=t.split("\n")).length;a<s;a++){var c=r[a];/([^:]+):\s*(.+)/.test(c)&&(c=null!=(c=RegExp.$1)?c.toLowerCase():void 0,o=RegExp.$2,c&&null==e[c]&&(e[c]=o))}return e}}(s.getAllResponseHeaders());for(t in i)n=i[t],s._radarResponse&&s._radarResponse.headers&&!s._radarResponse.headers[t]&&(e=t.toLowerCase(),s._radarResponse.headers[e]=n);if(s.responseType&&"text"!==s.responseType)"document"===s.responseType?(s._radarResponse.xml=s.responseXML,s._radarResponse.data=s.responseXML):s._radarResponse.data=s.response;else{s._radarResponse.text=s.responseText,s._radarResponse.data=s.responseText;try{s._radarResponse.xml=s.responseXML}catch(t){}}"responseURL"in s&&(s._radarResponse.finalUrl=s.responseURL);try{var a=null!=(r=c["ktrace-str"])?r:"";a&&window.parseWedTraceId&&(s._radarRequest.trace_id=window.parseWedTraceId(null!=(o=a.split("|")[1])?o:""))}catch(t){y("traceId 解析异常")}l(s._radarRequest,s._radarResponse)}}),"function"==typeof s.setRequestHeader&&(n=s.setRequestHeader,s.setRequestHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return W.includes(t[0])&&(c[t[0]]=t[1]),n.apply(this,t)}),"function"==typeof s.open&&(a=s.open,s.open=function(t,e,n,r,o){var i=[].slice.call(arguments);return this._radarRequest=u({method:t,url:e,async:n,user:r,pass:o},this._radarRequest),this._radarResponse.headers={},a.apply(this,i)}),"function"==typeof s.send&&(e=s.send,s.send=function(){var t=[].slice.call(arguments);return"function"==typeof r&&(this._radarRequest._config=t[0],r(this._radarRequest)),e.apply(this,t)}),s},["DONE","HEADERS_RECEIVED","LOADING","OPENED","UNSENT"].forEach(function(t){window.XMLHttpRequest[t]=o[t]}),window.XMLHttpRequest.prototype=o.prototype,function(){o&&(window.XMLHttpRequest=o)}):(b("118"),!1))),!0!==this.option.ignoreFetch&&(this.initiatorTypeList.push("fetch"),this.unhookFetch=Y(function(t){return n.beforeHook(t)},function(t,e){return n.afterHook(t,e)}))}catch(t){b("308"),null!=(e=this.core)&&e.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:s.API})}},t.prototype.customHook=function(t){var e={};if(void 0===this.APIHook)return e;if("function"!=typeof this.APIHook)return y("300"),e;var n={};try{n=this.APIHook(t)}catch(t){return y("301",t),{}}if(!n)return y("302"),e;t=n.response_msg;var r=n.response_code,o=n.status,i=n.custom_failed,a=n.intercept_report,n=n.broadcast_info;if(!0===Boolean(a)&&(e.intercept_report=!0),void 0!==t)try{var s=JSON.stringify(t);100<s.length&&y("307"),e.response_msg=s.slice(0,100)}catch(t){e.response_msg="response_msg返回结果异常",y("303")}return void 0!==r&&(a=Number(r),isNaN(a)?y("304"):e.response_code=a),void 0!==o&&(t=Number(o),isNaN(t)?y("305"):e.status=t),void 0!==i&&(!0===i||!1===i?e.custom_failed=i:y("306")),e.broadcast_info=n,e},t.prototype.observeAPI=function(t){var o=this;t.getEntriesByType("resource").forEach(function(e){var t,n,r;if(0===(null==(r=e.name)?void 0:r.indexOf("data:"))||a(e.name,o.ignoreList)||a(e.name,(null==(r=o.core)?void 0:r.ignoreList)||[]))return!1;"api"===X(e)&&((r=f(gt,e)).perfTime=Date.now(),null!=(t=null==(t=e.serverTiming)?void 0:t.map(function(t){return{name:t.name,duration:t.duration,description:t.description||void 0}}))&&t.length||(t=void 0),n={encoded_body_size:e.encodedBodySize,decoded_body_size:e.decodedBodySize},Object.keys(vt).forEach(function(t){n[t]=Number(e[vt[t]]+performance.timing.navigationStart)}),r=L(L(L(L({},r),{api:r.file}),n),{server_timing:t}),o.mergeAPIPerf(r)||o.perfList.push(r))})},t.prototype.destroy=function(){this.unhookXML&&this.unhookXML(),this.unhookFetch&&this.unhookFetch(),this.observer&&this.observer.disconnect()},t.prototype.mergeAPIPerf=function(t,e){if(t?e=this.takeItem(t,this.logList):e&&(t=this.takeItem(e,this.perfList)),!t||!e)return!1;if(!0===e.intercept_report)return!0;var n,r=Object.assign({},e,t,{size:t.size||e.size});return delete r.file,r.size&&0!=r.size||!r.responseData||(r.size=yt(r.responseData)),delete r.responseData,(e=e.server_timing||t.server_timing)&&(n=null,e.map(function(t){"total-timing"===t.name&&(n=null!=(t=t.duration)?t:null)}),r.total_server_timing=n,r.server_data_list=JSON.stringify(e)),delete r.server_timing,this.collect(r),!0},t.prototype.takeItem=function(t,e){var n,r=(t.api||"").replace(/\?.+$/,"");if(-1!==(t=e.findIndex(function(t){return t=(t.api||"").replace(/\?.+$/,""),r===t})))return n=e[t],e.splice(t,1),n},t.prototype.collect=function(i){var a=this,t=i.res_type,e=i.protocol,n=i.api,r=i.custom_failed,o=i.status,s=i.cached,c=i.method,l=i.response_code,u=i.response_msg,p=(i.has_fmp,i.server_data_list),d=i.content_type,f=i.broadcast_info,m=i.before_hook_time,h=i.after_hook_time,g=i.api_intercept_result,v=i.api_intercept_result_code,_={dimension:{before_hook_time:m,after_hook_time:h,res_type:t,protocol:e,api:n,custom_failed:r,status:o,cached:s,method:c,response_code:l,response_msg:u,content_type:d,broadcast_info:f,is_official:1,server_data_list:p,trace_id:i.trace_id,api_intercept_result:g,api_intercept_result_code:v,has_timing_allow:i.has_timing_allow},value:ht(i,["res_type","protocol","api","custom_failed","status","cached","method","response_code","response_msg","has_fmp","server_data_list","content_type","broadcast_info","before_hook_time","after_hook_time","api_intercept_result","api_intercept_result_code","trace_id","has_timing_allow"])};this.broadcastApi.emit(w(i)),0===o&&S(this.option.isIgnoreInvalidStatusCode)?new Promise(function(e,t){var n,r,o;a.option.isIgnoreInvalidStatusCode&&(n=a.option.isIgnoreInvalidStatusCode(i),(o=n)&&S(o.then)&&S(o.catch)?(r=setTimeout(function(){return e(!1)},2e3),n.then(function(t){clearTimeout(r),e(!0===t)},t)):e(!0===n))}).then(function(t){t?y("异步拦截日志"):a.baseCollect(_)},function(t){a.baseCollect(_),b(t)}):this.baseCollect(_)},t}(t),St=function(t,e){return(St=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},R=function(){return(R=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},wt=Object.assign({},e,{duration:{end:"responseEnd",start:"fetchStart"},cached_type:{custom:function(t,e){var n="hit_browser";if(0===e.transferSize||0===e.duration)return n;if(null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart))return n;if(e.serverTiming&&e.serverTiming.some(function(t){return"cdn"===t.name})){if(e.serverTiming.some(function(t){return"miss"===t.name}))return"miss_cdn";if(e.serverTiming.some(function(t){return"hit"===t.name}))return"hit_cdn"}return"miss_browser"},crossOriginSkip:!0},cdn_duration:{custom:function(t,e){return e.serverTiming&&e.serverTiming.some(function(t){return"cdn"===t.name})?null==(e=null==(e=e.serverTiming)?void 0:e.find(function(t){return"total-timing"===t.name}))?void 0:e.duration:null},crossOriginSkip:!0,cachedSkip:!0},cdn_ip:{custom:function(t,e){if(e.serverTiming&&e.serverTiming.some(function(t){return"cdn"===t.name}))return null==(e=e.serverTiming.find(function(t){return"miss"===t.name||"hit"===t.name}))?void 0:e.description},crossOriginSkip:!0,cachedSkip:!0}}),Ot={fetch_start_time:"fetchStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function P(t){return{name:t,value:1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,delta:0,entries:[],id:"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),isFinal:!1}}function C(t,e){try{var n;if(PerformanceObserver.supportedEntryTypes.includes(t))return(n=new PerformanceObserver(function(t){return t.getEntries().map(e)})).observe({type:t,buffered:!0}),n}catch(t){}}function Et(t){xt=!t.persisted}function x(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];At||(It(),At=!0),addEventListener("visibilitychange",function(t){t=t.timeStamp,"hidden"===document.visibilityState&&e({timeStamp:t,isUnloading:xt})},{capture:!0,once:t})}function A(t,e,n,r){var o;return function(){n&&e.isFinal&&n.disconnect(),0<=e.value&&(r||e.isFinal||"hidden"===document.visibilityState)&&(e.delta=e.value-(o||0),(e.delta||e.isFinal||void 0===o)&&(t(e),o=e.value))}}function kt(){return void 0===I&&(I="hidden"===document.visibilityState?0:1/0,x(function(t){return t=t.timeStamp,I=t},!0)),{get timeStamp(){return I}}}var I,Lt,Rt,Pt=function(n){function t(t){var e,o=this;return(o=n.call(this,{core:null==t?void 0:t.core,sampling:null!=(e=null==t?void 0:t.sampling)?e:.1,version:"1.2.5",key:s.RES,name:"RadarResourceCollect"})||this).ignoreList=H,o.broadcastJs=G(),o.onResError=function(t,e){var n;(n=t).message||null!=n.lineno||(n=(t.target.src||t.target.href||"").toString(),n={failed:!0,file:n="function"!=typeof t.target.getAttribute||""!==t.target.getAttribute("src")&&""!==t.target.getAttribute("href")?n:"",res_path:(t=t&&t.path||t&&t.composedPath&&t.composedPath(),Array.isArray(t)?t.map(function(t){var e=void 0===(e=t.tagName)?"":e,n=t.id;return t=t.getAttribute?t.getAttribute("class"):t.className||"",e=e.toLowerCase(),n&&(e+="#".concat(n)),t&&(e+=t.split(/\s+/g).map(function(t){return".".concat(t)}).join("")),e}).filter(function(t){return t}).join(","):"")},o.collect(n,e),o.broadcastJs.emit(n))},o.observeResource=function(t){t.getEntriesByType("resource").forEach(function(e){var t,n,r;if(0===e.name.indexOf("data:")||a(e.name,o.ignoreList)||a(e.name,(null==(t=o.core)?void 0:t.ignoreList)||[]))return!1;"resource"===X(e)&&(t=f(wt,e),n={encoded_body_size:e.encodedBodySize,decoded_body_size:e.decodedBodySize},Object.keys(Ot).forEach(function(t){n[t]=Number(e[Ot[t]]+performance.timing.navigationStart)}),r=R(R({failed:!1},t),n),o.collect(r),setTimeout(function(){o.broadcastJs.emit(r)}))})},o.resourceHook=t.resourceHook,void 0!==t.ignoreList&&(Array.isArray(t.ignoreList)||_("802"),t.ignoreList.forEach(function(t){"string"!=typeof t&&_("802")}),o.ignoreList=o.ignoreList.concat(t.ignoreList)),o.init(),o}var e=t,r=n;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=e}return St(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.init=function(){var e,n=this;try{this.observeResource(performance),this.observer=new PerformanceObserver(function(t){return n.observeResource(t)}),this.observer.observe({entryTypes:["resource"]})}catch(t){b("801"),null!=(e=this.core)&&e.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:s.RES})}m(window,"error",function(t){return n.onResError(t)},!0),this.parseSeedLog()},t.prototype.parseSeedLog=function(){var n=this,t=v(F,[]);t.length&&(t.map(function(t){var e=t.data;t=t.dimension||{},n.onResError(e,t)}),nt(F,[]))},t.prototype.collect=function(t,e){var n=t.cached,r=t.failed,o=t.file,i=t.protocol,a=t.res_type,s=t.res_path,c=t.cached_type,l=t.cdn_ip,u=t.has_timing_allow;t=function(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(t,["cached","failed","file","protocol","res_type","res_path","cached_type","cdn_ip","has_timing_allow"]);try{var p=this.resourceHook&&this.resourceHook({file:o,cached:n,protocol:i,res_type:a,failed:r});if(null!=p&&p.intercept_report)return}catch(t){b("803",t)}this.baseCollect({value:t,dimension:R({cached:n,failed:r,file:o,protocol:i,res_type:a,res_path:s,sample_rate:this.sampling,is_official:1,cached_type:c,cdn_ip:l,has_timing_allow:u},e)})},t.prototype.destroy=function(){this.isHit&&(h(window,"error",this.onResError,!0),this.observer&&this.observer.disconnect())},t}(t),Ct=function(t,e){return(Ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},xt=!1,At=!1,It=function(){addEventListener("pagehide",Et),addEventListener("beforeunload",function(){})},Tt=[{name:"fid",collectFn:function(t){function e(t){t.startTime<r.timeStamp&&(n.value=t.processingStart-t.startTime,n.entries.push(t),n.isFinal=!0,i())}var n=P("FID"),r=kt(),o=C("first-input",e),i=A(t,n,o);o?x(function(){o.takeRecords().map(e),o.disconnect()},!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay(function(t,e){e.timeStamp<r.timeStamp&&(n.value=t,n.isFinal=!0,n.entries=[{entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t}],i())})}},{name:"lcp",collectFn:function(t){function e(t){var e=t.startTime;e<i.timeStamp?(o.value=e,o.entries.push(t)):o.isFinal=!0,n()}var n,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=P("LCP"),i=kt(),a=C("largest-contentful-paint",e);a&&(n=A(t,o,a,r),r=function(){o.isFinal||(a.takeRecords().map(e),o.isFinal=!0,n())},(Lt=Lt||new Promise(function(e){return["scroll","keydown","pointerdown"].map(function(t){addEventListener(t,e,{once:!0,passive:!0,capture:!0})})})).then(r),x(r,!0))}},{name:"cls",collectFn:function(t){function e(t){t.hadRecentInput||(o.value+=t.value,o.entries.push(t),n())}var n,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=P("CLS",0),i=C("layout-shift",e);i&&(n=A(t,o,i,r),x(function(t){t=t.isUnloading,i.takeRecords().map(e),t&&(o.isFinal=!0),n()}))}},{name:"fcp",collectFn:function(t){var e,n=P("FCP"),r=kt(),o=C("paint",function(t){"first-contentful-paint"===t.name&&t.startTime<r.timeStamp&&(n.value=t.startTime,n.isFinal=!0,n.entries.push(t),e())});o&&(e=A(t,n,o))}}],Dt=function(e){function t(t){var o=e.call(this,{core:t.core,sampling:t.sampling,version:"1.2.5",key:s.EVENT,name:"RadarChromeMetricsCollect"})||this;return o.options={lcp:!1,cls:!1,fid:!1,fcp:!1},o.init=function(){var n=o.options;Tt.forEach(function(t){var e=t.name;n&&!n[e]||t.collectFn(function(t){var e,n,r=t.name;t=t.value,e=r.toLocaleLowerCase(),n=Number(t),null!==window&&void 0!==window&&window.__RADAR_PERFORMANCE_TIMING_||(window.__RADAR_PERFORMANCE_TIMING_={}),window.__RADAR_PERFORMANCE_TIMING_[e]=n,o.baseCollect({dimension:{name:r.toLocaleLowerCase(),is_official:1},value:{duration:Number(t)}})})})},Object.assign(o.options,t.options),Tt.forEach(function(t){var e=$("radar_"+t.name);e&&(o.options[t.name]="1"===e)}),o.init(),o}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return Ct(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t}(t),jt=function(t,e){return(jt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Nt=function(){return(Nt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Mt=function(n){function t(t){var e=n.call(this,{core:t.core,sampling:t.sampling,key:s.EVENT,version:"1.2.5",name:"RadarEventCollect"})||this;return e.action={start:function(t){e._checkActionDimension(t),e.event({name:t.name,extra_info:t.extra_info,event_type:"radar_action_start"})},end:function(t){e._checkActionDimension(t),e.event({name:t.name,extra_info:t.extra_info,result_type:t.result_type,event_type:"radar_action_end"})}},e.parseSeedLog(),e}var e=t,r=n;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=e}return jt(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.parseSeedLog=function(){var n=this,t=v(z,[]);t.length&&(t.map(function(t){var e=t.dimension;t=t.value,n.event(e,t)}),nt(z,[]))},t.prototype.event=function(t,e){var n;this.isHit?(t||_("402"),void 0!==t.name&&"string"==typeof t.name||_("402"),127<t.name.length&&(b("403"),t.name=t.name.slice(0,127)),t.is_official=1,e&&void 0!==e.duration&&("number"!=typeof e.duration||e.duration<0)&&_("404"),e&&void 0!==e.event_count&&("number"!=typeof e.event_count||e.event_count<0)&&_("405，".concat(e.event_count)),n={dimension:t,value:e},t&&t.extra_info&&"object"==typeof t.extra_info&&(n={dimension:Nt(Nt({},t),{extra_info:JSON.stringify(t.extra_info)}),value:e}),this.baseCollect(n)):y("401")},t.prototype.destroy=function(){this.event=function(){y("407")},this.action={start:function(){y("407")},end:function(){y("407")}}},t.prototype._checkActionDimension=function(t){if(!t)throw Error("408");void 0===t.extra_info||t.extra_info instanceof Object||_("406")},t}(t),Ht=function(t,e){return(Ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},T=function(){return(T=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Rt={SCRIPT:"script",RES:"res",API:"api",VIDEO:"video"};var D=[];function Jt(t,e,n){var r,o;if(e&&(e instanceof Error||"object"==typeof e&&"string"==typeof e.message)){if("BridgeError"===(r=e.name||"ErrorLikeObject")&&"function"==typeof e.toJSON)try{var i=e.toJSON();delete i.name,delete i.message,o="".concat(e.message," (").concat(JSON.stringify(i),")")}catch(t){o=e.message||""}else o=e.message||"";i=e.stack||void 0}else o=null==e&&"Script error."===(null==n?void 0:n.message)?(r="CrossOriginError","".concat(t," - message: ").concat((null==n?void 0:n.message)||"<UNKNOWN>")):null===e&&null!=n&&n.message&&"Uncaught null"!==n.message?(r="Error","".concat(t," - message: ").concat(n.message)):(r=null==e?"".concat(e):typeof e,n=function(t){var e;try{e=t.toString(),t&&"object"==typeof t&&(e=JSON.stringify(t))}catch(t){}return"string"!=typeof e||""===e?e=null===t?"<NULL>":void 0===t?"<UNDEFINED>":""===e?"<EMPTY>":"<UNKNOWN>":2e3<e.length&&(e=e.substring(0,2e3)+"<<< ……"),e}(e),"".concat(t," - value: ").concat(n));return{error_type:Rt.SCRIPT,error_cons_type:r,msg:o,stack:i}}function qt(t){for(var e,n,r=0;r<D.length;r++)if(e=D[r],n=t,e.msg===n.msg&&e.stack===n.stack&&e.file===n.file&&e.line===n.line&&e.col===n.col)return r;return-1}var Ut=function(e){function t(t){var r=e.call(this,{core:t.core,sampling:t.sampling,key:s.ERROR,version:"1.2.5",name:"RadarErrorCollect"})||this;return r.onError=function(t,e){var n;!(n=t).message&&null==n.lineno||(t=T(T({},Jt("Global Uncaught Exception",t.error,t)),{file:t.filename,line:t.lineno,col:t.colno}),r.isSameErrorAndReport(t,e))},r.onPromiseError=function(t,e){t=Jt("Unhandled Promise Rejection",t.reason),r.isSameErrorAndReport(t,e)},r.core=t.core,r.init(),r}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return Ht(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.init=function(){D.splice(0),m(window,"error",this.onError,!0),m(window,"unhandledrejection",this.onPromiseError),this.parseSeedLog()},t.prototype.destroy=function(){h(window,"error",this.onError,!0),h(window,"unhandledrejection",this.onPromiseError),this.captureException=function(){y("600")}},t.prototype.parseSeedLog=function(){var n=this,t=v(U,[]);t.length&&(t.map(function(t){var e=t.data;t=t.dimension||{},"unhandledrejection"===(null==e?void 0:e.type)?n.onPromiseError(e,t):n.onError(e,t)}),nt(U,[]))},t.prototype.isSameErrorAndReport=function(t,e){0<=qt(t)||(D.push(t),setTimeout(function(){D.splice(qt(t),1)},2e3),this.collect(t,e))},t.prototype.collect=function(t,e){var n,r,o,i,a,s,c,l;r=(n=t).error_cons_type,o=n.file,i=n.error_type,a=n.msg,s=n.col,c=n.line,l=n.stack,t={key:"error",value:function(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(n,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:r,file:o,error_type:i,msg:a,col:s,line:c,stack:l}},e=T(T({},t.dimension),e||{}),this.baseCollect({dimension:e,value:t.value})},t.prototype.captureException=function(t){this.isSameErrorAndReport(Jt("Captured Exception",t))},t}(t),e=(j.prototype.apply=function(t){this.bindWeblogger(t)},j.prototype.bindWeblogger=function(t){this.weblogger=t,this.core.bindWeblogger(this.weblogger)},j.prototype.event=function(t,e){this.eventCollect.event(t,e)},j.prototype.customStage=function(t,e){this.navigationCollect.customStage(t,e)},j.prototype.setDimensions=function(t){this.core.setDimensions(t)},j.prototype.fmp=function(t){"number"==typeof t?this.navigationCollect.fmp(t):"object"==typeof t&&t.timestamp?this.navigationCollect.fmp(t.timestamp):this.navigationCollect.fmp()},j.prototype.captureException=function(t){var e;this.errorCollect?null!=(e=this.errorCollect)&&e.captureException(t):console.warn("902")},j.prototype.destroy=function(){var t;null!=(t=this.navigationCollect)&&t.destroy(),null!=(t=this.apiCollect)&&t.destroy(),null!=(t=this.resourceCollect)&&t.destroy(),null!=(t=this.eventCollect)&&t.destroy(),null!=(t=this.errorCollect)&&t.destroy()},j.key="radar",j.version="1.2.5",j);function j(t){var e,n=this;this.core=new at({weblogger:t.weblog,projectId:t.projectId,sampling:null!=(e=t.sampling)?e:1,httpReportFirst:t.httpReportFirst,customDimensions:t.customDimensions}),this.navigationCollect=new ft({core:this.core,mainApi:t.mainApi,mainJs:t.mainJs}),t.unuseAPIPlugin||(this.apiCollect=new bt({core:this.core,sampling:t.apiSampling,APIHook:t.APIHook,customizeRadarStatus:t.customizeRadarStatus,ignoreList:t.ignoreList,ignoreXHR:t.ignoreXHR,ignoreFetch:t.ignoreFetch,isIgnoreInvalidStatusCode:t.isIgnoreInvalidStatusCode}),this.apiCollect.broadcastApi.on(function(t){return n.navigationCollect.dealAPI(t)})),t.unuseResourcePlugin||(this.resourceCollect=new Pt({sampling:t.resourceSampling,core:this.core,ignoreList:t.ignoreList,resourceHook:t.resourceHook}),this.resourceCollect.broadcastJs.on(function(t){return n.navigationCollect.addMainJSResult(t)})),this.chromeMetricsCollect=new Dt({core:this.core,options:{lcp:t.lcp,cls:t.cls,fid:t.fid,fcp:t.fcp}}),this.eventCollect=new Mt({core:this.core}),this.action=this.eventCollect.action,t.unuseErrorPlugin||(this.errorCollect=new Ut({core:this.core})),o[i]&&(o[i][J]=!0)}return"undefined"!=typeof window&&"function"!=typeof window.Radar&&(window.Radar=e),e});
