# radar 采集器合集

考虑到雷达采集器接入成本问题，提供一个合集包，默认安装好雷达所有官方采集器，以供业务快速接入

采集器中所有依赖所有官方采集器

## 安装依赖

```bash
npm i @ks/weblogger
npm i @ks-radar/radar
```

## 常规Web场景

```typescript
import { Weblog } from '@ks/weblogger';
import Radar from '@ks-radar/radar';

const weblog = = new Weblog();
const radar = new Radar({
  weblog,
  projectId: '***',
})
```

### API

#### bindWeblogger

异步传入 weblogger 实例：支持在初始化时不传入 weblogger 实例对采集到的日志，异步传入 weblogger 实例，在传入后触发缓存日志数据的上报。

```typescript
import { Weblog } from '@ks/weblogger';
import Radar from '@ks-radar/radar';
// 初始化radar时可以不传入weblogger实例
const radar = new Radar({
  projectId: '***',
})
......
const weblog = = new Weblog(...);

// 传入weblogger实例
radar.bindWeblogger(weblog)

```

## Vue SPA 场景

```typescript
import { Weblog } from '@ks/weblogger';
import Radar from '@ks-radar/radar/vue-spa';
import router from '@/router';

const weblog = = new Weblog(...);
const radar = new Radar({
  weblog,
  projectId: '***',
  router, // spa 页面需要根据路由判断是否是否上报fmp sfmp，router为必传
})
```

详细使用说明可查看[官方文档](https://docs.corp.kuaishou.com/d/home/fcADjDgWjyG9CTROkT83HmNBs#)

### API

#### bindWeblogger

异步传入 weblogger 实例：支持在初始化时不传入 weblogger 实例对采集到的日志，异步传入 weblogger 实例，在传入后触发缓存日志数据的上报。

```typescript
import { Weblog } from '@ks/weblogger';
import Radar from '@ks-radar/radar/vue-spa';
// 初始化radar时可以不传入weblogger实例
const radar = new Radar({
  projectId: '***',
})
......
const weblog = = new Weblog(...);

// 传入weblogger实例
radar.bindWeblogger(weblog)

```


## KRN场景
```typescript
import { AppRegistry } from 'react-native';
import { Weblog } from '@ks/weblogger';
import RadarKrn from '@ks-radar/radar/krn';

const weblog = new Weblog();

function App(props?: any) {

    const radarKrn = new RadarKrn({
        weblog, // 传入weblogger实例
        props, // 直接透传即可
    });

    return <View>demo</View>;
}

export default App;

// 注册组件
AppRegistry.registerComponent('demo', () => App);
```

### 配置

| 属性            | 类型    | 说明                                                                                          | 是否必传 |
| --------------- | ------- | --------------------------------------------------------------------------------------------- | -------- |
| weblog       | object  | weblogger 实例                                                                            | 否       |
| props       | object  | KRN根组件参数                                                                            | 是       |

### props支持的参数
| 属性            | 类型    | 说明                                                                                          | 是否必传 |
| --------------- | ------- | --------------------------------------------------------------------------------------------- | -------- |
| sessionId       | string  | krn 页面打开时对应的 session id       | 是       |
| bundleId        | number  | bundle 包的唯一标识                                                                | 是       |
| bundleVersion | string | bundle 的版本号                                                                 | 是       |
| bundleVersionCode | number | bundle 的版本号（number 类型）                                                                 | 是       |
| componentName | string | 标识页面入口，一个 bundle 可以有多个入口                                                                 | 是       |
| jsExecutor | string | JS引擎                                                                | 是       |

### API
#### bindWeblogger

异步传入 weblogger 实例：支持在初始化时不传入 weblogger 实例对采集到的日志，异步传入 weblogger 实例，在传入后触发缓存日志数据的上报。
```typescript
// 传入weblogger实例
radarKrn.bindWeblogger(weblog)
```
#### event
```typescript
 // 通过 radar 上报自定义事件
radarKrn.event({
    name: '事件名', // 必填
    event_type: '事件类型', // 【可选】
    result_type: '事件结果', // 【可选】
    message: '消息', // 【可选】
    extra_info: '额外信息，支持 Object 和 String 格式' // 【可选】
}, {
    event_count: 123, //  【可选】 事件触发计数，一般用于记录当前页面下某个事件的触发次数 不涉及可不传
    duration: 123 // 【可选】时长（单位 ms），可以计算分位数
})
```
#### action

```typescript
// 通过 radar 上报关键动作
// 关键动作开始
radarKrn.action.start({
    name: '关键动作名', // 必填 
    extra_info: {}//【可选】支持 Object 和 String 格式
});
// 关键动作结束
radarKrn.action.end({
    name: '关键动作名',// 必填 
    extra_info : {},//【可选】支持 Object 和 String 格式
    result_type: '',//【可选】事件结果
});
```