# 雷达 RESOURCE 采集器

RESOURCE 采集器为雷达官方采集器，负责收集 API 相关的性能数据。该采集器通过监听 Performance 和 window error 的非脚本异常，自动收集页面 RESOURCE 相关的数据进行上报。上报后的数据可以在[雷达平台](https://radar-plus.corp.kuaishou.com/projects)查看。

## 前置需求

需要提前按照 @ks/weblogger @ks-radar/radar-core 两个包

## 接入教程

### 安装依赖

```bash
npm install @ks/weblogger
npm install @ks-radar/radar-core
npm install @ks-radar/radar-resource-collect
```

### 初始化插件

```typescript
import { Weblog } from '@ks/weblogger';
import RadarCore from '@ks-radar/radar-core';
import ResourceCollect from '@ks-radar/radar-resource-collect';

const weblog = new Weblog();

// 初始化core 用于采集公共数据，上报日志，需要在采集器初始化时传入，以供采集器使用
const core = new RadarCore({
    weblogger: weblog, // 传入weblogger实例
    projectId: '*****', // 传入项目id
    sampling: 1,
});

const resourceCollect = new ResourceCollect({
    core,
});
```

# 配置

支持初始化时配置如下参数

| 属性         | 是否必填 | 类型                                                                                                                                                                                          | 说明                                                                                            |
| ------------ | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| core         | 是       | RadarCore                                                                                                                                                                                     | @ks/radar-core 的实例                                                                           |
| sampling     | 否       | number                                                                                                                                                                                        | 采样率，默认为 1                                                                                |
| ignoreList   | 否       | string[]                                                                                                                                                                                      | 上报忽略 URI 列表，有的资源不想被监控，可以在这里忽略，不进行收集                               |
| resourceHook | 否       | ({file: string, // 资源地址<br/> cached: boolean,// 是否缓存<br/> protocol: string, // 协议<br/> res_type: string, // 类型<br/> failed: boolean // 是否失败}) => ({intercept_report:boolean}) | 通过 hook 方法，拦截资源上报，根据返回 intercept_report 结果判断是否拦截日志上报，true 为拦截。 |

# API

获取采集到的 Resource 性能数据

```typescript
resourceCollect.broadcastJs.on(item => {
    // item 为 resource 采集器收集到的数据
});
```
