# Radar Core

雷达官方核心功能包，Radar Core 的所有雷达采集器的基础。

Core 负责 SDK 除采集外的主要功能，即**公共数据处理**和**上报信息**。我们不希望 Core 带有任何业务色彩，对所有采集器来说，Core 的功能都是一致的，这样 Core 就可以做到对所有采集器进行**全局控制**。

由于雷达数据上报链路中，一些公共数据的获取和数据的上报是依赖 weblogger 的，所以由 Core 封装 Weblogger 的功能，Weblogger 对采集器透明，涉及到与 Weblogger 相关的处理都放在 Core 里。

## 前置需求

需要提前按照 @ks/weblogger 包

## 接入教程

### 安装依赖

```bash
npm install @ks/weblogger
npm install @ks-radar/radar-core
```

### 初始化

```typescript
import { Weblog } from '@ks/weblogger';
import RadarCore from '@ks-radar/radar-core';

const weblog = new Weblog();

// 初始化core 用于采集公共数据，上报日志，需要在采集器初始化时传入，以供采集器使用
const core = new RadarCore({
    weblogger: weblog, // 传入weblogger实例
    projectId: '*****', // 传入项目id
    sampling: 1,
});
```

## 配置

| 属性            | 类型    | 说明                                                                                          | 是否必传 |
| --------------- | ------- | --------------------------------------------------------------------------------------------- | -------- |
| weblogger       | object  | @ks/weblogger 实例                                                                            | 是       |
| projectId       | string  | 项目 id，在雷达平台新建/编辑项目获取[雷达平台](https://radar-plus.corp.kuaishou.com/projects) | 是       |
| sampling        | number  | 采样率，支持 0~1 的数字，默认为 1                                                             | 否       |
| httpReportFirst | boolean | 优先使用 http 上报，默认为 false                                                              | 否       |

## API

### bindWeblogger

异步传入 weblogger 实例：core 支持在初始化时不传入 weblogger 实例对采集到的日志，异步传入 weblogger 实例，在传入后触发缓存日志数据的上报。

```typescript
import { Weblog } from '@ks/weblogger';
import RadarCore from '@ks-radar/radar-core';
// 在初始化时不传入weblogger实例
const core = new RadarCore({
    projectId: '*****', // 传入项目id
    sampling: 1,
});

......
const weblog = new Weblog();
core.bindWeblogger(weblog)
```
