import{RADAR_KEY as t,setRadarTiming as n,getSwitchFromCookie as e,BaseCollect as i}from"@ks-radar/radar-util";var a=function(t,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)};var r,o,c=function(){return"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)},s=function(t){return{name:t,value:1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,delta:0,entries:[],id:c(),isFinal:!1}},u=function(t,n){try{var e;if(PerformanceObserver.supportedEntryTypes.includes(t))return(e=new PerformanceObserver((function(t){return t.getEntries().map(n)}))).observe({type:t,buffered:!0}),e}catch(t){}},l=!1,p=!1,f=function(t){l=!t.persisted},m=function(){addEventListener("pagehide",f),addEventListener("beforeunload",(function(){}))},d=function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];p||(m(),p=!0),addEventListener("visibilitychange",(function(n){n=n.timeStamp,"hidden"===document.visibilityState&&t({timeStamp:n,isUnloading:l})}),{capture:!0,once:n})},v=function(t,n,e,i){var a;return function(){e&&n.isFinal&&e.disconnect(),0<=n.value&&(i||n.isFinal||"hidden"===document.visibilityState)&&(n.delta=n.value-(a||0),(n.delta||n.isFinal||void 0===a)&&(t(n),a=n.value))}},h=function(){return void 0===r&&(r="hidden"===document.visibilityState?0:1/0,d((function(t){return t=t.timeStamp,r=t}),!0)),{get timeStamp(){return r}}},y=function(){return o=o||new Promise((function(t){return["scroll","keydown","pointerdown"].map((function(n){addEventListener(n,t,{once:!0,passive:!0,capture:!0})}))}))},F=[{name:"fid",collectFn:function(t){function n(t){t.startTime<i.timeStamp&&(e.value=t.processingStart-t.startTime,e.entries.push(t),e.isFinal=!0,r())}var e=s("FID"),i=h(),a=u("first-input",n),r=v(t,e,a);a?d((function(){a.takeRecords().map(n),a.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(t,n){n.timeStamp<i.timeStamp&&(e.value=t,e.isFinal=!0,e.entries=[{entryType:"first-input",name:n.type,target:n.target,cancelable:n.cancelable,startTime:n.timeStamp,processingStart:n.timeStamp+t}],r())}))}},{name:"lcp",collectFn:function(t){function n(t){var n=t.startTime;n<r.timeStamp?(a.value=n,a.entries.push(t)):a.isFinal=!0,e()}var e,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=s("LCP"),r=h(),o=u("largest-contentful-paint",n);o&&(e=v(t,a,o,i),i=function(){a.isFinal||(o.takeRecords().map(n),a.isFinal=!0,e())},y().then(i),d(i,!0))}},{name:"cls",collectFn:function(t){function n(t){t.hadRecentInput||(a.value+=t.value,a.entries.push(t),e())}var e,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=s("CLS",0),r=u("layout-shift",n);r&&(e=v(t,a,r,i),d((function(t){t=t.isUnloading,r.takeRecords().map(n),t&&(a.isFinal=!0),e()})))}},{name:"fcp",collectFn:function(t){var n,e=s("FCP"),i=h(),a=u("paint",(function(t){"first-contentful-paint"===t.name&&t.startTime<i.timeStamp&&(e.value=t.startTime,e.isFinal=!0,e.entries.push(t),n())}));a&&(n=v(t,e,a))}}],g=function(i){function r(a){var r=i.call(this,{core:a.core,sampling:a.sampling,version:"1.2.5",key:t.EVENT,name:"RadarChromeMetricsCollect"})||this;return r.options={lcp:!1,cls:!1,fid:!1,fcp:!1},r.init=function(){var t=r.options;F.forEach((function(e){var i=e.name;t&&!t[i]||e.collectFn((function(t){var e=t.name;t=t.value;n(e.toLocaleLowerCase(),Number(t)),r.baseCollect({dimension:{name:e.toLocaleLowerCase(),is_official:1},value:{duration:Number(t)}})}))}))},Object.assign(r.options,a.options),F.forEach((function(t){var n=e("radar_"+t.name);n&&(r.options[t.name]="1"===n)})),r.init(),r}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}a(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}(r,i),r}(i);export{g as default};
