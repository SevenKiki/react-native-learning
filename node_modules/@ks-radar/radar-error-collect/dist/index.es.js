import{addMonitor as r,removeMonitor as e,consoleWarn as o,storeGet as t,JS_ERROR_QUEUE as n,storeSet as i,RADAR_KEY as c,BaseCollect as s}from"@ks-radar/radar-util";var a=function(r,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])})(r,e)};var l,u,p=function(){return(p=Object.assign||function(r){for(var e,o=1,t=arguments.length;o<t;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}).apply(this,arguments)};function f(r,e){var o={};for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(o[n]=r[n]);if(null!=r&&"function"==typeof Object.getOwnPropertySymbols)for(var t=0,n=Object.getOwnPropertySymbols(r);t<n.length;t++)e.indexOf(n[t])<0&&Object.prototype.propertyIsEnumerable.call(r,n[t])&&(o[n[t]]=r[n[t]]);return o}(u=l=l||{}).SCRIPT="script",u.RES="res",u.API="api",u.VIDEO="video";var y=[];function m(r,e,o){var t,n;if(function(r){return!!r&&(r instanceof Error||"object"==typeof r&&"string"==typeof r.message)}(e)){if("BridgeError"===(t=e.name||"ErrorLikeObject")&&"function"==typeof e.toJSON)try{var i=e.toJSON();delete i.name,delete i.message,n="".concat(e.message," (").concat(JSON.stringify(i),")")}catch(r){n=e.message||""}else n=e.message||"";i=e.stack||void 0}else n=function(r,e){return null==r&&"Script error."===(null==e?void 0:e.message)}(e,o)?(t="CrossOriginError","".concat(r," - message: ").concat((null==o?void 0:o.message)||"<UNKNOWN>")):null===e&&null!=o&&o.message&&"Uncaught null"!==o.message?(t="Error","".concat(r," - message: ").concat(o.message)):(t=null==e?"".concat(e):typeof e,o=function(r){var e;try{e=r.toString(),r&&"object"==typeof r&&(e=JSON.stringify(r))}catch(r){}return"string"!=typeof e||""===e?e=null===r?"<NULL>":void 0===r?"<UNDEFINED>":""===e?"<EMPTY>":"<UNKNOWN>":2e3<e.length&&(e=e.substring(0,2e3)+"<<< ……"),e}(e),"".concat(r," - value: ").concat(o));return{error_type:l.SCRIPT,error_cons_type:t,msg:n,stack:i}}function g(r){for(var e=0;e<y.length;e++)if(d(y[e],r))return e;return-1}function d(r,e){return r.msg===e.msg&&r.stack===e.stack&&r.file===e.file&&r.line===e.line&&r.col===e.col}var h=function(s){function l(r){var e=s.call(this,{core:r.core,sampling:r.sampling,key:c.ERROR,version:"1.2.5",name:"RadarErrorCollect"})||this;return e.onError=function(r,o){(function(r){return r.message||null!=r.lineno})(r)&&(r=p(p({},m("Global Uncaught Exception",r.error,r)),{file:r.filename,line:r.lineno,col:r.colno}),e.isSameErrorAndReport(r,o))},e.onPromiseError=function(r,o){r=m("Unhandled Promise Rejection",r.reason),e.isSameErrorAndReport(r,o)},e.core=r.core,e.init(),e}return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=r}a(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(l,s),l.prototype.init=function(){y.splice(0),r(window,"error",this.onError,!0),r(window,"unhandledrejection",this.onPromiseError),this.parseSeedLog()},l.prototype.destroy=function(){e(window,"error",this.onError,!0),e(window,"unhandledrejection",this.onPromiseError),this.captureException=function(){o("600")}},l.prototype.parseSeedLog=function(){var r=this,e=t(n,[]);e.length&&(e.map((function(e){var o=e.data;e=e.dimension||{};"unhandledrejection"===(null==o?void 0:o.type)?r.onPromiseError(o,e):r.onError(o,e)})),i(n,[]))},l.prototype.isSameErrorAndReport=function(r,e){0<=g(r)||(y.push(r),setTimeout((function(){y.splice(g(r),1)}),2e3),this.collect(r,e))},l.prototype.collect=function(r,e){r=function(r){var e=r.error_cons_type,o=r.file,t=r.error_type,n=r.msg,i=r.col,c=r.line,s=r.stack;return{key:"error",value:f(r,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:e,file:o,error_type:t,msg:n,col:i,line:c,stack:s}}}(r),e=p(p({},r.dimension),e||{}),this.baseCollect({dimension:e,value:r.value})},l.prototype.captureException=function(r){this.isSameErrorAndReport(m("Captured Exception",r))},l}(s);export{h as default};
