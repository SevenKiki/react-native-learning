!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react-native")):"function"==typeof define&&define.amd?define(["exports","react-native"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Weblog={},t.reactNative)}(this,(function(t,e){"use strict";var a=function(){return(a=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function r(t,e,a){if(a||2===arguments.length)for(var r,n=0,i=e.length;n<i;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}var n;function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var a=null===console||void 0===console?void 0:console.log;return a&&a.call.apply(a,r([console],t,!1))}catch(t){return}}function o(t){return"string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""}var s="REACT_NATIVE";function c(){return s}var g=function(t){t.data.container=s,t.data.page_type="NATIVE";try{n(t,(function(t,e){1!==t&&i("setClientLog error",t,e)}))}catch(t){i("yoda invoke error")}},u=function(t,e,a,r){var n;void 0===e&&(e={}),"string"!=typeof t&&(n=t.type),n=t.toUpperCase();var i={};if("string"==typeof e)i.contentPackage=r,"CUSTOM"===t?(i.key=e,i.value=a):(i.params=a,"PV"===t?i.page=e:i.action=e);else if(i=e,["CUSTOM","CUSTOM_EVENT"].includes(n)){var o=e;o.action&&!o.key&&(i.key=o.action),o.params&&!o.value&&(i.value=o.params)}return[n,i]},l=0,d=function(){function t(t,e){this.h5ExtraAttr={sdk_name:"webLogger_krn",sdk_version:"3.10.23",sdk_bundle:"log.krnbridge.js",coPage:!1},this.version=this.h5ExtraAttr.sdk_version,this.currentUrlPackage={page:"",params:{},identity:"",coPage:!1},this.plugins={},this.entered="",this.logConfig=a({},t),Object.assign(this.h5ExtraAttr,null==e?void 0:e.h5_extra_attr),this.addPlugins()}return Object.defineProperty(t.prototype,"commonPackage",{get:function(){return{h5_extra_attr:this.h5ExtraAttr}},enumerable:!1,configurable:!0}),t.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},t.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(l++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},t.prototype.plug=function(t,e){if(this.plugins[t.key])throw new Error("There is a duplex plugin called ".concat(t.key));this.addPluginInstance(new t(this,e))},t.prototype.send=function(e,r,n){e=e.toUpperCase();var i,s=this.h5ExtraAttr,u=r,l=u.action,d=u.contentPackage,p=u.params,f=u.areaPackage,h=u.type,P=u.feedLogCtx,v=u.status,y=u.disablePV,k=u.urlPage,x=u.bridgeFields;if("PV"===e){if(this.logConfig.disablePV)return;var m=r,E=m.page,C=void 0===E?this.currentUrlPackage.page:E,b=m.type,A=void 0===b?"enter":b,T=m.coPage,U=m.timeCost,N=m.status,_=m.category,O=t.kdsUtils.appVersion;if("leave"===A&&this.currentUrlPackage.coPage&&O&&function(t,e){if(!e)return!1;if(-1!==e.indexOf("alpha"))return!1;if(-1!==e.indexOf("beta"))return!1;try{var a=t.match(/\d+\.\d+\.\d+/);if(!(t=(null==a?void 0:a[0])||""))return!0;if(a=e.match(/\d+\.\d+\.\d+/),!(e=(null==a?void 0:a[0])||""))return!1;var r=t.split(".").map((function(t){return Number(t)})),n=r[0],i=r[1],o=r[2],s=e.split(".").map((function(t){return Number(t)})),c=s[0],g=s[1],u=s[2];return!(c<n||!(c>n)&&(g<i||!(g>i)&&u<o))}catch(t){return!1}}("10.8.30",O))return void function(t){g({type:"closeCoPage",data:t})}(a(a({},this.currentUrlPackage),r));if("enter"!==A&&"visible"!==A)return;if("enter"===A&&(C&&(this.currentUrlPackage={page:C,coPage:!1,params:p,identity:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},this.entered=C),T&&(this.currentUrlPackage.coPage=T,this.h5ExtraAttr.coPage=T),_&&(this.currentUrlPackage.category=_)),this.currentUrlPackage.params=a(a({},this.currentUrlPackage.params||{}),p),!this.currentUrlPackage.page)return;return function(t,e){var a=e||{},r=a.params,n=a.contentPackage,i=a.identity,s=a.h5ExtraAttr,c=a.coPage,u=a.feedLogCtx,l=a.status,d=a.timeCost,p=void 0===d?0:d;g({type:"setCurrentPage",data:{page:t,identity:i,params:o(r),contentPackage:o(n),h5ExtraAttr:JSON.stringify(s),action:"PV",pageType:"NATIVE",coPage:c,feedLogCtx:u,status:l,timeCost:p}})}(this.currentUrlPackage.page,a(a({},this.currentUrlPackage),{contentPackage:d,feedLogCtx:P,h5ExtraAttr:s,status:N,timeCost:U,bridgeFields:x}))}if(null==k?void 0:k.page)i={page:k.page,identity:k.identity,params:"REACT_NATIVE"===c()?k.params:o(k.params)};else{var V="REACT_NATIVE"===c()?this.currentUrlPackage:a(a({},this.currentUrlPackage),{params:o(this.currentUrlPackage.params)});i=this.logConfig.disablePV||y||!this.currentUrlPackage.page?void 0:V}if("SHOW"===e)return function(t,e){var r=e||{},n=r.params,i=r.contentPackage,s=r.areaPackage,c=r.urlPage,u=r.h5ExtraAttr,l=r.feedLogCtx,d=r.status,p=r.bridgeFields;g({type:"addElementShowEvent",data:a(a({},p),{action:t,params:o(n),urlPage:c,areaPackage:s,contentPackage:o(i),h5ExtraAttr:JSON.stringify(u),feedLogCtx:l,status:d})})}(l,{urlPage:i,params:p,contentPackage:d,areaPackage:f,h5ExtraAttr:s,feedLogCtx:P,status:v,bridgeFields:x});if("CLICK"===e&&(!h||"USER_OPERATION"===h)){var S=r.entryTag;return function(t,e){var r=e||{},n=r.params,i=r.contentPackage,s=r.areaPackage,c=r.urlPage,u=r.entryTag,l=r.h5ExtraAttr,d=r.feedLogCtx;r.status;var p=r.bridgeFields;g({type:"addTaskEvent",data:a(a({},p),{action:t,params:o(n),urlPage:c,areaPackage:s,contentPackage:o(i),entryTagInfo:u,h5ExtraAttr:JSON.stringify(l),feedLogCtx:d,type:"USER_OPERATION"})})}(l,{urlPage:i,params:p,areaPackage:f,contentPackage:d,entryTag:S?a({page_name:this.currentUrlPackage.page,element_action:l},S):void 0,h5ExtraAttr:s,feedLogCtx:P,status:v,bridgeFields:x})}if(["CUSTOM_EVENT","CUSTOM"].includes(e)){var I=r,L=I.key,M=I.value,R=I.biz,j="CUSTOM_EVENT"===e;return function(t,e,r){void 0===r&&(r=!1);var n=e||{},i=n.value,s=n.biz,c=n.contentPackage,u=n.areaPackage,l=n.urlPage,d=n.h5ExtraAttr,p=n.bridgeFields;g({type:r?"addCustomEvent":"addCustomStatEvent",data:a(a({},p),{key:t,value:o(i),urlPage:l,areaPackage:u,contentPackage:o(c),h5ExtraAttr:JSON.stringify(d),biz:s})})}(L||l,{urlPage:i,value:a(a({},M||p),{url_package:i}),biz:R||this.logConfig.biz,areaPackage:f,contentPackage:d,h5ExtraAttr:s,feedLogCtx:P,bridgeFields:x},j)}return function(t,e){var r=e||{},n=r.params,i=r.contentPackage,s=r.areaPackage,c=r.urlPage,u=r.entryTag,l=r.type,d=r.h5ExtraAttr,p=r.feedLogCtx,f=r.status,h=r.bridgeFields;g({type:"addTaskEvent",data:a(a({},h),{action:t,params:o(n),urlPage:c,areaPackage:s,contentPackage:o(i),entryTagInfo:u,h5ExtraAttr:JSON.stringify(d),feedLogCtx:p,type:l||"BACKGROUND_TASK_EVENT",status:f})})}(l,{urlPage:i,params:p,areaPackage:f,contentPackage:d,h5ExtraAttr:s,type:h,feedLogCtx:P,bridgeFields:x,status:v})},t.prototype.collect=function(t,e,a,r){var n=u(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!1)},t.prototype.sendImmediately=function(t,e,a,r){var n=u(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!0)},t.prototype.flush=function(){},t.prototype.updateCommonPackage=function(t){(null==t?void 0:t.h5_extra_attr)&&Object.assign(this.h5ExtraAttr,t.h5_extra_attr)},t.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=""),"object"==typeof t&&t){var a=t.page,r=void 0===a?this.currentUrlPackage.page:a,n=t.params,i=void 0===n?{}:n;if(!(this.entered===r))return void(this.currentUrlPackage.params=Object.assign(this.currentUrlPackage.params||{},i));this.send("PV",{type:"visible",params:t.params})}},t.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage)},t}(),p=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}(),f={NativeModules:e.NativeModules,AppState:e.AppState,deviceInfo:function(){var t,r,n=(null===(t=null===e.NativeModules||void 0===e.NativeModules?void 0:e.NativeModules.KSRCTBridge)||void 0===t?void 0:t.deviceInfo)||(null===(r=null===e.NativeModules||void 0===e.NativeModules?void 0:e.NativeModules.KRNBasic)||void 0===r?void 0:r.deviceInfo);if(n){var i="string"==typeof n?JSON.parse(n):n,o=i.data;if(1===i.result){var s=e.Platform.OS,c=e.Platform.Version;return a(a({},o),{os:s,osVersion:c})}}return{appVersion:"",locale:"",uuid:"",systemVersion:"",networkType:"",manufacturer:"",model:"",screenWidth:0,screenHeight:0,statusBarHeight:0,titleBarHeight:0,os:"",osVersion:""}}(),Platform:e.Platform};n=function(t,a){e.NativeModules.yoda.invoke("tool","setClientLog",JSON.stringify(t),a)},s="REACT_NATIVE"||"REACT_NATIVE",d.kdsUtils={appVersion:f.deviceInfo.appVersion},t.BasePlugin=p,t.Weblog=d,t.default=d,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=log.krnbridge.js.map
