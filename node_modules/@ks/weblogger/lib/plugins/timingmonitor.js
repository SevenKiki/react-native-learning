!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t="undefined"!=typeof globalThis?globalThis:t||self).TimingMonitor=o()}(this,(function(){"use strict";var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])})(o,n)};function o(t,o,n){if(n||2===arguments.length)for(var e,r=0,i=o.length;r<i;r++)!e&&r in o||(e||(e=Array.prototype.slice.call(o,0,r)),e[r]=o[r]);return t.concat(e||Array.prototype.slice.call(o))}var n=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}(),e="undefined"!=typeof window?window.performance:null,r=e&&e.timing||null;e&&e.getEntriesByType&&e.getEntriesByType("navigation")[0];var i={dnsLookup:{end:"domainLookupEnd",start:"domainLookupStart"},tcpConnection:{end:"connectEnd",start:"connectStart"},resourceLoad:{end:"responseEnd",start:"requestStart"},jsCost:{custom:function(){if("function"!=typeof performance.getEntries)return 0;var t=performance.getEntries(),o=t[0],n=t.filter((function(t){return"script"===t.initiatorType}))[0];return n&&o?o.domComplete-n.fetchStart:0}},documentContentLoaded:{end:"domComplete",start:"fetchStart"},load:{end:"loadEventEnd",start:"fetchStart"},timeToFirstByte:{end:"loadEventEnd",start:"fetchStart"},firstScreen:{custom:function(t,o){var n=(o||{}).endPoint,e=void 0!==n?n:(new Date).valueOf();return r&&e-r.fetchStart||0}},whiteScreen:{custom:function(t,o){var n=(o||{}).endPoint,e=void 0!==n?n:(new Date).valueOf();return r&&e-r.fetchStart||0}}},c=function(n){function e(t){var e=n.call(this)||this;return e.load=function(){setTimeout((function(){var t=e.collect();t&&["load","documentContentLoaded","dnsLookup","tcpConnection","jsCost","timeToFirstByte"].forEach((function(o){var n;"jsCost"===o&&0===t[o]||e.weblog.collect("CUSTOM",{key:a[o],value:(n={},n[a[o]]=t[o],n)})}))}))},r?(t&&e.apply(t),e):(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{var e=null===console||void 0===console?void 0:console.error;e&&e.call.apply(e,o([console],t,!1))}catch(t){return}}("The Timing Monitor need performance APIs to Support!"),e)}return function(o,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}(e,n),e.prototype.apply=function(t){var o,n,e,r;this.weblog=t,o=window,n="load",e=this.load,"attachEvent"in o?o.attachEvent("on"+n,e):o.addEventListener(n,e,r)},e.prototype.destroy=function(){var t,o,n,e;t=window,o="load",n=this.load,"attachEvent"in t?t.detachEvent("on"+o,n):t.removeEventListener(o,n,e)},e.prototype.calculate=function(t,o){var n=i[t];if(!n)throw new Error("The perf key is not correct!");return"function"==typeof n.custom?n.custom(t,o):r[i[t].end]-r[i[t].start]},e.prototype.mark=function(t,o){var n,e=this.collect(t,o);e&&this.weblog.collect("CUSTOM",{key:a[t],value:(n={},n[a[t]]=e[t],n)})},e.prototype.collect=function(t,o){var n,e=this;if(r){if(t)return(n={})[t]=this.calculate(t,o),n;return Object.keys(i).reduce((function(t,n){return t[n]=e.calculate(n,o),t}),{})}},e.key="timingMonitor",e}(n),a={load:"total_download_cost",documentContentLoaded:"operational_cost",dnsLookup:"dns_query_cost",tcpConnection:"tcp_cost",jsCost:"js_cost",whiteScreen:"white_screen_cost",firstScreen:"first_screen_cost",timeToFirstByte:"ttfb_cost"};return function(t,o){var n;if("undefined"!=typeof window&&void 0!==window._GLOBAL_KS_WEBLOGGER_&&"function"==typeof t){var e=window._GLOBAL_KS_WEBLOGGER_,r=e.weblog,i=e.config,c=o?null===(n=i.plugins[o])||void 0===n?void 0:n.options:void 0;r.addPluginInstance(new t(c))}}(c),c}));
//# sourceMappingURL=timingmonitor.js.map
