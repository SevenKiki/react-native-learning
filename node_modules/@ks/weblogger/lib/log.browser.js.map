{"version":3,"file":"log.browser.js","sources":["../src/util/compatibility.ts","../src/util/polyfill.ts","../node_modules/tslib/tslib.es6.js","../src/config/global.ts","../src/core/url-package.ts","../src/util/const.ts","../src/util/cookie.ts","../src/util/console.ts","../src/util/index.ts","../src/util/events.ts","../src/core/index.ts","../src/config/index.ts","../src/util/uuid.ts","../src/platform/browser/url-package.ts","../src/config/apis.ts","../src/core/logger.ts","../src/io/util.ts","../src/io/xhr.ts","../src/io/beacon.ts","../src/io/index.ts","../src/util/test.ts","../src/util/loader.ts","../src/proto/base.ts","../src/proto/v3/client_event.ts","../src/proto/v2/client_event.ts","../src/platform/browser/logger.ts","../src/core/show-event.ts","../src/core/log.ts","../src/util/ua.ts","../src/core/task-event.ts","../src/core/custom-stat-event.ts","../src/core/video-stat-event.ts","../src/util/increment-id.ts","../src/util/yodav2Browser.ts","../src/config/types.ts","../src/core/common.ts","../src/util/device-detect.ts","../src/platform/browser/common.ts","../src/util/namespace.ts","../src/util/history-polyfill.ts","../src/platform/browser/index.ts","../src/plugins/base.ts","../src/entries/browser.ts"],"sourcesContent":["/**\n * 兼容 SSR、react native、worker 等非浏览器场景\n */\nconst commonGlobal: any = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n(() => {\n    if (typeof commonGlobal.window === 'undefined') {\n        commonGlobal.window = {\n            addEventListener: () => {},\n            removeEventListener: () => {},\n            setTimeout: () => {},\n            setInterval: () => {},\n            _WEBLOGGER_MOCKED_WINDOW_: true,\n            global: commonGlobal\n        };\n    }\n    if (typeof commonGlobal.document === 'undefined') {\n        commonGlobal.document = commonGlobal.window.document || {\n            cookie: '',\n            addEventListener: () => {},\n            removeEventListener: () => {},\n            querySelector: () => {},\n            querySelectorAll: () => {},\n        };\n        if (typeof commonGlobal.window.document === 'undefined') {\n            commonGlobal.window.document = commonGlobal.document;\n        }\n    }\n    if (typeof commonGlobal.navigator === 'undefined') {\n        commonGlobal.navigator = commonGlobal.window.navigator || {\n            userAgent: ''\n        };\n        if (typeof commonGlobal.window.navigator === 'undefined') {\n            commonGlobal.window.navigator = commonGlobal.navigator;\n        }\n    }\n    if (typeof commonGlobal.screen === 'undefined') {\n        commonGlobal.screen = commonGlobal.window.screen || {};\n        if (typeof commonGlobal.window.screen === 'undefined') {\n            commonGlobal.window.screen = commonGlobal.screen;\n        }\n    }\n    if (typeof commonGlobal.history === 'undefined') {\n        commonGlobal.history = commonGlobal.window.history || {};\n        if (typeof commonGlobal.window.history === 'undefined') {\n            commonGlobal.window.history = commonGlobal.history;\n        }\n    }\n    if (typeof commonGlobal.location === 'undefined') {\n        commonGlobal.location = commonGlobal.window.location || {\n            hostname: '',\n            search: '',\n            href: '',\n            origin: ''\n        };\n        if (typeof commonGlobal.window.location === 'undefined') {\n            commonGlobal.window.location = commonGlobal.location;\n        }\n    }\n    try {\n        if (typeof commonGlobal.localStorage === 'undefined') {\n            commonGlobal.localStorage = commonGlobal.window.localStorage || {\n                getItem: () => {},\n                setItem: () => {}\n            };\n            if (typeof commonGlobal.window.localStorage === 'undefined') {\n                commonGlobal.window.localStorage = commonGlobal.localStorage;\n            }\n        }\n    } catch (err){};\n})();\n/**\n *  FIX:  Cannot redeclare block-scoped variable 'commonGlobal'.\n * 进行测试命令行时，lib下的d.ts文件与本文件的commonGlobal 定义冲突，利用typescript 模块化解决，添加默认export关键字，就会被typescript任务这个文件是一个模块，不会与全局变量冲突。\n * 具体解释如下\n * https://www.jianshu.com/p/78268bd9af0a\n */\n\nexport {};\n","import './compatibility';\n/**\n * Object.defineProperty 容错暂时处理\n */\nif (!Object.defineProperty) {\n    // @ts-ignore\n    Object.defineProperty = function (target, key, descriptor) {\n        // @ts-ignore\n        target[key] = Object.prototype.toString.call(descriptor) === '[object Object]'\n            && descriptor.hasOwnProperty('value')\n            ? descriptor.value\n            : descriptor;\n    };\n}\n/**\n * Object.assign polyfill\n */\nif (!Object.assign) {\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n        value(target: object) { // .length of function is 2\n            if (target === null) { // TypeError if undefined or null\n                throw new TypeError('Cannot convert undefined or null to object');\n            }\n            const to = Object(target);\n            for (let index = 1; index < arguments.length; index++) {\n                const nextSource = arguments[index];\n                if (nextSource !== null) { // Skip over if undefined or null\n                    for (const nextKey in nextSource) {\n                        // Avoid bugs when hasOwnProperty is shadowed\n                        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                            to[nextKey] = nextSource[nextKey];\n                        }\n                    }\n                }\n            }\n            return to;\n        },\n        writable: true,\n        configurable: true,\n    });\n}\n\n/**\n * bind polyfill\n */\nif (!Function.prototype.bind) {\n    Function.prototype.bind = function (oThis) {\n        if (typeof this !== 'function') {\n            // closest thing possible to the ECMAScript 5\n            // internal IsCallable function\n            throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n        }\n\n        const aArgs = Array.prototype.slice.call(arguments, 1);\n        const fToBind = this;\n        class FNOP {\n        }\n        const fBound = function (this: any) {\n            const currentThis = this instanceof FNOP\n                ? this\n                : oThis;\n            // this instanceof FNOP === true时,说明返回的fBound被当做new的构造函数调用\n            return fToBind.apply(\n                currentThis,\n                // 获取调用时(fBound)的传参.bind 返回的函数入参往往是这么传递的\n                aArgs.concat(Array.prototype.slice.call(arguments)),\n            );\n        };\n\n        // 维护原型关系\n        if (this.prototype) {\n            // Function.prototype doesn't have a prototype property\n            FNOP.prototype = this.prototype;\n        }\n        // 下行的代码使fBound.prototype是FNOP的实例,因此\n        // 返回的fBound若作为new的构造函数,new生成的新对象作为this传入fBound,新对象的__proto__就是FNOP的实例\n        fBound.prototype = new FNOP();\n\n        return fBound;\n    };\n}\n/**\n * indexOf polyfill\n */\n// Production steps of ECMA-262, Edition 5, 15.4.4.14\n// Reference: http://es5.github.io/#x15.4.4.14\nif (!Array.prototype.indexOf) {\n    Array.prototype.indexOf = function (searchElement, fromIndex: number) {\n\n        let k;\n\n        // 1. Let O be the result of calling ToObject passing\n        //    the this value as the argument.\n        if (this == null) {\n            throw new TypeError('\"this\" is null or not defined');\n        }\n\n        const O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get\n        //    internal method of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        const len = O.length >>> 0;\n\n        // 4. If len is 0, return -1.\n        if (len === 0) {\n            return -1;\n        }\n\n        // 5. If argument fromIndex was passed let n be\n        //    ToInteger(fromIndex); else let n be 0.\n        let n = +fromIndex || 0;\n\n        if (Math.abs(n) === Infinity) {\n            n = 0;\n        }\n\n        // 6. If n >= len, return -1.\n        if (n >= len) {\n            return -1;\n        }\n\n        // 7. If n >= 0, then Let k be n.\n        // 8. Else, n<0, Let k be len - abs(n).\n        //    If k is less than 0, then let k be 0.\n        k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n\n        // 9. Repeat, while k < len\n        while (k < len) {\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the\n            //    HasProperty internal method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            //    i.  Let elementK be the result of calling the Get\n            //        internal method of O with the argument ToString(k).\n            //   ii.  Let same be the result of applying the\n            //        Strict Equality Comparison Algorithm to\n            //        searchElement and elementK.\n            //  iii.  If same is true, return k.\n            if (k in O && O[k] === searchElement) {\n                return k;\n            }\n            k++;\n        }\n        return -1;\n    };\n}\n\nif (!Object.keys) {\n    Object.keys = (function () {\n        const hasOwnProperty = Object.prototype.hasOwnProperty;\n        const hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString');\n        const dontEnums = [\n            'toString',\n            'toLocaleString',\n            'valueOf',\n            'hasOwnProperty',\n            'isPrototypeOf',\n            'propertyIsEnumerable',\n            'constructor',\n        ];\n        return (obj: any) => {\n            if (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n                throw new TypeError('Object.keys called on non-object');\n            }\n            const result = [];\n            for (const prop in obj) {\n                if (hasOwnProperty.call(obj, prop)) result.push(prop);\n            }\n            if (hasDontEnumBug) {\n                for (const key of dontEnums) {\n                    if (hasOwnProperty.call(obj, key)) {\n                        result.push(key);\n                    }\n                }\n            }\n            return result;\n        };\n    })();\n}\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.18\n// Reference: http://es5.github.io/#x15.4.4.18\nif (!Array.prototype.forEach) {\n\n    Array.prototype.forEach = function (callback, thisArg) {\n\n        let T;\n        let k;\n\n        if (this == null) {\n            throw new TypeError(' this is null or not defined');\n        }\n\n        // 1. Let O be the result of calling toObject() passing the\n        // |this| value as the argument.\n        const O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get() internal\n        // method of O with the argument \"length\".\n        // 3. Let len be toUint32(lenValue).\n        const len = O.length >>> 0;\n\n        // 4. If isCallable(callback) is false, throw a TypeError exception.\n        // See: http://es5.github.com/#x9.11\n        if (typeof callback !== 'function') {\n            throw new TypeError(callback + ' is not a function');\n        }\n\n        // 5. If thisArg was supplied, let T be thisArg; else let\n        // T be undefined.\n        if (arguments.length > 1) {\n            T = thisArg;\n        }\n\n        // 6. Let k be 0\n        k = 0;\n\n        // 7. Repeat, while k < len\n        while (k < len) {\n\n            let kValue;\n\n            // a. Let Pk be ToString(k).\n            //    This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty\n            //    internal method of O with argument Pk.\n            //    This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n\n                // i. Let kValue be the result of calling the Get internal\n                // method of O with argument Pk.\n                kValue = O[k];\n\n                // ii. Call the Call internal method of callback with T as\n                // the this value and argument list containing kValue, k, and O.\n                callback.call(T, kValue, k, O);\n            }\n            // d. Increase k by 1.\n            k++;\n        }\n        // 8. return undefined\n    };\n}","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","\n/**\n * 全局配置，可用于所有模块中\n */\ninterface Config {\n    sessionId: string;\n    [key: string]: any;\n};\n\nconst GlobalConfig:Config = {\n    sessionId: '',\n    // 小程序专用\n    appDevicePackageReady: false, // 公参app_package device_package是否设置完成，在getNetwork 成功后会被设为true\n    identityPackageReady: false, // identity数据是否设置完成，调用setPublicParam后 设置完成。\n};\n\nexport const updateConfig = (key: string, value: any) => {\n    GlobalConfig[key] = value;\n};\n\nexport const updateConfigs = (configs: {[key: string]: any}) => {\n    Object.assign(GlobalConfig, configs);\n}\n\nexport default GlobalConfig;","import type { UrlObj, PageTypeKey } from '@/config/types';;\nexport default class UrlPackage {\n    // 一级页面。参考埋点需求填写即可\n    page: string = '';\n    // 参数列表参考埋点需求填写，并转成 json 字符串格式\n    params?: {[key: string]: any};\n    // 实例的全局唯一标识，使用UUID即可\n    identity: string = '';\n    // 应用页面类型\n    page_type: 1 | 2 | 3 | 0;\n    // 是否是半屏页\n    coPage?: boolean;\n    // 桥接新添加字段\n    category?: string;\n    constructor(url: UrlObj, pageType?: PageTypeKey) {\n        switch (pageType) {\n            case 'web':\n                this.page_type = 2;\n                break;\n            case 'native':\n                this.page_type = 1;\n                break;\n            case 'mina':\n                this.page_type = 3;\n                break;\n            default:\n                this.page_type = 0; // unknown\n        }\n        this.update(url.page, url.params);\n    }\n\n    // 更新urlPackage\n    update(page: string = '', params?: any) {\n        if (page && page !== this.page) {\n            this.page = page;\n            this.identity = this.generatePageId(page);\n        }\n        if (params) {\n            this.params = Object.assign(this.params || {}, params);\n        }\n    }\n    toJSON() {\n        return {\n            page: this.page,\n            identity: this.identity,\n            page_type: this.page_type,\n            params: JSON.stringify(this.params),\n            category: this.category,\n        };\n    }\n    /**\n     * 生成页面唯一id\n     * 未自定义页面唯一ID生成方法，请自行添加后重新尝试\n     * @param page\n     */\n    generatePageId(page: string) {\n        return page + new Date().getTime();\n    }\n}\n","/**\n * 快手系应用UA标示\n */\n// TODO 海外 APP List 要求不区分大小写判断\nexport const ksOverseaAppList = ['UVideo', 'Vstatus', 'Kwaigo', 'MvMaster'];\n\n// TODO这么加没个完了，后面想办法搞成自行传入吧\nexport const ksAppList = [\n    'Kwai',\n    'Kwai_Lite',\n    'Kwai_Pro',\n    'livemate',\n    'ksthanos',\n    'ksNebula',\n    'ksnebula',\n    'kwaiying',\n    'pearl',\n    'kinder',\n    'm2u',\n    'LOLita',\n    'XFunCore', // A 站 —— 水母 APP\n    'ACVideoCore', // A 站 —— acfun\n    'ZIKZAK', // ZIKZAK\n].concat(ksOverseaAppList);\n","\n// TODO后面这里面的东西要拆一下，不能全一口气扔在util下面\ninterface CookieOptions {\n    expires?: Date;\n    path?: string;\n    domain?: string;\n    secure?: boolean;\n    raw?: boolean;\n}\n\n/**\n * 创建一个cookie字符串，可被赋值给document.cookie.\n * @param {string} name cookie名称.\n * @param {string} value cookie值.\n * @param {boolean} encode 是否对值进行编码.\n * @param {Object} options (Optional) 配置项.\n * @return {string} 返回 cookie 字符串.\n */\nfunction createCookieString(\n    name: string,\n    value: string,\n    encode: boolean,\n    options: CookieOptions = {},\n) {\n    let text = `${encodeURIComponent(name)}=${(encode ? encodeURIComponent(value) : value)}`;\n    const expires = options.expires;\n    const path = options.path || '/';\n    const domain = options.domain || '';\n\n    if (expires instanceof Date) {\n        text += `; expires=${expires.toUTCString()}`;\n    }\n\n    if (typeof expires === 'number') {\n        text += `; max-age==${expires}`;\n    }\n\n    if (path !== '') {\n        text += `; path=${path}`;\n    }\n\n    if (domain !== '') {\n        text += `; domain=${domain}`;\n    }\n\n    if (options.secure === true) {\n        text += '; secure';\n    }\n\n    return text;\n}\n\n/**\n * 将cookie序列化成对象.\n * @param {string} text cookie值.\n * @param {boolean=} shouldDecode cookie是否需要被解码. 默认为true.\n * @param {object=} options 如何读取cookie的配置.\n * @return {object} 可访问cookie的序列化结果\n */\nexport function parseCookieString(\n    text: string,\n    shouldDecode: boolean,\n    options: any = {},\n) {\n    const cookies: { [key: string]: any } = {};\n\n    if (text.length > 0) {\n        const decodeValue = !shouldDecode\n            ? function (s: string) {\n                return s;\n            }\n            : decodeURIComponent;\n        const cookieParts = text.split(/;\\s/g);\n        let cookieName = null;\n        let cookieValue = null;\n        let cookieNameValue = null;\n\n        for (let i = 0, len = cookieParts.length; i < len; i++) {\n            cookieNameValue = cookieParts[i]?.match(/([^=]+)=/i);\n            if (cookieNameValue && cookieNameValue !== null) {\n                try {\n                    cookieName = decodeURIComponent(cookieNameValue[1]!);\n                    cookieValue = decodeValue(cookieParts[i]!.substring(cookieNameValue[1]!.length + 1));\n                } catch (ex) {\n                    // 忽略\n                }\n            } else {\n                // cookie 中没有 \"=\", 当成布尔值\n                cookieName = decodeURIComponent(cookieParts[i]!);\n                cookieValue = '';\n            }\n            if (cookieName !== null) {\n                // 默认后面的cookie覆盖前面的\n                cookies[cookieName] = cookieValue;\n            }\n        }\n\n    }\n\n    return cookies;\n}\n\nlet cookiesMap: {[key: string]: any} = {};\nlet prevCookie: string;\n/**\n * 获取cookie值.\n * @param {string} name cookie名称.\n * @param {object=} options 配置项\n *                    raw: 是否进行编码，true则是未编码\n * @return {*} 不存在返回null.\n */\nexport function getCookie(name: string, options: CookieOptions = {}, force = false) {\n    try {\n        if (!force && name in cookiesMap) {\n            return cookiesMap[name];\n        }\n        if (!window?.document) return;\n        // 处理 cookie 动态更新情形\n        const curCookie = document.cookie || '';\n        if (curCookie === prevCookie) return cookiesMap[name];\n        prevCookie = curCookie;\n        cookiesMap = parseCookieString(curCookie, !options.raw, options);\n        return cookiesMap[name];\n    } catch (err) {}\n}\n\n/**\n * 给定的键值设置cookie\n * @param {string} name 名称.\n * @param {*} value cookie值.\n * @param {object=} options (Optional) 配置项:\n *      path 路径\n *      domain 域名\n *      expires 过期时间，一个Date对象\n *      secure 是否安全cookie\n *      raw (true/false). Setting raw to true indicates that the cookie should not be URI encoded before being set.\n */\nexport function setCookie(name: string, value: string, options: CookieOptions = {}) {\n    try {\n        document.cookie = createCookieString(name, value, !options.raw, options);\n        cookiesMap[name] = value;\n    } catch (err) {}\n}\n// 测试用例清除cookie缓存使用\nexport function clearCacheCookies() {\n    cookiesMap = {};\n    prevCookie = '';\n}\n\nexport default {\n    getCookie,\n    setCookie,\n    parseCookieString\n};\n","export function log(...args: any[]) {\n    try {\n        const log = console?.log;\n        return log && log.call(console, ...args);\n    } catch (e) {\n        return;\n    }\n}\n\nexport function warn(...args: any[]) {\n    try {\n        const warn = console?.warn;\n        return warn && warn.call(console, ...args);\n    } catch (e) {\n        return;\n    }\n}\nconst sdkName: string = '__SDK_NAME__';\nexport function error(...args: any[]) {\n    try {\n        const error = sdkName === 'webLogger_krn' ? console?.log : console?.error;\n        return error && error.call(console, ...args);\n    } catch (e) {\n        return;\n    }\n}\n","import { ksAppList } from './const';\nimport { getCookie } from '@/util/cookie';\nimport type { UrlMapFn, UrlMap, UrlMapFnParam } from '../config/types';\nimport { error } from './console';\n\n/**\n * 获取 localStorage 缓存\n */\nexport function getLocalStorageItem(key: string) {\n    try {\n        if (window && window.localStorage) {\n            const value = window.localStorage.getItem(key);\n            if (value) {\n                try {\n                    return JSON.parse(value);\n                } catch (err) {\n                    return value;\n                }\n            }\n        }\n    } catch (err) {\n        return null;\n    }\n    return null;\n\n}\n/**\n * 设置 localStorage 缓存\n */\nexport function setLocalStorageItem(key: string, value: any) {\n    try {\n        if (window && window.localStorage) {\n            window.localStorage.setItem(key, JSON.stringify(value));\n            return true;\n        }\n    } catch (err) {\n        return false;\n    }\n    return false;\n}\n\n/**\n * 判断item是否在目标数组arr中\n * @param {*} arr   目标数组\n * @param {*} item  item\n */\nexport function inArray(arr: any[], item: any) {\n    return arr.indexOf(item) > -1;\n}\n/**\n * 从目标arr中删除item\n * @param {*} arr  目标数组\n * @param {*} item  item\n */\nexport function deleteArray(arr: any[], item: any) {\n    const index = arr.indexOf(item);\n\n    if (index > -1) {\n        arr.splice(index, 1);\n    }\n}\n\n/**\n * 事件监听兼容处理\n * @param {*} evtTarget  事件监听目标\n * @param {*} evtName   事件名\n * @param {*} callback  回调函数\n * @param {*} options  相关参数设置\n */\nexport function addMonitor(\n    evtTarget: Element | Window | Document,\n    evtName: string,\n    callback: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n) {\n    if ('attachEvent' in evtTarget) {\n        return evtTarget.attachEvent('on' + evtName, callback);\n    }\n    return evtTarget.addEventListener(evtName, callback, options);\n}\n\n/**\n * 事件监听解绑兼容处理\n * @param {*} evtTarget  事件监听目标\n * @param {*} evtName   事件名\n * @param {*} callback  事件回调\n */\nexport function removeMonitor(\n    evtTarget: Element | Window | Document,\n    evtName: string,\n    callback: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n) {\n    if ('attachEvent' in evtTarget) {\n        return evtTarget.detachEvent('on' + evtName, callback);\n    }\n    return evtTarget.removeEventListener(evtName, callback, options);\n}\n\nexport function leftPad(str: string, len: number, ch = ' ') {\n    len = len - str.length;\n    if (len <= 0) {\n        return str;\n    }\n    let pad = '';\n    while (len) {\n        if (len & 1) {\n            pad += ch;\n        }\n        len >>= 1;\n        ch += ch;\n    }\n    return pad + str;\n}\n\n/**\n * 是否是快手系APP\n */\nexport const isInApp = (ua = window.navigator.userAgent.toLowerCase()) => {\n    try {\n        for (let i = 0; i < ksAppList.length; i++) {\n            if (ua.indexOf(ksAppList[i]!.toLowerCase()) > -1) {\n                return true;\n            }\n        }\n    } catch (err) {\n        return false;\n    }\n};\n\nexport function parseQueryString(queryString: string) {\n    const result: any = {};\n    const queries = queryString.split('&');\n    for (const query of queries) {\n        const [key, value] = query.split('=');\n        if (!(key! in result)) {\n            result[key!] = value;\n            continue;\n        }\n        if (result[key!] instanceof Array) {\n            result[key!].push(value);\n            continue;\n        }\n        result[key!] = [result[key!], value];\n    }\n    return result;\n}\n\nexport function stringifyQuery(paramsString: any) {\n    const params = typeof paramsString === 'string' ? JSON.parse(paramsString) : paramsString;\n    const queries: string[] = [];\n    Object.keys(params).forEach(key => {\n        if (params[key] instanceof Array) {\n            for (const val of params[key]) {\n                queries.push(`${key}=${val}`);\n            }\n        } else if (typeof params[key] === 'object' && params[key] !== null) {\n            queries.push(`${key}=${JSON.stringify(params[key])}`);\n        } else {\n            queries.push(`${key}=${params[key]}`);\n        }\n    });\n    return queries.join('&');\n}\n\n// 参考：https://codereview.stackexchange.com/questions/37512/count-byte-length-of-string\nexport function getStringBytes(data: any) {\n    let dataStr = '';\n\n    // Force string type\n    if (typeof data === 'string') {\n        dataStr = data;\n    } else {\n        try {\n            dataStr = JSON.stringify(data);\n        } catch (e) {\n            dataStr = String(data);\n        }\n    }\n\n    let byteLen = 0;\n    for (let i = 0; i < dataStr.length; i++) {\n        const c = dataStr.charCodeAt(i);\n        byteLen += c < (1 << 7) ? 1 :\n            c < (1 << 11) ? 2 :\n                c < (1 << 16) ? 3 :\n                    c < (1 << 21) ? 4 :\n                        c < (1 << 26) ? 5 :\n                            c < (1 << 31) ? 6 : Number.NaN;\n    }\n    return byteLen;\n}\n\n/**\n * lodash 的 pick 方法\n */\nexport function pick(data: any, paths: string[]) {\n    let index = -1;\n    const length = paths.length;\n    const result: any = {};\n\n    while (++index < length) {\n        const path = paths[index];\n        const value = data[path!];\n        result[path!] = value;\n    }\n\n    return result;\n}\n\n/**\n * lodash的omit方法\n * @param data\n * @param paths\n */\nexport function omit(data: any, paths: string[]) {\n    const result: any = {};\n\n    for (const i in data) {\n        if (data.hasOwnProperty(i)) {\n            if (Array.isArray(paths) && paths.indexOf(i) === -1) {\n                result[i] = data[i];\n            }\n        }\n    }\n\n    return result;\n}\n\n/**\n * 检查依赖版本号是否不小于推荐版本\n */\nexport function checkVersion(recommendVersion: string, version: string) {\n    if (!version) return false;\n    if (version.indexOf('alpha') !== -1) return false;\n    if (version.indexOf('beta') !== -1) return false;\n    try {\n        let matches = recommendVersion.match(/\\d+\\.\\d+\\.\\d+/);\n        recommendVersion = matches?.[0] || '';\n        if (!recommendVersion) return true;\n\n        matches = version.match(/\\d+\\.\\d+\\.\\d+/);\n        version = matches?.[0] || '';\n        if (!version) return false;\n\n        const [rMajor, rMinor, rPatch] = recommendVersion.split('.').map((i: string) => Number(i));\n        const [major, minor, patch] = version.split('.').map((i: string) => Number(i));\n\n        if (major! < rMajor!) return false;\n        if (major! > rMajor!) return true;\n\n        if (minor! < rMinor!) return false;\n        if (minor! > rMinor!) return true;\n\n        if (patch! < rPatch!) return false;\n\n        return true;\n    } catch (err) {\n        return false;\n    }\n}\n\nexport function checkSupportCloseCoPage() {\n    const version = getCookie('appver', undefined, true);\n    return version && checkVersion('10.8.30', version);\n}\n/**\n * 获取元素xpath\n * @param element 元素\n */\nexport function getXpathFromNode(element: HTMLElement): string {\n    // if (element && element.id !== '')\n    //     return 'id(\"' + element.id + '\")';\n    if (element === document.body)\n        return 'HTML/' + element.tagName;\n\n    let ix = 0;\n    if (element && element.parentNode) {\n        const siblings = element.parentNode.childNodes;\n        for (let i = 0; i < siblings.length; i++) {\n            const sibling = siblings[i] as HTMLElement;\n            if (sibling === element)\n                return getXpathFromNode(element.parentNode as HTMLElement) + '/' + element.tagName + '[' + (ix + 1) + ']';\n            if (sibling.nodeType === 1 && sibling.tagName === element.tagName)\n                ix++;\n        }\n    }\n    return '';\n}\n\n/**\n * url中获取path和query\n */\nexport function getPathAndQueryFromUrl() {\n    const { protocol, host, pathname, search, href } = window.location;\n    const pageUrl = href;\n    const pagePath = protocol + host + pathname;\n    const pageParams = parseQueryString(search.slice(1));\n    return { pageUrl, pagePath, pageParams };\n}\n\nexport function getUrlAndQueryFromUrl(url = location.href) {\n    const queryIndex = url.lastIndexOf('?');\n    if (queryIndex === -1) {\n        return {\n            page: url\n        };\n    }\n    const page = url.slice(0, queryIndex);\n    const queryString = url.slice(queryIndex + 1);\n    return {\n        page,\n        params: parseQueryString(queryString),\n    };\n};\n\nexport const getMappingPage = (urlPackage: UrlMapFnParam, urlMap?: UrlMap | UrlMapFn) => {\n    let { url, page, params, pageId } = urlPackage;\n    if (!page && typeof url === 'string') {\n        const parsed = getUrlAndQueryFromUrl(url);\n        page = parsed.page;\n        params = parsed.params;\n    }\n    if (typeof urlMap === 'function') {\n        try {\n            const res = urlMap({ url, page, params });\n            if (typeof res === 'string') {\n                page = res;\n            } else if (typeof res === 'object') {\n                if (res.page) {\n                    page = res.page;\n                }\n                if (res.params) {\n                    params = res.params;\n                }\n                if (res.pageId) {\n                    pageId = res.pageId;\n                }\n            }\n        } catch (err) { }\n    } else if (typeof urlMap === 'object') {\n        let mappingPage = '';\n        for (const key in urlMap) {\n            if ((url || page || '').indexOf(key) > -1) {\n                mappingPage = urlMap[key]!;\n                break;\n            }\n        }\n        if (mappingPage) {\n            page = mappingPage;\n        }\n    }\n    return {\n        page,\n        params,\n        pageId\n    };\n};\n\nexport function cloneDeep(obj: [] | {}): [] | {} {\n    if (typeof obj !== 'object') return {};\n    const newObj = obj instanceof Array ? [] : {};\n    for (const key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            // @ts-ignore\n            newObj[key] = typeof obj[key] === 'object' ? cloneDeep(obj[key]) : obj[key];\n        }\n    }\n    return newObj;\n}\n\n/**\n * 非空纯对象判定\n * @param obj\n * @returns\n */\n const isObj = (obj: any) => obj && typeof obj === 'object' && !Array.isArray(obj);\n /**\n  * 对象打平赋值\n  * @param target\n  * @param options\n  * @returns\n  */\n export const flattenAssign = (target: any, options: any) => {\n    if (!isObj(target) || !isObj(options)) return;\n    const merge = (obj1: any, obj2: any, key: string) => {\n        if (isObj(obj1[key]) && isObj(obj2[key])) {\n            Object.assign(obj1[key], obj2[key]);\n        } else if (!isObj(obj1[key]) && !isObj(obj2[key])){\n            obj1[key] = obj2[key];\n        }\n    }\n    for (const key in options) {\n        if (target.hasOwnProperty(key)) {\n            merge(target, options, key);\n            continue;\n        }\n        for (const deepKey in target) {\n            if (isObj(target[deepKey]) && target[deepKey].hasOwnProperty(key)) {\n                merge(target[deepKey], options, key);\n            }\n        }\n    }\n}\n\nexport function pageUrlValidate(page: string) {\n    // 对于上报到v2，page为url的埋点，给予警告\n    if (page && /^(https?:)?\\/\\//.test(page)) {\n        error('[error 108]',`请注意当前埋点页面信息为 ${page}，不符合规范，上报失败！`);\n        return false;\n    }\n    return true;\n}\n\nexport const getResolution = (() => {\n    let resolution = '';\n    return () => {\n        if (resolution) {\n            return resolution;\n        }\n        try {\n            const ratio = window.devicePixelRatio || 1;\n            const width = Math.floor(screen.width * ratio); // 有的devicePixelRatio为小数，在此转为整数\n            const height = Math.floor(screen.height * ratio);\n            resolution = `${width}x${height}`;\n            return resolution;\n        } catch (err) {\n            return '';\n        }\n    };\n})();\n\n// 从vue-router里面拿的……\nexport function supportsPushState() {\n    const ua = window.navigator.userAgent;\n    if (\n        (ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1)\n        && ua.indexOf('Mobile Safari') !== -1\n        && ua.indexOf('Chrome') === -1\n        && ua.indexOf('Windows Phone') === -1\n    ) {\n        return false;\n    }\n    return window.history && 'pushState' in window.history;\n}\n\nexport function deleteUrlQueryAndReturnFullUrl(url: string, deleteKeyArray: string[]) {\n    const { page, params } = getUrlAndQueryFromUrl(url);\n    if (Array.isArray(deleteKeyArray) && deleteKeyArray.length) {\n        deleteKeyArray.forEach(key => {\n            delete params[key];\n        });\n        let paramsString = '';\n        for (const i in params) {\n            if (params.hasOwnProperty(i)) {\n                paramsString += paramsString ? '&' : '';\n                paramsString += `${i}=${params[i]}`;\n            }\n        }\n        return paramsString ? `${page}?${paramsString}` : page;\n    }\n    return url;\n}\n\ninterface TypeQueryMap {\n    [key: string]: string | number;\n}\n\n/**\n * 设置url中的参数，并返回完整url\n * @param url\n * @param configQueryMap\n */\nexport function setUrlQueryAndReturnFullUrl(url: string, configQueryMap: TypeQueryMap): string {\n    if (typeof configQueryMap !== 'object') {\n        return url;\n    }\n    let paramsString = '';\n    for (const i in configQueryMap) {\n        if (configQueryMap.hasOwnProperty(i)) {\n            const paramString = `${i}=${configQueryMap[i]}`;\n            paramsString += paramsString ? `&${paramString}` : paramString;\n        }\n    }\n    let partUrl;\n    const lastChar = url[url.length - 1];\n    if (url.indexOf('?') === -1) {\n        // 不存在变量\n        partUrl = `?${paramsString}`;\n    } else if (lastChar === '?' || lastChar === '&') {\n        // 处理最后一个字符是 ? 以及 & 的特殊情况\n        partUrl = paramsString;\n    } else {\n        // 正常添加变量\n        partUrl = `&${paramsString}`;\n    }\n    return url + partUrl;\n}\n\nexport function isMobileAndIpad() {\n    const ua = window?.navigator?.userAgent || '';\n    const isMobile = /mobile|tablet|ip(ad|hone|od)|android|(windows phone)/i.test(ua);\n    // 兼容最新版本 ipad 版本 ua 判断\n    const isiPad = window?.navigator.platform === 'MacIntel' && window?.navigator?.maxTouchPoints > 1;\n    return isMobile || isiPad;\n}\n\n/**\n * 是否支持 worker gzip 压缩\n * @returns\n */\nexport const enableAsyncGzip = () => !!(\n    window?.Worker // 可以新建 worker\n    && window?.Uint8Array // 支持二进制存储\n    && window.URL // 可以创建文件路径\n    && window.Promise // 可以使用 promise\n    && !isMobileAndIpad() // 移动端禁止使用压缩\n);\n\n/**\n * 返回正整数数值\n * @param value\n */\nexport const getPositiveInteger = (value: number) => {\n    try {\n        return Math.abs(Math.floor(value));\n    } catch (e) {\n        return value;\n    }\n};\n\nexport function stringifyParams(params: string | any) {\n    return typeof params === 'string' ? params : typeof params === 'object' ? JSON.stringify(params) : '';\n}\n","// 为了减少点代码体积，自己搞一个简易的EventEmitter\nimport { deleteArray } from '.';\n\nexport default class EventEmitter {\n    private events: {\n        [key: string]: Array<(...args: any[]) => void>;\n    } = {};\n    on(eventName: string, callback: (...args: any[]) => void) {\n        if (callback && typeof callback === 'function') {\n            this.events[eventName] = this.events[eventName] || [];\n            this.events[eventName]?.push(callback);\n        }\n    }\n    off(eventName: string, callback?: (...args: any[]) => void) {\n        if (!this.events[eventName]) {\n            return;\n        }\n        if (callback && typeof callback === 'function') {\n            const array = this.events[eventName]\n            if (array) {\n                deleteArray(array, callback);\n            }\n        }\n        if (!callback) {\n            this.events[eventName] = [];\n        }\n    }\n    emit(eventName: string, ...args: any[]) {\n        if (!this.events[eventName]) {\n            return;\n        }\n        this.events[eventName]?.forEach(callback => {\n            callback(...args);\n        });\n    }\n}\n","import type { LogPackage, BatchLog as Logger } from './logger';\nimport type { BasePlugin, BasePluginConstructor } from '@/plugins/base';\nimport type { ClientLog as ClientLogV3 } from '../proto/v3/client_log';\nimport type { CommonPackage, CommonPackageOptions } from './common';\nimport type { HttpCommonPackage, CommonConfig, UrlObj, PageTypeKey } from '@/types/configuration';\nimport Global from '../config/global';\nimport UrlPackage from './url-package';\nimport EventEmitter from '../util/events';\nimport initConfig from '@/config';\nimport { error } from '@/util/console';\nimport type {\n    EventType as IEventType,\n    EventOptions as IEventOptions,\n    ImmediatelyEventOptions\n} from '@/types/event';\n\nlet pluginIndex = 0;\n\nexport default class Weblog extends EventEmitter {\n    static __instance: Weblog;\n    version: string = '__VERSION__';\n    currentUrlPackage!: UrlPackage;\n    referUrlPackage?: UrlPackage;\n    baseOption: HttpCommonPackage;\n    logConfig: CommonConfig;\n    // 核心日志发送\n    logger!: Logger;\n    commonPackage!: CommonPackage;\n    // 插件\n    plugins: {\n        [key: string]: BasePlugin | any;\n    } = {};\n    /**\n     * @param {?object} logConfig Logger初始化配置\n     * @param {object=} options 额外配置参数\n     *                    - base 公参的覆盖\n     */\n    constructor(\n        logConfig: CommonConfig,\n        base?: HttpCommonPackage,\n    ) {\n        super();\n        // 初始化初始化参数配置和埋点基础信息配置\n        this.baseOption = { ...base };\n        this.logConfig = initConfig(logConfig);\n        // 初始化页面信息\n        this.initUrlPackage();\n        // 记录首个实例\n        if (!Weblog.__instance) {\n            Weblog.__instance = this;\n        }\n    }\n\n    get sessionId() {\n        return Global.sessionId;\n    }\n\n    initUrlPackage() {\n        this.updateCurrentUrlPackage();\n    }\n\n    /**\n     * 更新当前 url 信息\n     * @param url\n     * @param type\n     */\n    updateCurrentUrlPackage(url: UrlObj | string = {}, type: PageTypeKey = 'web') {\n         // 该接口不改变 refer 信息\n        if (typeof url === 'object' && url.page) {\n            if (this.currentUrlPackage && url.page === this.currentUrlPackage.page) {\n                return this.currentUrlPackage.update(url.page, url.params);\n            }\n        }\n        this.currentUrlPackage = new UrlPackage(url as UrlObj, type);\n    }\n\n    /**\n     * 更新 refer url 信息\n     * @param url\n     * @param type\n     */\n    updateReferUrlPackage(url: UrlObj | UrlPackage | string = this.currentUrlPackage, type: PageTypeKey = 'web') {\n        if (url instanceof UrlPackage) {\n            this.referUrlPackage = url;\n        } else {\n            this.referUrlPackage = new UrlPackage(url as UrlObj, type);\n        }\n    }\n    /**\n     * 重设 common_package 信息\n     * @param base\n     */\n    updateBase(base: HttpCommonPackage) {\n        this.updateCommonPackage(base);\n    }\n    /**\n     * 更新现有 common_package 信息\n     */\n    updateCommonPackage(options: HttpCommonPackage | CommonPackageOptions) {\n        if (typeof options !== 'object') return;\n        this.commonPackage.update(options);\n    }\n\n    /**\n     * 初始化插件\n     * @param plugins\n     */\n    addPlugins() {\n        if (!this.logConfig.plugins || !this.logConfig.plugins.length) return;\n        // 类似 webpack plugins 的实例数组\n        this.logConfig.plugins.forEach((plugin: any) => {\n            if (typeof plugin === 'object' && typeof plugin.apply === 'function') {\n                this.addPluginInstance(plugin);\n            }\n        });\n    }\n    /**\n     * 加载插件实例\n     */\n    addPluginInstance(pluginInstance: any) {\n        if (pluginInstance) {\n            const key = pluginInstance.key || pluginInstance.constructor && pluginInstance.constructor.key || `plugin_auto_key_${pluginIndex++}`;\n            if (typeof pluginInstance.apply === 'function'\n                && (!pluginInstance.weblog || pluginInstance.weblog !== this)\n            ) {\n                pluginInstance.apply(this);\n            }\n            this.plugins[key] = pluginInstance;\n        }\n    }\n    /**\n     * 加载插件构造函数\n     * @param plugin\n     * @param pluginOptions\n     */\n    plug(plugin: BasePluginConstructor, pluginOptions?: any) {\n        if (this.plugins[plugin.key]) {\n            return error('[code 301]', `${plugin.key} 插件重复加载！`)\n        }\n        this.addPluginInstance(new plugin(this, pluginOptions));\n    }\n\n    unplug(name: string) {\n        const plugin = this.plugins[name];\n        if (plugin) {\n            plugin.destroy();\n            delete this.plugins[name];\n        }\n    }\n\n    unplugAll() {\n        for (const key in this.plugins) {\n            if (this.plugins[key]) {\n                this.unplug(key);\n            }\n        }\n    }\n\n    public flush = () => {\n        this.logger.flush();\n    }\n    /**\n     * 扩展类实现\n     * @param eventType \n     * @param eventOptions \n     * @returns \n     */\n    generateLog<T extends IEventType>(\n        eventType: T,\n        eventOptions?: IEventOptions<T>\n    ) {\n        return {};\n    }\n    send<T extends IEventType>(type: T, options: IEventOptions<T>, immediately?: boolean) {\n        const log = this.generateLog(type.toUpperCase() as T, options) as ClientLogV3.ReportEvent;\n        // @ts-ignore\n        if (typeof this.beforeSend === 'function') {\n            // @ts-ignore\n            this.beforeSend(type, options, log);\n        }\n        return this.logger.send(log, !!immediately, (options as ImmediatelyEventOptions<T>).callback);\n    }\n    /**\n     * 收集上报\n     * @param type \n     * @param options \n     * @returns \n     */\n    collect<T extends IEventType>(type: T, options: IEventOptions<T>): void {\n        this.send(type, options);\n    }\n\n    sendImmediately<T extends IEventType>(type: T, options: IEventOptions<T>): void {\n        this.send(type, options, true);\n    }\n\n    sendPackage(data: LogPackage, callback?: (error?: any) => void) {\n        this.logger.sendPackage(data, callback);\n    }\n\n    destroy() {\n        this.unplugAll();\n    }\n}\n","import type { HybridWeblogInitParams } from '@/types/configuration';\n\nexport default (options?: HybridWeblogInitParams[0]): HybridWeblogInitParams[0] => {\n    const logConfig: HybridWeblogInitParams[0] = {\n        env: 'production',\n        proto: 'v3',\n        timeout: 30000,\n        wait: 1000,\n        maxBatchLength: 50,\n        sampleRate: 1,\n        // 尝试从全局中获取 yoda\n        yoda: typeof window !== 'undefined' && (window as any).yoda,\n        forbidV2HttpUrlPage: true,\n        ...(options || {})\n    };\n    return logConfig;\n};\n\nexport type LogConfig =  HybridWeblogInitParams[0];\n\nexport type BridgeLogConfig = {\n    /**\n     * 是否禁止 PV，用于将 H5 作为端内元素上报，不会上报 PV 事件\n     */\n    disablePV?: boolean;\n\n    /**\n     * 自定义事件所属的业务线，如 LIVE、ESHOP 等\n     */\n    biz?: string;\n    /**\n     * 是否在 bridge 模式下同时开启 HTTP 上报\n     */\n    openHttpSender?: boolean;\n}","import { isInApp } from '.';\nimport { getCookie, setCookie } from './cookie';\n\nexport function uuid() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n/**\n * 生成nano id\n * @return {string} 16长度的字符串\n */\nexport function nanoId() {\n    const ts = ((Math.random() * 1e9) >>> 0);\n    const randomer = [];\n    const seed = '0123456789ABCDEF';\n    for (let i = 0; i < 7; i++) {\n        randomer.push(seed.charAt(Math.random() * 16));\n    }\n\n    return ts + randomer.join('');\n}\n/**\n * 提取顶级域名\n * @param {?string=} hostname\n * @return {string} 返回顶级域名\n */\nfunction resolveTopLevelDomain(hostname: string = typeof location !== 'undefined' ? location.hostname : '') {\n    if (!hostname) {\n        return '';\n    }\n\n    const ret = hostname.split('.');\n    const len = ret.length;\n    return (len <= 2 ? '' : `.${ret[len - 2]}.${ret[len - 1]}`);\n}\nconst didKey: string = 'did';\n/**\n * 生成did\n * @return {string}\n */\nexport function generateDID() {\n    try {\n        // 兼容一下原下发的did逻辑，如果能从did获取，那么就走did\n        // 如果不能，那就通过log sdk自行维护的_did来搞\n        let did = getCookie(didKey) || getCookie('_did');\n        if (!did) {\n            did = `web_${nanoId()}`;\n            const expires = new Date();\n            expires.setFullYear(expires.getFullYear() + 1);\n            setCookie('_did', did, {\n                expires,\n                domain: resolveTopLevelDomain(),\n                path: '/',\n            });\n        }\n        return did;\n    } catch (err) {\n        return '';\n    }\n}\nconst sessionKey = 'WEBLOGGER_SESSIONID';\n// session_id 用来串联在一次打开 App 期间跳转不同页面的用户行为\nexport const getSessionId = () => {\n    let sessionId: string = '';\n    const defaultKey = 'session_id';\n    try {\n        if (isInApp()) {\n            sessionId = getCookie(defaultKey) || getCookie('sid'); // 端内从 cookie 中获取客户端传来的 session_id\n            if (sessionId) return sessionId;\n        } else if (typeof sessionStorage !== 'undefined') {\n            sessionId = sessionStorage.getItem(sessionKey) || '';\n            if (!sessionId) {\n                sessionId = uuid();\n                sessionStorage.setItem(sessionKey, sessionId);\n            }\n        }\n    } catch (err) {\n        sessionId = uuid();\n    }\n    return sessionId || uuid();\n};\n","import type { UrlMapFn, UrlMap, PageTypeKey, UrlObj } from '@/config/types';\n\nimport BaseUrlPackage from '@/core/url-package';\nimport { getMappingPage, getUrlAndQueryFromUrl } from '@/util';\nimport { uuid } from '@/util/uuid';\n\nexport default class UrlPackage extends BaseUrlPackage {\n    sampled?: boolean | {radar: {[key: string]: number}};\n    constructor(url: string | UrlObj, pageType: PageTypeKey, urlMap?: UrlMap | UrlMapFn) {\n        super({}, pageType);\n        if (typeof url === 'string') {\n            // TODO: 避免兼容问题，暂不处理\n            // try {\n            //     url = window.decodeURIComponent(url);\n            // } catch (err) {}\n            const obj = getUrlAndQueryFromUrl(url);\n            this.page = obj.page;\n            this.params = obj.params;\n        } else {\n            this.page = (url || {}).page || '';\n            this.params = (url || {}).params || undefined;\n        }\n        this.identity = this.generatePageId();\n        if (urlMap && typeof url === 'string') {\n            this.init(url, urlMap);\n        }\n    }\n\n    init(url: string, urlMap: UrlMap | UrlMapFn = {}) {\n        const { page, params } = getMappingPage({url, page: this.page, params: this.params}, urlMap);\n        this.update(page, params);\n    }\n\n    attachUrl() {\n        if (!this.params) {\n            this.params = {};\n        }\n        if (location?.href) {\n            // 电商需求，页面信息携带原始 url 和 pathname\n            this.params.origin_url = this.params.origin_url || location?.href;\n            const { page = '' } = getUrlAndQueryFromUrl(location.href);\n            this.params.origin_pathname = page;\n        }\n    }\n\n    getRealUrlPackage() {\n        const { page, params } = getUrlAndQueryFromUrl(location.href);\n        return {\n            page,\n            params: JSON.stringify({\n                page_code: this.page,\n                url: location.href,\n                query: params,\n                ...params\n            }),\n            page_type: this.page_type,\n            identity: this.identity\n        };\n    }\n\n    override generatePageId() {\n        return uuid();\n    }\n\n}","import type { v3Env } from '@/config/types';\nimport env = Tachikoma.env;\n\nexport const dataTrackHost = 'https://data-track.corp.kuaishou.com';\nexport const overseaDataTrackHost = 'https://data-track-sgp.corp.kuaishou.com';\nconst testHost = dataTrackHost + '/';\n\nexport const PROD = 'production';\nconst TEST = 'test';\nconst DEV = 'development';\nconst OVERSEA = 'oversea';\nexport const LOGGER = 'logger';\nexport const LOGGER_SGP = 'logger-oversea';\n\nconst v3Api = 'rest/wd/common/log/collect/';\nexport const Envs = [PROD, TEST, DEV, LOGGER, OVERSEA];\nconst overseaHost = 'https://logsdk.kwai-pro.com/';\nexport const Apis = {\n    // v2 接口一定要带上 _json=1 参数，不然服务端会解析失败\n    v2: `rest/kd/log/collect?_json=1&biz=`,\n    v3: `${v3Api}misc2`,\n    // 雷达都上报到 v3\n    radar: `${v3Api}radar`\n};\n\nexport const Hosts = {\n    v2: {\n        // 正式环境随机域名分流\n        production: ['https://wlog.ksapisrv.com/', 'https://wlog.gifshow.com/'][Math.round(Math.random())],\n        development: testHost,\n        test: testHost,\n        oversea: overseaHost\n    },\n    v3: {\n        production: 'https://log-sdk.ksapisrv.com/',\n        development: testHost,\n        test: testHost,\n        oversea: overseaHost\n    }\n};\n\nexport const NodeHosts = {\n    v2: {\n        // 正式环境随机域名分流\n        production: ['https://wlog.ksapisrv.com/', 'https://wlog.gifshow.com/'][Math.round(Math.random())],\n        development: testHost,\n        test: testHost,\n        oversea: overseaHost\n    },\n    v3: {\n        production: 'https://log-sdk-internal.corp.kuaishou.com/',\n        development: testHost,\n        test: testHost,\n        oversea: overseaHost\n    }\n}\n\nexport const buildUrl = (\n    env: string = PROD,\n    radar = false,\n    proto: 'v2' | 'v3' = 'v3',\n) => {\n    if (Envs.indexOf(env) === -1) {\n        return env + Apis[proto];\n    }\n    if (radar && Hosts.v3[env as v3Env]) {\n        return Hosts.v3[env as v3Env] + Apis.radar;\n    }\n    if (Hosts[proto][env as v3Env] && Apis[proto]) {\n        return Hosts[proto][env as v3Env] + Apis[proto];\n    }\n    return Hosts.v3.production + Apis.v3;\n};\n\nexport const nodeBuildUrl = (\n    env: string = PROD,\n    radar = false,\n    proto: 'v2' | 'v3' = 'v3',\n) => {\n    if (Envs.indexOf(env) === -1) {\n        return env + Apis[proto];\n    }\n    if (radar && NodeHosts.v3[env as v3Env]) {\n        return NodeHosts.v3[env as v3Env] + Apis.radar;\n    }\n    if (NodeHosts[proto][env as v3Env] && Apis[proto]) {\n        return NodeHosts[proto][env as v3Env] + Apis[proto];\n    }\n    return NodeHosts.v3.production + Apis.v3;\n}\n\nexport const formatUrlQuery = (url: string, querys: string) => {\n    if (!querys) return url;\n    let reg = /\\?(.+?)$/;\n    try {\n        return reg.test(url) ? url.replace(/\\?(.+?)$/, `?${querys}&$1`) : url + `?${querys}`;\n    } catch (err) {\n        return url;\n    }\n};\n","import type { ClientLog as ClientLogV3 } from '../proto/v3/client_log';\nimport type { ClientLog as ClientLogV2} from '../proto/v2/client_log';\nimport type { CommonPackage } from './common';\nimport type { CommonConfig } from '@/types/configuration';\nimport type { SendCallback, LoggerSender } from '@/config/types';\nimport { buildUrl, formatUrlQuery, Apis, Hosts } from '@/config/apis';\n\nexport type LogPackage = (ClientLogV3.ReportPackage | ClientLogV2.ReportPackage) & { seqid?: number };\nexport type ReportEvent = ClientLogV3.ReportEvent | ClientLogV2.ReportEvent;\n\nexport class BatchLog {\n    // 立即发送队列\n    asyncQueue: ReportEvent[] = [];\n    // 存储待发送的消息\n    throttleQueue: ReportEvent[] = [];\n    // 存储失败或者超时的数据\n    errorQueue: LogPackage[] = [];\n    sendingQueue: {[key: string]: LogPackage} = {};\n    // 延迟发送定时器\n    protected batchWaitTimer: any;\n    // 延时补报日志定时器\n    private compensateTimer: any;\n    commonPackage: CommonPackage;\n    config!: CommonConfig;\n    url: string = '';\n    isV2 = false;\n    isDebug = false;\n    radarUrl: string = '';\n    drained: boolean = false; // 是否未排干日志队列\n    baseSendData!: LoggerSender;\n    batchCount: number = 50;\n    isSetSamplingResult = false;\n    // 有值时阻塞日志发送\n    sendingYield?: Promise<any> | null = null;\n    constructor(config: any, commonPackage: CommonPackage) {\n        this.config = config;\n        if (this.config.maxBatchLength && this.config.maxBatchLength > 1) {\n            this.batchCount = Math.min(50, this.config.maxBatchLength);\n        }\n        this.commonPackage = commonPackage;\n        this.isDebug = this.config.logger || this.config.env === 'logger';\n        this.isV2 = this.config.proto === 'v2';\n        this.updateUrls();\n    }\n    sendData(data: {url: string, data: any, [key: string]: any}, callback?: SendCallback) {\n        if (typeof this.config.sender === 'function') {\n            return this.config.sender(data, callback);\n        }\n        return this.baseSendData(data, callback);\n    }\n    get responseSamplingStorageKey() {\n        const { product_name, product } = this.commonPackage.app_package;\n        const { device_id } = this.commonPackage.identity_package;\n        // tslint:disable-next-line:max-line-length\n        return `RESPONSE_SAMPLING_STORAGE_KEY_${product_name || product}_${device_id}`;\n    }\n\n    /**\n     * 根据配置生成上报的 url 地址\n     */\n    updateUrls() {\n        const { env } = this.config;\n        // 线上地址 -> 抓包查找工具后端，用以测试后端\n        // 兼容方式：若小程序里有扫码工具，扫码后直接进行切换\n        if (env && /^(https?:)?\\/\\//.test(env)) {\n            this.url = env;\n        } else {\n            this.url = buildUrl(env);\n        }\n        this.formatUrl();\n    }\n\n    formatUrl() {\n        if (!this.radarUrl) {\n            this.radarUrl = this.url.replace(this.url.indexOf(Apis.v2) !== -1 ? Apis.v2 : Apis.v3, Apis.radar);\n            // v2 域名不能上报雷达事件\n            if (this.radarUrl.indexOf(Hosts.v2.production || '') !== -1) {\n                this.radarUrl.replace(Hosts.v2.production || '', Hosts.v3.production);\n            }\n        }\n        const { product_name, product } = this.commonPackage.app_package;\n        const querys = `v=__VERSION__&kpn=${product_name || product}`;\n        this.url = formatUrlQuery(this.url, querys);\n        this.radarUrl = formatUrlQuery(this.radarUrl, querys);\n    }\n    /**\n     * 之所以使用 JSON 而不是 commonPackage 对象，是因为对象可能会变化，而 JSON 则是当时的一个快照，一旦生成不会变化\n     */\n    getCommonPackageJSON() {\n        return this.commonPackage.toJSON();\n    }\n    /**\n     * 进入发送流程\n     * @param data\n     * @param immediate\n     * @param callback 用户自定义 callback\n     * @returns\n     */\n    send(data: ReportEvent, immediate = false, callback?: SendCallback) {\n        // 有回调的立即上报\n        if (callback || this.drained) {\n            return this.sendLogs([data], callback);\n        }\n        if (immediate) {\n            this.sendAsync(data, callback);\n            return;\n        }\n        this.sendThrottle(data);\n    }\n    /**\n     * 短时异步上报\n     */\n    async sendAsync(data: ReportEvent, callback?: SendCallback) {\n        this.asyncQueue.push(data);\n        if (this.asyncQueue.length >= this.batchCount) {\n            this.flush();\n            return;\n        }\n        // 用一个微任务包裹，减少同时触发的 sendImmediately 对性能影响，TODO：丢失率影响\n        if (this.sendingYield) {\n            await this.sendingYield;\n            this.sendingYield = null;\n        }\n        try {\n            await Promise.resolve();\n        } catch (err) {}\n        if (!this.asyncQueue.length) return;\n        this.flush();\n    }\n    /**\n     * 节流上报\n     */\n    sendThrottle(data: ReportEvent) {\n        this.throttleQueue.push(data);\n        // 积攒超过最大\n        if (this.throttleQueue.length >= this.batchCount) {\n            this.flush();\n            return;\n        }\n\n        // debounce逻辑\n        clearTimeout(this.batchWaitTimer);\n        this.batchWaitTimer = setTimeout(() => {\n            this.flush();\n        }, this.config.wait);\n    }\n    /**\n     * 批量发送日志\n     * @param logs\n     * @param callback 用户自定义 callback\n     */\n    sendLogs(logs: ReportEvent[], callback?: SendCallback): void | Boolean {\n        if (!logs || !logs.length) {\n            return typeof callback === 'function' && callback();\n        }\n        const data: LogPackage = this.buildLogPackage(logs, this.url);\n        // 网络发送错误回调\n        const callbackFn = (error?: any) => {\n            // 如果网络异常，日志发送失败，则将错误日志缓存，在网络恢复时清空一次错误队列\n            if (error) {\n                this.errHandler(data);\n            } else {\n                this.flushErrorLogs();\n            }\n            typeof callback === 'function' && callback(error);\n        }\n        this.sendPackage(data, callbackFn);\n    }\n    /**\n     * 将日志包通过接口发送\n     * @param data\n     * @param callback\n     */\n    sendPackage(data: LogPackage, callback?: SendCallback) {\n        const { timeout } = this.config;\n        try {\n            // 如果业务方配置了 sender\n            this.sendData({\n                ...data,\n                isDebug: this.isDebug,\n                isDrained: this.drained,\n                timeout\n            }, callback);\n        } catch (err) {\n            typeof callback === 'function' && callback(err);\n        }\n    }\n\n    /**\n     * 每个 logPackage 包含了所有上报所需的信息，上报地址和上报数据\n     * @param logs\n     * @param url\n     */\n    buildLogPackage(logs: ReportEvent[], url: string) {\n        if (this.isV2) {\n            return this.buildV2Package(logs as ClientLogV2.ReportEvent[], url);\n        }\n        return this.buildV3Package(logs as ClientLogV3.ReportEvent[], url);\n    }\n    buildV2Package(logs: ClientLogV2.ReportEvent[], url: string): ClientLogV2.ReportPackage {\n        return {\n            url,\n            data: {\n                log: {\n                    event: logs\n                }\n            }\n        }\n    }\n    buildV3Package(logs: ClientLogV3.ReportEvent[], url: string, commonPackageOptions?: {[key: string]: any}): ClientLogV3.ReportPackage {\n        const common = this.getCommonPackageJSON();\n        commonPackageOptions && Object.assign(common, commonPackageOptions);\n        return {\n            url,\n            data: {\n                common,\n                logs\n            }\n        }\n    }\n    /**\n     * 清空当前日志队列\n     * @param callback\n     */\n    flush = (callback?: SendCallback) => {\n        this.sendLogs(this.throttleQueue.concat(this.asyncQueue), callback);\n        this.throttleQueue = [];\n        this.asyncQueue = [];\n    }\n    /**\n     * 页面关闭前排干所有未发送的和发送失败的日志\n     */\n    drain = () => {\n        this.drained = true;\n        this.flush();\n        this.flushErrorLogs();\n        // 处理 beforunload 中断，实际页面未退出的情况\n        setTimeout(() => {\n            this.drained = false;\n        }, 1000);\n    }\n\n    /**\n     * 日志上报出错处理，一般为网络异常\n     * @param logPackage\n     */\n    errHandler(logPackage: LogPackage) {\n        if (this.isV2) {\n            this.errorQueue.unshift(logPackage);\n            return;\n        }\n        const { data } = logPackage as ClientLogV3.ReportPackage;\n        if (!data.logs.length) return;\n        // http_seq_id 和 client_timestamp 不是必须的，合并时删除\n        delete data.common.h5_extra_attr.http_seq_id;\n        delete data.common.h5_extra_attr.client_timestamp;\n\n        // 尝试合并相同 url 和 common 的请求\n        let merged = false;\n        for (let i = 0; i < this.errorQueue.length; i++) {\n            const currentLog = this.errorQueue[i]  as ClientLogV3.ReportPackage;\n            if (\n                currentLog.url === logPackage.url &&\n                currentLog.data.logs.length + data.logs.length <= 100 &&\n                JSON.stringify(currentLog.data.common) === JSON.stringify(data.common)\n            ) {\n                merged = true;\n                currentLog.data.logs.push(...data.logs);\n                break;\n            }\n        }\n        if (!merged) {\n            // 先进后出\n            // 最大错误数量限制为 5\n            if (this.errorQueue.length >= 5) {\n                this.errorQueue.pop();\n            }\n            this.errorQueue.unshift(logPackage);\n        }\n    }\n\n    // 当网络恢复时尝试一次上报\n    flushErrorLogs() {\n        this.errorQueue.forEach(logPackage => {\n            this.sendPackage(logPackage);\n        });\n        this.errorQueue = [];\n    }\n\n    destory() {\n        this.batchWaitTimer && clearTimeout(this.batchWaitTimer);\n        this.compensateTimer && clearTimeout(this.compensateTimer);\n    }\n    /**\n     * 雷达专用上报（雷达上报接口和其他事件上报接口做了区分，用于分流统计）\n     * @param radar\n     */\n    sendRadar(radar: ClientLogV3.ReportEvent, service_name?: string) {\n        const options = service_name ? { service_name } : undefined;\n        const radarPackage = this.buildV3Package([radar], this.radarUrl || this.url, options);\n        this.sendPackage(radarPackage);\n    }\n}\n","import { error } from '@/util/console';\n\nexport const xhrErrorLog = (err: any, url: string, data: any) => error('[error 400]', '埋点上报接口请求报错', '\\nurl:', url, '\\ndata', data, '\\nerror:', err || 'server decode log failed');\n\nexport const logXhrResponseCheck = (status: number, response: string, url: string, data: any) => {\n    let err;\n    if (status < 200 || (status >= 300 && status !== 304)) {\n        const err = response || status || 'unknonw error';\n    } else {\n        try {\n            const { exception, result, error_msg } = JSON.parse(response);\n            if (exception) {\n                err = exception;\n            }\n            if (result !== 1) {\n                err = error_msg || `result is ${result}`\n            }\n        } catch (e){\n            err = (e as Error).message;\n        }\n    }\n    err && xhrErrorLog(err, url, data);\n    return err;\n}","import type { DataOptions } from './types';\nimport { logXhrResponseCheck, xhrErrorLog } from './util';\nimport { error } from '@/util/console';\n\nexport default function send(\n    { url, data, timeout }: DataOptions,\n    callback?: (error?: any) => void,\n): Promise<{\n    error?: string;\n    response?: string\n}> {\n    return new Promise(resolve => {\n        const xhr = new XMLHttpRequest();\n        // async 同步情况会报错，而且影响性能，取消使用同步\n        xhr.open('POST', url);\n        xhr.setRequestHeader('Content-Type', 'text/plain;charset=UTF-8');\n        if (typeof data === 'object' && !(data instanceof Uint8Array)) {\n            data = JSON.stringify(data);\n        }\n        if (timeout) {\n            xhr.timeout = timeout;\n        }\n        xhr.onload = () => {\n            const err = logXhrResponseCheck(xhr.status, xhr.response, url, data);\n            callback && callback(err);\n            resolve({\n                error: err,\n                response: err ? undefined : xhr.response,\n            });\n        };\n\n        xhr.ontimeout = xhr.onerror = err => {\n            if (err) xhrErrorLog(err, url, data);\n            // err 不能直接传入 postMessage，会导致 postMessage 直接报错，误认为 worker 内部直接逻辑报错，以后发送埋点直接无法压缩\n            callback && callback(err ? 'networkTimeout' : '');\n            resolve({\n                error: 'networkTimeout',\n            });\n        };\n        xhr.send(data);\n        return xhr;\n    });\n}\n\nexport const get = (url: string) => {\n    const errorHandler = (err: any) => error('[error 401]', `GET 请求出错 url: ${url}`, err);\n    try {\n        const xhr = new XMLHttpRequest();\n        xhr.open('GET', url);\n        xhr.setRequestHeader('Content-Type', 'text/plain;charset=UTF-8');\n        xhr.send();\n        xhr.onerror = errorHandler;\n    } catch (err) {\n        errorHandler(err);\n    }\n};\n","import type { DataOptions } from './types';\nimport { error } from '@/util/console';\n\nconst navigator = window?.navigator;\nconst navigatorEnable = navigator && navigator.userAgent.indexOf('Chrome') !== -1;\nconst functionEnable = typeof navigator.sendBeacon === 'function';\n\n/**\n *\n * @param url 发送地址\n * @param data 发送内容\n * @param forceSendBeacon 是否强制使用 sendBeacon 方式发送埋点。\n */\nexport default function send({ url, data, forceSendBeacon }: DataOptions) {\n    if (!navigatorEnable && !forceSendBeacon || !functionEnable) return false;\n    // xhook 如果改写了 FormData\n    if (typeof data === 'object' && data.fd) {\n        data = data.fd;\n    }\n    try {\n        return navigator.sendBeacon(url, data);\n    } catch (err) {\n        error('[error 403]', 'navigator.sendBeacon 报错', err);\n        return false;\n    }\n}\n","import type { DataOptions } from './types';\nimport sendXHR from './xhr';\nimport sendBeacon from './beacon';\n\nexport default async function sendData(\n    { url, data, timeout, isDebug, isDrained, forceSendBeacon }: DataOptions & { isDebug?: boolean },\n    callback?: (error?: any) => void\n) {\n    data = JSON.stringify(data);\n    // 优先走 sendBeacon，如果成功把数据添加到 beacon 通道，则认为发送成功\n    if (isDrained && sendBeacon({ url, data, forceSendBeacon })) {\n        callback && callback();\n        return;\n    }\n    const result = await sendXHR({ url, data, timeout }, callback);\n    return result.error ? undefined : result.response;\n}\n","import { dataTrackHost } from '@/config/apis';\nimport { log } from '@/util/console';\nexport const getReportUrl = (viewHost: string = dataTrackHost, reportHost: string, sessionId: string) => {\n    const loggerUrl = `${viewHost}/#/logger/index?sessionId=${sessionId}`;\n    log(`%c埋点抓包校验: %c${loggerUrl}`, 'color:#1abf89;font-size:1.2em;line-height:2.4em;', 'font-size:1.2em;');\n    return `${reportHost}/${sessionId}/`;\n};","/**\n * 异步模块加载\n */\n\nexport enum ModuleStates {\n    loading = 'loading',\n    loaded = 'loaded'\n};\n\ninterface ModuleState {\n    state?: ModuleStates;\n    resolve?: (value?: any) => void;\n    reject?: (reason?: any) => void;\n}\n\nexport const LoadedModules: {[key: string]: ModuleState} = Object.create(null);\n/**\n * 加载 js 脚本\n * @param script\n * @param async\n */\nexport const loadScript = (script: string, async: boolean = true, callback?: (error?: any) => void) => {\n    if (LoadedModules[script]) {\n        return callback && callback(`${script} load repeat`);\n    }\n    const mod: ModuleState = LoadedModules[script] = {\n        state: ModuleStates.loading,\n    };\n    const scriptEl = document.createElement('script');\n    scriptEl.crossOrigin = 'anonymous';\n    scriptEl.src = script;\n    if (async) {\n        scriptEl.async = true;\n    }\n    const referEl = document.getElementsByTagName('script')[0];\n    if (referEl && referEl.parentNode) {\n        referEl.parentNode.insertBefore(scriptEl, referEl);\n    } else {\n        document.head.appendChild(scriptEl);\n    }\n\n    scriptEl.onload = () => {\n        mod.state = ModuleStates.loaded;\n        callback && callback();\n    };\n    scriptEl.onerror = (e) => {\n        mod.state = ModuleStates.loaded;\n        callback && callback(`${script} loaded failed, ${e}`);\n    };\n};\n","/**\n * v2、v3 PB 相同部分\n */\nexport namespace Base {\n    // 设备和用户Id\n    export interface IdentityPackage {\n        device_id?: string;  // 设备Id, 唯一标识一台设备\n        user_id?: string | number;  // 用户Id, 唯一标识一个用户\n        iu_id?: string;  // 数盟sdk获取到的设备Id, 唯一标识一台设备(仅用于安卓)\n        global_id?: string;  // 内部SDK生成的全局唯一id，识别多个app之间的相同设备\n        union_id?: string;  // 各端设备识的备用参数，例如微信小程序端上报微信内部用户的唯一标识\n        open_id?: string;  // 微信小程序open_id，需加解密\n    }\n\n    // 设备基础信息\n    export interface DevicePackage {\n        os_version?: string; // 操作系统版本\n        model?: string; // 机型\n        ua?: string; // user agent\n    }\n    export interface NetworkPackage {\n        type?: number; // 网络类型\n        isp?: string; // 运营商\n        ip?: string; // 外网IP地址\n        ipv6?: string; // ipv6地址\n    }\n\n    // 地理位置信息\n    export interface LocationPackage {\n        country?: string; // 国家\n        province?: string; // 省份/自治区/州\n        city?: string; // 城市\n        county?: string; // 县/区域\n        street?: string; // 街道\n        latitude?: number; // 纬度\n        longitude?: number; // 经度\n    }\n\n    // A/B测试实验\n    export interface Experiment {\n        name: string;  // 实验名称\n        value: string; // 实验分组\n    }\n    // 客户端日志额外的sequenceId，用来验证不同发送通道、不同类型的日志的丢失率等。\n    export interface AdditionalSeqIdPackage {\n        channel: number; // 数据发送通道类型\n        channel_seq_id: number; // 日志对应的发送通道的自增ID\n        custom_type: string; // 自定义类型\n        custom_seq_id: number; // 自定义类型的自增ID\n    }\n\n    // 应用基础信息\n    export interface AppPackage {\n        product?: number; // 产品名称, 不同产品独立进行统计分析(为了灵活接入新app，废弃该参数，新接入app请上报到参数8)\n        platform?: number; // 平台\n        language?: string; // 语言, 例: zh-cn\n        channel?: string; // 用户来源渠道\n        version_name?: string; // 版本名\n        version_code?: number; // 版本号\n        package_name?: string; // 应用包名\n        product_name?: string; // 产品名称(为了避免不同app参数值冲突，新接入app请到埋点平台注册，具体咨询宋萌)\n        hotfix_patch_version?: string; // 热更新的patch版本号, 用于相同版本号但是不同Patch的分析\n        container?: string; // 和platform组合使用。platfrom标识平台，container标识应用运行载体. 取值如下，NATIVE、H5、小程序（MP_WECHAT、MP_ALIPAY、MP_BAIDU）\n    }\n\n    // 所有 Event 都包含的数据\n    export interface CommonPackage {\n        identity_package: IdentityPackage; // 用户和设置Id\n        app_package: AppPackage; // 应用信息\n        device_package: DevicePackage; // 设备基本信息\n        network_package: NetworkPackage; // 网络信息\n        location_package?: LocationPackage; // 地理位置信息\n        experiment?: Experiment[]; // A/B测试实验\n        sdk_version?: string; // logsdk版本号\n        service_name?: string; // 中台服务名称，比如积木、im sdk等，如果业务log未使用中台服务，该字段置空\n        safety_id?: string; // 防盗链id\n        sub_biz?: string; // 多业务场景，同一中台可能存在多业务场景，比如评论sdk有 说说、作品评论等不同场景\n        style_type?: string; // 客户端UI模式，比如滑滑版/极速版/普通版\n        additional_seq_id_package?: AdditionalSeqIdPackage; // 客户端日志额外的sequenceId，用来验证不同发送通道、不同类型的日志的丢失率等。\n        need_encrypt?: boolean; // 标记此条数据是否需要做加密处理\n        global_attr?: {[key: string]: any}; // App内全局参数，json格式. 比如流量运营导流参数. 避免key冲突，key统一由埋点平台维护,最终上报 string\n        h5_extra_attr: {[key: string]: any}; // H5埋点专用扩展参数,json格式.\n    }\n\n    // 页面信息\n    export interface UrlPackage {\n        page: string; // 一级页面。参考埋点需求填写即可\n        params: string; // 参数列表参考埋点需求填写，并转成 json 字符串格式\n        identity: string; // 页面唯一标识，使用UUID即可\n        page_type?: number; // 应用页面类型\n        coPage?: boolean;\n        category?: string;\n    }\n\n    export enum ElementStatus {\n        UNKNOWN_STATUS = 0, // 未知\n        CHECKED = 1, // 选中\n        UNCHECKED = 2, // 未选中\n    }\n\n    // 页面元素详细信息\n    export interface ElementPackage {\n        action?: string;\n        action2?: string;\n        index?: number; // 废弃 元素位置, 从0开始 (备注：element补充参数统一定义到params中)\n        value?: number; // 废弃 元素的值, 用于求和, 求平均等 (备注：element补充参数统一定义到params中)\n        status?: ElementStatus; // 废弃 元素状态 (备注：element补充参数统一定义到params中)\n        params: string; // 参数列表参考埋点需求填写，并转成 json 字符串格式\n    }\n\n    // 页面曝光动作\n    export enum PageShowAction {\n        UNKNOWN_ACTION = 0, // 未知\n        ENTER = 1, // 进入页面\n        LEAVE = 2, // 离开页面\n        RESUME = 3, // 恢复页面, 也可以认为是热加载, 这种情况下不需要重新渲染\n    }\n\n    export enum ActionStatus {\n        UNKNOWN_STATUS = 0, // 未知\n        SUCCESS = 1, // 成功\n        FAIL = 2, // 失败\n    }\n\n    export enum ActionType {\n        UNKNOWN_ACTION_TYPE = 0, // 未知\n        CLICK = 1, // 点击进入或离开页面\n        LEFT_PULL = 2, // 左滑进入或离开页面\n        RIGHT_PULL = 3, // 右滑进入或离开页面\n        UP_PULL = 4, // 上滑进入或者离开页面\n        DOWN_PULL = 5, // 下滑进入或者离开页面\n    }\n\n    export enum SubAction {\n        UNKNOWN_SUB_ACTION = 0, // 未知\n        PAGE_ENTER = 1, // 进入页面\n        PAGE_LEAVE = 2, // 离开页面 退出页面\n        PAGE_RESUME = 3, // 恢复页面, 也可以认为是热加载, 这种情况下不需要重新渲染\n        PAGE_PAUSE = 4, // 页面暂停，用户进入下一级页面，当前页面被覆盖的情况\n    }\n\n    // 操作方向\n    export enum Direction {\n        UNKNOWN2 = 0,\n        UP = 1,\n        DOWN = 2,\n        LEFT = 3,\n        RIGHT = 4,\n    }\n\n    /**\n     * 染色参数\n     *  page_name: 页面标识，\n     *  element_action: 元素标识，\n     *  stid：策略id（格式由小分队提供），\n     *  pos：位置信息1，\n     *  params:{元素参数1}\n     */\n    export interface EntryTagType  {\n        page_name: string,\n        element_action: string,\n        stid?: string,\n        pos?: number,\n        params?: {[prop: string]: any}\n    }\n\n    export interface Event {\n        url_package?: UrlPackage; // 事件发生页面\n        refer_url_package?: UrlPackage; // 事件发生页面的来源页面\n        element_package?: ElementPackage; // 触发事件发生的行为\n        refer_element_package?: ElementPackage; // 触发事件发生的来源元素信息\n    }\n\n    // 曝光事件\n    export interface ShowEvent extends Event {\n        action?: PageShowAction; // 进入或离开\n        type?: number; // 页面类型\n        status?: ActionStatus; // 展现状态, 成功或者失败\n        action_type?: number; // 记录进入或离开页面的方式\n        show_type?: number; // 记录进入或离开页面的方式\n        time_cost?: number; // 页面加载, 刷新或离开时长, 单位: ms\n        stay_length?: number; // 页面停留时长, 单位: ms\n        url_package: UrlPackage; // 页面, 精确到页面级别, 控件级别的展现, 需填充 element_package\n        sub_page?: boolean; // 是否包含子页面，true为包含，false为不包含，所有页面enter事件均上报，统计加载时长数据时使用。\n        first_load?: boolean; // 记录是否是首个加载，true代表是，false代表不是，仅子页面加载事件中上报（非子页面不上报），统计加载时长数据时使用。\n        sub_action?: SubAction; // 页面进入或离开的类型细分\n    }\n\n    export enum TaskStatus {\n        UNKNOWN_STATUS = 0,\n        START = 1, // 开始\n        RETRY = 2, // 重试\n        PAUSE = 3, // 暂停\n        RESUME = 4, // 恢复\n        PENDING = 5, // 等待\n        PROCESSING = 6, // 进行中\n        SUCCESS = 7, // 成功\n        FAIL = 8, // 失败\n        CANCEL = 9, // 取消\n        FINISH = 10, // 完成，比如直播结束的，长链接关闭\n    }\n\n    export enum OperationType {\n        UNKNOWN_OPERATION = 0,\n        CLICK = 1, // 点击\n        DOUBLE_CLICK = 2, // 双击\n        TRIPLE_CLICK = 3, // 三击\n        LONG_PRESS = 4, // 长按\n        PULL = 5, // 滑动\n        DRAG = 6, // 拖拽\n        SCALE = 7, // 双指缩放\n        PULL_DOWN = 8, // 下拉刷新\n        PULL_UP = 9, // 上拉加载更多\n        RIGHT_CLICK = 10, // 鼠标右键点击\n        AUTO = 11, // 自动\n    }\n\n    // 任务事件\n    export interface TaskEvent extends Event {\n        status: TaskStatus // 任务状态\n        session_id?: string; // 任务的 session Id, 确保是全局唯一, 通常使用UUID即可, 连续 Action 相同的 task 保持一样的 session id\n        operation_type?: OperationType; // 用户操作类型\n        operation_direction?: Direction;\n        url_package: UrlPackage; // Task发生页面\n        element_package: ElementPackage; // 触发Task发生的行为\n    }\n\n    // 自定义弱类型事件\n    export interface CustomEvent {\n        key: string; // 自定义事件的key\n        value: string; // 自定义事件的value\n    }\n}\n","import type { Base } from '../base';\n\nexport namespace ClientEvent {\n    // 页面元素详细信息\n    export interface ElementPackage extends Base.ElementPackage {\n        action?: string; // 元素业务类型。参考埋点需求填写即可\n    }\n\n    // 页面信息\n    export interface UrlPackage extends Base.UrlPackage {\n        page: string; // 一级页面。参考埋点需求填写即可\n    }\n\n    // 曝光类型\n    export enum ShowType {\n        UNKNOWN_TYPE = 0, // 未知\n        PAGE_AUTO = 10, // sdk自动采集页面\n        PAGE_CUSTOM = 11, // 自定义页面\n        ELEMENT = 12, // 自定义元素\n    }\n\n    // 曝光事件\n    export interface ShowEvent extends Base.ShowEvent {\n        type?: ShowType;\n        element_package?: ElementPackage;\n        content_package?: string; // 相关内容。具体项目把具体业务要上报的参数转成 json 字符串格式\n    }\n\n    export enum TaskEventType {\n        UNKNOWN_TYPE = 0,\n        USER_OPERATION = 1, // 用户操作\n        STAY_LENGTH_STAT_EVENT = 2, // 非页面级别的停留时长统计事件，比如不同tab的停留时长\n        BACKGROUND_TASK_EVENT = 3, // 记录客户端发起的后台请求任务\n    }\n    // 任务事件\n    export interface TaskEvent extends Base.TaskEvent {\n        type: TaskEventType;\n        content_package?: string; // 相关内容。具体项目把具体业务要上报的参数转成 json 字符串格式\n    }\n\n    export interface CustomEvent {\n        custom_stat_event: Base.CustomEvent;\n    }\n\n    export interface EventPackage {\n        show_event?: ShowEvent;\n        task_event?: TaskEvent;\n        stat_package?: CustomEvent;\n    }\n}\n","import type { Base } from '../base';\n\nexport namespace ClientEvent {\n    // 页面信息\n    export interface UrlPackage extends Base.UrlPackage {\n        page2: string; // 一级页面。参考埋点需求填写即可\n    }\n\n    // 页面元素详细信息\n    export interface ElementPackage extends Base.ElementPackage {\n        action2: string; // 业务类型字符串版本\n    }\n\n    export interface LaunchEvent {\n        cold: boolean;\n        detail: string;\n        mode: number;\n        source: number;\n        target: string;\n    };\n    export interface AppUsageStatEvent {\n        last_url_package: Base.UrlPackage;\n        app_use_duration: number;\n    };\n    export interface DeviceStatEvent {\n        battery: number;\n        density_dpi: number;\n        model: string;\n        os_version: string;\n        screen_height: number;\n        screen_width: number;\n    };\n    export interface ExceptionEvent {\n        type: number;\n        message: string;\n        url_package: Base.UrlPackage;\n    };\n    export interface CustomStatEvent {\n        key: string;\n        value: string;\n    };\n    export interface StatPackage {\n        launch_event?: LaunchEvent;\n        app_usage_stat_event?: AppUsageStatEvent;\n        device_stat_event?: DeviceStatEvent;\n        custom_stat_event?: CustomStatEvent;\n    };\n\n    export enum ShowType {\n        UNKNOWN2 = 0, // 未知\n        PAGE = 1, // 页面\n    }\n\n    // 页面区域信息   页面+区域+元素\n    export interface AreaPackage {\n        name: string; // 区域名称\n        params: string; // 区域补充参数\n    }\n\n    // 曝光事件\n    export interface ShowEvent extends Base.ShowEvent {\n        type?: ShowType;\n        show_type?: number; // 记录进入或离开页面的方式\n        page_show_seq?: number; // 页面展示的Sequence id，每次展示一次页面就加1(页面展示事件才有意义)\n        content_wrapper?: string; // 上报业务相关信息，客户端将content_wrapper转成json上报\n        extra_message?: string; // 用于存放一些点击时候的额外信息，可以是 json, string 分割等，此字段仅限于客户端内部分析使用！\n        area_package?: AreaPackage; // 页面区域信息\n    }\n\n    // 任务事件\n    export interface TaskEvent extends Base.TaskEvent {\n        action2: string;\n        content_package?: any; // 相关内容，TODO: 比较复杂，暂时没写\n        content_wrapper?: string; // 上报业务相关信息，客户端将content_wrapper转成json上报\n    }\n\n    export interface ClickEvent extends Base.Event {\n        type: number; // 点击类型\n        direction: Base.Direction; // Action={PULL, DRAG}时有意义\n        url_package: Base.UrlPackage; // 页面\n        element_package: Base.ElementPackage; // 所操作的元素信息\n        content_package?: any; // 相关内容，TODO: 比较复杂，暂时没写\n        extra_message?: any; // 用于存放一些点击时候的额外信息，可以是 json, string 分割等，此字段仅限于客户端内部分析使用！\n        content_wrapper?: string; // 上报业务相关信息，客户端将content_wrapper转成json上报\n        area_package?: AreaPackage; // 页面区域信息\n    }\n\n    export interface CustomEvent extends Base.CustomEvent {\n\n    }\n\n    export interface EventPackage {\n        show_event?: ShowEvent;\n        click_event?: ClickEvent;\n        task_event?: TaskEvent;\n        custom_event?: CustomEvent;\n    }\n\n    export interface VideoStatEvent extends Base.Event {\n        video_stat_event: {\n            // 视频总时长\n            duration?: number;\n            // 播放时长\n            played_duration?: number;\n            // 是否已经下载\n            downloaded?: boolean;\n            //  从进入页面到开始播放准备的时长 单位ms\n            prepare_duration?: number;\n            // 进入视频播放详情页页面的时间戳 ms\n            enter_time?: number;\n            // 离开视频播放页面的时间戳\n            leave_time?: number;\n            // 视频的类型\n            video_type?: string;\n            // 播放的时候的类型, 由于有些机型不支持 H265，或者做 A/B test 的时候视频类型和播放类型不一致.\n            play_video_type?: string;\n            // 作品ID 废弃\n            photo_id?: number;\n            // 用户离开播放页面的方式\n            leave_action?: string;\n            // 视频播放的平均fps\n            average_fps?: number;\n            // 媒体类型：短视频、图片、图集等\n            media_type?: string;\n            // 作品ID\n            s_photo_id?: number;\n            // 记录当前页面及extra参数信息\n            url_package?: Base.UrlPackage;\n            // 记录来源页面相关参数，包括来源页面、exptag、llsid等\n            refer_url_package?: Base.UrlPackage;\n            // 播放器基本状态信息，用json串上报\n            video_qos_json?: string;\n            // 从点击feed到渲染第一帧总时长\n            click_to_first_frame_duration?: number;\n            // 信号强度，单位为dbm，wifi/4g/3g/2g下均需上报\n            rssi?: number;\n            // 用户进入播放器页面的方式\n            enter_player_action?: string;\n            // 用于记录该Event的其他附属字段，可以是普通字符串或json字段\n            summary?: string;\n            // 芯片名字\n            board_platform?: string;\n            // 用户观看视频前是否收藏\n            collect_before_status?: string;\n            // 用户观看视频后是否收藏\n            collect_after_status?: string;\n            session_uuid?: string;\n            // android soc的名字，比如Kirin 960\n            soc_name?: string;\n        };\n    }\n}\n","import type { ReportEvent } from '@/core/logger';\nimport type { CommonPackage } from './common';\nimport type { v3Env, SendCallback } from '@/config/types';\n\nimport { BatchLog as BaseLogger} from '@/core/logger';\nimport { getCookie } from '@/util/cookie';\nimport { generateDID } from '@/util/uuid';\nimport { parseQueryString, enableAsyncGzip } from '@/util';\nimport sendData from '@/io';\nimport { get } from '@/io/xhr';\nimport { dataTrackHost, overseaDataTrackHost, buildUrl, LOGGER_SGP, LOGGER, PROD } from '@/config/apis';\nimport { getReportUrl } from '@/util/test';\nimport { loadScript } from '@/util/loader';\nimport type { ResponseType } from '@/io/types';\n\ninterface WebloggerSwitch {\n    // 将log切换发送到该地址\n    reportHost: string;\n    // log测试前端页面地址\n    loggerHost: string;\n    // 本次logger测试的sessionId\n    loggerSessionId: string;\n    handshakeApi?: string;\n}\nconst SWICTH = 'weblogger_switch';\n/**\n * 端内环境根据cookie值切换发送地址\n */\nconst getCookieReportUrl = () => {\n    try {\n        const webloggerSwitch = getCookie(SWICTH) ||\n            typeof sessionStorage !== 'undefined' && sessionStorage.getItem(SWICTH);\n        if (!webloggerSwitch) return;\n        const { loggerSessionId, reportHost, loggerHost, handshakeApi }: WebloggerSwitch = JSON.parse(webloggerSwitch);\n        // 若cookie内存在loggerSessionId，则会自动切换发送路径到测试地址，否则返回空，代表不切换地址\n        if (!loggerSessionId) {\n            return '';\n        }\n        get(handshakeApi || `${reportHost}/${loggerSessionId}`);\n        return getReportUrl(loggerHost, reportHost, loggerSessionId);\n    } catch (err) {\n        return '';\n    }\n};\n\n/**\n * env 为 logger 时上报的 url\n */\nconst getLoggerReportUrl = (did: string = generateDID(), isOversea = false) => {\n    const url = isOversea ? overseaDataTrackHost : dataTrackHost;\n    get(`${url}/rest/${did}`);\n    return getReportUrl(url, `${url}/rest`, did);\n};\n\n/**\n * 端外H5 or pc页面根据当前的url参数切换发送地址\n */\nconst getWebPageReportUrl = (url: string = location.href) => {\n    // const { storage, io } = Global.adapter;\n    const queryIndex = url.lastIndexOf('?');\n    if (queryIndex === -1) {\n        return '';\n    }\n    const queryString = url.slice(queryIndex + 1);\n    const { webloggerSwitch } = parseQueryString(queryString);\n    if (!webloggerSwitch) {\n        return '';\n    }\n    try {\n        const data = decodeURIComponent(webloggerSwitch);\n        const { loggerSessionId, reportHost, loggerHost, handshakeApi } = JSON.parse(data);\n        if (!loggerSessionId) {\n            return '';\n        }\n        // 存到 sessionStorage 中使同域名页面都可以调试\n        // storage.setSession(SWICTH, data);\n        // io.get({url: handshakeApi || `${reportHost}/${loggerSessionId}`});\n        if (typeof sessionStorage !== 'undefined') {\n            sessionStorage.setItem(SWICTH, data);\n        }\n        get(handshakeApi || `${reportHost}/${loggerSessionId}`);\n        return getReportUrl(loggerHost, reportHost, loggerSessionId);\n    } catch (err) {\n        return '';\n    }\n};\n\nconst getTemporaryLoggerUrl = (proto?: 'v2' | 'v3') => {\n    const url = getCookieReportUrl() || getWebPageReportUrl();\n    if (url) {\n        return buildUrl(url, false, proto);\n    }\n};\n\nexport const RESPONSE_SAMPLING_STORAGE_KEY = 'RESPONSE_SAMPLING_STORAGE_KEY';\n\nexport default class Logger extends BaseLogger {\n    static Gzipper?: any;\n    declare commonPackage: CommonPackage;\n    enableAsyncGzip: boolean | undefined;\n    override baseSendData = this.sendLog;\n    // 服务端控制的采样发送，可以发送合法时间，当前时间戳大于这个时间戳，才可以发送\n    sendEffectiveTime: undefined | number;\n    // 采样存储 key，作为实例化的一个键值，避免多实例互相干扰\n    constructor(config: any, commonPackage: CommonPackage) {\n        super(config, commonPackage);\n        this.getResponseSamplingStorage();\n    }\n    // 获取 storage 判断是否有过期时间\n    async getResponseSamplingStorage() {\n        try {\n            // 直接异步获取 localstorage 信息。保证初始化 weblogger 性能。\n            // 因为 sendImmediately 也是微任务发送，所以获取本地存储信息，是可以保证在发送 pv 之前,获取到采样信息\n            await Promise.resolve();\n            const storageEffectiveTime = Number(localStorage.getItem(this.responseSamplingStorageKey));\n            if (storageEffectiveTime && (Date.now() < storageEffectiveTime)) {\n                this.sendEffectiveTime = storageEffectiveTime;\n            } else if (storageEffectiveTime) {\n                // 如果采样已经过期，清除 storage\n                localStorage.removeItem(this.responseSamplingStorageKey);\n            }\n        } catch (e) {\n            console.error(e);\n        }\n    }\n    /**\n     * 返回 true 代表不发送埋点\n     * @param log\n     * @param immediate\n     * @param callback\n     */\n    isResponseSampling(): boolean {\n        return !!(this.sendEffectiveTime && (Date.now() < this.sendEffectiveTime));\n    }\n    // 埋点返回结果处理\n    setResponseSamplingConfig(responsePromise?: Promise<string | undefined>) {\n        if (this.isSetSamplingResult) { return; }\n        this.isSetSamplingResult = true;\n        responsePromise?.then(res => {\n            let response: ResponseType;\n            try {\n                response = res && JSON.parse(res);\n            } catch (e) {\n                response = {\n                    result: 1,\n                    hostName: '',\n                };\n            }\n            const expireSeconds = response?.expireSeconds;\n            if (expireSeconds) {\n                const effectiveTime = Date.now() + expireSeconds * 1000;\n                this.sendEffectiveTime = effectiveTime;\n                localStorage.setItem(this.responseSamplingStorageKey, String(effectiveTime));\n            }\n        });\n    }\n    /**\n     * 根据配置生成上报的 url 地址\n     */\n     override updateUrls() {\n        const { env = PROD, logger, proto, isBridge, disableCompress } = this.config;\n        const url = getTemporaryLoggerUrl(proto);\n        if (url) {\n            this.url = url;\n            this.isDebug = true;\n        } else if (logger || env === LOGGER || env === LOGGER_SGP) {\n            const loggerEnv = getLoggerReportUrl(this.commonPackage.identity_package.device_id, env === LOGGER_SGP);\n            this.url = buildUrl(loggerEnv, false, proto);\n            this.isDebug = true;\n        } else if (env && /^(https?:)?\\/\\//.test(env)) {\n            this.url = env;\n        } else {\n            this.isDebug = env !== PROD;\n            this.url = buildUrl(env as v3Env, false, proto);\n            this.radarUrl = buildUrl(env as v3Env, true, proto);\n        }\n        this.enableAsyncGzip = !disableCompress // 用户没有配置禁止压缩\n            && proto === 'v3' // 必须是 v3 上报, v2 虽然压缩上报接口虽然没报错，但是服务端不做解析。\n            && !isBridge // 非桥接上报\n            && enableAsyncGzip() // 平台兼容性\n            && env === PROD // 必须在 prod 环境\n            && !url // 非埋点抓包查找\n            && !logger; // 非埋点抓包查找\n        this.enableAsyncGzip && loadScript('__GZIPER_URL__');\n        this.formatUrl();\n    }\n    sendLog(data: {url: string, data: any, [key: string]: any}, callback?: (error?: any) => void): void {\n         const { forceSendBeacon } = this.config;\n        if (!this.isV2) {\n            //  根据埋点接口判断是否需要采样\n            if (this.isResponseSampling()) {\n                return;\n            }\n        }\n        if (this.drained || !this.enableAsyncGzip || !this.sendGzip(data, callback)) {\n            this.setResponseSamplingConfig(\n                sendData({ ...data, forceSendBeacon }, callback),\n            );\n        }\n    }\n    /**\n     *\n     * @param data\n     * @param callback weblogger 系统级错误回调，会清除缓存的发送错误的日志。\n     */\n    sendGzip(data: {url: string, data: any, [key: string]: any}, callback?: (error?: any) => void) {\n        if (!Logger.Gzipper?.sendData) return false;\n        const workerCallback = (e: any) => {\n            if (e) {\n                this.setResponseSamplingConfig(\n                    sendData(data, callback),\n                );\n            }\n        };\n        // 如果发送压缩代码成功，会返回一个 promise\n        const promise = Logger.Gzipper.sendData(data, workerCallback);\n        this.setResponseSamplingConfig(promise);\n        return !!promise;\n    }\n    /**\n     * 埋点发送前获取 common_package 信息\n     * @param data\n     * @returns\n     */\n    override getCommonPackageJSON() {\n        return this.commonPackage.toJSON();\n    }\n\n    override send(data: ReportEvent, immediate = false, callback?: SendCallback) {\n        // v2 是每个 log 都有 common_package\n        if (this.isV2) {\n            // v2 log 的自增 id 是存在 common 信息中\n            this.commonPackage.setAdditionalSeqIdPackage((data as any).getEventType());\n            data.common_package = this.getCommonPackageJSON();\n        }\n        super.send(data, immediate, callback);\n    }\n}\n","import type { ShowEventOptions } from '../config/types';\n\nimport { Base } from '../proto/base';\nimport { ClientEvent as ClientEventV3 } from '../proto/v3/client_event';\nimport { ClientEvent as ClientEventV2} from '../proto/v2/client_event';\nimport { getPositiveInteger } from '@/util';\n\n// TODO: 这两个变量有副作用，待优化\nlet firstLoad: boolean | undefined = true;\nlet enterTime: number = new Date().valueOf();\nexport default (options: ShowEventOptions, isV2: boolean = false): ClientEventV3.EventPackage | ClientEventV2.EventPackage => {\n    const {\n        type,\n        currentUrlPackage,\n        referUrlPackage,\n        name = '',\n        action,\n        beginTime,\n        params,\n        contentPackage,\n        status,\n        actionType, // 这值目前似乎没传进来\n        auto\n    } = options;\n    const commonInfo = {\n        status: status ? (Base.ActionStatus[status] || Base.ActionStatus.UNKNOWN_STATUS) : Base.ActionStatus.SUCCESS,\n        [isV2 ? 'show_type' : 'action_type']: actionType ? (Base.ActionType[actionType] || Base.ActionType.UNKNOWN_ACTION_TYPE) : Base.ActionType.CLICK,\n        url_package: currentUrlPackage,\n        refer_url_package: referUrlPackage,\n        [isV2 ? 'content_wrapper' : 'content_package']: contentPackage,\n    };\n    if (type === 'PV') {\n        let sub_action = Base.SubAction.PAGE_ENTER;\n        let actionPB = Base.PageShowAction.ENTER;\n        let first_load = firstLoad;\n        let stay_length = 0;\n        firstLoad = false;\n        switch (action) {\n            case 'leave':\n                actionPB = Base.PageShowAction.LEAVE;\n                sub_action = Base.SubAction.PAGE_LEAVE;\n                stay_length = getPositiveInteger(new Date().valueOf() - (beginTime || enterTime));\n                break;\n            case 'enter':\n                actionPB = Base.PageShowAction.ENTER;\n                sub_action = Base.SubAction.PAGE_ENTER;\n                enterTime = new Date().valueOf();\n                break;\n            case 'visible':\n                actionPB = Base.PageShowAction.RESUME;\n                sub_action = Base.SubAction.PAGE_RESUME;\n                enterTime = new Date().valueOf();\n                break;\n            case 'hidden':\n                actionPB = Base.PageShowAction.LEAVE;\n                sub_action = Base.SubAction.PAGE_PAUSE;\n                stay_length = getPositiveInteger(new Date().valueOf() - (beginTime || enterTime));\n                break;\n        }\n        let showType: ClientEventV3.ShowType | ClientEventV2.ShowType = auto ? ClientEventV3.ShowType.PAGE_AUTO : ClientEventV3.ShowType.PAGE_CUSTOM;\n        if (isV2) {\n            first_load = undefined;\n            showType = ClientEventV2.ShowType.PAGE;\n        }\n        return {\n            show_event: {\n                action: actionPB,\n                sub_action,\n                type: showType,\n                first_load,\n                time_cost: 0,\n                stay_length,\n                ...commonInfo\n            }\n        } as ClientEventV3.EventPackage | ClientEventV2.EventPackage\n    }\n    return {\n        show_event: {\n            action: isV2 ? 0 : Base.PageShowAction.ENTER,\n            type: isV2 ? 0 : ClientEventV3.ShowType.ELEMENT,\n            sub_action: isV2 ? 0 : Base.SubAction.PAGE_ENTER,\n            element_package: {\n                [isV2 ? 'action2': 'action']: name,\n                params: JSON.stringify(params),\n            },\n            ...commonInfo\n        }\n    }\n}\n","import type { ClientEvent as ClientEventV3 } from '../proto/v3/client_event';\nimport type { ClientEvent as ClientEventV2 } from '../proto/v2/client_event';\nimport type {\n    OtherEventOptions,\n    ShowEventProps,\n    TaskOperations,\n    TaskEventOptions,\n} from '@/config/types';\nimport type { DeepPartial } from 'utility-types';\n\nimport ShowEvent from './show-event';\nimport TaskEvent from './task-event';\nimport CustomStatEvent from './custom-stat-event';\nimport VideoStatEvent from './video-stat-event';\nimport { leftPad, getPositiveInteger } from '@/util';\nimport { getCustomIncrementId, getNomalIncrementId } from '@/util/increment-id';\nimport Global from '../config/global';\n\nconst GMT = (() => {\n    const timeZoneGMTOffset = (new Date()).getTimezoneOffset() / 60;\n    return timeZoneGMTOffset <= 0\n        ? `GMT+${leftPad(-timeZoneGMTOffset + '', 2, '0')}:00`\n        : `GMT-${leftPad(timeZoneGMTOffset + '', 2, '0')}:00`;\n})();\n\n// 为防止每个传出都带common_package，所以用base保留大多数信息\n// 部分信息放到每个消息体内维护，比如client_timestamp\nexport class ReportEvent {\n    // uint64 客户端时间, Event或Stat发生时的时间, 而不是上传时的时间\n    client_timestamp = getPositiveInteger(new Date().valueOf());\n\n    // uint64 客户端自增Id, 每新增一条日志+1, 必须是连续的, 用于校检数据完整性\n    client_increment_id = 0;\n\n    // string 会话id，设备冷启动或者切到后台超过5分钟再切回前台时，重新生成一个id\n    // 端内页面不可缺省\n    // Tip: 小程序的global字段不一致\n    session_id = Global.sessionId;\n    time_zone?: string;\n    event_package?: ClientEventV3.EventPackage | ClientEventV2.EventPackage;\n    stat_package?: ClientEventV3.CustomEvent | ClientEventV2.VideoStatEvent;\n    // 埋点唯一主键， PB 中已不推荐使用\n    event_id = '';\n    constructor(options: DeepPartial<ReportEvent>, isV2: boolean = false) {\n        // v2 没有 time_zone 字段\n        if (!isV2) {\n            this.time_zone = GMT;\n        }\n        Object.assign(this, options);\n        this.genIncrementId();\n    }\n    // 设置自增 id，自定义事件和常规事件使用不同的 localStorage key\n    genIncrementId() {\n        this.client_increment_id = this.isCustomStatEvent() ? getCustomIncrementId() : getNomalIncrementId();\n    }\n    // 是否是自定义事件\n    isCustomStatEvent() {\n        return !!(this.stat_package && 'custom_stat_event' in this.stat_package);\n    }\n    // 获取埋点事件类型\n    getEventType() {\n        if (this.event_package) {\n            const {\n                task_event,\n                show_event,\n                click_event,\n                custom_event,\n            } = this.event_package as ClientEventV2.EventPackage;\n            if (show_event) return 'showEvent';\n            if (click_event) return 'clickEvent';\n            if (task_event) return 'taskEvent';\n            if (custom_event) return 'customEvent';\n        }\n        return 'customEvent';\n    }\n}\n// 微信小程序事件处理\nconst StatEvent = (eventOptions: any) => {\n    const { currentUrlPackage, referUrlPackage, taskType, ...event } = eventOptions;\n    return event;\n}\n\nexport function logFactory(type: string, data: ShowEventProps | OtherEventOptions, isV2: boolean = false) {\n    const { eventId: event_id, currentUrlPackage, referUrlPackage, contentPackage, name, params } = data;\n    if (isV2 && type !== 'RADAR' && type !== 'CUSTOM') {\n        // v2 需要特殊处理，先保留 ts-ignore\n        if (currentUrlPackage) {\n            // @ts-ignore\n            currentUrlPackage.page2 = currentUrlPackage.page;\n            // @ts-ignore\n            delete currentUrlPackage.page;\n        }\n        if (referUrlPackage) {\n            // @ts-ignore\n            referUrlPackage.page2 = referUrlPackage.page;\n            // @ts-ignore\n            delete referUrlPackage.page;\n        }\n    }\n    switch (type) {\n        case 'PV':\n        case 'SHOW':\n            return new ReportEvent({\n                event_package: ShowEvent({\n                    type,\n                    status: (data as ShowEventProps).status,\n                    currentUrlPackage,\n                    referUrlPackage,\n                    action: (data as ShowEventProps).type,\n                    beginTime: (data as ShowEventProps).beginTime,\n                    actionType: (data as ShowEventProps).actionType,\n                    name,\n                    params,\n                    contentPackage,\n                    operationDirection: data.operationDirection,\n                    auto: (data as ShowEventProps).auto,\n                }, isV2),\n                event_id,\n            }, isV2);\n        case 'CUSTOM':\n        case 'CUSTOM_STAT_EVENT':\n            const customData = CustomStatEvent({\n                name,\n                params,\n                currentUrlPackage,\n                referUrlPackage,\n            });\n            return new ReportEvent(isV2 ?\n                {\n                    event_package: {\n                        custom_event: customData,\n                    },\n                    event_id,\n                }\n                :\n                {\n                    stat_package: {\n                        custom_stat_event: customData,\n                    },\n                    event_id,\n                }, isV2);\n        case 'RADAR':\n            return new ReportEvent({\n                stat_package: {\n                    custom_stat_event: CustomStatEvent({\n                        name,\n                        params,\n                        currentUrlPackage,\n                        referUrlPackage,\n                    }),\n                },\n                event_id,\n            }, isV2);\n        // 小程序自定义的事件名称\n        case 'HEART_BEAT_EVENT':\n        case 'LAUNCH_EVENT':\n        case 'APP_USAGE_STAT_EVENT':\n        case 'EXCEPTION_EVENT':\n        case 'DEVICE_STAT_EVENT':\n            return new ReportEvent({\n                stat_package: {\n                    [type.toLowerCase()]: StatEvent(data)\n                },\n            }, isV2);\n        case 'VIDEO':\n            if (isV2) {\n                return new ReportEvent({\n                    stat_package: VideoStatEvent({\n                        currentUrlPackage,\n                        referUrlPackage,\n                        options: params.params,\n                    }),\n                    event_id,\n                }, isV2);\n            }\n            return new ReportEvent({\n                event_package: TaskEvent({\n                    type: type as TaskOperations,\n                    status: (data as TaskEventOptions).status,\n                    taskType: (data as TaskEventOptions).taskType,\n                    sessionId: Global.sessionId,\n                    currentUrlPackage,\n                    referUrlPackage,\n                    name,\n                    params: params.params,\n                    contentPackage,\n                }, isV2),\n                event_id,\n            }, isV2);\n        default:\n            return new ReportEvent({\n                event_package: TaskEvent({\n                    type: type as TaskOperations,\n                    status: (data as TaskEventOptions).status,\n                    taskType: (data as TaskEventOptions).taskType,\n                    sessionId: Global.sessionId,\n                    currentUrlPackage,\n                    referUrlPackage,\n                    name,\n                    params,\n                    contentPackage,\n                }, isV2),\n                event_id,\n            }, isV2);\n    }\n}\n","import { supportsPushState, isInApp } from './index';\nimport { getCookie } from './cookie';\n\nlet uaInfo: {\n    os: {\n        name?: string;\n        version?: string;\n    },\n    model?: string;\n};\n\nlet lastUA = window?.navigator?.userAgent || ''\n\nexport const getUAInfo = (ua = window?.navigator?.userAgent) => {\n    if (uaInfo && ua === lastUA) {\n        return uaInfo;\n    }\n    const UNKNOWN = 'unknow';\n    const androidReg = /android/i;\n    const MacOS = 'Mac OS';\n    const Windows = 'Windows';\n    const Android = 'Android';\n    const iPhone = 'iPhone';\n    const iPad = 'iPhone';\n    const WinPhone = 'Windows Phone';\n    const Linux = 'Linux';\n    uaInfo = {\n        os: {\n            name: UNKNOWN,\n            version: UNKNOWN\n        },\n        model: UNKNOWN\n    };\n    try {\n        const uaMatches = ua.match(/\\((.*?)\\)/);\n        if (!uaMatches) {\n            const isAndroid = androidReg.test(ua);\n            if (isAndroid) {\n                uaInfo.os.name = Android;\n            }\n            return uaInfo;\n        }\n        const uaMain = uaMatches[1] + ')';\n        const uaArr = uaMain.split(';').map(str => str.trim());\n        let osName, osVersion, model;\n        if (ua.indexOf(WinPhone) > -1) {\n            model = osName = WinPhone;\n            const matches = uaMain.match(/Windows\\sPhone\\s(.*?)[;\\)\\s]/);\n            if (matches) {\n                osVersion = matches[1];\n            }\n            model = uaArr[uaArr.length - 1]?.replace(')', '');\n        } else if (androidReg.test(ua)) {\n            // 安卓 ua 信息解析\n            osName = Android;\n            const modelMatches = uaMain.match(/android.*?;(.*?)build\\//i);\n            if (modelMatches) {\n                model = modelMatches[1]?.split(';').pop();\n                model = model && model.trim();\n            }\n            for (let i = 0; i < uaArr.length; i++) {\n                if (androidReg.test(uaArr[i]!)) {\n                    osVersion = uaArr[i]?.replace(androidReg, '');\n                    if (!model) {\n                        model = uaArr[i + 1];\n                    }\n                    break;\n                }\n            }\n        } else if (ua.indexOf(iPhone) > -1 || ua.indexOf(iPad) > -1) {\n            // iOS 系统信息解析\n            model = ua.indexOf(iPhone) > -1 ? iPhone : iPad;\n            osName = 'iOS';\n            const matches = uaMain.match(/OS\\s(.*?)\\slike/);\n            if (matches) {\n                osVersion = matches[1];\n            }\n        } else if (ua.indexOf(MacOS) > -1) {\n            // Mac OS 系统信息解析\n            model = osName = MacOS;\n            const matches = uaMain.match(/OS\\sX\\s(.*?)[;\\)\\s]/);\n            if (matches) {\n                osVersion = matches[1];\n            }\n        } else if (ua.indexOf(Windows) > -1) {\n            model = osName = Windows;\n            const matches = uaMain.match(/Windows\\s(.*?)[;\\)]/);\n            if (matches) {\n                osVersion = matches[1];\n            }\n        } else if (ua.indexOf('Nokia') > -1) {\n            osName = 'Symbian';\n            const vMatches = ua.match(/Symbian.*?\\/(.*?);/);\n            if (vMatches) {\n                osVersion = vMatches[1];\n            }\n            const mMatches = ua.match(/Nokia(.*?)\\//);\n            if (mMatches) {\n                model = mMatches[1];\n            }\n        } else if (uaMain.indexOf(Linux) > -1) {\n            osName = model = Linux;\n        }\n        uaInfo = {\n            os: {\n                name: osName || UNKNOWN,\n                version: osVersion && osVersion.replace(/_/g, '.').trim() || UNKNOWN\n            },\n            model: model || UNKNOWN\n        };\n    } catch (err) {\n        console.error('[109]', 'UA 信息解析错误', (err as Error).message);\n    }\n    return uaInfo;\n};\n\n\n/**\n * http://git.corp.kuaishou.com/ks-frontend/modules/web-util/blob/master/src/device.js\n */\nconst kpnFromUA = () => {\n    if (typeof window === 'undefined') return '';\n    let ua = window.navigator.userAgent;\n    // 注意顺序很重要\n    let rules = [\n        [/ Kwai\\//, 'KUAISHOU'],\n        [/ ksthanos\\//, 'THANOS'],\n        [/ ksNebula\\//i, 'NEBULA'],\n\n        // iOS 审核移除敏感信息\n        // [/ wxwork\\//, 'workWechat'],\n        // [/ MicroMessenger\\//, 'wechat'],\n        // [/ QQ\\//, 'qq'],\n        // [/__weibo__([^_]+)/, 'weibo'],\n        // [/ livemate\\//, 'livemate'],\n        // [/ baiduboxapp\\//, 'baidu'],\n\n        // [/ MQQBrowser\\//, 'qqBrowser'],\n        // [/\\(MSIE ([^;]+);/, 'ie'],\n    ];\n\n    for (let i = 0; i < rules.length; i++) {\n        let tmp = rules[i]!;\n        let rule = tmp[0];\n        let name = tmp[1];\n        let rRes = (rule as RegExp).exec(ua);\n        if (rRes) {\n            return name;\n        }\n    }\n    return '';\n};\n\n/**\n * 获取默认的 KPN,TODO: 副作用函数\n */\nlet defaultKpn: string;\nexport function getDefaultKpn() {\n    if (defaultKpn === undefined) {\n        defaultKpn = isInApp() && getCookie('kpn') || kpnFromUA() || '';\n    }\n    return defaultKpn;\n}\n\n/**\n * 判断是否是 kds 环境\n */\nexport const isKDSNative = (() => {\n    let res: boolean | undefined;\n    return () => {\n        if (typeof res !== undefined) return res;\n        const platform = window?.navigator?.platform?.toLowerCase();\n        res = !!(platform && ['ios', 'android'].indexOf(platform) !== -1);\n        return res;\n    }\n})();\n\nexport default {\n    supportsPushState,\n    getUAInfo,\n    getDefaultKpn\n};","import type { ClientEvent as ClientEventV2 } from '../proto/v2/client_event';\nimport type { TaskEventOptions } from '../config/types';\n\nimport { Base } from '../proto/base';\nimport { ClientEvent as ClientEventV3 } from '../proto/v3/client_event';\n\nexport default (options: TaskEventOptions, isV2: boolean = false): ClientEventV3.EventPackage | ClientEventV2.EventPackage => {\n    const {\n        sessionId,\n        currentUrlPackage,\n        referUrlPackage,\n        name,\n        params,\n        type,\n        contentPackage,\n        status,\n        taskType,\n        operationDirection,\n    } = options;\n    const commonInfo = {\n        url_package: currentUrlPackage,\n        refer_url_package: referUrlPackage,\n        element_package: {\n            [isV2 ? 'action2': 'action']: name,\n            params: JSON.stringify(params),\n        },\n        [isV2 ? 'content_wrapper' : 'content_package']: contentPackage\n    }\n    if (isV2) {\n        // v2 click_event 是一个单独的事件类型，v3 则属于 task_event\n        const isV2Click = taskType === 'USER_OPERATION' || type === 'CLICK' && !taskType;\n        const operationType = type && Base.OperationType[type as keyof typeof Base.OperationType] || Base.OperationType.CLICK;\n        if (isV2Click) {\n            return {\n                click_event: {\n                    type: operationType,\n                    direction: operationDirection && Base.Direction[operationDirection] || Base.Direction.UNKNOWN2,\n                    ...commonInfo,\n                }\n            }\n        }\n        return {\n            task_event: {\n                action2: name,\n                status: status && Base.TaskStatus[status] || Base.TaskStatus.UNKNOWN_STATUS,\n                ...commonInfo,\n            }\n        }\n    }\n    return {\n        task_event: {\n            type: taskType && ClientEventV3.TaskEventType[taskType as keyof typeof ClientEventV3.TaskEventType] || ClientEventV3.TaskEventType.USER_OPERATION,\n            status: status && Base.TaskStatus[status] || Base.TaskStatus.UNKNOWN_STATUS,\n            operation_type: Base.OperationType[type] || Base.OperationType.CLICK,\n            operation_direction: operationDirection && Base.Direction[operationDirection] || Base.Direction.UNKNOWN2,\n            session_id: sessionId,\n            ...commonInfo\n        }\n    }\n}","import type { Base } from '../proto/base';\nimport type { CustomStatEventOptions } from '../config/types';\n\n/**\n * 自定义事件上报\n */\nexport default (options: CustomStatEventOptions): Base.CustomEvent => {\n    const { name, params, currentUrlPackage, referUrlPackage, ...extra } = options;\n    return {\n        key: name,\n        value: JSON.stringify({\n            url_package: currentUrlPackage,\n            refer_url_package: referUrlPackage,\n            ...params,\n            ...extra,\n        })\n    };\n}\n","import type { ClientEvent } from '@/proto/v2/client_event';\nimport type { Base } from '@/proto/base';\nimport type { VideoEventOptionsParams } from '@/config/types';\n\ninterface Params {\n    currentUrlPackage: Base.UrlPackage;\n    referUrlPackage: Base.UrlPackage | undefined;\n    options: VideoEventOptionsParams;\n}\n\nexport default (params: Params): ClientEvent.VideoStatEvent => {\n    const { currentUrlPackage, referUrlPackage, options } = params;\n    return {\n        video_stat_event: {\n            ...options,\n            url_package: currentUrlPackage,\n            refer_url_package: referUrlPackage,\n        },\n    };\n}\n","import { getLocalStorageItem, setLocalStorageItem } from '../util';\n// 常规业务事件自增 id key\nconst LOCAL_INCREAMENT_ID_KEY = 'WEBLOGGER_INCREAMENT_ID_KEY';\n// 自定义事件自增 id key\nconst LOCAL_CUSTOM_INCREAMENT_ID_KEY = 'WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY';\n// Bridge 常规事件自增 id 本地缓存 key\nconst H5_SEQ_ID_KEY = 'WEBLOGGER_H5_SEQ_ID';\n// Bridge 自定义事件自增 id 本地缓存 key\nconst H5_CUSTOM_SEQ_ID_KEY = 'WEBLOGGER_H5_CUSTOM_SEQ_ID';\n// http 请求自增 id 本地缓存 key\nconst LOCAL_HTTP_INCREMENT_ID_KEY = 'WEBLOGGER_HTTP_SEQ_ID';\n// v2 自增 id 本地缓存 key\nconst V2_INCREMENT_ID_KEY = 'WEBLOGGER_V2_SEQ_ID';\nconst CHANNEL_INCREMENT_ID_KEY = 'WEBLOGGER_CHANNEL_SEQ_ID';\n// 自增 id 最大值\nconst maxId = 1e8;\n// 如果没有 localStorage 则使用运行时自增 id，用于非浏览器场景，比如 React Native\nconst runtimeIdMap:{[key: string]: number} = {};\nconst genId = (key: string) => {\n    try {\n        if (window && window.localStorage && typeof Storage !== 'undefined' && window.localStorage instanceof Storage) {\n            let id = Number(getLocalStorageItem(key)) || 0;\n            if (id + 1 > maxId) {\n                id = 0;\n            }\n            setLocalStorageItem(key, id + 1);\n            return id;\n        }\n    } catch (err) {};\n    if (!runtimeIdMap[key]) {\n        runtimeIdMap[key] = 0;\n    }\n    return runtimeIdMap[key] ++;\n}\n/**\n * 常规事件自增 id\n */\nexport const getNomalIncrementId = () => {\n    return genId(LOCAL_INCREAMENT_ID_KEY);\n};\n/**\n * 自定义事件自增 id\n */\nexport const getCustomIncrementId = () => {\n    return genId(LOCAL_CUSTOM_INCREAMENT_ID_KEY);\n};\n/**\n * 桥接常规事件自增 id\n */\nexport const getBridgeNormalIncrementId = () => {\n    return genId(H5_SEQ_ID_KEY);\n};\n/**\n * 桥接自定义事件自增 id\n */\nexport const getBridgeCustomIncrementId = () => {\n    return genId(H5_CUSTOM_SEQ_ID_KEY);\n};\n/**\n * http 请求自增 id\n */\nexport const getHttpIncrementId = () => {\n    return genId(LOCAL_HTTP_INCREMENT_ID_KEY);\n};\n/**\n * v2 channel 自增 id\n */\nexport const getChannelIncrementId = (channel: string = '') => {\n    return genId(`${CHANNEL_INCREMENT_ID_KEY}_${channel}`);\n};\n/**\n * v2 事件自增 id\n */\nexport const getV2EventIncrementId = (event: string) => {\n    return genId(`${V2_INCREMENT_ID_KEY}_${event}`);\n};","/**\n * hybrid 以及 browser 包使用此文件，将 invoke 定义和 bridge 包隔离，避免 browser 以及 hybrid 包必须引用 yoda 包 ts 定义问题。\n */\n\nimport { error } from './console';\nimport type { SetClientLogTypes } from '@/types/bridge';\n\nlet invoke!: any;\n\nexport const isInYoda = () => {\n    // @ts-ignore\n    return typeof window?.__yodaBridge__?.invoke === 'function';\n};\n\n/**\n * 是否支持桥接 canIUse\n */\nconst isSupportBridge = async (name: string, namespace = 'tool') => {\n    if (typeof invoke === 'undefined') return false;\n    const res = await invoke('tool.canIUse', {\n        namespace,\n        name\n    });\n    return (res as any)?.canUse as boolean || false;\n};\n\n/**\n * 是否支持桥接上报埋点接口\n */\nexport const isSupportBridgeLog = () => {\n    return isSupportBridge('setClientLog');\n};\n\n/**\n * 传入 invoke 方法\n */\nexport const postInvoke = (invokeOrYoda: any) => {\n    if (typeof invokeOrYoda === 'function') {\n        invoke = invokeOrYoda;\n    } else {\n        invoke = invokeOrYoda.invoke;\n    }\n};\n\n/**\n * 发送业务事件\n */\nexport const setClientLog = async (type: SetClientLogTypes, data: unknown) => {\n    try {\n        return await invoke('tool.setClientLog', { type, data });\n    } catch (err) {\n        error(\n            '[error 206]', `yoda.tool.setClientLog() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 发送雷达事件\n */\nexport const sendRadarLog = async (params: any) => {\n    try {\n        return await invoke('tool.sendRadarLog', params);\n    } catch (err) {\n        error(\n            '[error 207]', `yoda.tool.sendRadarLog() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 发送web日志，支持日志回捞\n */\nexport const sendWebLog = async (params: any) => {\n    try {\n        return  invoke('tool.sendWebLog', params);\n    } catch (err) {\n        error(\n            '[error 214]', `yoda.tool.sendWebLog() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 发送汇总数据\n */\nexport const sendSummarizedLog = async (params: any) => {\n    try {\n        return await invoke('tool.sendSummarizedLog', params);\n    } catch (err) {\n        error(\n            '[error 208]', `yoda.tool.sendSummarizedLog() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 获取应用信息\n * @returns\n */\nexport const getAppInfo = async () => {\n    try {\n        return await invoke('system.getAppInfo');\n    } catch (err) {\n        error(\n            '[error 209]', `yoda.system.getAppInfo() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 获取 webview 信息\n */\nexport const getWebviewLoadPerf = async (params: any = {}, options: any) => {\n    try {\n        return await invoke('webview.getPageLoadData', params, options);\n    } catch (err) {\n        error(\n            '[error 209]', `yoda.webview.getPageLoadData() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 获取 webview 加载信息\n */\nexport const getWebviewInfo = async () => {\n    try {\n        return await invoke('webview.getLaunchParams');\n    } catch (err) {\n        error(\n            '[error 209]', `yoda.webview.getPageLoadData() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 获取 ksd相关webview 信息\n */\nexport const getKDSWebviewLoadPerf = async (params: any = {}) => {\n    try {\n        return await invoke('system.getPageLoadData', params);\n    } catch (err) {\n        error(\n            '[error 209]', `yoda.system.getPageLoadData() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n/**\n * 获取设备信息\n * @returns\n */\nexport const getDeviceInfo = async () => {\n    try {\n        return await invoke('system.getDeviceInfo');\n    } catch (err) {\n        error(\n            '[error 209]', `yoda.system.getDeviceInfo() 报错: ${(err as Error).message}`,\n        );\n    }\n};\n\n\nexport default {\n    setClientLog,\n    sendRadarLog,\n    sendWebLog,\n    sendSummarizedLog,\n    getWebviewLoadPerf,\n    getKDSWebviewLoadPerf,\n    isSupportBridgeLog,\n    isSupportBridge,\n    invoke\n};\n","import type { Base } from '../proto/base';\nimport type { ClientEvent as ClientEventV3 } from '../proto/v3/client_event';\n\nexport interface UrlObj {\n    page?: string;\n    params?: any;\n    pageId?: string;\n    force?: boolean;\n}\n\nexport interface UrlMapFnParam {\n    url?: string;\n    page?: string;\n    params?: any;\n    pageId?: string;\n}\n\n/**\n * 全局附加属性\n */\nexport type GlobalAttr = {\n    entry_tag?: EntryTagType[];\n    [key: string]: any;\n}\n\nexport type UrlMapFn = (param: UrlMapFnParam) => (UrlObj | string);\nexport type BaseOptions = {\n    /**\n     * did\n     */\n    device_id?: string;\n    /**\n     * 预留字段, 端内页面不可缺省，服务端需解密\n     */\n    global_id?: string;\n    /**\n     * 用户唯一标志\n     */\n    user_id?: string;\n    /**\n     * 标识调用方,产品线（新注册时自动增加）,找韩小龙要\n     * 默认是0，表示产品未被注册= =\n     */\n    product?: number;\n    /**\n     * 来源\n     */\n    channel?: string;\n    /**\n     * 版本名\n     */\n    version_name?: string;\n    /**\n     * 应用包名\n     */\n    package_name?: string;\n    /**\n     * 代替app_product参数上报具体接入的app，具体值请联系韩小龙分配\n     */\n    product_name?: string;\n    /**\n     * 各端设备识的备用参数，例如微信小程序端上报微信内部用户的唯一标识\n     */\n    union_id?: string;\n    /**\n     * 网络类型\n     */\n    network_type?: keyof typeof networkType;\n    /**\n     * 区分平台\n     */\n    container?: Container;\n    /**\n     * 中台服务名称，比如积木、im sdk等，如果业务log未使用中台服务，该字段置空\n     */\n    service_name?: string;\n    /**\n     * 子业务场景\n     */\n    sub_biz?: string;\n    /**\n     * 是否需要加密\n     */\n    need_encrypt?: boolean;\n    /**\n     * 防盗链id\n     */\n    safety_id?: string;\n    /**\n     * AB实验\n     */\n    experiment?: Base.Experiment[];\n    /**\n     * H5 附加参数\n     */\n    h5_extra_attr?: H5ExtraAttr;\n    /**\n     * 表示宿主平台环境，默认是 PC 端 web 页面\n     */\n    platform?: number;\n    /**\n     * 表示页面会话 id\n     */\n    session_id?: string;\n    /**\n     * 全局参数，可用来设置染色参数\n     */\n    global_attr?: GlobalAttr;\n}\n\n// 小程序需要的参数\nexport type MinaBaseOption = BaseOptions & {\n    // 公参的app product字段\n    appProduct?: string;\n    // 批量上报的时间间隔\n    batchReportInterval?: number;\n    // 是否上报都等待一次业务中公参的设定\n    isReportUtilBizPublicParamsBeSet?: boolean;\n    [key: string]: string | boolean | number | undefined;\n};\n\n/**\n * 事件\n */\n// 网络类型\nexport const networkType = {\n    unknown: 0,\n    none: 1,\n    wifi: 2,\n    '4g': 3,\n    '3g': 4,\n    '2g': 5,\n    '5g': 7,\n    'slow-2g': 5,\n};\n\n// 任务事件类型\nexport enum TaskOperations {\n    CLICK = 'CLICK',\n    DOUBLE_CLICK = 'DOUBLE_CLICK',\n    TRIPLE_CLICK = 'TRIPLE_CLICK',\n    LONG_PRESS = 'LONG_PRESS',\n    PULL = 'PULL',\n    DRAG = 'DRAG',\n    SCALE = 'SCALE',\n    PULL_DOWN = 'PULL_DOWN',\n    PULL_UP = 'PULL_UP',\n    AUTO = 'AUTO',\n}\n\n// 事件类型\nexport enum EventTypes {\n    PV = 'PV',\n    SHOW = 'SHOW',\n    VIDEO = 'VIDEO',\n    // Costume\n    CUSTOM = 'CUSTOM',\n    CUSTOM_EVENT = 'CUSTOM_EVENT',\n    RADAR = 'RADAR',\n}\n\nexport type StatusTypes = keyof typeof Base.ActionStatus;\n\nexport type OperationDirectionTypes = keyof typeof Base.Direction;\n\nexport type TaskStatusTypes = keyof typeof Base.TaskStatus;\n\nexport interface OtherEventOptions {\n    name: string;\n    params?: any;\n    referUrlPackage?: Base.UrlPackage;\n    currentUrlPackage: Base.UrlPackage;\n    contentPackage?: ContentPackage;\n    status?: TaskStatusTypes;\n    taskType?: TaskEventTypeStrings;\n    eventId?: string;\n    operationDirection?: OperationDirectionTypes;\n}\n\n// H5 附加参数\nexport interface H5ExtraAttr {\n    // 主要用于 bridge 模式下，将当前产品的 product_name 透传\n    product_name?: string;\n    // 描述实际埋点对应的产品名称。比如一个h5的产品A，嵌入到产品B中使用，则product_name = A\n    host_product?: string;\n    // 宿主客户端版本号\n    app_version_name?: string;\n    seq_id?: number;\n    http_seq_id?: number;\n    domain?: string;\n    [key: string]: any;\n}\n\n/**\n * 染色参数\n *  page_name: 页面标识，\n *  element_action: 元素标识，\n *  stid：策略id（格式由小分队提供），\n *  pos：位置信息1，\n *  params:{元素参数1}\n */\nexport interface EntryTagType {\n    page_name?: string;\n    element_action?: string;\n    stid?: string;\n    pos?: number;\n    params?: {[key: string]: any};\n}\n\nexport type PageTypeKey = 'web' | 'native' | 'mina';\n\nexport type Container = 'NATIVE' | 'REACT_NATIVE' | 'H5' | 'MP_WECHAT' | 'MP_ALIPAY' | 'MP_BAIDU' | 'MP_KUAISHOU' | 'WEB';\n\nexport interface UrlMap {\n    [key: string]: string;\n}\n\nexport type ContentPackage = string | {[key: string]: any};\n\nexport interface ShowEventOptions {\n    type?: string;\n    referUrlPackage?: Base.UrlPackage;\n    currentUrlPackage: Base.UrlPackage;\n    action: 'enter' | 'leave' | 'hidden' | 'visible';\n    beginTime?: number;\n    name?: string;\n    timeCost?: number;\n    params?: any;\n    contentPackage?: ContentPackage;\n    status?: StatusTypes;\n    operationDirection?: OperationDirectionTypes;\n    actionType?: keyof typeof Base.ActionType;\n    auto?: boolean;\n    eventId?: string;\n    disablePV?: boolean;\n    /**\n     * 向客户端透传的日志信息，如 stid\n     */\n    feedLogCtx?: {\n        stidContainer?: string;\n        [key: string]: any;\n    };\n}\n\nexport interface ShowEventProps {\n    referUrlPackage?: Base.UrlPackage;\n    currentUrlPackage: Base.UrlPackage;\n    type: 'enter' | 'leave' | 'hidden' | 'visible';\n    beginTime?: number;\n    name: string;\n    params?: any;\n    contentPackage?: ContentPackage;\n    status?: StatusTypes;\n    eventId?: string;\n    operationDirection?: OperationDirectionTypes;\n    actionType?: keyof typeof Base.ActionType;\n    auto?: boolean;\n}\n\nexport type TaskEventTypeStrings = keyof typeof ClientEventV3.TaskEventType;\n\nexport type TaskEventOperationTypes = keyof typeof Base.OperationType;\nexport interface TaskEventOptions {\n    sessionId?: string;\n    referUrlPackage?: Base.UrlPackage;\n    currentUrlPackage: Base.UrlPackage;\n    name: string;\n    params?: any;\n    type: TaskOperations;\n    contentPackage?: ContentPackage;\n    status?: StatusTypes;\n    taskType?: string;\n    operationDirection?: keyof typeof Base.Direction;\n    eventId?: string;\n    disablePV?: boolean;\n}\n\nexport interface CustomStatEventOptions {\n    name: string;\n    params: any;\n    currentUrlPackage: Base.UrlPackage;\n    referUrlPackage?: Base.UrlPackage;\n    [key: string]: any;\n    eventId?: string;\n}\n\nexport interface Weblogger {\n    logConfig: any;\n    collect: (type: string, ...params: any) => void;\n    sendImmediately: (type: string, ...params: any) => void;\n    plug: (params: any, options?: any) => void;\n    addPluginInstance: (plugin: any) => void;\n    unplug: (name: string) => void;\n    updateBase: (options: BaseOptions) => void;\n    updateCommonPackage: (options: BaseOptions) => void;\n    updateReferUrlPackage: (url?: string | UrlObj, type?: 'web' | 'native' | 'mina') => void;\n    updateCurrentUrlPackage: (url: string | UrlObj, type?: 'web' | 'native' | 'mina') => void;\n    flush: () => void;\n    logger: any;\n    currentUrlPackage: Base.UrlPackage & { getRealUrlPackage: Function, update: (page: string, params: any, pageId?: string) => void, toJSON: () => void; };\n    referUrlPackage?: Base.UrlPackage & { getRealUrlPackage: Function };\n    commonPackage: any;\n    baseOption: any;\n    plugins: {[key: string]: any};\n    bridge?: any;\n    yoda?: any;\n    entryTag?: any;\n    sessionId: string;\n    SampledPageMap?: { [key: string]: boolean | { radar: { [key: string]: number; }; }; };\n    Utils: {\n        [key: string]: any;\n    };\n    beforeUnload: (event: Event) => void;\n    initBuildInPlugins?: (option?: any) => any;\n    addPlugins: () => void;\n    unplugAll: () => void;\n    on: (event: 'event', handler: (e: {type: string, action: string; data: any}) => void) => void;\n    off: (event: 'event', handler: (e?: any) => void) => void;\n    generateLog: (\n        type: string | SendConfig,\n        name: string | PVOptions | ShowOptions | TaskOptions | CustomOptions | OtherEventOptions,\n        params?: any,\n        contentPackage?: ContentPackage,\n        factory?: (type: string, data: any) => any,\n    ) => any;\n    getEntryTags?: () => Base.EntryTagType[];\n    setEntryTag?: (entryTag: Base.EntryTagType) => void;\n    consumeEntryTag?: (identity: string) => Base.EntryTagType[];\n    clearEntryTag?: (identity: string, containSelf: boolean) => void;\n    sendByHttp?: (type: string, ...params: any) => void;\n}\n\nexport type WeblogClass = {\n    __instance: Object;\n};\n\nexport type AutoPVFilter = (newUrl: string, oldUrl: string | null, type: 'enter' | 'leave' | 'hidden' | 'visible') => boolean;\n\n/**\n * PV 类型参数\n */\nexport interface PVOptions {\n    page?: string;\n    identity?: string;\n    pageId?: string;\n    pageType?: string;\n    params?: string | any;\n    contentPackage?: ContentPackage;\n    currentUrlPackage?: Base.UrlPackage;\n    status?: StatusTypes;\n    type?: 'enter' | 'leave' | 'hidden' | 'visible';\n    beginTime?: number;\n    eventId?: string;\n    auto?: boolean;\n    name?: string; // 小程序专用\n    timeCost?: number;\n    /**\n     * 是否是半屏页面\n     */\n    coPage?: boolean;\n    callback?: (error?: any) => void;\n    feedLogCtx?: {\n        stidContainer?: string;\n        [key: string]: any;\n    };\n}\n\nexport interface UrlPage {\n    page: string; // url_package.page 当前 page 的 name\n    identity?: string;\n    params?: any;\n    coPage?: boolean;\n}\n\n/**\n * Show 类型参数\n */\nexport interface ShowOptions {\n    action: string;\n    params?: any;\n    contentPackage?: ContentPackage;\n    currentUrlPackage?: Base.UrlPackage;\n    eventId?: string;\n    urlPage?: UrlPage;\n    disablePV?: boolean;\n    /**\n     * 向客户端透传的日志信息，如 stid\n     */\n    feedLogCtx?: {\n        stidContainer?: string;\n        [key: string]: any;\n    };\n    callback?: (error?: any) => void;\n}\n\n/**\n * TASK 类型参数\n */\nexport interface TaskOptions {\n    action: string;\n    params?: any;\n    contentPackage?: ContentPackage;\n    currentUrlPackage?: Base.UrlPackage;\n    type?: TaskEventTypeStrings;\n    status?: TaskStatusTypes;\n    eventId?: string;\n    urlPage?: UrlPage;\n    disablePV?: boolean;\n    /**\n     * 向客户端透传的日志信息，如 stid\n     */\n    feedLogCtx?: {\n        stidContainer?: string;\n        [key: string]: any;\n    };\n    callback?: (error?: any) => void;\n}\n\nexport interface ClickOptions {\n    action: string;\n    params?: any;\n    contentPackage?: ContentPackage;\n    currentUrlPackage?: Base.UrlPackage;\n    type?: TaskEventTypeStrings;\n    status?: TaskStatusTypes;\n    eventId?: string;\n    urlPage?: UrlPage;\n    disablePV?: boolean;\n    /**\n     * 染色参数\n     */\n    entryTag?: EntryTagType;\n    /**\n     * 向客户端透传的日志信息，如 stid\n     */\n    feedLogCtx?: {\n        stidContainer?: string;\n        [key: string]: any;\n    };\n    callback?: (error?: any) => void;\n}\n\n/**\n * CUSTOM 类型参数\n */\nexport interface CustomOptions {\n    key: string;\n    value?: any;\n    biz?: string;\n    eventId?: string;\n    urlPage?: UrlPage;\n    disablePV?: boolean;\n    currentUrlPackage?: Base.UrlPackage;\n    callback?: (error?: any) => void;\n}\n\nexport interface VideoEventOptionsParams {\n    duration?: number;\n    played_duration?: number;\n    downloaded?: boolean;\n    prepare_duration?: number;\n    enter_time?: number;\n    leave_time?: number;\n    video_type?: string;\n    play_video_type?: string;\n    photo_id?: number;\n    leave_action?: string;\n    average_fps?: number;\n    media_type?: string;\n    s_photo_id?: number;\n    video_qos_json?: string;\n    click_to_first_frame_duration?: number;\n    rssi?: number;\n    enter_player_action?: string;\n    summary?: string;\n    board_platform?: string;\n    collect_before_status?: string;\n    collect_after_status?: string;\n    session_uuid?: string;\n    soc_name?: string;\n}\n\nexport interface VideoEventOptions {\n    params: VideoEventOptionsParams;\n    callback?: (error?: any) => void;\n    urlPage?: UrlPage;\n    currentUrlPackage?: Base.UrlPackage;\n}\n\nexport type v3Env = 'production' | 'test' | 'development';\nexport type SendCallback = (error?: any) => void;\nexport type LoggerSender = (data: {url: string, data: any, [key: string]: any}, callback?: (error?: any) => void) => void;\n/**\n * 发送埋点接口参数\n */\nexport type EventOptions = PVOptions | ShowOptions | TaskOptions | CustomOptions | VideoEventOptions | ClickOptions;\n/**\n * 支持的事件类型\n */\nexport type SupportTypes = keyof typeof EventTypes | keyof typeof TaskOperations;\nexport interface SendConfig {\n    type: SupportTypes;\n    async?: boolean;\n}\n","/**\n * @file 日志公参，基本确定不变的数据\n * @author <zhangshen@kuaishou.com>\n */\nimport type { Base } from '../proto/base';\nimport type { DeepPartial } from 'utility-types';\nimport { H5ExtraAttr, networkType, BaseOptions, GlobalAttr } from '@/config/types';\nimport { flattenAssign } from '@/util';\n\nexport type CommonPackageOptions = DeepPartial<Base.CommonPackage>;\nexport type ICommonPackage = typeof CommonPackage;\n\nexport class CommonPackage implements Base.CommonPackage {\n    // 默认值为 undefined 减小上报时字段\n    // 标识信息\n    identity_package: Base.IdentityPackage = {\n        device_id: undefined,\n        global_id: undefined,\n        user_id: undefined,\n        union_id: undefined,\n        open_id: undefined,\n        iu_id: undefined\n    };\n    // 应用信息\n    app_package: Base.AppPackage = {\n        product: undefined,\n        language: undefined,\n        platform: undefined,\n        container: 'H5',\n        package_name: undefined,\n        product_name: undefined,\n        version_name: undefined,\n        channel: undefined,\n        version_code: undefined,\n    };\n    experiment?: any[] = undefined;\n    service_name?: string = undefined;\n    safety_id?: string = undefined;\n    sub_biz?: string = undefined;\n    // 设备信息\n    device_package: Base.DevicePackage = {\n        os_version: undefined,\n        model: undefined,\n        ua: undefined,\n    };\n    need_encrypt: boolean = false;\n    network_package: Base.NetworkPackage = {\n        type: networkType.unknown,\n    };\n    // H5 附加参数\n    h5_extra_attr: H5ExtraAttr = {\n        // SDK 版本信息\n        sdk_name: '__SDK_NAME__',\n        sdk_version: '__VERSION__',\n        sdk_bundle: '__SDK_BUNDLE__',\n    };\n    global_attr: GlobalAttr = {\n        // 染色参数\n        entry_tag: [],\n    };\n    location_package?: Base.LocationPackage = {\n        country: undefined, // 国家\n        province: undefined, // 省份/自治区/州\n        city: undefined, // 城市\n        county: undefined, // 县/区域\n        street: undefined, // 街道\n        latitude: undefined, // 纬度\n        longitude: undefined, // 经度\n    };\n\n    constructor(options: CommonPackageOptions | BaseOptions) {\n        this.update(options);\n        if (this.app_package.version_name) {\n            const lastDotIndex = this.app_package.version_name.lastIndexOf('.');\n            this.app_package.version_code = +this.app_package.version_name.slice(lastDotIndex + 1) || 0;\n        }\n        if (!this.app_package.version_name) {\n            this.app_package.version_name = undefined;\n        }\n        if (!this.app_package.version_code) {\n            this.app_package.version_code = undefined;\n        }\n    }\n\n    getH5ExtraAttr(extraInfo?: {[key: string]: any}) {\n        return Object.assign({}, this.h5_extra_attr, extraInfo);\n    }\n    /**\n     * 更新 commonPackage 信息\n     * @param options\n     * @returns\n     */\n    update(options: CommonPackageOptions | BaseOptions) {\n        if (typeof options !== 'object') return;\n        flattenAssign(this, options);\n        // network type 特殊处理\n        const network = (options as BaseOptions).network_type;\n        if (network && (networkType as any)[network]) {\n            this.network_package.type = (networkType as any)[network];\n        }\n    }\n    /**\n     * 更新 global_attr 信息\n     * @param options\n     */\n    updateGlobalAttr(options: {[key: string]: any}) {\n        Object.assign(this.global_attr || {}, options);\n    }\n    /**\n     * 将 commonPackage 转换为 json 输出\n     * @returns\n     */\n    toJSON() {\n        // 处理 v2 空字符串接口会报错问题\n        if (!this.identity_package.user_id) {\n            this.identity_package.user_id = undefined;\n        }\n        const json: Base.CommonPackage = {\n            ...this,\n            toJSON() {\n                return {\n                    ...json,\n                    h5_extra_attr: JSON.stringify(json.h5_extra_attr),\n                    global_attr: JSON.stringify(json.global_attr),\n                };\n            }\n        };\n        json.global_attr = {...this.global_attr};\n        if (this.global_attr.entry_tag && this.global_attr.entry_tag.length) {\n            json.global_attr.entry_tag = this.global_attr.entry_tag.slice();\n        } else {\n            // 节省上报字段\n            delete json.global_attr.entry_tag;\n        }\n        if (!Object.keys(this.global_attr).length) {\n            // 节省上报字段\n            delete json.global_attr;\n        }\n        const location = this.location_package;\n        if (location) {\n            Object.keys(location).forEach((key) => {\n                if (typeof location[key as keyof Base.LocationPackage] === 'undefined') {\n                    delete location[key as keyof Base.LocationPackage];\n                }\n            });\n        }\n        return json;\n    }\n}\n","import { isInApp, getResolution } from './index';\nimport { getUAInfo } from './ua';\n\nconst devices: Array<[string, string, string[]]> = [\n    ['a7', '640x1136', ['iPhone 5', 'iPhone 5s']],\n    ['a7', '1536x2048', ['iPad Air', 'iPad Mini 2', 'iPad Mini 3']],\n    ['a8', '640x1136', ['iPod touch (6th gen)']],\n    ['a8', '750x1334', ['iPhone 6']],\n    ['a8', '1242x2208', ['iPhone 6 Plus']],\n    ['a8', '1536x2048', ['iPad Air 2', 'iPad Mini 4']],\n    ['a9', '640x1136', ['iPhone SE']],\n    ['a9', '750x1334', ['iPhone 6s']],\n    ['a9', '1242x2208', ['iPhone 6s Plus']],\n    ['a9x', '1536x2048', ['iPad Pro (1st gen 9.7-inch)']],\n    ['a9x', '2048x2732', ['iPad Pro (1st gen 12.9-inch)']],\n    ['a10', '750x1334', ['iPhone 7']],\n    ['a10', '1242x2208', ['iPhone 7 Plus']],\n    ['a10x', '1668x2224', ['iPad Pro (2th gen 10.5-inch)']],\n    ['a10x', '2048x2732', ['iPad Pro (2th gen 12.9-inch)']],\n    ['a11', '750x1334', ['iPhone 8']],\n    ['a11', '1242x2208', ['iPhone 8 Plus']],\n    ['a11', '1125x2436', ['iPhone X']],\n    ['a12', '828x1792', ['iPhone Xr']],\n    ['a12', '1125x2436', ['iPhone Xs']],\n    ['a12', '1242x2688', ['iPhone Xs Max']],\n    ['a12x', '1668x2388', ['iPad Pro (3rd gen 11-inch)']],\n    ['a12x', '2048x2732', ['iPad Pro (3rd gen 12.9-inch)']],\n];\n\n\n\nconst pickDeviceByResolution = () => {\n    const resolution = getResolution();\n    let perhaps: string[] = [];\n    for (const device of devices) {\n        if (resolution === device[1]) {\n            perhaps = perhaps.concat(device[2]);\n        }\n    }\n    return perhaps.length && perhaps;\n}\n\nexport const getModel = (() => {\n    let model = '';\n    return () => {\n        if (model) {\n            return model;\n        }\n        try {\n            const uaInfo = getUAInfo();\n            const inApp = isInApp();\n            let model = uaInfo.model  || uaInfo.os.name || 'unknown';\n            if (uaInfo.os.name !== 'iOS' || inApp) {\n                return model;\n            }\n            const device = pickDeviceByResolution();\n            if (device) {\n                return device.join(' or ');\n            }\n            return model;\n        } catch (err) {\n            return 'unknown';\n        }\n    };\n})();","import type { CommonPackageOptions } from '@/core/common';\nimport type { Base } from '@/proto/base';\nimport type { BaseOptions } from '@/config/types';\n\nimport { CommonPackage as BaseCommonPackage } from '@/core/common';\nimport { isInApp, getResolution, getPositiveInteger } from '@/util';\nimport { getCookie } from '@/util/cookie';\nimport { getUAInfo, getDefaultKpn } from '@/util/ua';\nimport { getModel } from '@/util/device-detect';\nimport {\n    getBridgeNormalIncrementId,\n    getBridgeCustomIncrementId,\n    getChannelIncrementId,\n    getV2EventIncrementId,\n} from '@/util/increment-id';\nimport { generateDID } from '@/util/uuid';\n\nlet platformPB: number = 0;\n\nfunction platform(): number {\n    try {\n        const osName = getUAInfo().os.name;\n        if (!osName) {\n            return platformPB = 0;\n        }\n        if (osName === 'Android') {\n            return platformPB = isInApp() ? 6 : 8;\n        }\n        if (osName === 'iOS') {\n            return platformPB = isInApp() ? 7 : 9;\n        }\n        return platformPB = 10;\n    } catch (err) {\n        return 0;\n    }\n}\n\nfunction network() {\n    let networkType = 'unknown';\n    const navigator = window?.navigator;\n    const connection = navigator?.connection || navigator?.mozConnection || navigator?.webkitConnection;\n    if (connection) {\n        networkType = connection.type || connection.effectiveType;\n    }\n    return networkType;\n}\nexport class CommonPackage extends BaseCommonPackage {\n    additional_seq_id_package?: Base.AdditionalSeqIdPackage;\n    constructor(options: BaseOptions) {\n        super({\n            platform: platform(),\n            container: platformPB === 10 ? 'WEB' : 'H5',\n            version_name: isInApp() && getCookie('appver', undefined, true) || '',  // 宿主客户端版本号\n            network_type: network(),\n            device_id: generateDID(),\n            user_id: getCookie('userId'),\n            global_id: isInApp() && getCookie('egid') || '',\n            app_package: {\n                language: navigator.language,\n            },\n            device_package: {\n                os_version: getUAInfo().os.version,\n                model: getModel(),\n                ua: navigator.userAgent,\n            },\n            ...options\n        });\n        Object.assign(this.h5_extra_attr, {\n            host_product: getDefaultKpn(),\n            resolution: getResolution(),\n            screen_width: getPositiveInteger(screen.width),\n            screen_height: getPositiveInteger(screen.height),\n            device_pixel_ratio: window.devicePixelRatio || 1,\n            domain: window.location.origin,\n            fromIframe: window?.self !== window?.top,\n        }, options.h5_extra_attr);\n        delete this.location_package;\n    }\n\n    getVersionName() {\n        return this.app_package.version_name;\n    }\n\n    /**\n    * 更新 commonPackage 信息\n    * @param options\n    * @returns\n    */\n    override update(options: CommonPackageOptions | BaseOptions) {\n        super.update(options);\n        // 主站版本号较为严格，直接通过版本名读取\n        const version_name = this.app_package.version_name;\n        if (typeof version_name === 'string') {\n            const lastDotIndex = version_name.lastIndexOf('.');\n            this.app_package.version_code = + version_name.slice(lastDotIndex + 1) || 0;\n            this.h5_extra_attr.app_version_name = version_name;\n        }\n\n    }\n    // v2 丢失统计\n    setAdditionalSeqIdPackage(eventType: string) {\n        this.additional_seq_id_package = {\n            channel: 3,\n            channel_seq_id: getChannelIncrementId('NORMAL'),\n            custom_type: eventType,\n            custom_seq_id: getV2EventIncrementId(eventType)\n        };\n    }\n    // 用于统计桥接丢失率\n    increaseH5SeqId(isCustom?: Boolean) {\n        this.h5_extra_attr.client_timestamp = getPositiveInteger(new Date().valueOf());\n        this.h5_extra_attr.seq_id = isCustom ? getBridgeCustomIncrementId() : getBridgeNormalIncrementId();\n    }\n}\n","type INamespace = {\n    _silenced: boolean;\n    constructors?: any[],\n    instances?: any[],\n    silence?: (state: boolean) => void;\n};\n\nlet WeblogNamespace: INamespace;\nconst WEBLOGGER_SILENCE_KEY = 'WEBLOGGER_SILENCED';\n// 在浏览器环境下统一一个命名空间，用来统计\nif (typeof window !== 'undefined') {\n    if (typeof window._WEBLOGGER !== 'object') {\n        window._WEBLOGGER = {\n            _silenced: false,\n            constructors: [],\n            instances: [],\n            // 全局静默\n            silence(state: boolean) {\n                try {\n                    if (state) {\n                        sessionStorage.setItem(WEBLOGGER_SILENCE_KEY, '1');\n                    } else {\n                        sessionStorage.removeItem(WEBLOGGER_SILENCE_KEY);\n                    }\n                    window._WEBLOGGER.instances.forEach((i: any) => {\n                        i?.silence(state);\n                    });\n                } catch (err) {}\n            }\n        };\n    }\n    WeblogNamespace = window._WEBLOGGER;\n}\nexport const initSilence = () => {\n    if (WeblogNamespace?.silence) {\n        try {\n            WeblogNamespace._silenced = !!sessionStorage.getItem(WEBLOGGER_SILENCE_KEY);\n        } catch (err) {}\n    }\n};\n/**\n * 记录一个 Weblog 类\n */\nexport const addClass = (C: any) => {\n    // bootstrap 分级加载命名空间，后续废弃\n    if (typeof window._GLOBAL_KS_WEBLOGGER_ !== 'undefined') {\n        window._GLOBAL_KS_WEBLOGGER_.Factory = C;\n    } else {\n        window.Weblog = C;\n    }\n    if (WeblogNamespace?.constructors && C && WeblogNamespace.constructors.indexOf(C) === -1) {\n        // 加个 id 区分\n        C._classId = WeblogNamespace.constructors.length;\n        WeblogNamespace.constructors.push(C);\n    }\n};\n/**\n * 记录一个 Weblog 实例\n */\nexport const addInstance = (i: any) => {\n    if (WeblogNamespace?.instances && i && WeblogNamespace.instances.indexOf(i) === -1) {\n        WeblogNamespace.instances.push(i);\n        if (WeblogNamespace._silenced) {\n            i?.silence(true);\n        }\n    }\n};\n/**\n * 移除一个 Weblog 实例\n */\nexport const removeInstance = (i: any) => {\n    if (WeblogNamespace?.instances) {\n        const index = WeblogNamespace.instances.indexOf(i);\n        if (index !== -1) {\n            WeblogNamespace.instances.splice(index, 1);\n        }\n    }\n};\n","import type {\n    EventType as IEventType,\n    EventOptions as IEventOptions,\n    DangerCunstomEventOption\n} from '@/types/event';\n\nexport const oldApiTransformer = <T extends IEventType>(\n    type: T | { type: T },\n    name: string | IEventOptions<T> = {},\n    params?: any,\n    contentPackage?: {[key: string]: any} | string\n): [T, IEventOptions<T>] => {\n    let realType: T;\n    if (typeof type !== 'string') {\n        realType = type.type;\n    }\n    realType = (type as T).toUpperCase() as T;\n    let options: any = {};\n    if (typeof name === 'string') {\n        console.warn('[warn 105]', '接口参数为旧式，后续版本将不再兼容，推荐使用新的参数形式');\n        options.contentPackage = contentPackage;\n        if (type === 'CUSTOM') {\n            options.key = name;\n            options.value = params;\n        } else {\n            options.params = params;\n            if (type === 'PV') {\n                options.page = name;\n            }else {\n                options.action = name;\n            }\n        }\n    } else {\n        options = name;\n        if (['CUSTOM', 'CUSTOM_EVENT'].includes(realType)) {\n            const customParams = name as DangerCunstomEventOption & { key?: string; value?: any };\n            if (customParams.action && !customParams.key) {\n                options.key = customParams.action;\n            }\n            if (customParams.params && !customParams.value) {\n                options.value = customParams.params;\n            }\n        }\n    }\n    return [\n        realType,\n        options\n    ];\n};","import type {\n    EventType as IEventType,\n    EventOptions as IEventOptions,\n    ImmediatelyEventOptions,\n    CustomEventOption,\n} from '@/types/event';\nimport type {\n    PageTypeKey,\n    UrlObj,\n    HttpWeblogInitParams,\n} from '@/types/configuration';\nimport type { ClientLog as ClientLogV3 } from '@/proto/v3/client_log';\nimport BaseWeblog from '@/core';\nimport UrlPackage from './url-package';\nimport Logger from './logger';\nimport { addMonitor, removeMonitor, pageUrlValidate, isInApp } from '@/util';\nimport sendData from '@/io';\nimport { logFactory } from '@/core/log';\nimport uaUtils from '@/util/ua';\nimport cookieUtils, { getCookie } from '@/util/cookie';\nimport { updateConfig } from '@/config/global';\nimport yodaUtils, { postInvoke, getDeviceInfo, getAppInfo, isInYoda } from '@/util/yodav2Browser';\nimport { generateDID, uuid, getSessionId } from '@/util/uuid';\nimport { CommonPackage } from './common';\nimport { oldApiTransformer } from '@/util/history-polyfill';\nimport { error, warn } from '@/util/console';\nimport { addInstance, removeInstance } from '@/util/namespace';\n\nconst getDefaultUserId = () => getCookie('userId') || getCookie('userName') || undefined;\n\nexport let isWillClosed = false;\n\nconst randomValue = Math.random();\nexport default class Weblog extends BaseWeblog {\n    static Logger = Logger;\n    declare currentUrlPackage: UrlPackage;\n    declare referUrlPackage: UrlPackage;\n    override logger: Logger;\n    override commonPackage: CommonPackage;\n    sampled?: boolean;\n    isV2: boolean;\n    isBridge?: boolean;\n    _silenced?: boolean;\n    constructor(\n        logConfig: HttpWeblogInitParams[0] = {},\n        base?: HttpWeblogInitParams[1],\n    ) {\n        super(logConfig, base);\n        this.isBridge = logConfig.bridgeMode && logConfig.yoda && isInYoda();\n        this.logConfig.isBridge = this.isBridge;\n        console.warn(\n            '[webLogger] 您正在使用的是',\n            logConfig.bridgeMode ?\n                `【桥接上报】的 js 包。${this.isBridge ? '' : '当前是端外打开，会自动改为 http 上报！上报链路为 ' + (logConfig.proto === 'v2' ? 'v2' : 'v3')}`\n                :\n                `【http 上报】的 js 包。上报链路为 ${logConfig.proto === 'v2' ? 'v2' : 'v3'}`,\n            );\n        updateConfig('sessionId', base && base.session_id || getCookie('sid') || getSessionId());\n        this.isV2 = this.logConfig.proto === 'v2';\n        this.getSampled(this.logConfig);\n        // 参数默认值处理\n        this.presetBaseOption(this.baseOption);\n        this.commonPackage = new CommonPackage(this.baseOption);\n        this.logger = new Logger(this.logConfig, this.commonPackage);\n        this.initYoda();\n        this.addPlugins();\n        addMonitor(window, 'pagehide', this.beforeUnload);\n        addMonitor(window, 'beforeunload', this.beforeUnload);\n        addInstance(this);\n    }\n    getSampled(logConfig: HttpWeblogInitParams[0]) {\n        const { sampleRateFn, sampleRate } = logConfig || {};\n        if (typeof sampleRateFn === 'function') {\n            this.sampled = !!sampleRateFn();\n        } else if (typeof sampleRate !== 'undefined') {\n            this.sampled = randomValue < Number(sampleRate);\n        }\n    }\n    /**\n     * 参数预处理\n     * @param base\n     */\n    private presetBaseOption(base: {[key: string]: any}) {\n        if (!this.isBridge) {\n            if (this.isV2) {\n                if (typeof base.product !== 'number') error(`[error 101]`, `请设置有效的 product 值，值类型为 number!`);\n                delete base.product_name;\n            } else {\n                if (!base.product_name || typeof base.product_name !== 'string') error(`[error 100]`, `请设置有效的 product_name 值，值类型为 string!`);\n                delete base.product;\n            }\n            if (!base.user_id) {\n                base.user_id = getDefaultUserId();\n                if (!base.user_id) warn(`[warn 102]`, `user_id 为空，请确定是否传入，如果是异步通过 updateCommonPackage 接口传入，可以忽略该提示!`);\n            }\n            if (!base.device_id) {\n                base.device_id = generateDID();\n                if (!base.device_id) error(`[error 103]`, `device_id 为空，请设置有效的设备 id!`);\n            }\n            if (!base.global_id && isInApp()) {\n                base.global_id = getCookie('egid') || ''\n            }\n        }\n    }\n\n    get yoda() {\n        return this.logConfig.yoda || window?.KSYoda || window?.yoda;\n    }\n\n    // TIP:\n    get Utils() {\n        return {\n            yoda: isInYoda() && this.yoda ? yodaUtils : null,\n            cookie: cookieUtils,\n            ua: uaUtils,\n            io: {\n                sendData,\n            },\n        }\n    }\n\n    initYoda() {\n        if (!isInYoda() || !this.yoda) return;\n        postInvoke(this.yoda);\n        // 更新设备信息\n        getDeviceInfo().then((info: any) => {\n            if (info?.mod) {\n                this.commonPackage.device_package.model = info.mod;\n            }\n        });\n        // 更新应用信息\n        getAppInfo().then((info) => {\n            if (typeof info === 'object') {\n                const { did, userId, appver } = info;\n                did && (this.commonPackage.identity_package.device_id = did);\n                userId && !this.commonPackage.identity_package.user_id && (this.commonPackage.identity_package.user_id = userId);\n                appver && (this.commonPackage.app_package.version_name = appver);\n            }\n        })\n    }\n\n    override initUrlPackage() {\n        super.initUrlPackage();\n        const { referer } = this.logConfig;\n        let referUrl;\n        let referType: PageTypeKey = 'web';\n        if (referer) {\n            referUrl = referer.value;\n            referType = referer.type && referer.type || referType;\n        } else if (typeof document !== 'undefined' && document.referrer) {\n            referUrl = document.referrer;\n        }\n        if (referUrl) {\n            this.updateReferUrlPackage(referUrl, referType);\n        }\n    }\n\n    override updateCurrentUrlPackage(url: string | UrlObj = location?.href || '', type: PageTypeKey = 'web') {\n        if (typeof url === 'object' && !url.force && this.currentUrlPackage) {\n            const { page = this.currentUrlPackage.page, params = {} } = url;\n            if (page === this.currentUrlPackage.page) {\n                return this.currentUrlPackage.update(page, params);\n            }\n        }\n        this.currentUrlPackage = new UrlPackage(url, type, this.logConfig.urlMap);\n        if (this.logConfig.attachUrl) this.currentUrlPackage.attachUrl();\n    }\n\n    /**\n     * 更新 refer url 信息\n     * @param url\n     * @param type\n     */\n    override updateReferUrlPackage(url: string | UrlObj | UrlPackage = this.currentUrlPackage, type: PageTypeKey = 'web') {\n        if (url instanceof UrlPackage) {\n            this.referUrlPackage = url;\n        } else {\n            this.referUrlPackage = new UrlPackage(url, type, this.logConfig.urlMap);\n        }\n    }\n\n    get isSendSampled() {\n        return (typeof this.sampled === 'undefined' ? true  : this.sampled) || this.logger.isDebug;\n    }\n    override generateLog<T extends IEventType>(\n        eventType: T,\n        eventOptions: IEventOptions<T>,\n        factory: (type: string, data: any, isV2?: boolean) => any = logFactory\n    ) {\n        let { action, params, status, type, eventId, contentPackage, urlPage } = eventOptions as IEventOptions<'CLICK'>;\n        let currentUrlPackage;\n        if (contentPackage) {\n            contentPackage = typeof contentPackage === 'string' ? contentPackage : JSON.stringify(contentPackage);\n        }\n        const isPVEvent = eventType === 'PV';\n        // 若是 pv 先更新currentUrlPackage\n        if (isPVEvent) {\n            let { page, type } = eventOptions as IEventOptions<'PV'>;\n            if (!type) (eventOptions as IEventOptions<'PV'>).type = type = 'enter';\n            // enter 则重新生成新的 currentUrlPackage，否则局部更新\n            if (type === 'enter' && page) {\n                this.updateCurrentUrlPackage({page, params});\n            } else {\n                this.currentUrlPackage.update(page, params);\n            }\n        } else if (urlPage && urlPage.page) {  // 如果参数中带有 urlPage，用来解决页面飘移问题，只影响该埋点\n            currentUrlPackage = {\n                page: urlPage.page,\n                identity: urlPage.identity || uuid(),\n                params: JSON.stringify(urlPage.params),\n                page_type: this.currentUrlPackage.page_type\n            }\n        }\n        const commonInfo = {\n            currentUrlPackage: currentUrlPackage || this.currentUrlPackage.toJSON(),\n            referUrlPackage: this.referUrlPackage ? this.referUrlPackage.toJSON() : undefined,\n            contentPackage\n        };\n        // 除了雷达之外的事件都希望能按照规范上报埋点，使 page 不为url\n        if (eventType !== 'RADAR' && currentUrlPackage?.page.indexOf('http') === 0) {\n            console.warn('[warn 104]', `埋点页面信息 ${currentUrlPackage?.page} 不符合规范，推荐使用大写英文 + 下划线格式`);\n        }\n        if (isPVEvent) {\n            const { type } = eventOptions as IEventOptions<'PV'>;\n            // PV 类型\n            return factory(eventType, {\n                ...eventOptions as IEventOptions<'PV'>,\n                type,\n                ...commonInfo\n            }, this.isV2);\n        }\n        if (eventType === 'SHOW') {\n            // SHOW 类型\n            return factory(eventType, {\n                ...eventOptions as IEventOptions<'SHOW'>,\n                name: action,\n                ...commonInfo\n            }, this.isV2);\n        }\n\n        if (eventType === 'VIDEO') {\n            return factory(eventType, {\n                params: eventOptions as IEventOptions<'VIDEO'>,\n                name: 'VIDEO',\n                ...commonInfo\n            }, this.isV2);\n        }\n\n        // Radar 日志特殊处理\n        if (eventType === 'RADAR') {\n            return factory(eventType, eventOptions, this.isV2);\n        }\n\n        if (['CUSTOM', 'RADAR', 'CUSTOM_EVENT'].indexOf(eventType) !== -1) {\n            // CUSTOM 类型\n            const { key, value } = eventOptions as CustomEventOption;\n            return factory('CUSTOM', {\n                ...eventOptions,\n                params: value,\n                name: key,\n                ...commonInfo\n            }, this.isV2);\n        }\n\n        // TASK 类型\n        return factory(eventType, {\n            ...eventOptions,\n            params,\n            status,\n            taskType: type,\n            eventId,\n            name: action,\n            ...commonInfo\n        }, this.isV2);\n    }\n    override collect<T extends IEventType>(type: T, options: IEventOptions<T>): void;\n    override collect<T extends IEventType>(type: T, name: string, params?: any, contentPackage?: { [keys: string]: any } | string): void;\n    override collect<T extends IEventType>(\n        type: T,\n        name: string | IEventOptions<T>,\n        params?: any,\n        contentPackage?: { [keys: string]: any } | string,\n    ) {\n        const [logType, logParams] = oldApiTransformer(type, name, params, contentPackage);\n        return this.send(logType, logParams, false);\n    }\n\n    override sendImmediately<T extends IEventType>(type: T, options: IEventOptions<T>): void;\n    override sendImmediately<T extends IEventType>(type: T, name: string, params?: any, contentPackage?: { [keys: string]: any } | string): void;\n    override sendImmediately<T extends IEventType>(\n        type: T,\n        name: string | IEventOptions<T>,\n        params?: any,\n        contentPackage?: { [keys: string]: any } | string,\n    ) {\n        const [logType, logParams] = oldApiTransformer(type, name, params, contentPackage);\n        return this.send(logType, logParams, true);\n    }\n\n    override send<T extends IEventType>(\n        type: T,\n        params: ImmediatelyEventOptions<T>,\n        immediately?: boolean,\n    ) {\n        if (this._silenced) return;\n        const log = this.generateLog(type, params) as ClientLogV3.ReportEvent;\n        this.emit('event', {type, action: (params as ImmediatelyEventOptions<'SHOW'>)?.action, log});\n        // this.beforeSend(type, params, log);\n        // 雷达日志单独处理\n        if (type === 'RADAR') {\n            return this.logger.sendRadar(log, (params as ImmediatelyEventOptions<'RADAR'>)?.serviceName);\n        }\n        if (this.isV2 && this.logConfig.forbidV2HttpUrlPage && !pageUrlValidate(this.currentUrlPackage.page)) return;\n        // 如果该用户不被采样，则所有日志都不会上报\n        if (!this.isSendSampled) {\n            return;\n        }\n        const callback = typeof params === 'object' && params.callback || undefined;\n        this.logger.send(log, !!immediately, callback);\n    }\n\n    beforeUnload = (event: Event) => {\n        if (isWillClosed) return;\n        this.logger.drain();\n        for (const key in this.plugins) {\n            const plugin = this.plugins[key];\n            if (typeof plugin.beforeUnload === 'function') {\n                plugin.beforeUnload(event);\n            }\n        }\n        isWillClosed = true;\n        setTimeout(() => {\n            isWillClosed = false;\n        }, 2000);\n    }\n    override destroy() {\n        super.destroy();\n        removeMonitor(window, 'pagehide', this.beforeUnload);\n        removeMonitor(window, 'beforeunload', this.beforeUnload);\n        removeInstance(this);\n    }\n    /**\n     * 是否不发送日志，true 暂停请求，false 则会继续请求\n     */\n    silence(state: boolean) {\n        this._silenced = state;\n    }\n}\n","import type { BaseWeblogInstance } from '@/types/index';\n\nexport abstract class BasePlugin {\n    declare weblog: BaseWeblogInstance;\n    abstract destroy(): void;\n    apply(weblog: BaseWeblogInstance) {\n        this.weblog = weblog;\n    }\n    /**\n     * 统一由 weblog 在页面关闭前调用的生命周期函数\n     */\n    beforeUnload?: (event: Event) => void;\n    static key: string;\n}\n\nexport interface BasePluginConstructor {\n    new(options?: any): any;\n    new(weblogger?: any, options?: any): any;\n    key: string;\n}\n/**\n * 在 bootstrap 环境下自动注册插件\n * @param Plugin\n * @param optionKey\n */\nexport const autoRegister = (Plugin: any, optionKey?: string) => {\n    if (\n        typeof window === 'undefined' ||\n        typeof window._GLOBAL_KS_WEBLOGGER_ === 'undefined' ||\n        typeof Plugin !== 'function') return;\n    const { weblog, config } = window._GLOBAL_KS_WEBLOGGER_;\n    let option = optionKey ? config.plugins[optionKey]?.options : undefined;\n    weblog.addPluginInstance(new Plugin(option));\n}\n","/**\n * 浏览器版本，只有 HTTP 上报\n */\nimport '../util/polyfill';\nimport type { HttpWeblogInitParams } from '@/types/configuration';\nimport Weblog from '@/platform/browser';\nimport { BasePlugin } from '../plugins/base';\nexport type {\n    SupportTypes,\n    SendConfig,\n    PVOptions,\n    ShowOptions,\n    TaskOptions,\n    CustomOptions,\n    BaseOptions,\n    VideoEventOptions,\n} from './types';\nimport { addClass, initSilence } from '@/util/namespace';\nexport type LoggerConfigByUser = HttpWeblogInitParams[0];\nexport type WeblogInitParams = HttpWeblogInitParams;\n// 注册到全局对象\naddClass(Weblog);\ninitSilence();\n\nexport {\n    Weblog,\n    BasePlugin,\n};\n\nexport default Weblog;\n"],"names":["hasOwnProperty","hasDontEnumBug","dontEnums","commonGlobal","globalThis","window","global","self","addEventListener","removeEventListener","setTimeout","setInterval","_WEBLOGGER_MOCKED_WINDOW_","document","cookie","querySelector","querySelectorAll","navigator","userAgent","screen","history","location","hostname","search","href","origin","localStorage","getItem","setItem","err","Object","defineProperty","target","key","descriptor","prototype","toString","call","value","assign","TypeError","to","index","arguments","length","nextSource","nextKey","writable","configurable","Function","bind","oThis","this","aArgs","Array","slice","fToBind","FNOP","fBound","currentThis","apply","concat","indexOf","searchElement","fromIndex","k","O","len","n","Math","abs","Infinity","max","keys","propertyIsEnumerable","obj","result","prop","push","dontEnums_1","_i","forEach","callback","thisArg","T","kValue","extendStatics","d","b","setPrototypeOf","__proto__","p","__extends","String","__","constructor","create","__assign","t","s","i","__rest","e","getOwnPropertySymbols","__awaiter","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","adopt","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","pop","__spreadArray","from","pack","ar","l","GlobalConfig","sessionId","appDevicePackageReady","identityPackageReady","UrlPackage","url","pageType","page","identity","page_type","update","params","generatePageId","toJSON","JSON","stringify","category","Date","getTime","ksAppList","parseCookieString","text","shouldDecode","options","cookies","decodeValue","decodeURIComponent","cookieParts","split","cookieName","cookieValue","cookieNameValue","_a","match","substring","ex","prevCookie","cookiesMap","getCookie","name","force","curCookie","raw","setCookie","encode","encodeURIComponent","expires","path","domain","toUTCString","secure","createCookieString","cookieUtils","error","args","error_1","console","addMonitor","evtTarget","evtName","attachEvent","removeMonitor","detachEvent","leftPad","str","ch","pad","isInApp","ua","toLowerCase","parseQueryString","queryString","queries_1","getUrlAndQueryFromUrl","queryIndex","lastIndexOf","isObj","isArray","resolution","getResolution","ratio","devicePixelRatio","width","floor","height","enableAsyncGzip","Worker","Uint8Array","URL","isMobile","test","isiPad","platform","_b","maxTouchPoints","isMobileAndIpad","getPositiveInteger","EventEmitter","events","on","eventName","off","array","item","arr","splice","emit","pluginIndex","Weblog","_super","logConfig","base","_this","version","plugins","flush","logger","baseOption","env","proto","timeout","wait","maxBatchLength","sampleRate","yoda","forbidV2HttpUrlPage","initUrlPackage","__instance","get","Global","updateCurrentUrlPackage","type","currentUrlPackage","updateReferUrlPackage","referUrlPackage","updateBase","updateCommonPackage","commonPackage","addPlugins","plugin","addPluginInstance","pluginInstance","weblog","plug","pluginOptions","unplug","destroy","unplugAll","generateLog","eventType","eventOptions","send","immediately","log","toUpperCase","beforeSend","collect","sendImmediately","sendPackage","data","uuid","replace","c","r","random","resolveTopLevelDomain","ret","generateDID","did","ts","randomer","charAt","join","nanoId","setFullYear","getFullYear","sessionKey","urlMap","undefined","init","urlPackage","pageId","parsed","res","mappingPage","getMappingPage","attachUrl","origin_url","origin_pathname","getRealUrlPackage","page_code","query","BaseUrlPackage","dataTrackHost","testHost","PROD","LOGGER","LOGGER_SGP","v3Api","Envs","overseaHost","Apis","v2","v3","radar","Hosts","production","round","development","oversea","buildUrl","formatUrlQuery","querys","BatchLog","config","asyncQueue","throttleQueue","errorQueue","sendingQueue","isV2","isDebug","radarUrl","drained","batchCount","isSetSamplingResult","sendingYield","sendLogs","drain","flushErrorLogs","min","updateUrls","sendData","sender","baseSendData","app_package","product_name","product","device_id","identity_package","formatUrl","getCommonPackageJSON","immediate","sendAsync","sendThrottle","clearTimeout","batchWaitTimer","logs","buildLogPackage","errHandler","isDrained","buildV2Package","buildV3Package","event","commonPackageOptions","common","logPackage","unshift","h5_extra_attr","http_seq_id","client_timestamp","merged","currentLog","destory","compensateTimer","sendRadar","service_name","radarPackage","xhrErrorLog","xhr","XMLHttpRequest","open","setRequestHeader","onload","status","response","parse","exception","error_msg","message","logXhrResponseCheck","ontimeout","onerror","errorHandler","navigatorEnable","functionEnable","sendBeacon","forceSendBeacon","fd","sendXHR","ModuleStates","getReportUrl","viewHost","reportHost","loggerUrl","log_1","Base","ClientEvent","LoadedModules","SWICTH","getTemporaryLoggerUrl","webloggerSwitch","sessionStorage","loggerSessionId","loggerHost","handshakeApi","getCookieReportUrl","getWebPageReportUrl","Logger","sendLog","getResponseSamplingStorage","storageEffectiveTime","Number","responseSamplingStorageKey","now","sendEffectiveTime","removeItem","isResponseSampling","setResponseSamplingConfig","responsePromise","hostName","expireSeconds","effectiveTime","isBridge","disableCompress","loggerEnv","isOversea","getLoggerReportUrl","script","async","mod","state","loading","scriptEl","createElement","crossOrigin","src","referEl","getElementsByTagName","parentNode","insertBefore","head","appendChild","loaded","loadScript","sendGzip","Gzipper","promise","setAdditionalSeqIdPackage","getEventType","common_package","BaseLogger","ElementStatus","PageShowAction","ActionStatus","ActionType","SubAction","Direction","TaskStatus","OperationType","ShowType","TaskEventType","timeZoneGMTOffset","uaInfo","firstLoad","enterTime","valueOf","ShowEvent","_c","action","beginTime","contentPackage","actionType","auto","commonInfo","UNKNOWN_STATUS","SUCCESS","UNKNOWN_ACTION_TYPE","CLICK","url_package","refer_url_package","sub_action","PAGE_ENTER","actionPB","ENTER","first_load","stay_length","LEAVE","PAGE_LEAVE","RESUME","PAGE_RESUME","PAGE_PAUSE","showType","ClientEventV3","PAGE_AUTO","PAGE_CUSTOM","ClientEventV2","PAGE","show_event","time_cost","ELEMENT","element_package","TaskEvent","taskType","operationDirection","isV2Click","operationType","click_event","direction","UNKNOWN2","task_event","action2","USER_OPERATION","operation_type","operation_direction","session_id","CustomStatEvent","extra","VideoStatEvent","video_stat_event","runtimeIdMap","genId","Storage","id","getLocalStorageItem","setLocalStorageItem","GMT","getTimezoneOffset","ReportEvent","client_increment_id","event_id","time_zone","genIncrementId","isCustomStatEvent","stat_package","event_package","custom_event","logFactory","eventId","page2","customData","custom_stat_event","defaultKpn","lastUA","getUAInfo","UNKNOWN","androidReg","MacOS","Windows","Android","iPhone","iPad","WinPhone","Linux","os","model","uaMatches","uaMain","uaArr","map","trim","osName","osVersion","matches","modelMatches","_d","vMatches","mMatches","getDefaultKpn","rules","tmp","rule","name_1","exec","kpnFromUA","invoke","TaskOperations","EventTypes","uaUtils","supportsPushState","isInYoda","__yodaBridge__","isSupportBridge","namespace","canUse","yodaUtils","setClientLog","err_1","sendRadarLog","err_2","sendWebLog","sendSummarizedLog","err_3","getWebviewLoadPerf","err_5","getKDSWebviewLoadPerf","err_7","isSupportBridgeLog","networkType","unknown","none","wifi","4g","3g","2g","5g","slow-2g","CommonPackage","global_id","user_id","union_id","open_id","iu_id","language","container","package_name","version_name","channel","version_code","experiment","safety_id","sub_biz","device_package","os_version","need_encrypt","network_package","sdk_name","sdk_version","sdk_bundle","global_attr","entry_tag","location_package","country","province","city","county","street","latitude","longitude","lastDotIndex","getH5ExtraAttr","extraInfo","merge","obj1","obj2","deepKey","flattenAssign","network","network_type","updateGlobalAttr","json","devices","getModel","inApp","model_1","device","perhaps","devices_1","pickDeviceByResolution","platformPB","connection","mozConnection","webkitConnection","effectiveType","WeblogNamespace","host_product","screen_width","screen_height","device_pixel_ratio","fromIframe","top","getVersionName","app_version_name","additional_seq_id_package","channel_seq_id","custom_type","custom_seq_id","increaseH5SeqId","isCustom","seq_id","BaseCommonPackage","oldApiTransformer","realType","includes","customParams","WEBLOGGER_SILENCE_KEY","_WEBLOGGER","_silenced","constructors","instances","silence","C","isWillClosed","randomValue","beforeUnload","bridgeMode","getSessionId","getSampled","presetBaseOption","initYoda","sampleRateFn","sampled","warn_1","warn","KSYoda","io","invokeOrYoda","err_8","info","err_4","userId","appver","referUrl","referer","referType","referrer","factory","urlPage","isPVEvent","type_1","type_2","logType","logParams","serviceName","isSendSampled","removeInstance","BaseWeblog","BasePlugin","_GLOBAL_KS_WEBLOGGER_","Factory","_classId","initSilence"],"mappings":"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"}