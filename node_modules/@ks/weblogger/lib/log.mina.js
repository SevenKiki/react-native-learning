!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Weblog={})}(this,(function(t){"use strict";var e=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}(),n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}function i(t,e,n,o){return new(n||(n=Promise))((function(r,a){function i(t){try{c(o.next(t))}catch(t){a(t)}}function s(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,s)}c((o=o.apply(t,e||[])).next())}))}function s(t,e){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function c(t,e,n){if(n||2===arguments.length)for(var o,r=0,a=e.length;r<a;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var u={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},p=function(t,e){u[t]=e},l=function(){function t(t,e){switch(this.page="",this.identity="",e){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(t.page,t.params)}return t.prototype.update=function(t,e){void 0===t&&(t=""),t&&t!==this.page&&(this.page=t,this.identity=this.generatePageId(t)),e&&(this.params=Object.assign(this.params||{},e))},t.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params),category:this.category}},t.prototype.generatePageId=function(t){return t+(new Date).getTime()},t}();function g(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,c([console],t,!1))}catch(t){return}}function h(t,e,n){if(void 0===n&&(n=" "),(e-=t.length)<=0)return t;for(var o="";e;)1&e&&(o+=n),e>>=1,n+=n;return o+t}var f=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},d=function(t){try{return Math.abs(Math.floor(t))}catch(e){return t}},y=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var n;e&&"function"==typeof e&&(this.events[t]=this.events[t]||[],null===(n=this.events[t])||void 0===n||n.push(e))},t.prototype.off=function(t,e){if(this.events[t]){if(e&&"function"==typeof e){var n=this.events[t];n&&(r=e,(a=(o=n).indexOf(r))>-1&&o.splice(a,1))}var o,r,a;e||(this.events[t]=[])}},t.prototype.emit=function(t){for(var e,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.events[t]&&(null===(e=this.events[t])||void 0===e||e.forEach((function(t){t.apply(void 0,n)})))},t}(),v=0,_=function(t){function e(n,o){var a,i=t.call(this)||this;return i.version="3.10.23",i.plugins={},i.flush=function(){i.logger.flush()},i.baseOption=r({},o),i.logConfig=(a=n,r({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda,forbidV2HttpUrlPage:!0},a||{})),i.initUrlPackage(),e.__instance||(e.__instance=i),i}return o(e,t),Object.defineProperty(e.prototype,"sessionId",{get:function(){return u.sessionId},enumerable:!1,configurable:!0}),e.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e="web"),"object"==typeof t&&t.page&&this.currentUrlPackage&&t.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(t.page,t.params);this.currentUrlPackage=new l(t,e)},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof l?t:new l(t,e)},e.prototype.updateBase=function(t){this.updateCommonPackage(t)},e.prototype.updateCommonPackage=function(t){"object"==typeof t&&this.commonPackage.update(t)},e.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},e.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(v++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},e.prototype.plug=function(t,e){if(this.plugins[t.key])return g("[code 301]","".concat(t.key," 插件重复加载！"));this.addPluginInstance(new t(this,e))},e.prototype.unplug=function(t){var e=this.plugins[t];e&&(e.destroy(),delete this.plugins[t])},e.prototype.unplugAll=function(){for(var t in this.plugins)this.plugins[t]&&this.unplug(t)},e.prototype.generateLog=function(t,e){return{}},e.prototype.send=function(t,e,n){var o=this.generateLog(t.toUpperCase(),e);return"function"==typeof this.beforeSend&&this.beforeSend(t,e,o),this.logger.send(o,!!n,e.callback)},e.prototype.collect=function(t,e){this.send(t,e)},e.prototype.sendImmediately=function(t,e){this.send(t,e,!0)},e.prototype.sendPackage=function(t,e){this.logger.sendPackage(t,e)},e.prototype.destroy=function(){this.unplugAll()},e}(y),m="MP_WECHAT",E="MP_ALIPAY",P="MP_BAIDU",k="MP_KUAISHOU";function T(){try{return"object"==typeof wx&&Object.keys(wx).length?m:"object"==typeof my&&Object.keys(my).length?E:"object"==typeof swan&&Object.keys(swan).length?P:"object"==typeof ks&&Object.keys(ks).length?k:m}catch(t){return m}}var S="object"==typeof wx?wx:"object"==typeof my?my:"object"==typeof swan?swan:"object"==typeof ks?ks:wx,U=T()===E,O=function(t){if("string"!=typeof t)throw Error("The relativeTime must be an string but received ".concat(t));var e=Date.now(),n=0;return t.split("-").forEach((function(e){var o=parseInt(e.slice(0,-1),10),r=e[e.length-1];if(/\D/.test(e.slice(0,-1))||"number"!=typeof o||-1==="yMdhms".indexOf(r))throw Error("The releated time you passed '"+t+"' is not valid. It should use '-' as the separator, and should be number except the last char which should be y|M|d|h|m|s of each item");switch(r){case"y":n+=31536e3*o;break;case"M":n+=2592e3*o;break;case"d":n+=86400*o;break;case"h":n+=3600*o;break;case"m":n+=60*o;break;case"s":n+=o}})),e+1e3*n},N="ks_storage_";var b,A,C=new(function(){function t(){this.cache={}}return t.prototype.getCompleteStorage=function(t){var e=null,n=N+t;try{null==this.cache[n]&&(this.cache[n]=function(t){var e;return U?null!==(e=S.getStorageSync({key:t})).data?e.data:"":e=S.getStorageSync(t)}(n)),e=this.cache[n]}catch(t){}return e},t.prototype.get=function(t){var e=null;try{var n=this.getCompleteStorage(t);if("object"==typeof n&&n.isSDKStorage){var o=n.value,r=n.expirationTime;r&&function(t){if(void 0===t||/\D/.test(t+""))return!0;return t<Date.now()}(r)?this.remove(t):e=o}else e=n}catch(t){}return e},t.prototype.set=function(t,e,n,o){void 0===o&&(o=!1);var r=!1,a=N+t;try{n=n&&(function(t){"number"==typeof t&&(t=""+t);return!/\D/.test(t)}(n)?Number(n):O(n+""));var i={value:e,isSDKStorage:!0,expirationTime:n};["number","string","boolean"].indexOf(typeof e)>-1&&e===this.get(t)||(o?function(t,e){U?S.setStorageSync({key:t,data:e}):S.setStorageSync(t,e)}(a,i):S.setStorage({key:a,data:i,fail:function(t){}}),this.cache[a]=i),r=!0}catch(t){}return r},t.prototype.remove=function(t){var e=!1,n=N+t;try{delete this.cache[n],S.removeStorage({key:n,fail:function(t){}}),e=!0}catch(t){}return e},t.prototype.clear=function(){var t=!1;try{this.cache={},S.clearStorage({fail:function(t){}}),t=!0}catch(t){}return t},t}()),I="weblogger_store",w={},L=function(t,e){var n=C.get(I);if(n){if("object"!=typeof e||Array.isArray(e))n[t]=e;else{var o={};Object.keys(e).forEach((function(t){o[t]=e[t]})),n[t]=r(r({},n[t]||{}),o)}C.set(I,n)}},R=function(t){try{return C.get(I)[t]}catch(t){return null}},D="ks_mina_did",x="wxo_",K=function(t){for(var e="",n=0;n<t;n++)e+=(16*Math.random()|0).toString(16);return e},G=function(){var t=W();return t&&-1!==t.indexOf(x)||(t=x+K(36),M(t)),t},W=function(){return R(D)},M=function(t){return t&&L(D,t)},V={route:"",options:{}},j=function(t){return"".concat(t,"_").concat(Date.now(),"_").concat(W())},H=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.identity=o.page?o.generatePageId(o.page):"",o}return o(e,t),e.prototype.generatePageId=function(t){return j(t)},e}(l),Q="https://data-track.corp.kuaishou.com",J=Q+"/",Y="production",B="rest/wd/common/log/collect/",F=[Y,"test","development","logger","oversea"],q="https://logsdk.kwai-pro.com/",z={v2:"rest/kd/log/collect?_json=1&biz=",v3:"".concat(B,"misc2"),radar:"".concat(B,"radar")},$={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:J,test:J,oversea:q},v3:{production:"https://log-sdk.ksapisrv.com/",development:J,test:J,oversea:q}},X=function(t,e,n){return void 0===t&&(t=Y),void 0===e&&(e=!1),void 0===n&&(n="v3"),-1===F.indexOf(t)?t+z[n]:e&&$.v3[t]?$.v3[t]+z.radar:$[n][t]&&z[n]?$[n][t]+z[n]:$.v3.production+z.v3},Z=function(t,e){if(!e)return t;try{return/\?(.+?)$/.test(t)?t.replace(/\?(.+?)$/,"?".concat(e,"&$1")):t+"?".concat(e)}catch(e){return t}},tt=function(){function t(t,e){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.isSetSamplingResult=!1,this.sendingYield=null,this.flush=function(t){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),t),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=t,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=e,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,this.updateUrls()}return t.prototype.sendData=function(t,e){return"function"==typeof this.config.sender?this.config.sender(t,e):this.baseSendData(t,e)},Object.defineProperty(t.prototype,"responseSamplingStorageKey",{get:function(){var t=this.commonPackage.app_package,e=t.product_name,n=t.product,o=this.commonPackage.identity_package.device_id;return"RESPONSE_SAMPLING_STORAGE_KEY_".concat(e||n,"_").concat(o)},enumerable:!1,configurable:!0}),t.prototype.updateUrls=function(){var t=this.config.env;t&&/^(https?:)?\/\//.test(t)?this.url=t:this.url=X(t),this.formatUrl()},t.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf(z.v2)?z.v2:z.v3,z.radar),-1!==this.radarUrl.indexOf($.v2.production||"")&&this.radarUrl.replace($.v2.production||"",$.v3.production));var t=this.commonPackage.app_package,e=t.product_name,n=t.product,o="v=3.10.23&kpn=".concat(e||n);this.url=Z(this.url,o),this.radarUrl=Z(this.radarUrl,o)},t.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},t.prototype.send=function(t,e,n){if(void 0===e&&(e=!1),n||this.drained)return this.sendLogs([t],n);e?this.sendAsync(t,n):this.sendThrottle(t)},t.prototype.sendAsync=function(t,e){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.asyncQueue.push(t),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:e.sent(),this.sendingYield=null,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return e.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},t.prototype.sendThrottle=function(t){var e=this;this.throttleQueue.push(t),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){e.flush()}),this.config.wait))},t.prototype.sendLogs=function(t,e){var n=this;if(!t||!t.length)return"function"==typeof e&&e();var o=this.buildLogPackage(t,this.url);this.sendPackage(o,(function(t){t?n.errHandler(o):n.flushErrorLogs(),"function"==typeof e&&e(t)}))},t.prototype.sendPackage=function(t,e){var n=this.config.timeout;try{this.sendData(r(r({},t),{isDebug:this.isDebug,isDrained:this.drained,timeout:n}),e)}catch(t){"function"==typeof e&&e(t)}},t.prototype.buildLogPackage=function(t,e){return this.isV2?this.buildV2Package(t,e):this.buildV3Package(t,e)},t.prototype.buildV2Package=function(t,e){return{url:e,data:{log:{event:t}}}},t.prototype.buildV3Package=function(t,e,n){var o=this.getCommonPackageJSON();return n&&Object.assign(o,n),{url:e,data:{common:o,logs:t}}},t.prototype.errHandler=function(t){var e;if(this.isV2)this.errorQueue.unshift(t);else{var n=t.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var o=!1,r=0;r<this.errorQueue.length;r++){var a=this.errorQueue[r];if(a.url===t.url&&a.data.logs.length+n.logs.length<=100&&JSON.stringify(a.data.common)===JSON.stringify(n.common)){o=!0,(e=a.data.logs).push.apply(e,n.logs);break}}o||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(t))}}},t.prototype.flushErrorLogs=function(){var t=this;this.errorQueue.forEach((function(e){t.sendPackage(e)})),this.errorQueue=[]},t.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},t.prototype.sendRadar=function(t,e){var n=e?{service_name:e}:void 0,o=this.buildV3Package([t],this.radarUrl||this.url,n);this.sendPackage(o)},t}(),et="app_device_package_ready",nt="identityPackageReady",ot="sessionId",rt="_log_pageAlias",at="_log_pageParams",it=function(t,e,n){return g("[error 400]","埋点上报接口请求报错","\nurl:",e,"\ndata",n,"\nerror:",t||"server decode log failed")},st=function(t,e,n){void 0===t&&(t=Q);var o="".concat(t,"/#/logger/index?sessionId=").concat(n);return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.log;n&&n.call.apply(n,c([console],t,!1))}catch(t){return}}("%c埋点抓包校验: %c".concat(o),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),"".concat(e,"/").concat(n,"/")},ct=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.continueSend=!1,o.baseSendData=function(t){var e=function(t,e){var n=t.url,o=t.data,r=t.timeout;return i(void 0,void 0,void 0,(function(){return s(this,(function(t){o=JSON.stringify(o);try{return[2,new Promise((function(t){S.request({url:n,data:o,header:{"content-type":"text/plain"},headers:{"content-type":"text/plain"},method:"POST",timeout:r,success:function(e){t(null==e?void 0:e.data)},fail:function(r){it(r,n,o),t(void 0),e&&e(r)}})}))]}catch(t){it(t,n,o),e&&e(t)}return[2]}))}))}(t);o.isSetSamplingResult||(o.setResponseSamplingConfig(e),o.isSetSamplingResult=!0)},o.flush=function(t){o.sendLogs(o.throttleQueue.concat(o.asyncQueue),t)&&(o.throttleQueue=[],o.asyncQueue=[])},o.getResponseSamplingStorage(),o}return o(e,t),e.prototype.getResponseSamplingStorage=function(){try{var t=Number(R(this.responseSamplingStorageKey));t&&Date.now()<t?this.sendEffectiveTime=t:t&&L(this.responseSamplingStorageKey,"")}catch(t){}},e.prototype.sendLogs=function(e,n){return!!this.shouldSendPackage()&&(t.prototype.sendLogs.call(this,e,n),!0)},e.prototype.updateUrls=function(t){var e=this.config,n=e.env;if(e.logger||"logger"===n){if(t)return S.request({url:t,method:"GET"}),this.url=t+z.v3;var o=function(){try{var t=W();return t=t.includes("wxo")?t.replace("wxo","web"):"web_".concat(t),S.request({url:"".concat(Q,"/rest/").concat(t),method:"GET"}),st(Q,"".concat(Q,"/rest"),t)}catch(t){}}();o&&(this.url=X(o))}else n&&/^(https?:)?\/\//.test(n)?this.url=n:this.url=X(n);this.formatUrl()},e.prototype.shouldSendPackage=function(){var t=!!u[et],e=u[nt]||!this.config.sendUtilIdentityDone;return t&&e},e.prototype.setResponseSamplingConfig=function(t){var e=this;null==t||t.then((function(t){var n=null==t?void 0:t.expireSeconds;if(n){var o=Date.now()+1e3*n;e.sendEffectiveTime=o,L(e.responseSamplingStorageKey,String(o))}}))},e.prototype.send=function(e,n,o){void 0===n&&(n=!1),t.prototype.send.call(this,e,n,o)},e.prototype.completeLog=function(t){return t.session_id=u.sessionId,t},e}(tt),ut={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(t){t.CLICK="CLICK",t.DOUBLE_CLICK="DOUBLE_CLICK",t.TRIPLE_CLICK="TRIPLE_CLICK",t.LONG_PRESS="LONG_PRESS",t.PULL="PULL",t.DRAG="DRAG",t.SCALE="SCALE",t.PULL_DOWN="PULL_DOWN",t.PULL_UP="PULL_UP",t.AUTO="AUTO"}(b||(b={})),function(t){t.PV="PV",t.SHOW="SHOW",t.VIDEO="VIDEO",t.CUSTOM="CUSTOM",t.CUSTOM_EVENT="CUSTOM_EVENT",t.RADAR="RADAR"}(A||(A={}));var pt,lt,gt,ht,ft,dt=function(t,e){switch(null==t?void 0:t.toLocaleLowerCase()){case"ios":return/ipad/i.test(e)?4:3;case"android":return 1;case"mac":case"windows":return 5}},yt=function(t){pt&&t(pt);try{S.getSystemInfo({success:function(t){void 0===t&&(t={}),pt=r(r({},t),{mpVersion:t.version,mpSDKVersion:t.SDKVersion,platform:dt(t.platform,t.model)||0})},complete:function(){t(pt)}})}catch(e){t(pt)}},vt=function(t){lt&&t(lt);try{S.getNetworkType({success:function(t){lt=function(t){return t=t.toLocaleLowerCase(),ut[t]||ut.unknown}(t.networkType)},complete:function(){t(lt)}})}catch(e){t(lt)}},_t={},mt=function(t){try{var e=Number(R(t))||0;return e+1>1e8&&(e=0),L(t,e+1),e}catch(t){}return _t[t]||(_t[t]=0),_t[t]++},Et="WEBLOGGER_HEART_BEAT_INCREAMENT_ID_KEY",Pt=0,kt=function(t){void 0===t&&(t=Date.now()),Pt=t},Tt=12e4,St=function(){return{upload_frequency:Tt,seq:mt(Et)+1,app_use_duration:d(Date.now()-Pt),event_name:"HEART_BEAT_EVENT"}};function Ut(t,e,n,o){return{cold:o,target:e,mode:o?ht.C:ht.H,source:n,detail:JSON.stringify({scene:n}),event_name:ft.L}}!function(t){t.SHOW_TIME="app_show_time",t.HIDE_TIME="app_hide_time",t.STAY="stay_length"}(gt||(gt={})),function(t){t[t.C=1]="C",t[t.H=2]="H",t[t.E=2]="E"}(ht||(ht={})),function(t){t.L="LAUNCH_EVENT",t.U="APP_USAGE_STAT_EVENT",t.E="EXCEPTION_EVENT",t.S="SHOW",t.D="DEVICE_STAT_EVENT"}(ft||(ft={}));var Ot=!1,Nt=function(t,e,n,o){void 0===n&&(n=3e4),void 0===o&&(o=0);var a=0,i=0;return{onLaunch:[function(){yt((function(e){if(e){var n=e.system,o=e.model,r=e.screenWidth,a=e.screenHeight,i=e.batteryLevel,s={os_version:n,model:o,density_dpi:0,screen_width:d(r),screen_height:d(a),battery:i,event_name:ft.D};t(s)}}))},function(){kt(),e.on("updateSessionId",(function(){L(Et,0)})),i=setInterval((function(){var e=St();t(e,"App",!0),kt()}),Tt)}],onShow:[function(o){var r=o.path,i=o.query,s=o.scene;clearTimeout(a),a=0;var c=Date.now(),u=c-R(gt.SHOW_TIME);L(gt.SHOW_TIME,c);var p=function(t,e){void 0===t&&(t=""),void 0===e&&(e={});for(var n=-1===t.indexOf("?")?"?":"&",o=[],r=0,a=Object.keys(e);r<a.length;r++){var i=a[r],s=e[i]||"";o.push("".concat(encodeURIComponent(i),"=").concat(encodeURIComponent(s)))}return o.length&&(t+=n+o.join("&")),t}(r,i),l=null;0!==getCurrentPages().length&&Ot||(l=Ut(0,p,s,!0),Ot=!0),u>n&&(e&&e.updateSessionId&&e.updateSessionId(),l=Ut(0,p,s,!1)),l&&t(l)},function(){0===i&&(kt(),i=setInterval((function(){var e=St();t(e,"App",!0),kt()}),Tt))}],onHide:[function(){var n=+o||0;e&&e.flush();var i=R(gt.SHOW_TIME),s=Date.now(),c=s-i;c=c<0?0:c;var u=R(gt.STAY),p=u?u+c:c;L(gt.HIDE_TIME,s),L(gt.STAY,p),a=setTimeout((function(){var n=r({app_use_duration:d(R(gt.STAY)),event_name:ft.U},e.currentUrlPackage.toJSON());L(gt.STAY,0),t(n)}),n)},function(){var e=St();t(e,"App",!0),kt(),clearInterval(i),i=0}]}};function bt(t){if(App){var e=App;App=function(n){return function(t,e){var n=function(n){if(Object.prototype.hasOwnProperty.call(t,n)){var o=t[n];!function(t,e,n,o){if(void 0===o&&(o=!1),e in t||o){var r=n(t[e]);"function"==typeof r&&(t[e]=r)}}(e,n,(function(t){return function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];o&&(Array.isArray(o)||(o=[o]),o.forEach((function(t){t.apply(e,n)}))),t&&t.apply(this,n)}}),!0)}};for(var o in t)n(o)}(t,n),e(n)}}}var At,Ct,It,wt={launchIntervalLimit:3e4,backgroundWaitingLimit:0},Lt=function(t){function e(e,n,o){void 0===o&&(o=wt);var r=t.call(this)||this;return r.config={},r.config=o,e&&r.apply(e),r.proxy(),r}return o(e,t),e.prototype.proxy=function(){bt(this.getAppConfig())},e.prototype.getAppConfig=function(){return this.config.App?this.config.App:Nt(this.send.bind(this),this.weblog,this.config.launchIntervalLimit,this.config.backgroundWaitingLimit)},e.prototype.apply=function(t){(null==t?void 0:t.collect)&&(this.weblog=t)},e.prototype.send=function(t,e,n){if(void 0===e&&(e="App"),void 0===n&&(n=!1),t){var o=t&&t.event_name?t.event_name:"CUSTOM_STAT_EVENT",a="App"===e?o:"SHOW";delete t.event_name,n?this.weblog.sendImmediately(a,r({},t)):this.weblog.collect(a,r({},t))}},e.prototype.destroy=function(){},e.key="minaAutoPV",e}(e);!function(t){var e,n,o,r,a,i,s,c;(e=t.ElementStatus||(t.ElementStatus={}))[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.CHECKED=1]="CHECKED",e[e.UNCHECKED=2]="UNCHECKED",(n=t.PageShowAction||(t.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(o=t.ActionStatus||(t.ActionStatus={}))[o.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",o[o.SUCCESS=1]="SUCCESS",o[o.FAIL=2]="FAIL",(r=t.ActionType||(t.ActionType={}))[r.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",r[r.CLICK=1]="CLICK",r[r.LEFT_PULL=2]="LEFT_PULL",r[r.RIGHT_PULL=3]="RIGHT_PULL",r[r.UP_PULL=4]="UP_PULL",r[r.DOWN_PULL=5]="DOWN_PULL",(a=t.SubAction||(t.SubAction={}))[a.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",a[a.PAGE_ENTER=1]="PAGE_ENTER",a[a.PAGE_LEAVE=2]="PAGE_LEAVE",a[a.PAGE_RESUME=3]="PAGE_RESUME",a[a.PAGE_PAUSE=4]="PAGE_PAUSE",(i=t.Direction||(t.Direction={}))[i.UNKNOWN2=0]="UNKNOWN2",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i[i.LEFT=3]="LEFT",i[i.RIGHT=4]="RIGHT",(s=t.TaskStatus||(t.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=t.OperationType||(t.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(At||(At={})),function(t){var e,n;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT",(n=t.TaskEventType||(t.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(Ct||(Ct={})),function(t){var e;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN2=0]="UNKNOWN2",e[e.PAGE=1]="PAGE"}(It||(It={}));var Rt,Dt=!0,xt=(new Date).valueOf(),Kt=function(t,e){var n,o;void 0===e&&(e=!1);var a=t.type,i=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=void 0===c?"":c,p=t.action,l=t.beginTime,g=t.params,h=t.contentPackage,f=t.status,y=t.actionType,v=t.auto,_=((n={status:f?At.ActionStatus[f]||At.ActionStatus.UNKNOWN_STATUS:At.ActionStatus.SUCCESS})[e?"show_type":"action_type"]=y?At.ActionType[y]||At.ActionType.UNKNOWN_ACTION_TYPE:At.ActionType.CLICK,n.url_package=i,n.refer_url_package=s,n[e?"content_wrapper":"content_package"]=h,n);if("PV"===a){var m=At.SubAction.PAGE_ENTER,E=At.PageShowAction.ENTER,P=Dt,k=0;switch(Dt=!1,p){case"leave":E=At.PageShowAction.LEAVE,m=At.SubAction.PAGE_LEAVE,k=d((new Date).valueOf()-(l||xt));break;case"enter":E=At.PageShowAction.ENTER,m=At.SubAction.PAGE_ENTER,xt=(new Date).valueOf();break;case"visible":E=At.PageShowAction.RESUME,m=At.SubAction.PAGE_RESUME,xt=(new Date).valueOf();break;case"hidden":E=At.PageShowAction.LEAVE,m=At.SubAction.PAGE_PAUSE,k=d((new Date).valueOf()-(l||xt))}var T=v?Ct.ShowType.PAGE_AUTO:Ct.ShowType.PAGE_CUSTOM;return e&&(P=void 0,T=It.ShowType.PAGE),{show_event:r({action:E,sub_action:m,type:T,first_load:P,time_cost:0,stay_length:k},_)}}return{show_event:r({action:e?0:At.PageShowAction.ENTER,type:e?0:Ct.ShowType.ELEMENT,sub_action:e?0:At.SubAction.PAGE_ENTER,element_package:(o={},o[e?"action2":"action"]=u,o.params=JSON.stringify(g),o)},_)}},Gt=function(t,e){var n,o;void 0===e&&(e=!1);var a=t.sessionId,i=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=t.params,p=t.type,l=t.contentPackage,g=t.status,h=t.taskType,f=t.operationDirection,d=((n={url_package:i,refer_url_package:s,element_package:(o={},o[e?"action2":"action"]=c,o.params=JSON.stringify(u),o)})[e?"content_wrapper":"content_package"]=l,n);if(e){var y="USER_OPERATION"===h||"CLICK"===p&&!h,v=p&&At.OperationType[p]||At.OperationType.CLICK;return y?{click_event:r({type:v,direction:f&&At.Direction[f]||At.Direction.UNKNOWN2},d)}:{task_event:r({action2:c,status:g&&At.TaskStatus[g]||At.TaskStatus.UNKNOWN_STATUS},d)}}return{task_event:r({type:h&&Ct.TaskEventType[h]||Ct.TaskEventType.USER_OPERATION,status:g&&At.TaskStatus[g]||At.TaskStatus.UNKNOWN_STATUS,operation_type:At.OperationType[p]||At.OperationType.CLICK,operation_direction:f&&At.Direction[f]||At.Direction.UNKNOWN2,session_id:a},d)}},Wt=function(t){var e=t.name,n=t.params,o=t.currentUrlPackage,i=t.referUrlPackage,s=a(t,["name","params","currentUrlPackage","referUrlPackage"]);return{key:e,value:JSON.stringify(r(r({url_package:o,refer_url_package:i},n),s))}},Mt=function(t){var e=t.currentUrlPackage,n=t.referUrlPackage,o=t.options;return{video_stat_event:r(r({},o),{url_package:e,refer_url_package:n})}},Vt=(Rt=(new Date).getTimezoneOffset()/60)<=0?"GMT+".concat(h(-Rt+"",2,"0"),":00"):"GMT-".concat(h(Rt+"",2,"0"),":00"),jt=function(){function t(t,e){void 0===e&&(e=!1),this.client_timestamp=d((new Date).valueOf()),this.client_increment_id=0,this.session_id=u.sessionId,this.event_id="",e||(this.time_zone=Vt),Object.assign(this,t),this.genIncrementId()}return t.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?mt("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):mt("WEBLOGGER_INCREAMENT_ID_KEY")},t.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},t.prototype.getEventType=function(){if(this.event_package){var t=this.event_package,e=t.task_event,n=t.show_event,o=t.click_event,r=t.custom_event;if(n)return"showEvent";if(o)return"clickEvent";if(e)return"taskEvent";if(r)return"customEvent"}return"customEvent"},t}();function Ht(t,e,n){var o;void 0===n&&(n=!1);var r,i=e.eventId,s=e.currentUrlPackage,c=e.referUrlPackage,p=e.contentPackage,l=e.name,g=e.params;switch(n&&"RADAR"!==t&&"CUSTOM"!==t&&(s&&(s.page2=s.page,delete s.page),c&&(c.page2=c.page,delete c.page)),t){case"PV":case"SHOW":return new jt({event_package:Kt({type:t,status:e.status,currentUrlPackage:s,referUrlPackage:c,action:e.type,beginTime:e.beginTime,actionType:e.actionType,name:l,params:g,contentPackage:p,operationDirection:e.operationDirection,auto:e.auto},n),event_id:i},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var h=Wt({name:l,params:g,currentUrlPackage:s,referUrlPackage:c});return new jt(n?{event_package:{custom_event:h},event_id:i}:{stat_package:{custom_stat_event:h},event_id:i},n);case"RADAR":return new jt({stat_package:{custom_stat_event:Wt({name:l,params:g,currentUrlPackage:s,referUrlPackage:c})},event_id:i},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new jt({stat_package:(o={},o[t.toLowerCase()]=(r=e,r.currentUrlPackage,r.referUrlPackage,r.taskType,a(r,["currentUrlPackage","referUrlPackage","taskType"])),o)},n);case"VIDEO":return new jt(n?{stat_package:Mt({currentUrlPackage:s,referUrlPackage:c,options:g.params})}:{event_package:Gt({type:t,status:e.status,taskType:e.taskType,sessionId:u.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:g.params,contentPackage:p},n),event_id:i},n);default:return new jt({event_package:Gt({type:t,status:e.status,taskType:e.taskType,sessionId:u.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:g,contentPackage:p},n),event_id:i},n)}}var Qt=function(){function t(t){this._tagQueue=[],this._stashQueue=[],this._identityQueue=[],this.weblog=t}return t.prototype.getEntryTags=function(){return this._tagQueue},t.prototype.setEntryTag=function(t){return this._stashQueue.push(t)},t.prototype.shouldConsume=function(){return this._stashQueue.length>0},t.prototype.pushState=function(t){this._tagQueue.push(this._stashQueue.pop()),this._identityQueue.push(t)},t.prototype.ifIdentityEmpty=function(t){if(!t)throw new Error("Identity is required")},t.prototype.ifIdentityRepeat=function(t){if(this._identityQueue.indexOf(t)>0)throw new Error("Identity ".concat(t," is already exist. Please change a new one.\n Current identity list: ").concat(this._identityQueue.join(", ")))},t.prototype.consumeEntryTag=function(t){this.ifIdentityEmpty(t),this.ifIdentityRepeat(t),this.weblog.flush(),this.shouldConsume()&&(this.pushState(t),this.updateCommonGlobalAttr())},t.prototype.updateCommonGlobalAttr=function(){var t=this.getEntryTags();return t.length&&this.weblog.commonPackage.updateGlobalAttr({entry_tag:t}),t},t.prototype.clearEntryTag=function(t,e){void 0===e&&(e=!0),this.ifIdentityEmpty(t);var n=this._identityQueue.indexOf(t);if(-1!==n){n=e?n:n+1;for(var o=this._identityQueue.length-n;o>0;)this._tagQueue.pop(),this._identityQueue.pop(),o--;this.updateCommonGlobalAttr()}},t}(),Jt=function(){function t(t){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:ut.unknown},this.h5_extra_attr={sdk_name:"webLogger_mina",sdk_version:"3.10.23",sdk_bundle:"log.mina.js"},this.global_attr={entry_tag:[]},this.location_package={country:void 0,province:void 0,city:void 0,county:void 0,street:void 0,latitude:void 0,longitude:void 0},this.update(t),this.app_package.version_name){var e=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(e+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return t.prototype.getH5ExtraAttr=function(t){return Object.assign({},this.h5_extra_attr,t)},t.prototype.update=function(t){if("object"==typeof t){!function(t,e){if(f(t)&&f(e)){var n=function(t,e,n){f(t[n])&&f(e[n])?Object.assign(t[n],e[n]):f(t[n])||f(e[n])||(t[n]=e[n])};for(var o in e)if(t.hasOwnProperty(o))n(t,e,o);else for(var r in t)f(t[r])&&t[r].hasOwnProperty(o)&&n(t[r],e,o)}}(this,t);var e=t.network_type;e&&ut[e]&&(this.network_package.type=ut[e])}},t.prototype.updateGlobalAttr=function(t){Object.assign(this.global_attr||{},t)},t.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var t=r(r({},this),{toJSON:function(){return r(r({},t),{h5_extra_attr:JSON.stringify(t.h5_extra_attr),global_attr:JSON.stringify(t.global_attr)})}});t.global_attr=r({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?t.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete t.global_attr.entry_tag,Object.keys(this.global_attr).length||delete t.global_attr;var e=this.location_package;return e&&Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t]})),t},t}(),Yt="cookie",Bt=new(function(){function t(){}return Object.defineProperty(t.prototype,"cookie",{get:function(){return C.get(Yt)||{}},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e,n,o){if(e!==this.get(t)){var a=this.cookie;"object"==typeof t?a=r(r({},a),t):a[t]=e,C.set(Yt,a,n,o)}},t.prototype.get=function(t){return this.cookie[t]},t.prototype.remove=function(t){var e=C.getCompleteStorage(Yt),n=e.value,o=e.expirationTime,r=n[t]&&delete n[t];return C.set(Yt,n,o),r},t.prototype.toCookieString=function(){var t=[];for(var e in this.cookie){var n=void 0;try{e=(e=e.replace(/[^#$&+^`|]/g,encodeURIComponent)).replace(/\(/g,"%28").replace(/\)/g,"%29"),n=(this.cookie[e]+"").replace(/[^!#$&-+\--:<-[\]-~]/g,encodeURIComponent)}catch(t){continue}t.push(e+"="+n)}return t.join("; ")},t}()),Ft=function(t){function e(e,n){var o=t.call(this,r({container:T()},e))||this;return o.updateSystemInfo(e||{}),o}return o(e,t),e.prototype.updateSystemInfo=function(t){var e=this;yt((function(n){if(n){var o=n.platform,a=n.language,i=n.system,s=n.model,c=n.brand,u=n.screenHeight,l=n.screenWidth,g=n.pixelRatio,h=n.mpSDKVersion,f=n.mpVersion;e.update(r(r({platform:o,app_package:{language:a},device_package:{os_version:i,ua:"",model:JSON.stringify({model:s,brand:c})}},t),{h5_extra_attr:r({screen_with:Math.floor(l),screen_height:Math.floor(u),device_pixel_ratio:g,resolution:"".concat(Math.floor(l*g),"x").concat(Math.floor(u*g)),mpSDKVersion:h,mpVersion:f},t.h5_extra_attr)}))}p(et,!0)})),vt((function(t){e.update({network_package:{type:t}})}))},e.prototype.checkMustProps=function(){"string"!=typeof this.app_package.product_name&&g("请设置有效的 product_name 值!")},e.prototype.toJSON=function(){return this.identity_package.user_id||(this.identity_package.user_id=Bt.get("userId")||Bt.get("userName")||""),t.prototype.toJSON.call(this)},e}(Jt),qt=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.entryTag=null,o.perennialExtra={},o.commonPackage=new Ft(o.baseOption,o.logConfig),C.get(I)||C.set(I,w),o.updateCommonPackage({device_id:G()}),o.logger=new ct(o.logConfig,o.commonPackage),o.entryTag=new Qt(o),o.initBuildInPlugins(),o.setPerennialExtra(o.commonPackage.h5_extra_attr),o.updateSessionId(o.commonPackage.identity_package.device_id),o.initUrlPackage(),o.addPlugins(),o}return o(e,t),e.prototype.initUrlPackage=function(){var t=getCurrentPages()[getCurrentPages().length-1]||V;this.updateCurrentUrlPackage({page:t[rt],params:t[at]})},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e="mina"),"object"==typeof t&&!t.force&&this.currentUrlPackage){var n=t.page,o=void 0===n?this.currentUrlPackage.page:n,r=t.params,a=void 0===r?{}:r;if(o===this.currentUrlPackage.page)return this.currentUrlPackage.update(o,a)}this.currentUrlPackage=new H(t,e)},e.prototype.generateLog=function(t,e,n){var o,a,i,s,c;void 0===n&&(n=Ht);var u=e,p=u.action,l=u.params,g=u.status,h=u.type,f=u.eventId,d=u.contentPackage,y=u.urlPage,v=this.referUrlPackage?null===(o=this.referUrlPackage)||void 0===o?void 0:o.toJSON():void 0;d&&(d="string"==typeof d?d:JSON.stringify(d));var _={currentUrlPackage:null===(a=this.currentUrlPackage)||void 0===a?void 0:a.toJSON(),referUrlPackage:v,contentPackage:d};if(t===A.PV){var m=e.type;return n(t,r(r(r({},e),{type:m}),_))}if("object"==typeof y){var E=y.page,P=y.identity,k=y.params;E&&_.currentUrlPackage.page!==E?_.currentUrlPackage={page:E,identity:P||j(E),params:JSON.stringify(k),page_type:null===(i=this.currentUrlPackage)||void 0===i?void 0:i.page_type,category:""}:k&&(null===(s=this.currentUrlPackage)||void 0===s||s.update("",k),_.currentUrlPackage=null===(c=this.currentUrlPackage)||void 0===c?void 0:c.toJSON(),P&&(null==_?void 0:_.currentUrlPackage)&&(_.currentUrlPackage.identity=P))}if(t===A.SHOW){var T=e.action;return n(t,r(r(r({},e),{name:T}),_))}if(-1!==[A.CUSTOM,A.RADAR,A.CUSTOM_EVENT].indexOf(t)){var S=e,U=S.key,O=S.value,N=S.eventId;return n(A.CUSTOM,r(r(r({},e),{params:O,eventId:N,name:U}),_))}return t===A.RADAR?n(t,e):n(t,r(r(r({},e),{params:l,status:g,taskType:h,eventId:f,name:p}),_))},e.prototype.updateReferUrlPackage=function(e,n){void 0===e&&(e=this.currentUrlPackage),void 0===n&&(n="mina"),t.prototype.updateReferUrlPackage.call(this,e,n)},e.prototype.getEntryTags=function(){return this.entryTag&&this.entryTag.getEntryTags()},e.prototype.setEntryTag=function(t){return this.entryTag&&this.entryTag.setEntryTag(t)},e.prototype.consumeEntryTag=function(t){return this.entryTag&&this.entryTag.consumeEntryTag(t)},e.prototype.clearEntryTag=function(t,e){return void 0===e&&(e=!0),this.entryTag&&this.entryTag.clearEntryTag(t,e)},e.prototype.initBuildInPlugins=function(){this.logConfig.minaAutoPV&&this.plug(Lt)},e.prototype.init=function(t,n){return t.batchReportInterval&&(t.wait=t.batchReportInterval,delete t.batchReportInterval),new e(t,n)},e.prototype.track=function(t){var e=t.operation,n=t.elementAction,o=t.elementParam,r=t.contentPackage,a=t.status,i=t.type;this.collect(e,{action:n,params:o,type:i,status:a,contentPackage:r})},e.prototype.sendPV=function(t){var e=t.type,n=t.actionType,o=t.status,r=t.elementAction,a=t.elementParam,i=t.contentPackage,s="ELEMENT"===e?"SHOW":"PV";this.collect(s,{action:r,actionType:n,params:a,name:r,type:e,status:o,contentPackage:i})},e.prototype.setPage=function(t){var e,n,o=t.page,r=t.pageParam;(null===(e=this.currentUrlPackage)||void 0===e?void 0:e.page)&&(null===(n=this.currentUrlPackage)||void 0===n?void 0:n.page)!==o&&this.updateReferUrlPackage(),this.updateCurrentUrlPackage({page:o,params:r})},e.prototype.sendCustomEvent=function(t){this.collect("CUSTOM",t)},e.prototype.genWebloggerParams=function(t){var e=t.did,n=t.uid,o=t.unionid,a=t.openid;return r({device_id:e,user_id:n,union_id:o,open_id:a},t)},e.prototype.setPublicParam=function(t){var e,n=this.genWebloggerParams(t),o=n.did;if(o){var r=W();r&&r.indexOf(x)>=0&&this.setExtraInfo({ksminaDid:r},!0),u.sessionId&&u.sessionId.indexOf(x)>=0&&this.updateSessionId(o),M(o)}for(var a in n)if(Object.prototype.hasOwnProperty.call(n,a)){var i=n[a];void 0!==i&&this.updateCommonPackage(((e={})[a]=i,e))}p(nt,!0)},e.prototype.sendExceptionEvent=function(t){this.collect("EXCEPTION_EVENT",t)},e.prototype.setSystemInfo=function(){},e.prototype.setLoggerSessionUrl=function(t){this.logger.config.env="logger",this.logger.updateUrls(t)},e.prototype.setExtraInfo=function(t,e){void 0===e&&(e=!1);var n=r(r({},this.perennialExtra),t);e||(this.commonPackage.h5_extra_attr={}),this.updateCommonPackage({h5_extra_attr:n})},e.prototype.setPerennialExtra=function(t){this.perennialExtra=r(r({},this.perennialExtra),t),this.setExtraInfo({},!0)},e.prototype.updateSessionId=function(t){p(ot,function(t){var e=t||W();return e?e+Date.now():""}(t)),this.emit("updateSessionId")},e.prototype.setCommonPackageReady=function(){p(nt,!0)},e.prototype.beforeSend=function(t,e){var n,o,a;if("CLICK"===t){var i=null==e?void 0:e.entryTag;i&&this.setEntryTag(r({page_name:null===(n=this.currentUrlPackage)||void 0===n?void 0:n.page,element_action:null==e?void 0:e.action},i))}else if("PV"===t){var s=e,c=null==s?void 0:s.type;if(!c||"enter"===c){!(null===(o=this.currentUrlPackage)||void 0===o?void 0:o.page)&&(null==s?void 0:s.page)&&this.updateCurrentUrlPackage({page:s.page,params:s.params});var u=null===(a=this.currentUrlPackage)||void 0===a?void 0:a.identity;this.clearEntryTag(u),this.consumeEntryTag(u)}}},e.prototype.collect=function(t,e){void 0===e&&(e={}),this.send(t,e)},e.prototype.sendImmediately=function(t,e){void 0===e&&(e={}),this.send(t,e,!0)},e.prototype.send=function(t,e,n){this.beforeSend(t,e);var o=this.generateLog(t,e);if("RADAR"===t)return this.logger.sendRadar(o,null==e?void 0:e.serviceName);var r="object"==typeof e&&e.callback||void 0;this.logger.send(o,!!n,r)},e}(_);t.BasePlugin=e,t.Weblog=qt,t.default=qt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=log.mina.js.map
