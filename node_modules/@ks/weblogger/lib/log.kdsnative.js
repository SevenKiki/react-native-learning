!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Weblog={})}(this,(function(t){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function a(t,e,a){if(a||2===arguments.length)for(var r,n=0,i=e.length;n<i;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}var r;function n(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var r=null===console||void 0===console?void 0:console.error;return r&&r.call.apply(r,a([console],t,!1))}catch(t){return}}function i(t){return"string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""}var o="REACT_NATIVE";function s(){return o}var c,g=function(t){t.data.container=o,t.data.page_type="NATIVE";try{r(t,(function(t,e){1!==t&&n("setClientLog error",t,e)}))}catch(t){n("yoda invoke error")}},u=function(t,e,a,r){var n;void 0===e&&(e={}),"string"!=typeof t&&(n=t.type),n=t.toUpperCase();var i={};if("string"==typeof e)i.contentPackage=r,"CUSTOM"===t?(i.key=e,i.value=a):(i.params=a,"PV"===t?i.page=e:i.action=e);else if(i=e,["CUSTOM","CUSTOM_EVENT"].includes(n)){var o=e;o.action&&!o.key&&(i.key=o.action),o.params&&!o.value&&(i.value=o.params)}return[n,i]},l=0,p=function(){function t(t,a){this.h5ExtraAttr={sdk_name:"weblogger_kds_native",sdk_version:"3.10.23",sdk_bundle:"log.kdsnative.js",coPage:!1},this.version=this.h5ExtraAttr.sdk_version,this.currentUrlPackage={page:"",params:{},identity:"",coPage:!1},this.plugins={},this.entered="",this.logConfig=e({},t),Object.assign(this.h5ExtraAttr,null==a?void 0:a.h5_extra_attr),this.addPlugins()}return Object.defineProperty(t.prototype,"commonPackage",{get:function(){return{h5_extra_attr:this.h5ExtraAttr}},enumerable:!1,configurable:!0}),t.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},t.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(l++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},t.prototype.plug=function(t,e){if(this.plugins[t.key])throw new Error("There is a duplex plugin called ".concat(t.key));this.addPluginInstance(new t(this,e))},t.prototype.send=function(a,r,n){a=a.toUpperCase();var o,c=this.h5ExtraAttr,u=r,l=u.action,p=u.contentPackage,d=u.params,f=u.areaPackage,h=u.type,P=u.feedLogCtx,y=u.status,v=u.disablePV,k=u.urlPage,x=u.bridgeFields;if("PV"===a){if(this.logConfig.disablePV)return;var m=r,E=m.page,C=void 0===E?this.currentUrlPackage.page:E,b=m.type,T=void 0===b?"enter":b,A=m.coPage,U=m.timeCost,_=m.status,O=m.category,N=t.kdsUtils.appVersion;if("leave"===T&&this.currentUrlPackage.coPage&&N&&function(t,e){if(!e)return!1;if(-1!==e.indexOf("alpha"))return!1;if(-1!==e.indexOf("beta"))return!1;try{var a=t.match(/\d+\.\d+\.\d+/);if(!(t=(null==a?void 0:a[0])||""))return!0;if(a=e.match(/\d+\.\d+\.\d+/),!(e=(null==a?void 0:a[0])||""))return!1;var r=t.split(".").map((function(t){return Number(t)})),n=r[0],i=r[1],o=r[2],s=e.split(".").map((function(t){return Number(t)})),c=s[0],g=s[1],u=s[2];return!(c<n||!(c>n)&&(g<i||!(g>i)&&u<o))}catch(t){return!1}}("10.8.30",N))return void function(t){g({type:"closeCoPage",data:t})}(e(e({},this.currentUrlPackage),r));if("enter"!==T&&"visible"!==T)return;if("enter"===T&&(C&&(this.currentUrlPackage={page:C,coPage:!1,params:d,identity:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},this.entered=C),A&&(this.currentUrlPackage.coPage=A,this.h5ExtraAttr.coPage=A),O&&(this.currentUrlPackage.category=O)),this.currentUrlPackage.params=e(e({},this.currentUrlPackage.params||{}),d),!this.currentUrlPackage.page)return;return function(t,e){var a=e||{},r=a.params,n=a.contentPackage,o=a.identity,s=a.h5ExtraAttr,c=a.coPage,u=a.feedLogCtx,l=a.status,p=a.timeCost,d=void 0===p?0:p;g({type:"setCurrentPage",data:{page:t,identity:o,params:i(r),contentPackage:i(n),h5ExtraAttr:JSON.stringify(s),action:"PV",pageType:"NATIVE",coPage:c,feedLogCtx:u,status:l,timeCost:d}})}(this.currentUrlPackage.page,e(e({},this.currentUrlPackage),{contentPackage:p,feedLogCtx:P,h5ExtraAttr:c,status:_,timeCost:U,bridgeFields:x}))}if(null==k?void 0:k.page)o={page:k.page,identity:k.identity,params:"REACT_NATIVE"===s()?k.params:i(k.params)};else{var S="REACT_NATIVE"===s()?this.currentUrlPackage:e(e({},this.currentUrlPackage),{params:i(this.currentUrlPackage.params)});o=this.logConfig.disablePV||v||!this.currentUrlPackage.page?void 0:S}if("SHOW"===a)return function(t,a){var r=a||{},n=r.params,o=r.contentPackage,s=r.areaPackage,c=r.urlPage,u=r.h5ExtraAttr,l=r.feedLogCtx,p=r.status,d=r.bridgeFields;g({type:"addElementShowEvent",data:e(e({},d),{action:t,params:i(n),urlPage:c,areaPackage:s,contentPackage:i(o),h5ExtraAttr:JSON.stringify(u),feedLogCtx:l,status:p})})}(l,{urlPage:o,params:d,contentPackage:p,areaPackage:f,h5ExtraAttr:c,feedLogCtx:P,status:y,bridgeFields:x});if("CLICK"===a&&(!h||"USER_OPERATION"===h)){var V=r.entryTag;return function(t,a){var r=a||{},n=r.params,o=r.contentPackage,s=r.areaPackage,c=r.urlPage,u=r.entryTag,l=r.h5ExtraAttr,p=r.feedLogCtx;r.status;var d=r.bridgeFields;g({type:"addTaskEvent",data:e(e({},d),{action:t,params:i(n),urlPage:c,areaPackage:s,contentPackage:i(o),entryTagInfo:u,h5ExtraAttr:JSON.stringify(l),feedLogCtx:p,type:"USER_OPERATION"})})}(l,{urlPage:o,params:d,areaPackage:f,contentPackage:p,entryTag:V?e({page_name:this.currentUrlPackage.page,element_action:l},V):void 0,h5ExtraAttr:c,feedLogCtx:P,status:y,bridgeFields:x})}if(["CUSTOM_EVENT","CUSTOM"].includes(a)){var L=r,I=L.key,j=L.value,w=L.biz,F="CUSTOM_EVENT"===a;return function(t,a,r){void 0===r&&(r=!1);var n=a||{},o=n.value,s=n.biz,c=n.contentPackage,u=n.areaPackage,l=n.urlPage,p=n.h5ExtraAttr,d=n.bridgeFields;g({type:r?"addCustomEvent":"addCustomStatEvent",data:e(e({},d),{key:t,value:i(o),urlPage:l,areaPackage:u,contentPackage:i(c),h5ExtraAttr:JSON.stringify(p),biz:s})})}(I||l,{urlPage:o,value:e(e({},j||d),{url_package:o}),biz:w||this.logConfig.biz,areaPackage:f,contentPackage:p,h5ExtraAttr:c,feedLogCtx:P,bridgeFields:x},F)}return function(t,a){var r=a||{},n=r.params,o=r.contentPackage,s=r.areaPackage,c=r.urlPage,u=r.entryTag,l=r.type,p=r.h5ExtraAttr,d=r.feedLogCtx,f=r.status,h=r.bridgeFields;g({type:"addTaskEvent",data:e(e({},h),{action:t,params:i(n),urlPage:c,areaPackage:s,contentPackage:i(o),entryTagInfo:u,h5ExtraAttr:JSON.stringify(p),feedLogCtx:d,type:l||"BACKGROUND_TASK_EVENT",status:f})})}(l,{urlPage:o,params:d,areaPackage:f,contentPackage:p,h5ExtraAttr:c,type:h,feedLogCtx:P,bridgeFields:x,status:y})},t.prototype.collect=function(t,e,a,r){var n=u(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!1)},t.prototype.sendImmediately=function(t,e,a,r){var n=u(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!0)},t.prototype.flush=function(){},t.prototype.updateCommonPackage=function(t){(null==t?void 0:t.h5_extra_attr)&&Object.assign(this.h5ExtraAttr,t.h5_extra_attr)},t.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=""),"object"==typeof t&&t){var a=t.page,r=void 0===a?this.currentUrlPackage.page:a,n=t.params,i=void 0===n?{}:n;if(!(this.entered===r))return void(this.currentUrlPackage.params=Object.assign(this.currentUrlPackage.params||{},i));this.send("PV",{type:"visible",params:t.params})}},t.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage)},t}(),d=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}();r=function(t,e){var a;null===KwaiBridgeCenter||void 0===KwaiBridgeCenter||KwaiBridgeCenter.commonBridge(JSON.stringify({nameSpace:"tool",methodName:"iOS"===(null===(a=null===Tachikoma||void 0===Tachikoma?void 0:Tachikoma.env)||void 0===a?void 0:a.platform)?"setClientLog":"setClientLogAsync",params:t}),(function(t,a){var r=JSON.parse(t);e&&e(r.result,a)}))},o="KDS_NATIVE"||"REACT_NATIVE",p.kdsUtils={appVersion:null===(c=null===Tachikoma||void 0===Tachikoma?void 0:Tachikoma.env)||void 0===c?void 0:c.appVersion},t.BasePlugin=d,t.Weblog=p,t.default=p,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=log.kdsnative.js.map
