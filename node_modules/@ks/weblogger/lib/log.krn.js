!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react-native")):"function"==typeof define&&define.amd?define(["exports","react-native"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Weblog={},e.reactNative)}(this,(function(e,t){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}var r=function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function o(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}function i(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{c(a.next(e))}catch(e){o(e)}}function s(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))}function s(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function c(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var u={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},p=function(){function e(e,t){switch(this.page="",this.identity="",t){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(e.page,e.params)}return e.prototype.update=function(e,t){void 0===e&&(e=""),e&&e!==this.page&&(this.page=e,this.identity=this.generatePageId(e)),t&&(this.params=Object.assign(this.params||{},t))},e.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params),category:this.category}},e.prototype.generatePageId=function(e){return e+(new Date).getTime()},e}();function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.log;return n&&n.call.apply(n,c([console],e,!1))}catch(e){return}}function g(e,t,n){if(void 0===n&&(n=" "),(t-=e.length)<=0)return e;for(var a="";t;)1&t&&(a+=n),t>>=1,n+=n;return a+e}function f(e){for(var t={},n=0,a=e.split("&");n<a.length;n++){var r=a[n].split("="),o=r[0],i=r[1];o in t?t[o]instanceof Array?t[o].push(i):t[o]=[t[o],i]:t[o]=i}return t}function d(e){void 0===e&&(e=location.href);var t=e.lastIndexOf("?");return-1===t?{page:e}:{page:e.slice(0,t),params:f(e.slice(t+1))}}var h=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},v=function(e){try{return Math.abs(Math.floor(e))}catch(t){return e}},_=function(){function e(){this.events={}}return e.prototype.on=function(e,t){var n;t&&"function"==typeof t&&(this.events[e]=this.events[e]||[],null===(n=this.events[e])||void 0===n||n.push(t))},e.prototype.off=function(e,t){if(this.events[e]){if(t&&"function"==typeof t){var n=this.events[e];n&&(r=t,(o=(a=n).indexOf(r))>-1&&a.splice(o,1))}var a,r,o;t||(this.events[e]=[])}},e.prototype.emit=function(e){for(var t,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];this.events[e]&&(null===(t=this.events[e])||void 0===t||t.forEach((function(e){e.apply(void 0,n)})))},e}(),y=0,P=function(e){function t(n,a){var o,i=e.call(this)||this;return i.version="3.10.23",i.plugins={},i.flush=function(){i.logger.flush()},i.baseOption=r({},a),i.logConfig=(o=n,r({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda,forbidV2HttpUrlPage:!0},o||{})),i.initUrlPackage(),t.__instance||(t.__instance=i),i}return a(t,e),Object.defineProperty(t.prototype,"sessionId",{get:function(){return u.sessionId},enumerable:!1,configurable:!0}),t.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},t.prototype.updateCurrentUrlPackage=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t="web"),"object"==typeof e&&e.page&&this.currentUrlPackage&&e.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(e.page,e.params);this.currentUrlPackage=new p(e,t)},t.prototype.updateReferUrlPackage=function(e,t){void 0===e&&(e=this.currentUrlPackage),void 0===t&&(t="web"),this.referUrlPackage=e instanceof p?e:new p(e,t)},t.prototype.updateBase=function(e){this.updateCommonPackage(e)},t.prototype.updateCommonPackage=function(e){"object"==typeof e&&this.commonPackage.update(e)},t.prototype.addPlugins=function(){var e=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(t){"object"==typeof t&&"function"==typeof t.apply&&e.addPluginInstance(t)}))},t.prototype.addPluginInstance=function(e){if(e){var t=e.key||e.constructor&&e.constructor.key||"plugin_auto_key_".concat(y++);"function"!=typeof e.apply||e.weblog&&e.weblog===this||e.apply(this),this.plugins[t]=e}},t.prototype.plug=function(e,t){if(this.plugins[e.key])return l("[code 301]","".concat(e.key," 插件重复加载！"));this.addPluginInstance(new e(this,t))},t.prototype.unplug=function(e){var t=this.plugins[e];t&&(t.destroy(),delete this.plugins[e])},t.prototype.unplugAll=function(){for(var e in this.plugins)this.plugins[e]&&this.unplug(e)},t.prototype.generateLog=function(e,t){return{}},t.prototype.send=function(e,t,n){var a=this.generateLog(e.toUpperCase(),t);return"function"==typeof this.beforeSend&&this.beforeSend(e,t,a),this.logger.send(a,!!n,t.callback)},t.prototype.collect=function(e,t){this.send(e,t)},t.prototype.sendImmediately=function(e,t){this.send(e,t,!0)},t.prototype.sendPackage=function(e,t){this.logger.sendPackage(e,t)},t.prototype.destroy=function(){this.unplugAll()},t}(_),m={NativeModules:t.NativeModules,AppState:t.AppState,deviceInfo:function(){var e,n,a=(null===(e=null===t.NativeModules||void 0===t.NativeModules?void 0:t.NativeModules.KSRCTBridge)||void 0===e?void 0:e.deviceInfo)||(null===(n=null===t.NativeModules||void 0===t.NativeModules?void 0:t.NativeModules.KRNBasic)||void 0===n?void 0:n.deviceInfo);if(a){var o="string"==typeof a?JSON.parse(a):a,i=o.data;if(1===o.result){var s=t.Platform.OS,c=t.Platform.Version;return r(r({},i),{os:s,osVersion:c})}}return{appVersion:"",locale:"",uuid:"",systemVersion:"",networkType:"",manufacturer:"",model:"",screenWidth:0,screenHeight:0,statusBarHeight:0,titleBarHeight:0,os:"",osVersion:""}}(),Platform:t.Platform};function E(){var e;return i(this,void 0,void 0,(function(){var t,n,a,r,o;return s(this,(function(i){switch(i.label){case 0:t=m.NativeModules,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,null===(e=t.WebLoggerDebugger)||void 0===e?void 0:e.getLoggerDebugConfig()];case 2:return"string"==typeof(n=i.sent())?(a=JSON.parse(n).host,(r=void 0===a?"":a)?(o=r.match(/([^\/]+)/g)||[],o[o.length-1]||""?[2,r]:[2,""]):[2]):[2,""];case 3:return i.sent(),[2,""];case 4:return[2]}}))}))}function k(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}var T,S,N=function(e){function t(t,n,a){var r=e.call(this,{},n)||this;if("string"==typeof t){var o=d(t);r.page=o.page,r.params=o.params}else r.page=(t||{}).page||"",r.params=(t||{}).params||void 0;return r.identity=r.generatePageId(),a&&"string"==typeof t&&r.init(t,a),r}return a(t,e),t.prototype.generatePageId=function(){return k()},t.prototype.init=function(e,t){void 0===t&&(t={});var n=function(e,t){var n=e.url,a=e.page,r=e.params,o=e.pageId;if(!a&&"string"==typeof n){var i=d(n);a=i.page,r=i.params}if("function"==typeof t)try{var s=t({url:n,page:a,params:r});"string"==typeof s?a=s:"object"==typeof s&&(s.page&&(a=s.page),s.params&&(r=s.params),s.pageId&&(o=s.pageId))}catch(e){}else if("object"==typeof t){var c="";for(var u in t)if((n||a||"").indexOf(u)>-1){c=t[u];break}c&&(a=c)}return{page:a,params:r,pageId:o}}({url:e,page:this.page,params:this.params},t),a=n.page,r=n.params;this.update(a,r)},t}(p),U={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(e){e.CLICK="CLICK",e.DOUBLE_CLICK="DOUBLE_CLICK",e.TRIPLE_CLICK="TRIPLE_CLICK",e.LONG_PRESS="LONG_PRESS",e.PULL="PULL",e.DRAG="DRAG",e.SCALE="SCALE",e.PULL_DOWN="PULL_DOWN",e.PULL_UP="PULL_UP",e.AUTO="AUTO"}(T||(T={})),function(e){e.PV="PV",e.SHOW="SHOW",e.VIDEO="VIDEO",e.CUSTOM="CUSTOM",e.CUSTOM_EVENT="CUSTOM_EVENT",e.RADAR="RADAR"}(S||(S={}));var O=function(e){function n(n){var a=e.call(this,r({identity_package:{device_id:m.deviceInfo.uuid,global_id:m.deviceInfo.globalId},app_package:{language:m.deviceInfo.locale,platform:("ios"===m.Platform.OS?3:"android"===m.Platform.OS&&1)||"web"===m.Platform.OS&&10||0,container:"REACT_NATIVE",version_name:m.deviceInfo.appVersion},device_package:{os_version:String(m.Platform.Version)||"unknown",model:m.deviceInfo.manufacturer||m.deviceInfo.model},network_package:{type:"WIFI"===m.deviceInfo.networkType?U.wifi:U.unknown}},n))||this,o=m.deviceInfo,i=o.product_name,s=o.screenWidth,c=o.screenHeight;return Object.assign(a.h5_extra_attr,{host_product:i,resolution:"".concat(s,"x").concat(c)},n.h5_extra_attr),a.identity_package.user_id||new Promise((function(e){try{(null===t.NativeModules||void 0===t.NativeModules?void 0:t.NativeModules.KSUserInfo)?t.NativeModules.KSUserInfo.getUserInfo((function(t){e(t&&t.userId)})):e("")}catch(t){e("")}})).then((function(e){Object.assign(a.identity_package,{user_id:e})})),a}return a(n,e),n}(function(){function e(e){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:U.unknown},this.h5_extra_attr={sdk_name:"webLogger_krn",sdk_version:"3.10.23",sdk_bundle:"log.krn.js"},this.global_attr={entry_tag:[]},this.location_package={country:void 0,province:void 0,city:void 0,county:void 0,street:void 0,latitude:void 0,longitude:void 0},this.update(e),this.app_package.version_name){var t=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(t+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return e.prototype.getH5ExtraAttr=function(e){return Object.assign({},this.h5_extra_attr,e)},e.prototype.update=function(e){if("object"==typeof e){!function(e,t){if(h(e)&&h(t)){var n=function(e,t,n){h(e[n])&&h(t[n])?Object.assign(e[n],t[n]):h(e[n])||h(t[n])||(e[n]=t[n])};for(var a in t)if(e.hasOwnProperty(a))n(e,t,a);else for(var r in e)h(e[r])&&e[r].hasOwnProperty(a)&&n(e[r],t,a)}}(this,e);var t=e.network_type;t&&U[t]&&(this.network_package.type=U[t])}},e.prototype.updateGlobalAttr=function(e){Object.assign(this.global_attr||{},e)},e.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var e=r(r({},this),{toJSON:function(){return r(r({},e),{h5_extra_attr:JSON.stringify(e.h5_extra_attr),global_attr:JSON.stringify(e.global_attr)})}});e.global_attr=r({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?e.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete e.global_attr.entry_tag,Object.keys(this.global_attr).length||delete e.global_attr;var t=this.location_package;return t&&Object.keys(t).forEach((function(e){void 0===t[e]&&delete t[e]})),e},e}()),A="https://data-track.corp.kuaishou.com",b=A+"/",w="production",C="rest/wd/common/log/collect/",L=[w,"test","development","logger","oversea"],I="https://logsdk.kwai-pro.com/",R={v2:"rest/kd/log/collect?_json=1&biz=",v3:"".concat(C,"misc2"),radar:"".concat(C,"radar")},x={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:b,test:b,oversea:I},v3:{production:"https://log-sdk.ksapisrv.com/",development:b,test:b,oversea:I}},D=function(e,t,n){return void 0===e&&(e=w),void 0===t&&(t=!1),void 0===n&&(n="v3"),-1===L.indexOf(e)?e+R[n]:t&&x.v3[e]?x.v3[e]+R.radar:x[n][e]&&R[n]?x[n][e]+R[n]:x.v3.production+R.v3},K=function(e,t){if(!t)return e;try{return/\?(.+?)$/.test(e)?e.replace(/\?(.+?)$/,"?".concat(t,"&$1")):e+"?".concat(t)}catch(t){return e}},M=function(){function e(e,t){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.isSetSamplingResult=!1,this.sendingYield=null,this.flush=function(e){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),e),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=e,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=t,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,this.updateUrls()}return e.prototype.sendData=function(e,t){return"function"==typeof this.config.sender?this.config.sender(e,t):this.baseSendData(e,t)},Object.defineProperty(e.prototype,"responseSamplingStorageKey",{get:function(){var e=this.commonPackage.app_package,t=e.product_name,n=e.product,a=this.commonPackage.identity_package.device_id;return"RESPONSE_SAMPLING_STORAGE_KEY_".concat(t||n,"_").concat(a)},enumerable:!1,configurable:!0}),e.prototype.updateUrls=function(){var e=this.config.env;e&&/^(https?:)?\/\//.test(e)?this.url=e:this.url=D(e),this.formatUrl()},e.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf(R.v2)?R.v2:R.v3,R.radar),-1!==this.radarUrl.indexOf(x.v2.production||"")&&this.radarUrl.replace(x.v2.production||"",x.v3.production));var e=this.commonPackage.app_package,t=e.product_name,n=e.product,a="v=3.10.23&kpn=".concat(t||n);this.url=K(this.url,a),this.radarUrl=K(this.radarUrl,a)},e.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},e.prototype.send=function(e,t,n){if(void 0===t&&(t=!1),n||this.drained)return this.sendLogs([e],n);t?this.sendAsync(e,n):this.sendThrottle(e)},e.prototype.sendAsync=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.asyncQueue.push(e),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:t.sent(),this.sendingYield=null,t.label=2;case 2:return t.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return t.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},e.prototype.sendThrottle=function(e){var t=this;this.throttleQueue.push(e),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){t.flush()}),this.config.wait))},e.prototype.sendLogs=function(e,t){var n=this;if(!e||!e.length)return"function"==typeof t&&t();var a=this.buildLogPackage(e,this.url);this.sendPackage(a,(function(e){e?n.errHandler(a):n.flushErrorLogs(),"function"==typeof t&&t(e)}))},e.prototype.sendPackage=function(e,t){var n=this.config.timeout;try{this.sendData(r(r({},e),{isDebug:this.isDebug,isDrained:this.drained,timeout:n}),t)}catch(e){"function"==typeof t&&t(e)}},e.prototype.buildLogPackage=function(e,t){return this.isV2?this.buildV2Package(e,t):this.buildV3Package(e,t)},e.prototype.buildV2Package=function(e,t){return{url:t,data:{log:{event:e}}}},e.prototype.buildV3Package=function(e,t,n){var a=this.getCommonPackageJSON();return n&&Object.assign(a,n),{url:t,data:{common:a,logs:e}}},e.prototype.errHandler=function(e){var t;if(this.isV2)this.errorQueue.unshift(e);else{var n=e.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var a=!1,r=0;r<this.errorQueue.length;r++){var o=this.errorQueue[r];if(o.url===e.url&&o.data.logs.length+n.logs.length<=100&&JSON.stringify(o.data.common)===JSON.stringify(n.common)){a=!0,(t=o.data.logs).push.apply(t,n.logs);break}}a||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(e))}}},e.prototype.flushErrorLogs=function(){var e=this;this.errorQueue.forEach((function(t){e.sendPackage(t)})),this.errorQueue=[]},e.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},e.prototype.sendRadar=function(e,t){var n=t?{service_name:t}:void 0,a=this.buildV3Package([e],this.radarUrl||this.url,n);this.sendPackage(a)},e}(),G=function(e,t,n){return l("[error 400]","埋点上报接口请求报错","\nurl:",t,"\ndata",n,"\nerror:",e||"server decode log failed")};function W(e,t){var n=e.url,a=e.data,r=e.timeout;return new Promise((function(e){var o=new XMLHttpRequest;return o.open("POST",n),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),"object"!=typeof a||a instanceof Uint8Array||(a=JSON.stringify(a)),r&&(o.timeout=r),o.onload=function(){var r=function(e,t,n,a){var r;if(e<200||e>=300&&304!==e);else try{var o=JSON.parse(t),i=o.exception,s=o.result,c=o.error_msg;i&&(r=i),1!==s&&(r=c||"result is ".concat(s))}catch(e){r=e.message}return r&&G(r,n,a),r}(o.status,o.response,n,a);t&&t(r),e({error:r,response:r?void 0:o.response})},o.ontimeout=o.onerror=function(r){r&&G(r,n,a),t&&t(r?"networkTimeout":""),e({error:"networkTimeout"})},o.send(a),o}))}var V,j,H,J=function(e,t,n){void 0===e&&(e=A);var a="".concat(e,"/#/logger/index?sessionId=").concat(n);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.log;n&&n.call.apply(n,c([console],e,!1))}catch(e){return}}("%c埋点抓包校验: %c".concat(a),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),"".concat(t,"/").concat(n,"/")},B=function(e){return void 0===e&&(e="krnlogger"),function(e){var t=function(t){return l("[error 401]","GET 请求出错 url: ".concat(e),t)};try{var n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(),n.onerror=t}catch(e){t(e)}}("".concat(A,"/rest/").concat(e)),J(A,"".concat(A,"/rest"),e)},Q=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a.radarUrl="",a.baseSendData=W,a}return a(t,e),t.prototype.updateUrls=function(){var e=this.config,t=e.env,n=e.logger;if(this.getKrnWebloggerSwitch(),n||"logger"===t){var a=B(this.commonPackage.identity_package.device_id);this.url=D(a)}else t&&/^(https?:)?\/\//.test(t)?this.url=t:(this.url=D(t),this.radarUrl=D(t,!0));this.formatUrl()},t.prototype.getKrnWebloggerSwitch=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,E()];case 1:return(e=t.sent())&&(this.config.logger=!0,this.url=D(e),this.radarUrl=this.url.replace(-1!==this.url.indexOf(R.v2)?R.v2:R.v3,R.radar)),[2]}}))}))},t}(M);!function(e){var t,n,a,r,o,i,s,c;(t=e.ElementStatus||(e.ElementStatus={}))[t.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",t[t.CHECKED=1]="CHECKED",t[t.UNCHECKED=2]="UNCHECKED",(n=e.PageShowAction||(e.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(a=e.ActionStatus||(e.ActionStatus={}))[a.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",a[a.SUCCESS=1]="SUCCESS",a[a.FAIL=2]="FAIL",(r=e.ActionType||(e.ActionType={}))[r.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",r[r.CLICK=1]="CLICK",r[r.LEFT_PULL=2]="LEFT_PULL",r[r.RIGHT_PULL=3]="RIGHT_PULL",r[r.UP_PULL=4]="UP_PULL",r[r.DOWN_PULL=5]="DOWN_PULL",(o=e.SubAction||(e.SubAction={}))[o.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",o[o.PAGE_ENTER=1]="PAGE_ENTER",o[o.PAGE_LEAVE=2]="PAGE_LEAVE",o[o.PAGE_RESUME=3]="PAGE_RESUME",o[o.PAGE_PAUSE=4]="PAGE_PAUSE",(i=e.Direction||(e.Direction={}))[i.UNKNOWN2=0]="UNKNOWN2",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i[i.LEFT=3]="LEFT",i[i.RIGHT=4]="RIGHT",(s=e.TaskStatus||(e.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=e.OperationType||(e.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(V||(V={})),function(e){var t,n;(t=e.ShowType||(e.ShowType={}))[t.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",t[t.PAGE_AUTO=10]="PAGE_AUTO",t[t.PAGE_CUSTOM=11]="PAGE_CUSTOM",t[t.ELEMENT=12]="ELEMENT",(n=e.TaskEventType||(e.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(j||(j={})),function(e){var t;(t=e.ShowType||(e.ShowType={}))[t.UNKNOWN2=0]="UNKNOWN2",t[t.PAGE=1]="PAGE"}(H||(H={}));var Y,F=!0,q=(new Date).valueOf(),z=function(e,t){var n,a;void 0===t&&(t=!1);var o=e.type,i=e.currentUrlPackage,s=e.referUrlPackage,c=e.name,u=void 0===c?"":c,p=e.action,l=e.beginTime,g=e.params,f=e.contentPackage,d=e.status,h=e.actionType,_=e.auto,y=((n={status:d?V.ActionStatus[d]||V.ActionStatus.UNKNOWN_STATUS:V.ActionStatus.SUCCESS})[t?"show_type":"action_type"]=h?V.ActionType[h]||V.ActionType.UNKNOWN_ACTION_TYPE:V.ActionType.CLICK,n.url_package=i,n.refer_url_package=s,n[t?"content_wrapper":"content_package"]=f,n);if("PV"===o){var P=V.SubAction.PAGE_ENTER,m=V.PageShowAction.ENTER,E=F,k=0;switch(F=!1,p){case"leave":m=V.PageShowAction.LEAVE,P=V.SubAction.PAGE_LEAVE,k=v((new Date).valueOf()-(l||q));break;case"enter":m=V.PageShowAction.ENTER,P=V.SubAction.PAGE_ENTER,q=(new Date).valueOf();break;case"visible":m=V.PageShowAction.RESUME,P=V.SubAction.PAGE_RESUME,q=(new Date).valueOf();break;case"hidden":m=V.PageShowAction.LEAVE,P=V.SubAction.PAGE_PAUSE,k=v((new Date).valueOf()-(l||q))}var T=_?j.ShowType.PAGE_AUTO:j.ShowType.PAGE_CUSTOM;return t&&(E=void 0,T=H.ShowType.PAGE),{show_event:r({action:m,sub_action:P,type:T,first_load:E,time_cost:0,stay_length:k},y)}}return{show_event:r({action:t?0:V.PageShowAction.ENTER,type:t?0:j.ShowType.ELEMENT,sub_action:t?0:V.SubAction.PAGE_ENTER,element_package:(a={},a[t?"action2":"action"]=u,a.params=JSON.stringify(g),a)},y)}},X=function(e,t){var n,a;void 0===t&&(t=!1);var o=e.sessionId,i=e.currentUrlPackage,s=e.referUrlPackage,c=e.name,u=e.params,p=e.type,l=e.contentPackage,g=e.status,f=e.taskType,d=e.operationDirection,h=((n={url_package:i,refer_url_package:s,element_package:(a={},a[t?"action2":"action"]=c,a.params=JSON.stringify(u),a)})[t?"content_wrapper":"content_package"]=l,n);if(t){var v="USER_OPERATION"===f||"CLICK"===p&&!f,_=p&&V.OperationType[p]||V.OperationType.CLICK;return v?{click_event:r({type:_,direction:d&&V.Direction[d]||V.Direction.UNKNOWN2},h)}:{task_event:r({action2:c,status:g&&V.TaskStatus[g]||V.TaskStatus.UNKNOWN_STATUS},h)}}return{task_event:r({type:f&&j.TaskEventType[f]||j.TaskEventType.USER_OPERATION,status:g&&V.TaskStatus[g]||V.TaskStatus.UNKNOWN_STATUS,operation_type:V.OperationType[p]||V.OperationType.CLICK,operation_direction:d&&V.Direction[d]||V.Direction.UNKNOWN2,session_id:o},h)}},$=function(e){var t=e.name,n=e.params,a=e.currentUrlPackage,i=e.referUrlPackage,s=o(e,["name","params","currentUrlPackage","referUrlPackage"]);return{key:t,value:JSON.stringify(r(r({url_package:a,refer_url_package:i},n),s))}},Z=function(e){var t=e.currentUrlPackage,n=e.referUrlPackage,a=e.options;return{video_stat_event:r(r({},a),{url_package:t,refer_url_package:n})}},ee={},te=function(e){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var t=Number(function(e){try{if(window&&window.localStorage){var t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}}}catch(e){return null}return null}(e))||0;return t+1>1e8&&(t=0),function(e,t){try{if(window&&window.localStorage)return window.localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return!1}}(e,t+1),t}}catch(e){}return ee[e]||(ee[e]=0),ee[e]++},ne=(Y=(new Date).getTimezoneOffset()/60)<=0?"GMT+".concat(g(-Y+"",2,"0"),":00"):"GMT-".concat(g(Y+"",2,"0"),":00"),ae=function(){function e(e,t){void 0===t&&(t=!1),this.client_timestamp=v((new Date).valueOf()),this.client_increment_id=0,this.session_id=u.sessionId,this.event_id="",t||(this.time_zone=ne),Object.assign(this,e),this.genIncrementId()}return e.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?te("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):te("WEBLOGGER_INCREAMENT_ID_KEY")},e.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},e.prototype.getEventType=function(){if(this.event_package){var e=this.event_package,t=e.task_event,n=e.show_event,a=e.click_event,r=e.custom_event;if(n)return"showEvent";if(a)return"clickEvent";if(t)return"taskEvent";if(r)return"customEvent"}return"customEvent"},e}();function re(e,t,n){var a;void 0===n&&(n=!1);var r,i=t.eventId,s=t.currentUrlPackage,c=t.referUrlPackage,p=t.contentPackage,l=t.name,g=t.params;switch(n&&"RADAR"!==e&&"CUSTOM"!==e&&(s&&(s.page2=s.page,delete s.page),c&&(c.page2=c.page,delete c.page)),e){case"PV":case"SHOW":return new ae({event_package:z({type:e,status:t.status,currentUrlPackage:s,referUrlPackage:c,action:t.type,beginTime:t.beginTime,actionType:t.actionType,name:l,params:g,contentPackage:p,operationDirection:t.operationDirection,auto:t.auto},n),event_id:i},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var f=$({name:l,params:g,currentUrlPackage:s,referUrlPackage:c});return new ae(n?{event_package:{custom_event:f},event_id:i}:{stat_package:{custom_stat_event:f},event_id:i},n);case"RADAR":return new ae({stat_package:{custom_stat_event:$({name:l,params:g,currentUrlPackage:s,referUrlPackage:c})},event_id:i},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new ae({stat_package:(a={},a[e.toLowerCase()]=(r=t,r.currentUrlPackage,r.referUrlPackage,r.taskType,o(r,["currentUrlPackage","referUrlPackage","taskType"])),a)},n);case"VIDEO":return new ae(n?{stat_package:Z({currentUrlPackage:s,referUrlPackage:c,options:g.params}),event_id:i}:{event_package:X({type:e,status:t.status,taskType:t.taskType,sessionId:u.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:g.params,contentPackage:p},n),event_id:i},n);default:return new ae({event_package:X({type:e,status:t.status,taskType:t.taskType,sessionId:u.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:g,contentPackage:p},n),event_id:i},n)}}var oe=function(e,t,n,a){var r;void 0===t&&(t={}),"string"!=typeof e&&(r=e.type),r=e.toUpperCase();var o={};if("string"==typeof t)o.contentPackage=a,"CUSTOM"===e?(o.key=t,o.value=n):(o.params=n,"PV"===e?o.page=t:o.action=t);else if(o=t,["CUSTOM","CUSTOM_EVENT"].includes(r)){var i=t;i.action&&!i.key&&(o.key=i.action),i.params&&!i.value&&(o.value=i.params)}return[r,o]},ie=function(e){function n(t,n){var a,r,o,i=this;return(i=e.call(this,t,n)||this).appStateChange=function(e){var t;"active"!==e&&i.flush(),"destroy"===e&&(null===(t=m.AppState)||void 0===t||t.removeEventListener("change",i.appStateChange),i.destroy())},null===(a=m.AppState)||void 0===a||a.addEventListener("change",i.appStateChange),r="sessionId",o=n&&n.session_id||k(),u[r]=o,i.commonPackage=new O(i.baseOption),i.logger=new Q(i.logConfig,i.commonPackage),i.addPlugins(),i}return a(n,e),n.prototype.initUrlPackage=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return this.updateCurrentUrlPackage(),[4,(a=this.logConfig.rootTag,new Promise((function(e){var n;try{(null===(n=null===t.NativeModules||void 0===t.NativeModules?void 0:t.NativeModules.RootViewPageBridge)||void 0===n?void 0:n.rootViewSignatureWith)&&"number"==typeof a?t.NativeModules.RootViewPageBridge.rootViewSignatureWith(a,(function(t){var n="string"==typeof t?JSON.parse(t):t;e(r({},n))})):e({})}catch(t){e({})}})))];case 1:return e=n.sent(),this.commonPackage.update({h5_extra_attr:e}),[2]}var a}))}))},n.prototype.updateCurrentUrlPackage=function(e,t){if(void 0===e&&(e=""),void 0===t&&(t="native"),"object"==typeof e&&!e.force&&this.currentUrlPackage){var n=e.page,a=void 0===n?this.currentUrlPackage.page:n,r=e.params,o=void 0===r?{}:r;if(a===this.currentUrlPackage.page)return this.currentUrlPackage.update(a,o)}this.currentUrlPackage=new N(e,t,this.logConfig.urlMap)},n.prototype.updateReferUrlPackage=function(e,t){void 0===e&&(e=this.currentUrlPackage),void 0===t&&(t="native"),this.referUrlPackage=e instanceof N?e:new N(e,t,this.logConfig.urlMap)},n.prototype.generateLog=function(e,t,n){void 0===n&&(n=re);var a,o=t,i=o.action,s=o.params,c=o.status,u=o.type,p=o.eventId,l=o.contentPackage,g=o.urlPage;if(l&&(l="string"==typeof l?l:JSON.stringify(l)),"PV"===e){var f=t.page;this.currentUrlPackage.update(f,s)}else g&&g.page&&(a={page:g.page,identity:g.identity||k(),params:JSON.stringify(g.params),page_type:this.currentUrlPackage.page_type});var d={currentUrlPackage:a||this.currentUrlPackage.toJSON(),referUrlPackage:this.referUrlPackage?this.referUrlPackage.toJSON():void 0,contentPackage:l};if("PV"===e){var h=t.type;return n(e,r(r(r({},t),{type:h,name:e}),d))}if("SHOW"===e)return n(e,r(r(r({},t),{name:i}),d));if("VIDEO"===e)return n(e,r({params:t,name:"VIDEO"},d));if("RADAR"===e)return n(e,t);if("CUSTOM"===e){var v=t,_=v.key,y=v.value;return n(e,r(r(r({},t),{params:y,name:_}),d))}return n(e,r(r(r({},t),{params:s,status:c,taskType:u,eventId:p,name:i}),d))},n.prototype.collect=function(e,t,n,a){var r=oe(e,t,n,a),o=r[0],i=r[1];return this.send(o,i,!1)},n.prototype.sendImmediately=function(e,t,n,a){var r=oe(e,t,n,a),o=r[0],i=r[1];return this.send(o,i,!0)},n}(P),se=function(){function e(){}return e.prototype.apply=function(e){this.weblog=e},e}();e.BasePlugin=se,e.Weblog=ie,e.default=ie,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=log.krn.js.map
