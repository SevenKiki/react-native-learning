!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Weblog={})}(this,(function(e){"use strict";var t,n,o,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){void 0===r.window&&(r.window={addEventListener:function(){},removeEventListener:function(){},setTimeout:function(){},setInterval:function(){},_WEBLOGGER_MOCKED_WINDOW_:!0,global:r}),void 0===r.document&&(r.document=r.window.document||{cookie:"",addEventListener:function(){},removeEventListener:function(){},querySelector:function(){},querySelectorAll:function(){}},void 0===r.window.document&&(r.window.document=r.document)),void 0===r.navigator&&(r.navigator=r.window.navigator||{userAgent:""},void 0===r.window.navigator&&(r.window.navigator=r.navigator)),void 0===r.screen&&(r.screen=r.window.screen||{},void 0===r.window.screen&&(r.window.screen=r.screen)),void 0===r.history&&(r.history=r.window.history||{},void 0===r.window.history&&(r.window.history=r.history)),void 0===r.location&&(r.location=r.window.location||{hostname:"",search:"",href:"",origin:""},void 0===r.window.location&&(r.window.location=r.location));try{void 0===r.localStorage&&(r.localStorage=r.window.localStorage||{getItem:function(){},setItem:function(){}},void 0===r.window.localStorage&&(r.window.localStorage=r.localStorage))}catch(e){}}(),Object.defineProperty||(Object.defineProperty=function(e,t,n){e[t]="[object Object]"===Object.prototype.toString.call(n)&&n.hasOwnProperty("value")?n.value:n}),Object.assign||Object.defineProperty(Object,"assign",{value:function(e){if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!==o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},writable:!0,configurable:!0}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},r=function(){var r=this instanceof o?this:e;return n.apply(r,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(o.prototype=this.prototype),r.prototype=new o,r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),r=o.length>>>0;if(0===r)return-1;var i=+t||0;if(Math.abs(i)===1/0&&(i=0),i>=r)return-1;for(n=Math.max(i>=0?i:r-Math.abs(i),0);n<r;){if(n in o&&o[n]===e)return n;n++}return-1}),Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var r=[];for(var i in e)t.call(e,i)&&r.push(i);if(n)for(var a=0,s=o;a<s.length;a++){var c=s[a];t.call(e,c)&&r.push(c)}return r})),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,o;if(null==this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),o=0;o<i;){var a=void 0;o in r&&(a=r[o],e.call(n,a,o,r)),o++}});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function c(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}function u(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))}function d(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function l(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var p={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},f=function(){function e(e,t){switch(this.page="",this.identity="",t){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(e.page,e.params)}return e.prototype.update=function(e,t){void 0===e&&(e=""),e&&e!==this.page&&(this.page=e,this.identity=this.generatePageId(e)),t&&(this.params=Object.assign(this.params||{},t))},e.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params),category:this.category}},e.prototype.generatePageId=function(e){return e+(new Date).getTime()},e}(),g=["Kwai","Kwai_Lite","Kwai_Pro","livemate","ksthanos","ksNebula","ksnebula","kwaiying","pearl","kinder","m2u","LOLita","XFunCore","ACVideoCore","ZIKZAK"].concat(["UVideo","Vstatus","Kwaigo","MvMaster"]);function h(e,t,n){var o,r={};if(e.length>0)for(var i=t?decodeURIComponent:function(e){return e},a=e.split(/;\s/g),s=null,c=null,u=null,d=0,l=a.length;d<l;d++){if((u=null===(o=a[d])||void 0===o?void 0:o.match(/([^=]+)=/i))&&null!==u)try{s=decodeURIComponent(u[1]),c=i(a[d].substring(u[1].length+1))}catch(e){}else s=decodeURIComponent(a[d]),c="";null!==s&&(r[s]=c)}return r}var v,y={};function _(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1);try{if(!n&&e in y)return y[e];if(!(null===window||void 0===window?void 0:window.document))return;var o=document.cookie||"";return o===v?y[e]:(v=o,(y=h(o,!t.raw))[e])}catch(e){}}function m(e,t,n){void 0===n&&(n={});try{document.cookie=function(e,t,n,o){void 0===o&&(o={});var r="".concat(encodeURIComponent(e),"=").concat(n?encodeURIComponent(t):t),i=o.expires,a=o.path||"/",s=o.domain||"";return i instanceof Date&&(r+="; expires=".concat(i.toUTCString())),"number"==typeof i&&(r+="; max-age==".concat(i)),""!==a&&(r+="; path=".concat(a)),""!==s&&(r+="; domain=".concat(s)),!0===o.secure&&(r+="; secure"),r}(e,t,!n.raw,n),y[e]=t}catch(e){}}var w={getCookie:_,setCookie:m,parseCookieString:h};function P(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,l([console],e,!1))}catch(e){return}}function S(e,t,n,o){return"attachEvent"in e?e.attachEvent("on"+t,n):e.addEventListener(t,n,o)}function E(e,t,n,o){return"attachEvent"in e?e.detachEvent("on"+t,n):e.removeEventListener(t,n,o)}function k(e,t,n){if(void 0===n&&(n=" "),(t-=e.length)<=0)return e;for(var o="";t;)1&t&&(o+=n),t>>=1,n+=n;return o+e}var O=function(e){void 0===e&&(e=window.navigator.userAgent.toLowerCase());try{for(var t=0;t<g.length;t++)if(e.indexOf(g[t].toLowerCase())>-1)return!0}catch(e){return!1}};function b(e){for(var t={},n=0,o=e.split("&");n<o.length;n++){var r=o[n].split("="),i=r[0],a=r[1];i in t?t[i]instanceof Array?t[i].push(a):t[i]=[t[i],a]:t[i]=a}return t}function U(e){void 0===e&&(e=location.href);var t=e.lastIndexOf("?");return-1===t?{page:e}:{page:e.slice(0,t),params:b(e.slice(t+1))}}var T=function(e){return e&&"object"==typeof e&&!Array.isArray(e)};var N,A=(N="",function(){if(N)return N;try{var e=window.devicePixelRatio||1,t=Math.floor(screen.width*e),n=Math.floor(screen.height*e);return N="".concat(t,"x").concat(n)}catch(e){return""}});var L=function(){return!(!((null===window||void 0===window?void 0:window.Worker)&&(null===window||void 0===window?void 0:window.Uint8Array)&&window.URL&&window.Promise)||function(){var e,t,n=(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent)||"",o=/mobile|tablet|ip(ad|hone|od)|android|(windows phone)/i.test(n),r="MacIntel"===(null===window||void 0===window?void 0:window.navigator.platform)&&(null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.maxTouchPoints)>1;return o||r}())},C=function(e){try{return Math.abs(Math.floor(e))}catch(t){return e}},I=function(){function e(){this.events={}}return e.prototype.on=function(e,t){var n;t&&"function"==typeof t&&(this.events[e]=this.events[e]||[],null===(n=this.events[e])||void 0===n||n.push(t))},e.prototype.off=function(e,t){if(this.events[e]){if(t&&"function"==typeof t){var n=this.events[e];n&&(r=t,(i=(o=n).indexOf(r))>-1&&o.splice(i,1))}var o,r,i;t||(this.events[e]=[])}},e.prototype.emit=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.events[e]&&(null===(t=this.events[e])||void 0===t||t.forEach((function(e){e.apply(void 0,n)})))},e}(),x=0,R=function(e){function t(n,o){var r,i=e.call(this)||this;return i.version="3.10.23",i.plugins={},i.flush=function(){i.logger.flush()},i.baseOption=s({},o),i.logConfig=(r=n,s({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda,forbidV2HttpUrlPage:!0},r||{})),i.initUrlPackage(),t.__instance||(t.__instance=i),i}return a(t,e),Object.defineProperty(t.prototype,"sessionId",{get:function(){return p.sessionId},enumerable:!1,configurable:!0}),t.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},t.prototype.updateCurrentUrlPackage=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t="web"),"object"==typeof e&&e.page&&this.currentUrlPackage&&e.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(e.page,e.params);this.currentUrlPackage=new f(e,t)},t.prototype.updateReferUrlPackage=function(e,t){void 0===e&&(e=this.currentUrlPackage),void 0===t&&(t="web"),this.referUrlPackage=e instanceof f?e:new f(e,t)},t.prototype.updateBase=function(e){this.updateCommonPackage(e)},t.prototype.updateCommonPackage=function(e){"object"==typeof e&&this.commonPackage.update(e)},t.prototype.addPlugins=function(){var e=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(t){"object"==typeof t&&"function"==typeof t.apply&&e.addPluginInstance(t)}))},t.prototype.addPluginInstance=function(e){if(e){var t=e.key||e.constructor&&e.constructor.key||"plugin_auto_key_".concat(x++);"function"!=typeof e.apply||e.weblog&&e.weblog===this||e.apply(this),this.plugins[t]=e}},t.prototype.plug=function(e,t){if(this.plugins[e.key])return P("[code 301]","".concat(e.key," 插件重复加载！"));this.addPluginInstance(new e(this,t))},t.prototype.unplug=function(e){var t=this.plugins[e];t&&(t.destroy(),delete this.plugins[e])},t.prototype.unplugAll=function(){for(var e in this.plugins)this.plugins[e]&&this.unplug(e)},t.prototype.generateLog=function(e,t){return{}},t.prototype.send=function(e,t,n){var o=this.generateLog(e.toUpperCase(),t);return"function"==typeof this.beforeSend&&this.beforeSend(e,t,o),this.logger.send(o,!!n,t.callback)},t.prototype.collect=function(e,t){this.send(e,t)},t.prototype.sendImmediately=function(e,t){this.send(e,t,!0)},t.prototype.sendPackage=function(e,t){this.logger.sendPackage(e,t)},t.prototype.destroy=function(){this.unplugAll()},t}(I);function D(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function G(e){if(void 0===e&&(e="undefined"!=typeof location?location.hostname:""),!e)return"";var t=e.split("."),n=t.length;return n<=2?"":".".concat(t[n-2],".").concat(t[n-1])}function K(){try{var e=_("did")||_("_did");if(!e){e="web_".concat(function(){for(var e=1e9*Math.random()>>>0,t=[],n=0;n<7;n++)t.push("0123456789ABCDEF".charAt(16*Math.random()));return e+t.join("")}());var t=new Date;t.setFullYear(t.getFullYear()+1),m("_did",e,{expires:t,domain:G(),path:"/"})}return e}catch(e){return""}}var W="WEBLOGGER_SESSIONID",M=function(e){function t(t,n,o){var r=e.call(this,{},n)||this;if("string"==typeof t){var i=U(t);r.page=i.page,r.params=i.params}else r.page=(t||{}).page||"",r.params=(t||{}).params||void 0;return r.identity=r.generatePageId(),o&&"string"==typeof t&&r.init(t,o),r}return a(t,e),t.prototype.init=function(e,t){void 0===t&&(t={});var n=function(e,t){var n=e.url,o=e.page,r=e.params,i=e.pageId;if(!o&&"string"==typeof n){var a=U(n);o=a.page,r=a.params}if("function"==typeof t)try{var s=t({url:n,page:o,params:r});"string"==typeof s?o=s:"object"==typeof s&&(s.page&&(o=s.page),s.params&&(r=s.params),s.pageId&&(i=s.pageId))}catch(e){}else if("object"==typeof t){var c="";for(var u in t)if((n||o||"").indexOf(u)>-1){c=t[u];break}c&&(o=c)}return{page:o,params:r,pageId:i}}({url:e,page:this.page,params:this.params},t),o=n.page,r=n.params;this.update(o,r)},t.prototype.attachUrl=function(){if(this.params||(this.params={}),null===location||void 0===location?void 0:location.href){this.params.origin_url=this.params.origin_url||(null===location||void 0===location?void 0:location.href);var e=U(location.href).page,t=void 0===e?"":e;this.params.origin_pathname=t}},t.prototype.getRealUrlPackage=function(){var e=U(location.href),t=e.page,n=e.params;return{page:t,params:JSON.stringify(s({page_code:this.page,url:location.href,query:n},n)),page_type:this.page_type,identity:this.identity}},t.prototype.generatePageId=function(){return D()},t}(f),j="https://data-track.corp.kuaishou.com",V=j+"/",B="production",H="logger",J="logger-oversea",Q="rest/wd/common/log/collect/",Y=[B,"test","development",H,"oversea"],F="https://logsdk.kwai-pro.com/",z={v2:"rest/kd/log/collect?_json=1&biz=",v3:"".concat(Q,"misc2"),radar:"".concat(Q,"radar")},q={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:V,test:V,oversea:F},v3:{production:"https://log-sdk.ksapisrv.com/",development:V,test:V,oversea:F}},X=function(e,t,n){return void 0===e&&(e=B),void 0===t&&(t=!1),void 0===n&&(n="v3"),-1===Y.indexOf(e)?e+z[n]:t&&q.v3[e]?q.v3[e]+z.radar:q[n][e]&&z[n]?q[n][e]+z[n]:q.v3.production+z.v3},$=function(e,t){if(!t)return e;try{return/\?(.+?)$/.test(e)?e.replace(/\?(.+?)$/,"?".concat(t,"&$1")):e+"?".concat(t)}catch(t){return e}},Z=function(){function e(e,t){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.isSetSamplingResult=!1,this.sendingYield=null,this.flush=function(e){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),e),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=e,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=t,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,this.updateUrls()}return e.prototype.sendData=function(e,t){return"function"==typeof this.config.sender?this.config.sender(e,t):this.baseSendData(e,t)},Object.defineProperty(e.prototype,"responseSamplingStorageKey",{get:function(){var e=this.commonPackage.app_package,t=e.product_name,n=e.product,o=this.commonPackage.identity_package.device_id;return"RESPONSE_SAMPLING_STORAGE_KEY_".concat(t||n,"_").concat(o)},enumerable:!1,configurable:!0}),e.prototype.updateUrls=function(){var e=this.config.env;e&&/^(https?:)?\/\//.test(e)?this.url=e:this.url=X(e),this.formatUrl()},e.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf(z.v2)?z.v2:z.v3,z.radar),-1!==this.radarUrl.indexOf(q.v2.production||"")&&this.radarUrl.replace(q.v2.production||"",q.v3.production));var e=this.commonPackage.app_package,t=e.product_name,n=e.product,o="v=3.10.23&kpn=".concat(t||n);this.url=$(this.url,o),this.radarUrl=$(this.radarUrl,o)},e.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},e.prototype.send=function(e,t,n){if(void 0===t&&(t=!1),n||this.drained)return this.sendLogs([e],n);t?this.sendAsync(e,n):this.sendThrottle(e)},e.prototype.sendAsync=function(e,t){return u(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return this.asyncQueue.push(e),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:t.sent(),this.sendingYield=null,t.label=2;case 2:return t.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return t.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},e.prototype.sendThrottle=function(e){var t=this;this.throttleQueue.push(e),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){t.flush()}),this.config.wait))},e.prototype.sendLogs=function(e,t){var n=this;if(!e||!e.length)return"function"==typeof t&&t();var o=this.buildLogPackage(e,this.url);this.sendPackage(o,(function(e){e?n.errHandler(o):n.flushErrorLogs(),"function"==typeof t&&t(e)}))},e.prototype.sendPackage=function(e,t){var n=this.config.timeout;try{this.sendData(s(s({},e),{isDebug:this.isDebug,isDrained:this.drained,timeout:n}),t)}catch(e){"function"==typeof t&&t(e)}},e.prototype.buildLogPackage=function(e,t){return this.isV2?this.buildV2Package(e,t):this.buildV3Package(e,t)},e.prototype.buildV2Package=function(e,t){return{url:t,data:{log:{event:e}}}},e.prototype.buildV3Package=function(e,t,n){var o=this.getCommonPackageJSON();return n&&Object.assign(o,n),{url:t,data:{common:o,logs:e}}},e.prototype.errHandler=function(e){var t;if(this.isV2)this.errorQueue.unshift(e);else{var n=e.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var o=!1,r=0;r<this.errorQueue.length;r++){var i=this.errorQueue[r];if(i.url===e.url&&i.data.logs.length+n.logs.length<=100&&JSON.stringify(i.data.common)===JSON.stringify(n.common)){o=!0,(t=i.data.logs).push.apply(t,n.logs);break}}o||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(e))}}},e.prototype.flushErrorLogs=function(){var e=this;this.errorQueue.forEach((function(t){e.sendPackage(t)})),this.errorQueue=[]},e.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},e.prototype.sendRadar=function(e,t){var n=t?{service_name:t}:void 0,o=this.buildV3Package([e],this.radarUrl||this.url,n);this.sendPackage(o)},e}(),ee=function(e,t,n){return P("[error 400]","埋点上报接口请求报错","\nurl:",t,"\ndata",n,"\nerror:",e||"server decode log failed")};function te(e,t){var n=e.url,o=e.data,r=e.timeout;return new Promise((function(e){var i=new XMLHttpRequest;return i.open("POST",n),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),"object"!=typeof o||o instanceof Uint8Array||(o=JSON.stringify(o)),r&&(i.timeout=r),i.onload=function(){var r=function(e,t,n,o){var r;if(e<200||e>=300&&304!==e);else try{var i=JSON.parse(t),a=i.exception,s=i.result,c=i.error_msg;a&&(r=a),1!==s&&(r=c||"result is ".concat(s))}catch(e){r=e.message}return r&&ee(r,n,o),r}(i.status,i.response,n,o);t&&t(r),e({error:r,response:r?void 0:i.response})},i.ontimeout=i.onerror=function(r){r&&ee(r,n,o),t&&t(r?"networkTimeout":""),e({error:"networkTimeout"})},i.send(o),i}))}var ne=function(e){var t=function(t){return P("[error 401]","GET 请求出错 url: ".concat(e),t)};try{var n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(),n.onerror=t}catch(e){t(e)}},oe=null===window||void 0===window?void 0:window.navigator,re=oe&&-1!==oe.userAgent.indexOf("Chrome"),ie="function"==typeof oe.sendBeacon;function ae(e,t){var n=e.url,o=e.data,r=e.timeout;e.isDebug;var i=e.isDrained,a=e.forceSendBeacon;return u(this,void 0,void 0,(function(){var e;return d(this,(function(s){switch(s.label){case 0:return o=JSON.stringify(o),i&&function(e){var t=e.url,n=e.data,o=e.forceSendBeacon;if(!re&&!o||!ie)return!1;"object"==typeof n&&n.fd&&(n=n.fd);try{return oe.sendBeacon(t,n)}catch(e){return P("[error 403]","navigator.sendBeacon 报错",e),!1}}({url:n,data:o,forceSendBeacon:a})?(t&&t(),[2]):[4,te({url:n,data:o,timeout:r},t)];case 1:return[2,(e=s.sent()).error?void 0:e.response]}}))}))}var se,ce=function(e,t,n){void 0===e&&(e=j);var o="".concat(e,"/#/logger/index?sessionId=").concat(n);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.log;n&&n.call.apply(n,l([console],e,!1))}catch(e){return}}("%c埋点抓包校验: %c".concat(o),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),"".concat(t,"/").concat(n,"/")};!function(e){e.loading="loading",e.loaded="loaded"}(se||(se={}));var ue,de,le,pe=Object.create(null),fe="weblogger_switch",ge=function(e){var t=function(){try{var e=_(fe)||"undefined"!=typeof sessionStorage&&sessionStorage.getItem(fe);if(!e)return;var t=JSON.parse(e),n=t.loggerSessionId,o=t.reportHost,r=t.loggerHost,i=t.handshakeApi;return n?(ne(i||"".concat(o,"/").concat(n)),ce(r,o,n)):""}catch(e){return""}}()||function(e){void 0===e&&(e=location.href);var t=e.lastIndexOf("?");if(-1===t)return"";var n=b(e.slice(t+1)).webloggerSwitch;if(!n)return"";try{var o=decodeURIComponent(n),r=JSON.parse(o),i=r.loggerSessionId,a=r.reportHost,s=r.loggerHost,c=r.handshakeApi;return i?("undefined"!=typeof sessionStorage&&sessionStorage.setItem(fe,o),ne(c||"".concat(a,"/").concat(i)),ce(s,a,i)):""}catch(e){return""}}();if(t)return X(t,!1,e)},he=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.baseSendData=o.sendLog,o.getResponseSamplingStorage(),o}return a(t,e),t.prototype.getResponseSamplingStorage=function(){return u(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Promise.resolve()];case 1:return t.sent(),(e=Number(localStorage.getItem(this.responseSamplingStorageKey)))&&Date.now()<e?this.sendEffectiveTime=e:e&&localStorage.removeItem(this.responseSamplingStorageKey),[3,3];case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},t.prototype.isResponseSampling=function(){return!!(this.sendEffectiveTime&&Date.now()<this.sendEffectiveTime)},t.prototype.setResponseSamplingConfig=function(e){var t=this;this.isSetSamplingResult||(this.isSetSamplingResult=!0,null==e||e.then((function(e){var n;try{n=e&&JSON.parse(e)}catch(e){n={result:1,hostName:""}}var o=null==n?void 0:n.expireSeconds;if(o){var r=Date.now()+1e3*o;t.sendEffectiveTime=r,localStorage.setItem(t.responseSamplingStorageKey,String(r))}})))},t.prototype.updateUrls=function(){var e=this.config,t=e.env,n=void 0===t?B:t,o=e.logger,r=e.proto,i=e.isBridge,a=e.disableCompress,s=ge(r);if(s)this.url=s,this.isDebug=!0;else if(o||n===H||n===J){var c=function(e,t){void 0===e&&(e=K()),void 0===t&&(t=!1);var n=t?"https://data-track-sgp.corp.kuaishou.com":j;return ne("".concat(n,"/rest/").concat(e)),ce(n,"".concat(n,"/rest"),e)}(this.commonPackage.identity_package.device_id,n===J);this.url=X(c,!1,r),this.isDebug=!0}else n&&/^(https?:)?\/\//.test(n)?this.url=n:(this.isDebug=n!==B,this.url=X(n,!1,r),this.radarUrl=X(n,!0,r));this.enableAsyncGzip=!a&&"v3"===r&&!i&&L()&&n===B&&!s&&!o,this.enableAsyncGzip&&function(e,t,n){if(void 0===t&&(t=!0),pe[e])return n&&n("".concat(e," load repeat"));var o=pe[e]={state:se.loading},r=document.createElement("script");r.crossOrigin="anonymous",r.src=e,t&&(r.async=!0);var i=document.getElementsByTagName("script")[0];i&&i.parentNode?i.parentNode.insertBefore(r,i):document.head.appendChild(r),r.onload=function(){o.state=se.loaded,n&&n()},r.onerror=function(t){o.state=se.loaded,n&&n("".concat(e," loaded failed, ").concat(t))}}("https://static.yximgs.com/udata/pkg/ks-track-platform-new/weblogger/3.10.23/async/gzipper.min.js"),this.formatUrl()},t.prototype.sendLog=function(e,t){var n=this.config.forceSendBeacon;!this.isV2&&this.isResponseSampling()||!this.drained&&this.enableAsyncGzip&&this.sendGzip(e,t)||this.setResponseSamplingConfig(ae(s(s({},e),{forceSendBeacon:n}),t))},t.prototype.sendGzip=function(e,n){var o,r=this;if(!(null===(o=t.Gzipper)||void 0===o?void 0:o.sendData))return!1;var i=t.Gzipper.sendData(e,(function(t){t&&r.setResponseSamplingConfig(ae(e,n))}));return this.setResponseSamplingConfig(i),!!i},t.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},t.prototype.send=function(t,n,o){void 0===n&&(n=!1),this.isV2&&(this.commonPackage.setAdditionalSeqIdPackage(t.getEventType()),t.common_package=this.getCommonPackageJSON()),e.prototype.send.call(this,t,n,o)},t}(Z);!function(e){var t,n,o,r,i,a,s,c;(t=e.ElementStatus||(e.ElementStatus={}))[t.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",t[t.CHECKED=1]="CHECKED",t[t.UNCHECKED=2]="UNCHECKED",(n=e.PageShowAction||(e.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(o=e.ActionStatus||(e.ActionStatus={}))[o.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",o[o.SUCCESS=1]="SUCCESS",o[o.FAIL=2]="FAIL",(r=e.ActionType||(e.ActionType={}))[r.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",r[r.CLICK=1]="CLICK",r[r.LEFT_PULL=2]="LEFT_PULL",r[r.RIGHT_PULL=3]="RIGHT_PULL",r[r.UP_PULL=4]="UP_PULL",r[r.DOWN_PULL=5]="DOWN_PULL",(i=e.SubAction||(e.SubAction={}))[i.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",i[i.PAGE_ENTER=1]="PAGE_ENTER",i[i.PAGE_LEAVE=2]="PAGE_LEAVE",i[i.PAGE_RESUME=3]="PAGE_RESUME",i[i.PAGE_PAUSE=4]="PAGE_PAUSE",(a=e.Direction||(e.Direction={}))[a.UNKNOWN2=0]="UNKNOWN2",a[a.UP=1]="UP",a[a.DOWN=2]="DOWN",a[a.LEFT=3]="LEFT",a[a.RIGHT=4]="RIGHT",(s=e.TaskStatus||(e.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=e.OperationType||(e.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(ue||(ue={})),function(e){var t,n;(t=e.ShowType||(e.ShowType={}))[t.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",t[t.PAGE_AUTO=10]="PAGE_AUTO",t[t.PAGE_CUSTOM=11]="PAGE_CUSTOM",t[t.ELEMENT=12]="ELEMENT",(n=e.TaskEventType||(e.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(de||(de={})),function(e){var t;(t=e.ShowType||(e.ShowType={}))[t.UNKNOWN2=0]="UNKNOWN2",t[t.PAGE=1]="PAGE"}(le||(le={}));var ve,ye,_e,me=!0,we=(new Date).valueOf(),Pe=function(e,t){var n,o;void 0===t&&(t=!1);var r=e.type,i=e.currentUrlPackage,a=e.referUrlPackage,c=e.name,u=void 0===c?"":c,d=e.action,l=e.beginTime,p=e.params,f=e.contentPackage,g=e.status,h=e.actionType,v=e.auto,y=((n={status:g?ue.ActionStatus[g]||ue.ActionStatus.UNKNOWN_STATUS:ue.ActionStatus.SUCCESS})[t?"show_type":"action_type"]=h?ue.ActionType[h]||ue.ActionType.UNKNOWN_ACTION_TYPE:ue.ActionType.CLICK,n.url_package=i,n.refer_url_package=a,n[t?"content_wrapper":"content_package"]=f,n);if("PV"===r){var _=ue.SubAction.PAGE_ENTER,m=ue.PageShowAction.ENTER,w=me,P=0;switch(me=!1,d){case"leave":m=ue.PageShowAction.LEAVE,_=ue.SubAction.PAGE_LEAVE,P=C((new Date).valueOf()-(l||we));break;case"enter":m=ue.PageShowAction.ENTER,_=ue.SubAction.PAGE_ENTER,we=(new Date).valueOf();break;case"visible":m=ue.PageShowAction.RESUME,_=ue.SubAction.PAGE_RESUME,we=(new Date).valueOf();break;case"hidden":m=ue.PageShowAction.LEAVE,_=ue.SubAction.PAGE_PAUSE,P=C((new Date).valueOf()-(l||we))}var S=v?de.ShowType.PAGE_AUTO:de.ShowType.PAGE_CUSTOM;return t&&(w=void 0,S=le.ShowType.PAGE),{show_event:s({action:m,sub_action:_,type:S,first_load:w,time_cost:0,stay_length:P},y)}}return{show_event:s({action:t?0:ue.PageShowAction.ENTER,type:t?0:de.ShowType.ELEMENT,sub_action:t?0:ue.SubAction.PAGE_ENTER,element_package:(o={},o[t?"action2":"action"]=u,o.params=JSON.stringify(p),o)},y)}},Se=function(e,t){var n,o;void 0===t&&(t=!1);var r=e.sessionId,i=e.currentUrlPackage,a=e.referUrlPackage,c=e.name,u=e.params,d=e.type,l=e.contentPackage,p=e.status,f=e.taskType,g=e.operationDirection,h=((n={url_package:i,refer_url_package:a,element_package:(o={},o[t?"action2":"action"]=c,o.params=JSON.stringify(u),o)})[t?"content_wrapper":"content_package"]=l,n);if(t){var v="USER_OPERATION"===f||"CLICK"===d&&!f,y=d&&ue.OperationType[d]||ue.OperationType.CLICK;return v?{click_event:s({type:y,direction:g&&ue.Direction[g]||ue.Direction.UNKNOWN2},h)}:{task_event:s({action2:c,status:p&&ue.TaskStatus[p]||ue.TaskStatus.UNKNOWN_STATUS},h)}}return{task_event:s({type:f&&de.TaskEventType[f]||de.TaskEventType.USER_OPERATION,status:p&&ue.TaskStatus[p]||ue.TaskStatus.UNKNOWN_STATUS,operation_type:ue.OperationType[d]||ue.OperationType.CLICK,operation_direction:g&&ue.Direction[g]||ue.Direction.UNKNOWN2,session_id:r},h)}},Ee=function(e){var t=e.name,n=e.params,o=e.currentUrlPackage,r=e.referUrlPackage,i=c(e,["name","params","currentUrlPackage","referUrlPackage"]);return{key:t,value:JSON.stringify(s(s({url_package:o,refer_url_package:r},n),i))}},ke=function(e){var t=e.currentUrlPackage,n=e.referUrlPackage,o=e.options;return{video_stat_event:s(s({},o),{url_package:t,refer_url_package:n})}},Oe={},be=function(e){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var t=Number(function(e){try{if(window&&window.localStorage){var t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}}}catch(e){return null}return null}(e))||0;return t+1>1e8&&(t=0),function(e,t){try{if(window&&window.localStorage)return window.localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return!1}}(e,t+1),t}}catch(e){}return Oe[e]||(Oe[e]=0),Oe[e]++},Ue=(ve=(new Date).getTimezoneOffset()/60)<=0?"GMT+".concat(k(-ve+"",2,"0"),":00"):"GMT-".concat(k(ve+"",2,"0"),":00"),Te=function(){function e(e,t){void 0===t&&(t=!1),this.client_timestamp=C((new Date).valueOf()),this.client_increment_id=0,this.session_id=p.sessionId,this.event_id="",t||(this.time_zone=Ue),Object.assign(this,e),this.genIncrementId()}return e.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?be("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):be("WEBLOGGER_INCREAMENT_ID_KEY")},e.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},e.prototype.getEventType=function(){if(this.event_package){var e=this.event_package,t=e.task_event,n=e.show_event,o=e.click_event,r=e.custom_event;if(n)return"showEvent";if(o)return"clickEvent";if(t)return"taskEvent";if(r)return"customEvent"}return"customEvent"},e}();function Ne(e,t,n){var o;void 0===n&&(n=!1);var r,i=t.eventId,a=t.currentUrlPackage,s=t.referUrlPackage,u=t.contentPackage,d=t.name,l=t.params;switch(n&&"RADAR"!==e&&"CUSTOM"!==e&&(a&&(a.page2=a.page,delete a.page),s&&(s.page2=s.page,delete s.page)),e){case"PV":case"SHOW":return new Te({event_package:Pe({type:e,status:t.status,currentUrlPackage:a,referUrlPackage:s,action:t.type,beginTime:t.beginTime,actionType:t.actionType,name:d,params:l,contentPackage:u,operationDirection:t.operationDirection,auto:t.auto},n),event_id:i},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var f=Ee({name:d,params:l,currentUrlPackage:a,referUrlPackage:s});return new Te(n?{event_package:{custom_event:f},event_id:i}:{stat_package:{custom_stat_event:f},event_id:i},n);case"RADAR":return new Te({stat_package:{custom_stat_event:Ee({name:d,params:l,currentUrlPackage:a,referUrlPackage:s})},event_id:i},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new Te({stat_package:(o={},o[e.toLowerCase()]=(r=t,r.currentUrlPackage,r.referUrlPackage,r.taskType,c(r,["currentUrlPackage","referUrlPackage","taskType"])),o)},n);case"VIDEO":return new Te(n?{stat_package:ke({currentUrlPackage:a,referUrlPackage:s,options:l.params}),event_id:i}:{event_package:Se({type:e,status:t.status,taskType:t.taskType,sessionId:p.sessionId,currentUrlPackage:a,referUrlPackage:s,name:d,params:l.params,contentPackage:u},n),event_id:i},n);default:return new Te({event_package:Se({type:e,status:t.status,taskType:t.taskType,sessionId:p.sessionId,currentUrlPackage:a,referUrlPackage:s,name:d,params:l,contentPackage:u},n),event_id:i},n)}}var Ae,Le=(null===(ye=null===window||void 0===window?void 0:window.navigator)||void 0===ye?void 0:ye.userAgent)||"",Ce=function(e){var t,n,o,r;if(void 0===e&&(e=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.userAgent),_e&&e===Le)return _e;var i="unknow",a=/android/i,s="Mac OS",c="Windows",u="Android",d="iPhone",l="iPhone",p="Windows Phone",f="Linux";_e={os:{name:i,version:i},model:i};try{var g=e.match(/\((.*?)\)/);if(!g)return a.test(e)&&(_e.os.name=u),_e;var h=g[1]+")",v=h.split(";").map((function(e){return e.trim()})),y=void 0,_=void 0,m=void 0;if(e.indexOf(p)>-1)m=y=p,(S=h.match(/Windows\sPhone\s(.*?)[;\)\s]/))&&(_=S[1]),m=null===(n=v[v.length-1])||void 0===n?void 0:n.replace(")","");else if(a.test(e)){y=u;var w=h.match(/android.*?;(.*?)build\//i);w&&(m=(m=null===(o=w[1])||void 0===o?void 0:o.split(";").pop())&&m.trim());for(var P=0;P<v.length;P++)if(a.test(v[P])){_=null===(r=v[P])||void 0===r?void 0:r.replace(a,""),m||(m=v[P+1]);break}}else if(e.indexOf(d)>-1||e.indexOf(l)>-1){m=e.indexOf(d)>-1?d:l,y="iOS",(S=h.match(/OS\s(.*?)\slike/))&&(_=S[1])}else if(e.indexOf(s)>-1){m=y=s,(S=h.match(/OS\sX\s(.*?)[;\)\s]/))&&(_=S[1])}else if(e.indexOf(c)>-1){var S;m=y=c,(S=h.match(/Windows\s(.*?)[;\)]/))&&(_=S[1])}else if(e.indexOf("Nokia")>-1){y="Symbian";var E=e.match(/Symbian.*?\/(.*?);/);E&&(_=E[1]);var k=e.match(/Nokia(.*?)\//);k&&(m=k[1])}else h.indexOf(f)>-1&&(y=m=f);_e={os:{name:y||i,version:_&&_.replace(/_/g,".").trim()||i},model:m||i}}catch(e){}return _e};function Ie(){return void 0===Ae&&(Ae=O()&&_("kpn")||function(){if("undefined"==typeof window)return"";for(var e=window.navigator.userAgent,t=[[/ Kwai\//,"KUAISHOU"],[/ ksthanos\//,"THANOS"],[/ ksNebula\//i,"NEBULA"]],n=0;n<t.length;n++){var o=t[n],r=o[0],i=o[1];if(r.exec(e))return i}return""}()||""),Ae}var xe,Re,De,Ge={supportsPushState:function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},getUAInfo:Ce,getDefaultKpn:Ie},Ke=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.__yodaBridge__)||void 0===e?void 0:e.invoke)},We=function(e,t){return void 0===t&&(t="tool"),u(void 0,void 0,void 0,(function(){var n;return d(this,(function(o){switch(o.label){case 0:return void 0===xe?[2,!1]:[4,xe("tool.canIUse",{namespace:t,name:e})];case 1:return[2,(null==(n=o.sent())?void 0:n.canUse)||!1]}}))}))},Me={setClientLog:function(e,t){return u(void 0,void 0,void 0,(function(){var n;return d(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,xe("tool.setClientLog",{type:e,data:t})];case 1:return[2,o.sent()];case 2:return n=o.sent(),P("[error 206]","yoda.tool.setClientLog() 报错: ".concat(n.message)),[3,3];case 3:return[2]}}))}))},sendRadarLog:function(e){return u(void 0,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,xe("tool.sendRadarLog",e)];case 1:return[2,n.sent()];case 2:return t=n.sent(),P("[error 207]","yoda.tool.sendRadarLog() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))}))},sendWebLog:function(e){return u(void 0,void 0,void 0,(function(){return d(this,(function(t){try{return[2,xe("tool.sendWebLog",e)]}catch(e){P("[error 214]","yoda.tool.sendWebLog() 报错: ".concat(e.message))}return[2]}))}))},sendSummarizedLog:function(e){return u(void 0,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,xe("tool.sendSummarizedLog",e)];case 1:return[2,n.sent()];case 2:return t=n.sent(),P("[error 208]","yoda.tool.sendSummarizedLog() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))}))},getWebviewLoadPerf:function(e,t){return void 0===e&&(e={}),u(void 0,void 0,void 0,(function(){var n;return d(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,xe("webview.getPageLoadData",e,t)];case 1:return[2,o.sent()];case 2:return n=o.sent(),P("[error 209]","yoda.webview.getPageLoadData() 报错: ".concat(n.message)),[3,3];case 3:return[2]}}))}))},getKDSWebviewLoadPerf:function(e){return void 0===e&&(e={}),u(void 0,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,xe("system.getPageLoadData",e)];case 1:return[2,n.sent()];case 2:return t=n.sent(),P("[error 209]","yoda.system.getPageLoadData() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))}))},isSupportBridgeLog:function(){return We("setClientLog")},isSupportBridge:We,invoke:xe},je={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(e){e.CLICK="CLICK",e.DOUBLE_CLICK="DOUBLE_CLICK",e.TRIPLE_CLICK="TRIPLE_CLICK",e.LONG_PRESS="LONG_PRESS",e.PULL="PULL",e.DRAG="DRAG",e.SCALE="SCALE",e.PULL_DOWN="PULL_DOWN",e.PULL_UP="PULL_UP",e.AUTO="AUTO"}(Re||(Re={})),function(e){e.PV="PV",e.SHOW="SHOW",e.VIDEO="VIDEO",e.CUSTOM="CUSTOM",e.CUSTOM_EVENT="CUSTOM_EVENT",e.RADAR="RADAR"}(De||(De={}));var Ve=function(){function e(e){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:je.unknown},this.h5_extra_attr={sdk_name:"webLogger",sdk_version:"3.10.23",sdk_bundle:"log.browser.js"},this.global_attr={entry_tag:[]},this.location_package={country:void 0,province:void 0,city:void 0,county:void 0,street:void 0,latitude:void 0,longitude:void 0},this.update(e),this.app_package.version_name){var t=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(t+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return e.prototype.getH5ExtraAttr=function(e){return Object.assign({},this.h5_extra_attr,e)},e.prototype.update=function(e){if("object"==typeof e){!function(e,t){if(T(e)&&T(t)){var n=function(e,t,n){T(e[n])&&T(t[n])?Object.assign(e[n],t[n]):T(e[n])||T(t[n])||(e[n]=t[n])};for(var o in t)if(e.hasOwnProperty(o))n(e,t,o);else for(var r in e)T(e[r])&&e[r].hasOwnProperty(o)&&n(e[r],t,o)}}(this,e);var t=e.network_type;t&&je[t]&&(this.network_package.type=je[t])}},e.prototype.updateGlobalAttr=function(e){Object.assign(this.global_attr||{},e)},e.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var e=s(s({},this),{toJSON:function(){return s(s({},e),{h5_extra_attr:JSON.stringify(e.h5_extra_attr),global_attr:JSON.stringify(e.global_attr)})}});e.global_attr=s({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?e.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete e.global_attr.entry_tag,Object.keys(this.global_attr).length||delete e.global_attr;var t=this.location_package;return t&&Object.keys(t).forEach((function(e){void 0===t[e]&&delete t[e]})),e},e}(),Be=[["a7","640x1136",["iPhone 5","iPhone 5s"]],["a7","1536x2048",["iPad Air","iPad Mini 2","iPad Mini 3"]],["a8","640x1136",["iPod touch (6th gen)"]],["a8","750x1334",["iPhone 6"]],["a8","1242x2208",["iPhone 6 Plus"]],["a8","1536x2048",["iPad Air 2","iPad Mini 4"]],["a9","640x1136",["iPhone SE"]],["a9","750x1334",["iPhone 6s"]],["a9","1242x2208",["iPhone 6s Plus"]],["a9x","1536x2048",["iPad Pro (1st gen 9.7-inch)"]],["a9x","2048x2732",["iPad Pro (1st gen 12.9-inch)"]],["a10","750x1334",["iPhone 7"]],["a10","1242x2208",["iPhone 7 Plus"]],["a10x","1668x2224",["iPad Pro (2th gen 10.5-inch)"]],["a10x","2048x2732",["iPad Pro (2th gen 12.9-inch)"]],["a11","750x1334",["iPhone 8"]],["a11","1242x2208",["iPhone 8 Plus"]],["a11","1125x2436",["iPhone X"]],["a12","828x1792",["iPhone Xr"]],["a12","1125x2436",["iPhone Xs"]],["a12","1242x2688",["iPhone Xs Max"]],["a12x","1668x2388",["iPad Pro (3rd gen 11-inch)"]],["a12x","2048x2732",["iPad Pro (3rd gen 12.9-inch)"]]],He=function(){try{var e=Ce(),t=O(),n=e.model||e.os.name||"unknown";if("iOS"!==e.os.name||t)return n;var o=function(){for(var e=A(),t=[],n=0,o=Be;n<o.length;n++){var r=o[n];e===r[1]&&(t=t.concat(r[2]))}return t.length&&t}();return o?o.join(" or "):n}catch(e){return"unknown"}},Je=0;function Qe(){try{var e=Ce().os.name;return Je=e?"Android"===e?O()?6:8:"iOS"===e?O()?7:9:10:0}catch(e){return 0}}function Ye(){var e="unknown",t=null===window||void 0===window?void 0:window.navigator,n=(null==t?void 0:t.connection)||(null==t?void 0:t.mozConnection)||(null==t?void 0:t.webkitConnection);return n&&(e=n.type||n.effectiveType),e}var Fe,ze=function(e){function t(t){var n=e.call(this,s({platform:Qe(),container:10===Je?"WEB":"H5",version_name:O()&&_("appver",void 0,!0)||"",network_type:Ye(),device_id:K(),user_id:_("userId"),global_id:O()&&_("egid")||"",app_package:{language:navigator.language},device_package:{os_version:Ce().os.version,model:He(),ua:navigator.userAgent}},t))||this;return Object.assign(n.h5_extra_attr,{host_product:Ie(),resolution:A(),screen_width:C(screen.width),screen_height:C(screen.height),device_pixel_ratio:window.devicePixelRatio||1,domain:window.location.origin,fromIframe:(null===window||void 0===window?void 0:window.self)!==(null===window||void 0===window?void 0:window.top)},t.h5_extra_attr),delete n.location_package,n}return a(t,e),t.prototype.getVersionName=function(){return this.app_package.version_name},t.prototype.update=function(t){e.prototype.update.call(this,t);var n=this.app_package.version_name;if("string"==typeof n){var o=n.lastIndexOf(".");this.app_package.version_code=+n.slice(o+1)||0,this.h5_extra_attr.app_version_name=n}},t.prototype.setAdditionalSeqIdPackage=function(e){var t,n;this.additional_seq_id_package={channel:3,channel_seq_id:(n="NORMAL",void 0===n&&(n=""),be("".concat("WEBLOGGER_CHANNEL_SEQ_ID","_").concat(n))),custom_type:e,custom_seq_id:(t=e,be("".concat("WEBLOGGER_V2_SEQ_ID","_").concat(t)))}},t.prototype.increaseH5SeqId=function(e){this.h5_extra_attr.client_timestamp=C((new Date).valueOf()),this.h5_extra_attr.seq_id=be(e?"WEBLOGGER_H5_CUSTOM_SEQ_ID":"WEBLOGGER_H5_SEQ_ID")},t}(Ve),qe=function(e,t,n,o){var r;void 0===t&&(t={}),"string"!=typeof e&&(r=e.type),r=e.toUpperCase();var i={};if("string"==typeof t)i.contentPackage=o,"CUSTOM"===e?(i.key=t,i.value=n):(i.params=n,"PV"===e?i.page=t:i.action=t);else if(i=t,["CUSTOM","CUSTOM_EVENT"].includes(r)){var a=t;a.action&&!a.key&&(i.key=a.action),a.params&&!a.value&&(i.value=a.params)}return[r,i]},Xe="WEBLOGGER_SILENCED";"undefined"!=typeof window&&("object"!=typeof window._WEBLOGGER&&(window._WEBLOGGER={_silenced:!1,constructors:[],instances:[],silence:function(e){try{e?sessionStorage.setItem(Xe,"1"):sessionStorage.removeItem(Xe),window._WEBLOGGER.instances.forEach((function(t){null==t||t.silence(e)}))}catch(e){}}}),Fe=window._WEBLOGGER);var $e,Ze=!1,et=Math.random(),tt=function(e){function t(t,n){void 0===t&&(t={});var o,r,i,a=e.call(this,t,n)||this;return a.beforeUnload=function(e){if(!Ze){for(var t in a.logger.drain(),a.plugins){var n=a.plugins[t];"function"==typeof n.beforeUnload&&n.beforeUnload(e)}Ze=!0,setTimeout((function(){Ze=!1}),2e3)}},a.isBridge=t.bridgeMode&&t.yoda&&Ke(),a.logConfig.isBridge=a.isBridge,o="sessionId",r=n&&n.session_id||_("sid")||function(){var e="";try{if(O()){if(e=_("session_id")||_("sid"))return e}else"undefined"!=typeof sessionStorage&&((e=sessionStorage.getItem(W)||"")||(e=D(),sessionStorage.setItem(W,e)))}catch(t){e=D()}return e||D()}(),p[o]=r,a.isV2="v2"===a.logConfig.proto,a.getSampled(a.logConfig),a.presetBaseOption(a.baseOption),a.commonPackage=new ze(a.baseOption),a.logger=new he(a.logConfig,a.commonPackage),a.initYoda(),a.addPlugins(),S(window,"pagehide",a.beforeUnload),S(window,"beforeunload",a.beforeUnload),i=a,(null==Fe?void 0:Fe.instances)&&i&&-1===Fe.instances.indexOf(i)&&(Fe.instances.push(i),Fe._silenced&&(null==i||i.silence(!0))),a}return a(t,e),t.prototype.getSampled=function(e){var t=e||{},n=t.sampleRateFn,o=t.sampleRate;"function"==typeof n?this.sampled=!!n():void 0!==o&&(this.sampled=et<Number(o))},t.prototype.presetBaseOption=function(e){this.isBridge||(this.isV2?("number"!=typeof e.product&&P("[error 101]","请设置有效的 product 值，值类型为 number!"),delete e.product_name):(e.product_name&&"string"==typeof e.product_name||P("[error 100]","请设置有效的 product_name 值，值类型为 string!"),delete e.product),e.user_id||(e.user_id=_("userId")||_("userName")||void 0,e.user_id||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.warn;n&&n.call.apply(n,l([console],e,!1))}catch(e){return}}("[warn 102]","user_id 为空，请确定是否传入，如果是异步通过 updateCommonPackage 接口传入，可以忽略该提示!")),e.device_id||(e.device_id=K(),e.device_id||P("[error 103]","device_id 为空，请设置有效的设备 id!")),!e.global_id&&O()&&(e.global_id=_("egid")||""))},Object.defineProperty(t.prototype,"yoda",{get:function(){return this.logConfig.yoda||(null===window||void 0===window?void 0:window.KSYoda)||(null===window||void 0===window?void 0:window.yoda)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Utils",{get:function(){return{yoda:Ke()&&this.yoda?Me:null,cookie:w,ua:Ge,io:{sendData:ae}}},enumerable:!1,configurable:!0}),t.prototype.initYoda=function(){var e,t=this;Ke()&&this.yoda&&(e=this.yoda,xe="function"==typeof e?e:e.invoke,u(void 0,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,xe("system.getDeviceInfo")];case 1:return[2,t.sent()];case 2:return e=t.sent(),P("[error 209]","yoda.system.getDeviceInfo() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))})).then((function(e){(null==e?void 0:e.mod)&&(t.commonPackage.device_package.model=e.mod)})),u(void 0,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,xe("system.getAppInfo")];case 1:return[2,t.sent()];case 2:return e=t.sent(),P("[error 209]","yoda.system.getAppInfo() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))})).then((function(e){if("object"==typeof e){var n=e.did,o=e.userId,r=e.appver;n&&(t.commonPackage.identity_package.device_id=n),o&&!t.commonPackage.identity_package.user_id&&(t.commonPackage.identity_package.user_id=o),r&&(t.commonPackage.app_package.version_name=r)}})))},t.prototype.initUrlPackage=function(){e.prototype.initUrlPackage.call(this);var t,n=this.logConfig.referer,o="web";n?(t=n.value,o=n.type&&n.type||o):"undefined"!=typeof document&&document.referrer&&(t=document.referrer),t&&this.updateReferUrlPackage(t,o)},t.prototype.updateCurrentUrlPackage=function(e,t){if(void 0===e&&(e=(null===location||void 0===location?void 0:location.href)||""),void 0===t&&(t="web"),"object"==typeof e&&!e.force&&this.currentUrlPackage){var n=e.page,o=void 0===n?this.currentUrlPackage.page:n,r=e.params,i=void 0===r?{}:r;if(o===this.currentUrlPackage.page)return this.currentUrlPackage.update(o,i)}this.currentUrlPackage=new M(e,t,this.logConfig.urlMap),this.logConfig.attachUrl&&this.currentUrlPackage.attachUrl()},t.prototype.updateReferUrlPackage=function(e,t){void 0===e&&(e=this.currentUrlPackage),void 0===t&&(t="web"),this.referUrlPackage=e instanceof M?e:new M(e,t,this.logConfig.urlMap)},Object.defineProperty(t.prototype,"isSendSampled",{get:function(){return void 0===this.sampled||this.sampled||this.logger.isDebug},enumerable:!1,configurable:!0}),t.prototype.generateLog=function(e,t,n){void 0===n&&(n=Ne);var o,r=t,i=r.action,a=r.params,c=r.status,u=r.type,d=r.eventId,l=r.contentPackage,p=r.urlPage;l&&(l="string"==typeof l?l:JSON.stringify(l));var f="PV"===e;if(f){var g=t,h=g.page,v=g.type;v||(t.type=v="enter"),"enter"===v&&h?this.updateCurrentUrlPackage({page:h,params:a}):this.currentUrlPackage.update(h,a)}else p&&p.page&&(o={page:p.page,identity:p.identity||D(),params:JSON.stringify(p.params),page_type:this.currentUrlPackage.page_type});var y={currentUrlPackage:o||this.currentUrlPackage.toJSON(),referUrlPackage:this.referUrlPackage?this.referUrlPackage.toJSON():void 0,contentPackage:l};if("RADAR"!==e&&(null==o||o.page.indexOf("http")),f){var _=t.type;return n(e,s(s(s({},t),{type:_}),y),this.isV2)}if("SHOW"===e)return n(e,s(s(s({},t),{name:i}),y),this.isV2);if("VIDEO"===e)return n(e,s({params:t,name:"VIDEO"},y),this.isV2);if("RADAR"===e)return n(e,t,this.isV2);if(-1!==["CUSTOM","RADAR","CUSTOM_EVENT"].indexOf(e)){var m=t,w=m.key,P=m.value;return n("CUSTOM",s(s(s({},t),{params:P,name:w}),y),this.isV2)}return n(e,s(s(s({},t),{params:a,status:c,taskType:u,eventId:d,name:i}),y),this.isV2)},t.prototype.collect=function(e,t,n,o){var r=qe(e,t,n,o),i=r[0],a=r[1];return this.send(i,a,!1)},t.prototype.sendImmediately=function(e,t,n,o){var r=qe(e,t,n,o),i=r[0],a=r[1];return this.send(i,a,!0)},t.prototype.send=function(e,t,n){if(!this._silenced){var o,r=this.generateLog(e,t);if(this.emit("event",{type:e,action:null==t?void 0:t.action,log:r}),"RADAR"===e)return this.logger.sendRadar(r,null==t?void 0:t.serviceName);if(!(this.isV2&&this.logConfig.forbidV2HttpUrlPage&&(o=this.currentUrlPackage.page,o&&/^(https?:)?\/\//.test(o)&&(P("[error 108]","请注意当前埋点页面信息为 ".concat(o,"，不符合规范，上报失败！")),1))))if(this.isSendSampled){var i="object"==typeof t&&t.callback||void 0;this.logger.send(r,!!n,i)}}},t.prototype.destroy=function(){e.prototype.destroy.call(this),E(window,"pagehide",this.beforeUnload),E(window,"beforeunload",this.beforeUnload),function(e){if(null==Fe?void 0:Fe.instances){var t=Fe.instances.indexOf(e);-1!==t&&Fe.instances.splice(t,1)}}(this)},t.prototype.silence=function(e){this._silenced=e},t.Logger=he,t}(R),nt=function(){function e(){}return e.prototype.apply=function(e){this.weblog=e},e}();$e=tt,void 0!==window._GLOBAL_KS_WEBLOGGER_?window._GLOBAL_KS_WEBLOGGER_.Factory=$e:window.Weblog=$e,(null==Fe?void 0:Fe.constructors)&&$e&&-1===Fe.constructors.indexOf($e)&&($e._classId=Fe.constructors.length,Fe.constructors.push($e)),function(){if(null==Fe?void 0:Fe.silence)try{Fe._silenced=!!sessionStorage.getItem(Xe)}catch(e){}}(),e.BasePlugin=nt,e.Weblog=tt,e.default=tt,Object.defineProperty(e,"__esModule",{value:!0})}));
