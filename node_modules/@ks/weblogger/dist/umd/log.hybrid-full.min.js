!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@yoda/bridge")):"function"==typeof define&&define.amd?define(["exports","@yoda/bridge"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Weblog={},t.KSYoda)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}function s(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))}function c(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function u(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var l,p,d,f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){void 0===f.window&&(f.window={addEventListener:function(){},removeEventListener:function(){},setTimeout:function(){},setInterval:function(){},_WEBLOGGER_MOCKED_WINDOW_:!0,global:f}),void 0===f.document&&(f.document=f.window.document||{cookie:"",addEventListener:function(){},removeEventListener:function(){},querySelector:function(){},querySelectorAll:function(){}},void 0===f.window.document&&(f.window.document=f.document)),void 0===f.navigator&&(f.navigator=f.window.navigator||{userAgent:""},void 0===f.window.navigator&&(f.window.navigator=f.navigator)),void 0===f.screen&&(f.screen=f.window.screen||{},void 0===f.window.screen&&(f.window.screen=f.screen)),void 0===f.history&&(f.history=f.window.history||{},void 0===f.window.history&&(f.window.history=f.history)),void 0===f.location&&(f.location=f.window.location||{hostname:"",search:"",href:"",origin:""},void 0===f.window.location&&(f.window.location=f.location));try{void 0===f.localStorage&&(f.localStorage=f.window.localStorage||{getItem:function(){},setItem:function(){}},void 0===f.window.localStorage&&(f.window.localStorage=f.localStorage))}catch(t){}}(),Object.defineProperty||(Object.defineProperty=function(t,e,n){t[e]="[object Object]"===Object.prototype.toString.call(n)&&n.hasOwnProperty("value")?n.value:n}),Object.assign||Object.defineProperty(Object,"assign",{value:function(t){if(null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!==o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},writable:!0,configurable:!0}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,o=function(){},r=function(){var r=this instanceof o?this:t;return n.apply(r,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(o.prototype=this.prototype),r.prototype=new o,r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),r=o.length>>>0;if(0===r)return-1;var i=+e||0;if(Math.abs(i)===1/0&&(i=0),i>=r)return-1;for(n=Math.max(i>=0?i:r-Math.abs(i),0);n<r;){if(n in o&&o[n]===t)return n;n++}return-1}),Object.keys||(Object.keys=(l=Object.prototype.hasOwnProperty,p=!{toString:null}.propertyIsEnumerable("toString"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var n in t)l.call(t,n)&&e.push(n);if(p)for(var o=0,r=d;o<r.length;o++){var i=r[o];l.call(t,i)&&e.push(i)}return e})),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,o;if(null==this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),o=0;o<i;){var a=void 0;o in r&&(a=r[o],t.call(n,a,o,r)),o++}});var h={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},g=function(){function t(t,e){switch(this.page="",this.identity="",e){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(t.page,t.params)}return t.prototype.update=function(t,e){void 0===t&&(t=""),t&&t!==this.page&&(this.page=t,this.identity=this.generatePageId(t)),e&&(this.params=Object.assign(this.params||{},e))},t.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params),category:this.category}},t.prototype.generatePageId=function(t){return t+(new Date).getTime()},t}(),m=["Kwai","Kwai_Lite","Kwai_Pro","livemate","ksthanos","ksNebula","ksnebula","kwaiying","pearl","kinder","m2u","LOLita","XFunCore","ACVideoCore","ZIKZAK"].concat(["UVideo","Vstatus","Kwaigo","MvMaster"]);function v(t,e,n){var o,r={};if(t.length>0)for(var i=e?decodeURIComponent:function(t){return t},a=t.split(/;\s/g),s=null,c=null,u=null,l=0,p=a.length;l<p;l++){if((u=null===(o=a[l])||void 0===o?void 0:o.match(/([^=]+)=/i))&&null!==u)try{s=decodeURIComponent(u[1]),c=i(a[l].substring(u[1].length+1))}catch(t){}else s=decodeURIComponent(a[l]),c="";null!==s&&(r[s]=c)}return r}var y,_={};function w(t,e,n){void 0===e&&(e={}),void 0===n&&(n=!1);try{if(!n&&t in _)return _[t];if(!(null===window||void 0===window?void 0:window.document))return;var o=document.cookie||"";return o===y?_[t]:(y=o,(_=v(o,!e.raw))[t])}catch(t){}}function S(t,e,n){void 0===n&&(n={});try{document.cookie=function(t,e,n,o){void 0===o&&(o={});var r="".concat(encodeURIComponent(t),"=").concat(n?encodeURIComponent(e):e),i=o.expires,a=o.path||"/",s=o.domain||"";return i instanceof Date&&(r+="; expires=".concat(i.toUTCString())),"number"==typeof i&&(r+="; max-age==".concat(i)),""!==a&&(r+="; path=".concat(a)),""!==s&&(r+="; domain=".concat(s)),!0===o.secure&&(r+="; secure"),r}(t,e,!n.raw,n),_[t]=e}catch(t){}}var b={getCookie:w,setCookie:S,parseCookieString:v};function k(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.log;return n&&n.call.apply(n,u([console],t,!1))}catch(t){return}}function E(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.warn;return n&&n.call.apply(n,u([console],t,!1))}catch(t){return}}function P(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,u([console],t,!1))}catch(t){return}}function O(t,e,n,o){return"attachEvent"in t?t.attachEvent("on"+e,n):t.addEventListener(e,n,o)}function T(t,e,n,o){return"attachEvent"in t?t.detachEvent("on"+e,n):t.removeEventListener(e,n,o)}function C(t,e,n){if(void 0===n&&(n=" "),(e-=t.length)<=0)return t;for(var o="";e;)1&e&&(o+=n),e>>=1,n+=n;return o+t}var L=function(t){void 0===t&&(t=window.navigator.userAgent.toLowerCase());try{for(var e=0;e<m.length;e++)if(t.indexOf(m[e].toLowerCase())>-1)return!0}catch(t){return!1}};function A(t){for(var e={},n=0,o=t.split("&");n<o.length;n++){var r=o[n].split("="),i=r[0],a=r[1];i in e?e[i]instanceof Array?e[i].push(a):e[i]=[e[i],a]:e[i]=a}return e}function I(){var t=w("appver",void 0,!0);return t&&function(t,e){if(!e)return!1;if(-1!==e.indexOf("alpha"))return!1;if(-1!==e.indexOf("beta"))return!1;try{var n=t.match(/\d+\.\d+\.\d+/);if(!(t=(null==n?void 0:n[0])||""))return!0;if(n=e.match(/\d+\.\d+\.\d+/),!(e=(null==n?void 0:n[0])||""))return!1;var o=t.split(".").map((function(t){return Number(t)})),r=o[0],i=o[1],a=o[2],s=e.split(".").map((function(t){return Number(t)})),c=s[0],u=s[1],l=s[2];return!(c<r||!(c>r)&&(u<i||!(u>i)&&l<a))}catch(t){return!1}}("10.8.30",t)}function N(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");return-1===e?{page:t}:{page:t.slice(0,e),params:A(t.slice(e+1))}}var U=function(t,e){var n=t.url,o=t.page,r=t.params,i=t.pageId;if(!o&&"string"==typeof n){var a=N(n);o=a.page,r=a.params}if("function"==typeof e)try{var s=e({url:n,page:o,params:r});"string"==typeof s?o=s:"object"==typeof s&&(s.page&&(o=s.page),s.params&&(r=s.params),s.pageId&&(i=s.pageId))}catch(t){}else if("object"==typeof e){var c="";for(var u in e)if((n||o||"").indexOf(u)>-1){c=e[u];break}c&&(o=c)}return{page:o,params:r,pageId:i}},R=function(t){return t&&"object"==typeof t&&!Array.isArray(t)};function x(t){return!t||!/^(https?:)?\/\//.test(t)||(P("[error 108]","请注意当前埋点页面信息为 ".concat(t,"，不符合规范，上报失败！")),!1)}var D,j=(D="",function(){if(D)return D;try{var t=window.devicePixelRatio||1,e=Math.floor(screen.width*t),n=Math.floor(screen.height*t);return D="".concat(e,"x").concat(n)}catch(t){return""}});var M=function(){return!(!((null===window||void 0===window?void 0:window.Worker)&&(null===window||void 0===window?void 0:window.Uint8Array)&&window.URL&&window.Promise)||function(){var t,e,n=(null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.userAgent)||"",o=/mobile|tablet|ip(ad|hone|od)|android|(windows phone)/i.test(n),r="MacIntel"===(null===window||void 0===window?void 0:window.navigator.platform)&&(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.maxTouchPoints)>1;return o||r}())},H=function(t){try{return Math.abs(Math.floor(t))}catch(e){return t}};function B(t){return"string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""}var G=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var n;e&&"function"==typeof e&&(this.events[t]=this.events[t]||[],null===(n=this.events[t])||void 0===n||n.push(e))},t.prototype.off=function(t,e){if(this.events[t]){if(e&&"function"==typeof e){var n=this.events[t];n&&(r=e,(i=(o=n).indexOf(r))>-1&&o.splice(i,1))}var o,r,i;e||(this.events[t]=[])}},t.prototype.emit=function(t){for(var e,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.events[t]&&(null===(e=this.events[t])||void 0===e||e.forEach((function(t){t.apply(void 0,n)})))},t}(),V=0,F=function(t){function e(n,o){var r,a=t.call(this)||this;return a.version="3.10.23",a.plugins={},a.flush=function(){a.logger.flush()},a.baseOption=i({},o),a.logConfig=(r=n,i({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda,forbidV2HttpUrlPage:!0},r||{})),a.initUrlPackage(),e.__instance||(e.__instance=a),a}return r(e,t),Object.defineProperty(e.prototype,"sessionId",{get:function(){return h.sessionId},enumerable:!1,configurable:!0}),e.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e="web"),"object"==typeof t&&t.page&&this.currentUrlPackage&&t.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(t.page,t.params);this.currentUrlPackage=new g(t,e)},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof g?t:new g(t,e)},e.prototype.updateBase=function(t){this.updateCommonPackage(t)},e.prototype.updateCommonPackage=function(t){"object"==typeof t&&this.commonPackage.update(t)},e.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},e.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(V++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},e.prototype.plug=function(t,e){if(this.plugins[t.key])return P("[code 301]","".concat(t.key," 插件重复加载！"));this.addPluginInstance(new t(this,e))},e.prototype.unplug=function(t){var e=this.plugins[t];e&&(e.destroy(),delete this.plugins[t])},e.prototype.unplugAll=function(){for(var t in this.plugins)this.plugins[t]&&this.unplug(t)},e.prototype.generateLog=function(t,e){return{}},e.prototype.send=function(t,e,n){var o=this.generateLog(t.toUpperCase(),e);return"function"==typeof this.beforeSend&&this.beforeSend(t,e,o),this.logger.send(o,!!n,e.callback)},e.prototype.collect=function(t,e){this.send(t,e)},e.prototype.sendImmediately=function(t,e){this.send(t,e,!0)},e.prototype.sendPackage=function(t,e){this.logger.sendPackage(t,e)},e.prototype.destroy=function(){this.unplugAll()},e}(G);function J(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function K(t){if(void 0===t&&(t="undefined"!=typeof location?location.hostname:""),!t)return"";var e=t.split("."),n=e.length;return n<=2?"":".".concat(e[n-2],".").concat(e[n-1])}function W(){try{var t=w("did")||w("_did");if(!t){t="web_".concat(function(){for(var t=1e9*Math.random()>>>0,e=[],n=0;n<7;n++)e.push("0123456789ABCDEF".charAt(16*Math.random()));return t+e.join("")}());var e=new Date;e.setFullYear(e.getFullYear()+1),S("_did",t,{expires:e,domain:K(),path:"/"})}return t}catch(t){return""}}var q="WEBLOGGER_SESSIONID",z=function(t){function e(e,n,o){var r=t.call(this,{},n)||this;if("string"==typeof e){var i=N(e);r.page=i.page,r.params=i.params}else r.page=(e||{}).page||"",r.params=(e||{}).params||void 0;return r.identity=r.generatePageId(),o&&"string"==typeof e&&r.init(e,o),r}return r(e,t),e.prototype.init=function(t,e){void 0===e&&(e={});var n=U({url:t,page:this.page,params:this.params},e),o=n.page,r=n.params;this.update(o,r)},e.prototype.attachUrl=function(){if(this.params||(this.params={}),null===location||void 0===location?void 0:location.href){this.params.origin_url=this.params.origin_url||(null===location||void 0===location?void 0:location.href);var t=N(location.href).page,e=void 0===t?"":t;this.params.origin_pathname=e}},e.prototype.getRealUrlPackage=function(){var t=N(location.href),e=t.page,n=t.params;return{page:e,params:JSON.stringify(i({page_code:this.page,url:location.href,query:n},n)),page_type:this.page_type,identity:this.identity}},e.prototype.generatePageId=function(){return J()},e}(g),Q="https://data-track.corp.kuaishou.com",Y=Q+"/",X="production",$="logger",Z="logger-oversea",tt="rest/wd/common/log/collect/",et=[X,"test","development",$,"oversea"],nt="https://logsdk.kwai-pro.com/",ot={v2:"rest/kd/log/collect?_json=1&biz=",v3:"".concat(tt,"misc2"),radar:"".concat(tt,"radar")},rt={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:Y,test:Y,oversea:nt},v3:{production:"https://log-sdk.ksapisrv.com/",development:Y,test:Y,oversea:nt}},it=function(t,e,n){return void 0===t&&(t=X),void 0===e&&(e=!1),void 0===n&&(n="v3"),-1===et.indexOf(t)?t+ot[n]:e&&rt.v3[t]?rt.v3[t]+ot.radar:rt[n][t]&&ot[n]?rt[n][t]+ot[n]:rt.v3.production+ot.v3},at=function(t,e){if(!e)return t;try{return/\?(.+?)$/.test(t)?t.replace(/\?(.+?)$/,"?".concat(e,"&$1")):t+"?".concat(e)}catch(e){return t}},st=function(){function t(t,e){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.isSetSamplingResult=!1,this.sendingYield=null,this.flush=function(t){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),t),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=t,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=e,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,this.updateUrls()}return t.prototype.sendData=function(t,e){return"function"==typeof this.config.sender?this.config.sender(t,e):this.baseSendData(t,e)},Object.defineProperty(t.prototype,"responseSamplingStorageKey",{get:function(){var t=this.commonPackage.app_package,e=t.product_name,n=t.product,o=this.commonPackage.identity_package.device_id;return"RESPONSE_SAMPLING_STORAGE_KEY_".concat(e||n,"_").concat(o)},enumerable:!1,configurable:!0}),t.prototype.updateUrls=function(){var t=this.config.env;t&&/^(https?:)?\/\//.test(t)?this.url=t:this.url=it(t),this.formatUrl()},t.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf(ot.v2)?ot.v2:ot.v3,ot.radar),-1!==this.radarUrl.indexOf(rt.v2.production||"")&&this.radarUrl.replace(rt.v2.production||"",rt.v3.production));var t=this.commonPackage.app_package,e=t.product_name,n=t.product,o="v=3.10.23&kpn=".concat(e||n);this.url=at(this.url,o),this.radarUrl=at(this.radarUrl,o)},t.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},t.prototype.send=function(t,e,n){if(void 0===e&&(e=!1),n||this.drained)return this.sendLogs([t],n);e?this.sendAsync(t,n):this.sendThrottle(t)},t.prototype.sendAsync=function(t,e){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.asyncQueue.push(t),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:e.sent(),this.sendingYield=null,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return e.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},t.prototype.sendThrottle=function(t){var e=this;this.throttleQueue.push(t),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){e.flush()}),this.config.wait))},t.prototype.sendLogs=function(t,e){var n=this;if(!t||!t.length)return"function"==typeof e&&e();var o=this.buildLogPackage(t,this.url);this.sendPackage(o,(function(t){t?n.errHandler(o):n.flushErrorLogs(),"function"==typeof e&&e(t)}))},t.prototype.sendPackage=function(t,e){var n=this.config.timeout;try{this.sendData(i(i({},t),{isDebug:this.isDebug,isDrained:this.drained,timeout:n}),e)}catch(t){"function"==typeof e&&e(t)}},t.prototype.buildLogPackage=function(t,e){return this.isV2?this.buildV2Package(t,e):this.buildV3Package(t,e)},t.prototype.buildV2Package=function(t,e){return{url:e,data:{log:{event:t}}}},t.prototype.buildV3Package=function(t,e,n){var o=this.getCommonPackageJSON();return n&&Object.assign(o,n),{url:e,data:{common:o,logs:t}}},t.prototype.errHandler=function(t){var e;if(this.isV2)this.errorQueue.unshift(t);else{var n=t.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var o=!1,r=0;r<this.errorQueue.length;r++){var i=this.errorQueue[r];if(i.url===t.url&&i.data.logs.length+n.logs.length<=100&&JSON.stringify(i.data.common)===JSON.stringify(n.common)){o=!0,(e=i.data.logs).push.apply(e,n.logs);break}}o||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(t))}}},t.prototype.flushErrorLogs=function(){var t=this;this.errorQueue.forEach((function(e){t.sendPackage(e)})),this.errorQueue=[]},t.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},t.prototype.sendRadar=function(t,e){var n=e?{service_name:e}:void 0,o=this.buildV3Package([t],this.radarUrl||this.url,n);this.sendPackage(o)},t}(),ct=function(t,e,n){return P("[error 400]","埋点上报接口请求报错","\nurl:",e,"\ndata",n,"\nerror:",t||"server decode log failed")};function ut(t,e){var n=t.url,o=t.data,r=t.timeout;return new Promise((function(t){var i=new XMLHttpRequest;return i.open("POST",n),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),"object"!=typeof o||o instanceof Uint8Array||(o=JSON.stringify(o)),r&&(i.timeout=r),i.onload=function(){var r=function(t,e,n,o){var r;if(t<200||t>=300&&304!==t);else try{var i=JSON.parse(e),a=i.exception,s=i.result,c=i.error_msg;a&&(r=a),1!==s&&(r=c||"result is ".concat(s))}catch(t){r=t.message}return r&&ct(r,n,o),r}(i.status,i.response,n,o);e&&e(r),t({error:r,response:r?void 0:i.response})},i.ontimeout=i.onerror=function(r){r&&ct(r,n,o),e&&e(r?"networkTimeout":""),t({error:"networkTimeout"})},i.send(o),i}))}var lt=function(t){var e=function(e){return P("[error 401]","GET 请求出错 url: ".concat(t),e)};try{var n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(),n.onerror=e}catch(t){e(t)}},pt=null===window||void 0===window?void 0:window.navigator,dt=pt&&-1!==pt.userAgent.indexOf("Chrome"),ft="function"==typeof pt.sendBeacon;function ht(t,e){var n=t.url,o=t.data,r=t.timeout;t.isDebug;var i=t.isDrained,a=t.forceSendBeacon;return s(this,void 0,void 0,(function(){var t;return c(this,(function(s){switch(s.label){case 0:return o=JSON.stringify(o),i&&function(t){var e=t.url,n=t.data,o=t.forceSendBeacon;if(!dt&&!o||!ft)return!1;"object"==typeof n&&n.fd&&(n=n.fd);try{return pt.sendBeacon(e,n)}catch(t){return P("[error 403]","navigator.sendBeacon 报错",t),!1}}({url:n,data:o,forceSendBeacon:a})?(e&&e(),[2]):[4,ut({url:n,data:o,timeout:r},e)];case 1:return[2,(t=s.sent()).error?void 0:t.response]}}))}))}var gt,mt=function(t,e,n){void 0===t&&(t=Q);var o="".concat(t,"/#/logger/index?sessionId=").concat(n);return k("%c埋点抓包校验: %c".concat(o),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),"".concat(e,"/").concat(n,"/")};!function(t){t.loading="loading",t.loaded="loaded"}(gt||(gt={}));var vt,yt,_t,wt=Object.create(null),St="weblogger_switch",bt=function(t){var e=function(){try{var t=w(St)||"undefined"!=typeof sessionStorage&&sessionStorage.getItem(St);if(!t)return;var e=JSON.parse(t),n=e.loggerSessionId,o=e.reportHost,r=e.loggerHost,i=e.handshakeApi;return n?(lt(i||"".concat(o,"/").concat(n)),mt(r,o,n)):""}catch(t){return""}}()||function(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");if(-1===e)return"";var n=A(t.slice(e+1)).webloggerSwitch;if(!n)return"";try{var o=decodeURIComponent(n),r=JSON.parse(o),i=r.loggerSessionId,a=r.reportHost,s=r.loggerHost,c=r.handshakeApi;return i?("undefined"!=typeof sessionStorage&&sessionStorage.setItem(St,o),lt(c||"".concat(a,"/").concat(i)),mt(s,a,i)):""}catch(t){return""}}();if(e)return it(e,!1,t)},kt=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.baseSendData=o.sendLog,o.getResponseSamplingStorage(),o}return r(e,t),e.prototype.getResponseSamplingStorage=function(){return s(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Promise.resolve()];case 1:return e.sent(),(t=Number(localStorage.getItem(this.responseSamplingStorageKey)))&&Date.now()<t?this.sendEffectiveTime=t:t&&localStorage.removeItem(this.responseSamplingStorageKey),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.isResponseSampling=function(){return!!(this.sendEffectiveTime&&Date.now()<this.sendEffectiveTime)},e.prototype.setResponseSamplingConfig=function(t){var e=this;this.isSetSamplingResult||(this.isSetSamplingResult=!0,null==t||t.then((function(t){var n;try{n=t&&JSON.parse(t)}catch(t){n={result:1,hostName:""}}var o=null==n?void 0:n.expireSeconds;if(o){var r=Date.now()+1e3*o;e.sendEffectiveTime=r,localStorage.setItem(e.responseSamplingStorageKey,String(r))}})))},e.prototype.updateUrls=function(){var t=this.config,e=t.env,n=void 0===e?X:e,o=t.logger,r=t.proto,i=t.isBridge,a=t.disableCompress,s=bt(r);if(s)this.url=s,this.isDebug=!0;else if(o||n===$||n===Z){var c=function(t,e){void 0===t&&(t=W()),void 0===e&&(e=!1);var n=e?"https://data-track-sgp.corp.kuaishou.com":Q;return lt("".concat(n,"/rest/").concat(t)),mt(n,"".concat(n,"/rest"),t)}(this.commonPackage.identity_package.device_id,n===Z);this.url=it(c,!1,r),this.isDebug=!0}else n&&/^(https?:)?\/\//.test(n)?this.url=n:(this.isDebug=n!==X,this.url=it(n,!1,r),this.radarUrl=it(n,!0,r));this.enableAsyncGzip=!a&&"v3"===r&&!i&&M()&&n===X&&!s&&!o,this.enableAsyncGzip&&function(t,e,n){if(void 0===e&&(e=!0),wt[t])return n&&n("".concat(t," load repeat"));var o=wt[t]={state:gt.loading},r=document.createElement("script");r.crossOrigin="anonymous",r.src=t,e&&(r.async=!0);var i=document.getElementsByTagName("script")[0];i&&i.parentNode?i.parentNode.insertBefore(r,i):document.head.appendChild(r),r.onload=function(){o.state=gt.loaded,n&&n()},r.onerror=function(e){o.state=gt.loaded,n&&n("".concat(t," loaded failed, ").concat(e))}}("https://static.yximgs.com/udata/pkg/ks-track-platform-new/weblogger/3.10.23/async/gzipper.min.js"),this.formatUrl()},e.prototype.sendLog=function(t,e){var n=this.config.forceSendBeacon;!this.isV2&&this.isResponseSampling()||!this.drained&&this.enableAsyncGzip&&this.sendGzip(t,e)||this.setResponseSamplingConfig(ht(i(i({},t),{forceSendBeacon:n}),e))},e.prototype.sendGzip=function(t,n){var o,r=this;if(!(null===(o=e.Gzipper)||void 0===o?void 0:o.sendData))return!1;var i=e.Gzipper.sendData(t,(function(e){e&&r.setResponseSamplingConfig(ht(t,n))}));return this.setResponseSamplingConfig(i),!!i},e.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},e.prototype.send=function(e,n,o){void 0===n&&(n=!1),this.isV2&&(this.commonPackage.setAdditionalSeqIdPackage(e.getEventType()),e.common_package=this.getCommonPackageJSON()),t.prototype.send.call(this,e,n,o)},e}(st);!function(t){var e,n,o,r,i,a,s,c;(e=t.ElementStatus||(t.ElementStatus={}))[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.CHECKED=1]="CHECKED",e[e.UNCHECKED=2]="UNCHECKED",(n=t.PageShowAction||(t.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(o=t.ActionStatus||(t.ActionStatus={}))[o.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",o[o.SUCCESS=1]="SUCCESS",o[o.FAIL=2]="FAIL",(r=t.ActionType||(t.ActionType={}))[r.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",r[r.CLICK=1]="CLICK",r[r.LEFT_PULL=2]="LEFT_PULL",r[r.RIGHT_PULL=3]="RIGHT_PULL",r[r.UP_PULL=4]="UP_PULL",r[r.DOWN_PULL=5]="DOWN_PULL",(i=t.SubAction||(t.SubAction={}))[i.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",i[i.PAGE_ENTER=1]="PAGE_ENTER",i[i.PAGE_LEAVE=2]="PAGE_LEAVE",i[i.PAGE_RESUME=3]="PAGE_RESUME",i[i.PAGE_PAUSE=4]="PAGE_PAUSE",(a=t.Direction||(t.Direction={}))[a.UNKNOWN2=0]="UNKNOWN2",a[a.UP=1]="UP",a[a.DOWN=2]="DOWN",a[a.LEFT=3]="LEFT",a[a.RIGHT=4]="RIGHT",(s=t.TaskStatus||(t.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=t.OperationType||(t.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(vt||(vt={})),function(t){var e,n;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT",(n=t.TaskEventType||(t.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(yt||(yt={})),function(t){var e;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN2=0]="UNKNOWN2",e[e.PAGE=1]="PAGE"}(_t||(_t={}));var Et,Pt,Ot,Tt=!0,Ct=(new Date).valueOf(),Lt=function(t,e){var n,o;void 0===e&&(e=!1);var r=t.type,a=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=void 0===c?"":c,l=t.action,p=t.beginTime,d=t.params,f=t.contentPackage,h=t.status,g=t.actionType,m=t.auto,v=((n={status:h?vt.ActionStatus[h]||vt.ActionStatus.UNKNOWN_STATUS:vt.ActionStatus.SUCCESS})[e?"show_type":"action_type"]=g?vt.ActionType[g]||vt.ActionType.UNKNOWN_ACTION_TYPE:vt.ActionType.CLICK,n.url_package=a,n.refer_url_package=s,n[e?"content_wrapper":"content_package"]=f,n);if("PV"===r){var y=vt.SubAction.PAGE_ENTER,_=vt.PageShowAction.ENTER,w=Tt,S=0;switch(Tt=!1,l){case"leave":_=vt.PageShowAction.LEAVE,y=vt.SubAction.PAGE_LEAVE,S=H((new Date).valueOf()-(p||Ct));break;case"enter":_=vt.PageShowAction.ENTER,y=vt.SubAction.PAGE_ENTER,Ct=(new Date).valueOf();break;case"visible":_=vt.PageShowAction.RESUME,y=vt.SubAction.PAGE_RESUME,Ct=(new Date).valueOf();break;case"hidden":_=vt.PageShowAction.LEAVE,y=vt.SubAction.PAGE_PAUSE,S=H((new Date).valueOf()-(p||Ct))}var b=m?yt.ShowType.PAGE_AUTO:yt.ShowType.PAGE_CUSTOM;return e&&(w=void 0,b=_t.ShowType.PAGE),{show_event:i({action:_,sub_action:y,type:b,first_load:w,time_cost:0,stay_length:S},v)}}return{show_event:i({action:e?0:vt.PageShowAction.ENTER,type:e?0:yt.ShowType.ELEMENT,sub_action:e?0:vt.SubAction.PAGE_ENTER,element_package:(o={},o[e?"action2":"action"]=u,o.params=JSON.stringify(d),o)},v)}},At=function(t,e){var n,o;void 0===e&&(e=!1);var r=t.sessionId,a=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=t.params,l=t.type,p=t.contentPackage,d=t.status,f=t.taskType,h=t.operationDirection,g=((n={url_package:a,refer_url_package:s,element_package:(o={},o[e?"action2":"action"]=c,o.params=JSON.stringify(u),o)})[e?"content_wrapper":"content_package"]=p,n);if(e){var m="USER_OPERATION"===f||"CLICK"===l&&!f,v=l&&vt.OperationType[l]||vt.OperationType.CLICK;return m?{click_event:i({type:v,direction:h&&vt.Direction[h]||vt.Direction.UNKNOWN2},g)}:{task_event:i({action2:c,status:d&&vt.TaskStatus[d]||vt.TaskStatus.UNKNOWN_STATUS},g)}}return{task_event:i({type:f&&yt.TaskEventType[f]||yt.TaskEventType.USER_OPERATION,status:d&&vt.TaskStatus[d]||vt.TaskStatus.UNKNOWN_STATUS,operation_type:vt.OperationType[l]||vt.OperationType.CLICK,operation_direction:h&&vt.Direction[h]||vt.Direction.UNKNOWN2,session_id:r},g)}},It=function(t){var e=t.name,n=t.params,o=t.currentUrlPackage,r=t.referUrlPackage,s=a(t,["name","params","currentUrlPackage","referUrlPackage"]);return{key:e,value:JSON.stringify(i(i({url_package:o,refer_url_package:r},n),s))}},Nt=function(t){var e=t.currentUrlPackage,n=t.referUrlPackage,o=t.options;return{video_stat_event:i(i({},o),{url_package:e,refer_url_package:n})}},Ut={},Rt=function(t){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0;return e+1>1e8&&(e=0),function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,e+1),e}}catch(t){}return Ut[t]||(Ut[t]=0),Ut[t]++},xt=(Et=(new Date).getTimezoneOffset()/60)<=0?"GMT+".concat(C(-Et+"",2,"0"),":00"):"GMT-".concat(C(Et+"",2,"0"),":00"),Dt=function(){function t(t,e){void 0===e&&(e=!1),this.client_timestamp=H((new Date).valueOf()),this.client_increment_id=0,this.session_id=h.sessionId,this.event_id="",e||(this.time_zone=xt),Object.assign(this,t),this.genIncrementId()}return t.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?Rt("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):Rt("WEBLOGGER_INCREAMENT_ID_KEY")},t.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},t.prototype.getEventType=function(){if(this.event_package){var t=this.event_package,e=t.task_event,n=t.show_event,o=t.click_event,r=t.custom_event;if(n)return"showEvent";if(o)return"clickEvent";if(e)return"taskEvent";if(r)return"customEvent"}return"customEvent"},t}();function jt(t,e,n){var o;void 0===n&&(n=!1);var r,i=e.eventId,s=e.currentUrlPackage,c=e.referUrlPackage,u=e.contentPackage,l=e.name,p=e.params;switch(n&&"RADAR"!==t&&"CUSTOM"!==t&&(s&&(s.page2=s.page,delete s.page),c&&(c.page2=c.page,delete c.page)),t){case"PV":case"SHOW":return new Dt({event_package:Lt({type:t,status:e.status,currentUrlPackage:s,referUrlPackage:c,action:e.type,beginTime:e.beginTime,actionType:e.actionType,name:l,params:p,contentPackage:u,operationDirection:e.operationDirection,auto:e.auto},n),event_id:i},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var d=It({name:l,params:p,currentUrlPackage:s,referUrlPackage:c});return new Dt(n?{event_package:{custom_event:d},event_id:i}:{stat_package:{custom_stat_event:d},event_id:i},n);case"RADAR":return new Dt({stat_package:{custom_stat_event:It({name:l,params:p,currentUrlPackage:s,referUrlPackage:c})},event_id:i},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new Dt({stat_package:(o={},o[t.toLowerCase()]=(r=e,r.currentUrlPackage,r.referUrlPackage,r.taskType,a(r,["currentUrlPackage","referUrlPackage","taskType"])),o)},n);case"VIDEO":return new Dt(n?{stat_package:Nt({currentUrlPackage:s,referUrlPackage:c,options:p.params}),event_id:i}:{event_package:At({type:t,status:e.status,taskType:e.taskType,sessionId:h.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:p.params,contentPackage:u},n),event_id:i},n);default:return new Dt({event_package:At({type:t,status:e.status,taskType:e.taskType,sessionId:h.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:p,contentPackage:u},n),event_id:i},n)}}var Mt,Ht=(null===(Pt=null===window||void 0===window?void 0:window.navigator)||void 0===Pt?void 0:Pt.userAgent)||"",Bt=function(t){var e,n,o,r;if(void 0===t&&(t=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent),Ot&&t===Ht)return Ot;var i="unknow",a=/android/i,s="Mac OS",c="Windows",u="Android",l="iPhone",p="iPhone",d="Windows Phone",f="Linux";Ot={os:{name:i,version:i},model:i};try{var h=t.match(/\((.*?)\)/);if(!h)return a.test(t)&&(Ot.os.name=u),Ot;var g=h[1]+")",m=g.split(";").map((function(t){return t.trim()})),v=void 0,y=void 0,_=void 0;if(t.indexOf(d)>-1)_=v=d,(b=g.match(/Windows\sPhone\s(.*?)[;\)\s]/))&&(y=b[1]),_=null===(n=m[m.length-1])||void 0===n?void 0:n.replace(")","");else if(a.test(t)){v=u;var w=g.match(/android.*?;(.*?)build\//i);w&&(_=(_=null===(o=w[1])||void 0===o?void 0:o.split(";").pop())&&_.trim());for(var S=0;S<m.length;S++)if(a.test(m[S])){y=null===(r=m[S])||void 0===r?void 0:r.replace(a,""),_||(_=m[S+1]);break}}else if(t.indexOf(l)>-1||t.indexOf(p)>-1){_=t.indexOf(l)>-1?l:p,v="iOS",(b=g.match(/OS\s(.*?)\slike/))&&(y=b[1])}else if(t.indexOf(s)>-1){_=v=s,(b=g.match(/OS\sX\s(.*?)[;\)\s]/))&&(y=b[1])}else if(t.indexOf(c)>-1){var b;_=v=c,(b=g.match(/Windows\s(.*?)[;\)]/))&&(y=b[1])}else if(t.indexOf("Nokia")>-1){v="Symbian";var k=t.match(/Symbian.*?\/(.*?);/);k&&(y=k[1]);var E=t.match(/Nokia(.*?)\//);E&&(_=E[1])}else g.indexOf(f)>-1&&(v=_=f);Ot={os:{name:v||i,version:y&&y.replace(/_/g,".").trim()||i},model:_||i}}catch(t){}return Ot};function Gt(){return void 0===Mt&&(Mt=L()&&w("kpn")||function(){if("undefined"==typeof window)return"";for(var t=window.navigator.userAgent,e=[[/ Kwai\//,"KUAISHOU"],[/ ksthanos\//,"THANOS"],[/ ksNebula\//i,"NEBULA"]],n=0;n<e.length;n++){var o=e[n],r=o[0],i=o[1];if(r.exec(t))return i}return""}()||""),Mt}var Vt,Ft,Jt,Kt=function(){},Wt={supportsPushState:function(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},getUAInfo:Bt,getDefaultKpn:Gt},qt=function(){var t;return"function"==typeof(null===(t=null===window||void 0===window?void 0:window.__yodaBridge__)||void 0===t?void 0:t.invoke)},zt=function(t,e){return void 0===e&&(e="tool"),s(void 0,void 0,void 0,(function(){var n;return c(this,(function(o){switch(o.label){case 0:return void 0===Vt?[2,!1]:[4,Vt("tool.canIUse",{namespace:e,name:t})];case 1:return[2,(null==(n=o.sent())?void 0:n.canUse)||!1]}}))}))},Qt=function(){return zt("setClientLog")},Yt=function(t,e){return s(void 0,void 0,void 0,(function(){var n;return c(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Vt("tool.setClientLog",{type:t,data:e})];case 1:return[2,o.sent()];case 2:return n=o.sent(),P("[error 206]","yoda.tool.setClientLog() 报错: ".concat(n.message)),[3,3];case 3:return[2]}}))}))},Xt={setClientLog:Yt,sendRadarLog:function(t){return s(void 0,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Vt("tool.sendRadarLog",t)];case 1:return[2,n.sent()];case 2:return e=n.sent(),P("[error 207]","yoda.tool.sendRadarLog() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))}))},sendWebLog:function(t){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){try{return[2,Vt("tool.sendWebLog",t)]}catch(t){P("[error 214]","yoda.tool.sendWebLog() 报错: ".concat(t.message))}return[2]}))}))},sendSummarizedLog:function(t){return s(void 0,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Vt("tool.sendSummarizedLog",t)];case 1:return[2,n.sent()];case 2:return e=n.sent(),P("[error 208]","yoda.tool.sendSummarizedLog() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))}))},getWebviewLoadPerf:function(t,e){return void 0===t&&(t={}),s(void 0,void 0,void 0,(function(){var n;return c(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Vt("webview.getPageLoadData",t,e)];case 1:return[2,o.sent()];case 2:return n=o.sent(),P("[error 209]","yoda.webview.getPageLoadData() 报错: ".concat(n.message)),[3,3];case 3:return[2]}}))}))},getKDSWebviewLoadPerf:function(t){return void 0===t&&(t={}),s(void 0,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Vt("system.getPageLoadData",t)];case 1:return[2,n.sent()];case 2:return e=n.sent(),P("[error 209]","yoda.system.getPageLoadData() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))}))},isSupportBridgeLog:Qt,isSupportBridge:zt,invoke:Vt},$t={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(t){t.CLICK="CLICK",t.DOUBLE_CLICK="DOUBLE_CLICK",t.TRIPLE_CLICK="TRIPLE_CLICK",t.LONG_PRESS="LONG_PRESS",t.PULL="PULL",t.DRAG="DRAG",t.SCALE="SCALE",t.PULL_DOWN="PULL_DOWN",t.PULL_UP="PULL_UP",t.AUTO="AUTO"}(Ft||(Ft={})),function(t){t.PV="PV",t.SHOW="SHOW",t.VIDEO="VIDEO",t.CUSTOM="CUSTOM",t.CUSTOM_EVENT="CUSTOM_EVENT",t.RADAR="RADAR"}(Jt||(Jt={}));var Zt=function(){function t(t){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:$t.unknown},this.h5_extra_attr={sdk_name:"webLogger",sdk_version:"3.10.23",sdk_bundle:"log.hybrid-full.js"},this.global_attr={entry_tag:[]},this.location_package={country:void 0,province:void 0,city:void 0,county:void 0,street:void 0,latitude:void 0,longitude:void 0},this.update(t),this.app_package.version_name){var e=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(e+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return t.prototype.getH5ExtraAttr=function(t){return Object.assign({},this.h5_extra_attr,t)},t.prototype.update=function(t){if("object"==typeof t){!function(t,e){if(R(t)&&R(e)){var n=function(t,e,n){R(t[n])&&R(e[n])?Object.assign(t[n],e[n]):R(t[n])||R(e[n])||(t[n]=e[n])};for(var o in e)if(t.hasOwnProperty(o))n(t,e,o);else for(var r in t)R(t[r])&&t[r].hasOwnProperty(o)&&n(t[r],e,o)}}(this,t);var e=t.network_type;e&&$t[e]&&(this.network_package.type=$t[e])}},t.prototype.updateGlobalAttr=function(t){Object.assign(this.global_attr||{},t)},t.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var t=i(i({},this),{toJSON:function(){return i(i({},t),{h5_extra_attr:JSON.stringify(t.h5_extra_attr),global_attr:JSON.stringify(t.global_attr)})}});t.global_attr=i({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?t.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete t.global_attr.entry_tag,Object.keys(this.global_attr).length||delete t.global_attr;var e=this.location_package;return e&&Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t]})),t},t}(),te=[["a7","640x1136",["iPhone 5","iPhone 5s"]],["a7","1536x2048",["iPad Air","iPad Mini 2","iPad Mini 3"]],["a8","640x1136",["iPod touch (6th gen)"]],["a8","750x1334",["iPhone 6"]],["a8","1242x2208",["iPhone 6 Plus"]],["a8","1536x2048",["iPad Air 2","iPad Mini 4"]],["a9","640x1136",["iPhone SE"]],["a9","750x1334",["iPhone 6s"]],["a9","1242x2208",["iPhone 6s Plus"]],["a9x","1536x2048",["iPad Pro (1st gen 9.7-inch)"]],["a9x","2048x2732",["iPad Pro (1st gen 12.9-inch)"]],["a10","750x1334",["iPhone 7"]],["a10","1242x2208",["iPhone 7 Plus"]],["a10x","1668x2224",["iPad Pro (2th gen 10.5-inch)"]],["a10x","2048x2732",["iPad Pro (2th gen 12.9-inch)"]],["a11","750x1334",["iPhone 8"]],["a11","1242x2208",["iPhone 8 Plus"]],["a11","1125x2436",["iPhone X"]],["a12","828x1792",["iPhone Xr"]],["a12","1125x2436",["iPhone Xs"]],["a12","1242x2688",["iPhone Xs Max"]],["a12x","1668x2388",["iPad Pro (3rd gen 11-inch)"]],["a12x","2048x2732",["iPad Pro (3rd gen 12.9-inch)"]]],ee=function(){try{var t=Bt(),e=L(),n=t.model||t.os.name||"unknown";if("iOS"!==t.os.name||e)return n;var o=function(){for(var t=j(),e=[],n=0,o=te;n<o.length;n++){var r=o[n];t===r[1]&&(e=e.concat(r[2]))}return e.length&&e}();return o?o.join(" or "):n}catch(t){return"unknown"}},ne=0;function oe(){try{var t=Bt().os.name;return ne=t?"Android"===t?L()?6:8:"iOS"===t?L()?7:9:10:0}catch(t){return 0}}function re(){var t="unknown",e=null===window||void 0===window?void 0:window.navigator,n=(null==e?void 0:e.connection)||(null==e?void 0:e.mozConnection)||(null==e?void 0:e.webkitConnection);return n&&(t=n.type||n.effectiveType),t}var ie,ae=function(t){function e(e){var n=t.call(this,i({platform:oe(),container:10===ne?"WEB":"H5",version_name:L()&&w("appver",void 0,!0)||"",network_type:re(),device_id:W(),user_id:w("userId"),global_id:L()&&w("egid")||"",app_package:{language:navigator.language},device_package:{os_version:Bt().os.version,model:ee(),ua:navigator.userAgent}},e))||this;return Object.assign(n.h5_extra_attr,{host_product:Gt(),resolution:j(),screen_width:H(screen.width),screen_height:H(screen.height),device_pixel_ratio:window.devicePixelRatio||1,domain:window.location.origin,fromIframe:(null===window||void 0===window?void 0:window.self)!==(null===window||void 0===window?void 0:window.top)},e.h5_extra_attr),delete n.location_package,n}return r(e,t),e.prototype.getVersionName=function(){return this.app_package.version_name},e.prototype.update=function(e){t.prototype.update.call(this,e);var n=this.app_package.version_name;if("string"==typeof n){var o=n.lastIndexOf(".");this.app_package.version_code=+n.slice(o+1)||0,this.h5_extra_attr.app_version_name=n}},e.prototype.setAdditionalSeqIdPackage=function(t){var e,n;this.additional_seq_id_package={channel:3,channel_seq_id:(n="NORMAL",void 0===n&&(n=""),Rt("".concat("WEBLOGGER_CHANNEL_SEQ_ID","_").concat(n))),custom_type:t,custom_seq_id:(e=t,Rt("".concat("WEBLOGGER_V2_SEQ_ID","_").concat(e)))}},e.prototype.increaseH5SeqId=function(t){this.h5_extra_attr.client_timestamp=H((new Date).valueOf()),this.h5_extra_attr.seq_id=Rt(t?"WEBLOGGER_H5_CUSTOM_SEQ_ID":"WEBLOGGER_H5_SEQ_ID")},e}(Zt),se=function(t,e,n,o){var r;void 0===e&&(e={}),"string"!=typeof t&&(r=t.type),r=t.toUpperCase();var i={};if("string"==typeof e)i.contentPackage=o,"CUSTOM"===t?(i.key=e,i.value=n):(i.params=n,"PV"===t?i.page=e:i.action=e);else if(i=e,["CUSTOM","CUSTOM_EVENT"].includes(r)){var a=e;a.action&&!a.key&&(i.key=a.action),a.params&&!a.value&&(i.value=a.params)}return[r,i]},ce="WEBLOGGER_SILENCED";"undefined"!=typeof window&&("object"!=typeof window._WEBLOGGER&&(window._WEBLOGGER={_silenced:!1,constructors:[],instances:[],silence:function(t){try{t?sessionStorage.setItem(ce,"1"):sessionStorage.removeItem(ce),window._WEBLOGGER.instances.forEach((function(e){null==e||e.silence(t)}))}catch(t){}}}),ie=window._WEBLOGGER);var ue,le=!1,pe=Math.random(),de=function(t){function e(e,n){void 0===e&&(e={});var o,r,i=t.call(this,e,n)||this;return i.beforeUnload=function(t){if(!le){for(var e in i.logger.drain(),i.plugins){var n=i.plugins[e];"function"==typeof n.beforeUnload&&n.beforeUnload(t)}le=!0,setTimeout((function(){le=!1}),2e3)}},i.isBridge=e.bridgeMode&&e.yoda&&qt(),i.logConfig.isBridge=i.isBridge,o="sessionId",r=n&&n.session_id||w("sid")||function(){var t="";try{if(L()){if(t=w("session_id")||w("sid"))return t}else"undefined"!=typeof sessionStorage&&((t=sessionStorage.getItem(q)||"")||(t=J(),sessionStorage.setItem(q,t)))}catch(e){t=J()}return t||J()}(),h[o]=r,i.isV2="v2"===i.logConfig.proto,i.getSampled(i.logConfig),i.presetBaseOption(i.baseOption),i.commonPackage=new ae(i.baseOption),i.logger=new kt(i.logConfig,i.commonPackage),i.initYoda(),i.addPlugins(),O(window,"pagehide",i.beforeUnload),O(window,"beforeunload",i.beforeUnload),function(t){(null==ie?void 0:ie.instances)&&t&&-1===ie.instances.indexOf(t)&&(ie.instances.push(t),ie._silenced&&(null==t||t.silence(!0)))}(i),i}return r(e,t),e.prototype.getSampled=function(t){var e=t||{},n=e.sampleRateFn,o=e.sampleRate;"function"==typeof n?this.sampled=!!n():void 0!==o&&(this.sampled=pe<Number(o))},e.prototype.presetBaseOption=function(t){this.isBridge||(this.isV2?("number"!=typeof t.product&&P("[error 101]","请设置有效的 product 值，值类型为 number!"),delete t.product_name):(t.product_name&&"string"==typeof t.product_name||P("[error 100]","请设置有效的 product_name 值，值类型为 string!"),delete t.product),t.user_id||(t.user_id=w("userId")||w("userName")||void 0,t.user_id||E("[warn 102]","user_id 为空，请确定是否传入，如果是异步通过 updateCommonPackage 接口传入，可以忽略该提示!")),t.device_id||(t.device_id=W(),t.device_id||P("[error 103]","device_id 为空，请设置有效的设备 id!")),!t.global_id&&L()&&(t.global_id=w("egid")||""))},Object.defineProperty(e.prototype,"yoda",{get:function(){return this.logConfig.yoda||(null===window||void 0===window?void 0:window.KSYoda)||(null===window||void 0===window?void 0:window.yoda)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Utils",{get:function(){return{yoda:qt()&&this.yoda?Xt:null,cookie:b,ua:Wt,io:{sendData:ht}}},enumerable:!1,configurable:!0}),e.prototype.initYoda=function(){var t,e=this;qt()&&this.yoda&&(t=this.yoda,Vt="function"==typeof t?t:t.invoke,s(void 0,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Vt("system.getDeviceInfo")];case 1:return[2,e.sent()];case 2:return t=e.sent(),P("[error 209]","yoda.system.getDeviceInfo() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))})).then((function(t){(null==t?void 0:t.mod)&&(e.commonPackage.device_package.model=t.mod)})),s(void 0,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Vt("system.getAppInfo")];case 1:return[2,e.sent()];case 2:return t=e.sent(),P("[error 209]","yoda.system.getAppInfo() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))})).then((function(t){if("object"==typeof t){var n=t.did,o=t.userId,r=t.appver;n&&(e.commonPackage.identity_package.device_id=n),o&&!e.commonPackage.identity_package.user_id&&(e.commonPackage.identity_package.user_id=o),r&&(e.commonPackage.app_package.version_name=r)}})))},e.prototype.initUrlPackage=function(){t.prototype.initUrlPackage.call(this);var e,n=this.logConfig.referer,o="web";n?(e=n.value,o=n.type&&n.type||o):"undefined"!=typeof document&&document.referrer&&(e=document.referrer),e&&this.updateReferUrlPackage(e,o)},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=(null===location||void 0===location?void 0:location.href)||""),void 0===e&&(e="web"),"object"==typeof t&&!t.force&&this.currentUrlPackage){var n=t.page,o=void 0===n?this.currentUrlPackage.page:n,r=t.params,i=void 0===r?{}:r;if(o===this.currentUrlPackage.page)return this.currentUrlPackage.update(o,i)}this.currentUrlPackage=new z(t,e,this.logConfig.urlMap),this.logConfig.attachUrl&&this.currentUrlPackage.attachUrl()},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof z?t:new z(t,e,this.logConfig.urlMap)},Object.defineProperty(e.prototype,"isSendSampled",{get:function(){return void 0===this.sampled||this.sampled||this.logger.isDebug},enumerable:!1,configurable:!0}),e.prototype.generateLog=function(t,e,n){void 0===n&&(n=jt);var o,r=e,a=r.action,s=r.params,c=r.status,u=r.type,l=r.eventId,p=r.contentPackage,d=r.urlPage;p&&(p="string"==typeof p?p:JSON.stringify(p));var f="PV"===t;if(f){var h=e,g=h.page,m=h.type;m||(e.type=m="enter"),"enter"===m&&g?this.updateCurrentUrlPackage({page:g,params:s}):this.currentUrlPackage.update(g,s)}else d&&d.page&&(o={page:d.page,identity:d.identity||J(),params:JSON.stringify(d.params),page_type:this.currentUrlPackage.page_type});var v={currentUrlPackage:o||this.currentUrlPackage.toJSON(),referUrlPackage:this.referUrlPackage?this.referUrlPackage.toJSON():void 0,contentPackage:p};if("RADAR"!==t&&(null==o||o.page.indexOf("http")),f){var y=e.type;return n(t,i(i(i({},e),{type:y}),v),this.isV2)}if("SHOW"===t)return n(t,i(i(i({},e),{name:a}),v),this.isV2);if("VIDEO"===t)return n(t,i({params:e,name:"VIDEO"},v),this.isV2);if("RADAR"===t)return n(t,e,this.isV2);if(-1!==["CUSTOM","RADAR","CUSTOM_EVENT"].indexOf(t)){var _=e,w=_.key,S=_.value;return n("CUSTOM",i(i(i({},e),{params:S,name:w}),v),this.isV2)}return n(t,i(i(i({},e),{params:s,status:c,taskType:u,eventId:l,name:a}),v),this.isV2)},e.prototype.collect=function(t,e,n,o){var r=se(t,e,n,o),i=r[0],a=r[1];return this.send(i,a,!1)},e.prototype.sendImmediately=function(t,e,n,o){var r=se(t,e,n,o),i=r[0],a=r[1];return this.send(i,a,!0)},e.prototype.send=function(t,e,n){if(!this._silenced){var o=this.generateLog(t,e);if(this.emit("event",{type:t,action:null==e?void 0:e.action,log:o}),"RADAR"===t)return this.logger.sendRadar(o,null==e?void 0:e.serviceName);if((!this.isV2||!this.logConfig.forbidV2HttpUrlPage||x(this.currentUrlPackage.page))&&this.isSendSampled){var r="object"==typeof e&&e.callback||void 0;this.logger.send(o,!!n,r)}}},e.prototype.destroy=function(){t.prototype.destroy.call(this),T(window,"pagehide",this.beforeUnload),T(window,"beforeunload",this.beforeUnload),function(t){if(null==ie?void 0:ie.instances){var e=ie.instances.indexOf(t);-1!==e&&ie.instances.splice(e,1)}}(this)},e.prototype.silence=function(t){this._silenced=t},e.Logger=kt,e}(F);!function(t){t[t.INIT=-1]="INIT",t[t.CHECKING=0]="CHECKING",t[t.READY=1]="READY",t[t.DISABLED=2]="DISABLED"}(ue||(ue={}));var fe=function(){try{if(qt())return{invoke:e.invoke,version:e.version}}catch(t){}},he=function(t){function n(e,n){var o=t.call(this,i(i({},e),{yoda:fe(),bridgeMode:!(null==e?void 0:e.disableBridge)}),n)||this;return o.yodaStatus=ue.INIT,o.entered="",(null==e?void 0:e.disableBridge)||!qt()?o.yodaStatus=ue.DISABLED:o.checkSupportBridge(),o.waitYodaQueue||(o.waitYodaQueue=[]),o}return r(n,t),n.prototype.checkSupportBridge=function(){return s(this,void 0,void 0,(function(){var t,e=this;return c(this,(function(n){switch(n.label){case 0:return[4,Qt()];case 1:return t=n.sent(),this.yodaStatus=t?ue.READY:ue.DISABLED,this.waitYodaQueue.forEach((function(n){var o=n.type,r=n.options,i=n.immediately;t?e.sendByBridge(o,r,i):e.sendByHttp(o,r,i)})),this.waitYodaQueue=[],[2]}}))}))},n.prototype.sendByBridge=function(t,n,o){var r,a,s=this.logConfig,c=s.disablePV,u=s.biz,l=n,p=l.contentPackage,d=l.disablePV,f=l.bridgeFields,h=void 0===f?{}:f,g=l.urlPage,m=c||d;p&&(p="string"==typeof p?p:JSON.stringify(p));var v="addTaskEvent",y="PV"===t;if(y){if(m)return;var _=n,w=_.page,S=_.type,b=_.params,k=_.coPage,E=_.category;if(S||(n.type=S="enter"),"leave"===S&&this.currentUrlPackage.coPage&&I())return void Yt("closeCoPage",i(i({},n),this.currentUrlPackage));if(-1===["enter","visible"].indexOf(S))return;if("enter"===S){var P=w||this.currentUrlPackage.page;this.updateCurrentUrlPackage({page:P,params:w?b:this.currentUrlPackage.params,force:!0}),k&&(this.currentUrlPackage.coPage=k),E&&(this.currentUrlPackage.category=E),this.entered=P}else w===this.entered&&this.currentUrlPackage.update(w,b);if(!x(this.currentUrlPackage.page))return;v="setCurrentPage"}var O=!!this.currentUrlPackage.coPage,T=(null==g?void 0:g.page)&&!y?{page:g.page,identity:g.identity,params:B(g.params),page_type:this.currentUrlPackage.page_type}:i(i({},this.currentUrlPackage.toJSON()),{coPage:O}),C=function(t,e){var n=e,o=n.action,r=n.params,a=n.eventId,s=n.contentPackage,c=n.currentUrlPackage,u=n.status,l=void 0===u?"SUCCESS":u;n.name;var p,d=n.feedLogCtx;if("PV"===t){var f=e,h=f.type,g=f.beginTime;return i(i({},c),{actionType:h,contentPackage:s,status:l,beginTime:g,eventId:a,pageType:Kt()?"NATIVE":"H5"})}if(c&&(p={page:c.page,params:c.params,identity:c.identity,coPage:c.coPage}),["RADAR","CUSTOM","CUSTOM_EVENT"].includes(t)){var m=e,v=m.key,y=m.value,_=m.biz;return{key:v,value:JSON.stringify(i(i({},y),{url_package:c})),biz:_,eventId:a,urlPage:p}}var w={action:o,params:JSON.stringify(r),contentPackage:s,feedLogCtx:d,eventId:a,urlPage:p};if("SHOW"!==t){var S=e.type;Object.assign(w,{type:S||"USER_OPERATION",status:l||"UNKNOWN_STATUS",operationType:t,operationDirection:"UNKNOWN2"})}return w}(t,i(i({biz:u},n),{contentPackage:p,currentUrlPackage:m?void 0:T})),L=-1!==["CUSTOM","RADAR","CUSTOM_EVENT"].indexOf(t);this.commonPackage.increaseH5SeqId(L);var A=this.baseOption||{},N=A.service_name,U=A.sub_biz,R=A.need_encrypt;C.h5ExtraAttr=JSON.stringify(this.commonPackage.getH5ExtraAttr({bridge_info:(null===(a=null===(r=this.logConfig)||void 0===r?void 0:r.yoda)||void 0===a?void 0:a.version)||e.version||!0,coPage:O})),C.realtime=!!o,C.serviceName=N||"",C.subBiz=U||"",C.needEncrypt=R||!1,C.container=Kt()?"REACT_NATIVE":"H5","SHOW"===t?v="addElementShowEvent":L&&(v="CUSTOM_EVENT"===t||this.logConfig.customStatToCustom?"addCustomEvent":"addCustomStatEvent"),Yt(v,i(i({},h),C))},n.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=(null===location||void 0===location?void 0:location.href)||""),void 0===e&&(e="web"),"object"==typeof t&&!t.force&&this.currentUrlPackage){var n=t.page,o=void 0===n?this.currentUrlPackage.page:n,r=t.params,i=void 0===r?{}:r;if(!o||o===this.currentUrlPackage.page){this.currentUrlPackage.update(o,i);var a=this.entered===o;return void(this.yodaStatus!==ue.DISABLED&&a&&this.send("PV",{type:"visible",page:o,params:i},!0))}}this.currentUrlPackage=new z(t,e,this.logConfig.urlMap),this.logConfig.attachUrl&&this.currentUrlPackage.attachUrl()},n.prototype.sendByHttp=function(e,n,o){return t.prototype.send.call(this,e,n,o)},n.prototype.send=function(t,e,n){var o=this.logConfig,r=o.enableV3CustomEvent,i=o.openHttpSender;return"CUSTOM"===t&&r||this.yodaStatus===ue.DISABLED||!qt()?this.sendByHttp(t,e,n):(i&&this.sendByHttp(t,e,n),this.yodaStatus===ue.INIT&&(this.yodaStatus=ue.CHECKING),this.yodaStatus===ue.CHECKING||void 0===this.yodaStatus?(k("[weblogger]: waiting yoda ready"),this.waitYodaQueue||(this.waitYodaQueue=[]),void this.waitYodaQueue.push({type:t,options:e,immediately:n})):this.sendByBridge(t,e,n))},n}(de),ge=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}(),me={updateInterval:2e4,crashThreshold:1e4},ve="@ks.monitor.crash_",ye=function(t){function e(e){var n=t.call(this)||this;return n.eventName="onpagehide"in window?"pagehide":"beforeunload",n.options=i({},me),n.historyMoniorInfo=null,n.stop=function(){clearInterval(n.updateIntervalId);try{localStorage.removeItem(n.monitorId)}catch(t){}},(null==e?void 0:e.collect)&&n.apply(e),O(window,n.eventName,n.stop),n}return r(e,t),e.prototype.apply=function(t){t&&(this.weblog=t,this.monitorId=ve+this.weblog.sessionId,this.start())},e.prototype.destroy=function(){this.stop(),T(window,this.eventName,this.stop)},e.prototype.pickHistoryInfo=function(){for(var t in localStorage)if(0===t.indexOf(ve))try{var e=localStorage.getItem(t),n=JSON.parse(e);this.checkHistoryCrash(n)}catch(t){}},e.prototype.checkHistoryCrash=function(t){var e=(new Date).valueOf();t&&t.time&&e-t.time>this.options.crashThreshold&&this.weblog.collect("CUSTOM",{key:"crash",value:t})},e.prototype.start=function(){var t=this;this.pickHistoryInfo(),this.updateIntervalId=window.setInterval((function(){t.update()}),this.options.updateInterval),this.update()},e.prototype.update=function(){var t,e;if(window.performance&&window.performance.memory){var n={time:(new Date).valueOf(),memory:{limit:Math.floor(window.performance.memory.jsHeapSizeLimit/1024),total:Math.floor(window.performance.memory.totalJSHeapSize/1024),used:Math.floor(window.performance.memory.usedJSHeapSize/1024)},href:null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href,sessionId:null===(e=this.weblog)||void 0===e?void 0:e.sessionId};try{localStorage.setItem(this.monitorId,JSON.stringify(n))}catch(t){}}},e.key="crachMonitor",e}(ge),_e={interval:1e4,decimals:2};function we(t){return setTimeout(t,62.5)}var Se=clearTimeout,be=function(t){function e(e,n){var o=t.call(this)||this;return o.options=i({},_e),o.count=0,o.visibilityChange=function(){var t=document.visibilityState;"visible"===t?o.start():"hidden"===t&&o.stop()},n||e&&(null==e?void 0:e.collect)&&o.apply(e),Object.assign(o.options,n),O(window,"visibilitychange",o.visibilityChange),o.start(),o}return r(e,t),e.prototype.destroy=function(){this.stop(),T(window,"visibilitychange",this.visibilityChange)},e.prototype.start=function(){this.loopId||this.fpsTickId||(this.loop(),this.fpsTick())},e.prototype.fpsTick=function(){var t=this;this.fpsTickId=function(t){return(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||we).call(this,t)}((function(){t.count++,t.fpsTick()}))},e.prototype.loop=function(){var t=this;this.loopBeginTime=(new Date).valueOf(),this.loopId=window.setTimeout((function(){t.loopEndTime=(new Date).valueOf();var e=t.calculate();t.weblog.collect("CUSTOM",{key:"fps",value:{key:"fps",value:e}}),t.count=0,t.loop()}),this.options.interval)},e.prototype.stop=function(){!function(t){(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||Se).call(this,t)}(this.fpsTickId),window.clearTimeout(this.loopId),this.loopId=0,this.fpsTickId=0},e.prototype.calculate=function(){return+(1e3/((this.loopEndTime-this.loopBeginTime)/this.count)).toFixed(this.options.decimals)},e.key="fpsMonitor",e}(ge),ke="undefined"!=typeof window?window.performance:null,Ee=ke&&ke.timing||null;ke&&ke.getEntriesByType&&ke.getEntriesByType("navigation")[0];var Pe={dnsLookup:{end:"domainLookupEnd",start:"domainLookupStart"},tcpConnection:{end:"connectEnd",start:"connectStart"},resourceLoad:{end:"responseEnd",start:"requestStart"},jsCost:{custom:function(){if("function"!=typeof performance.getEntries)return 0;var t=performance.getEntries(),e=t[0],n=t.filter((function(t){return"script"===t.initiatorType}))[0];return n&&e?e.domComplete-n.fetchStart:0}},documentContentLoaded:{end:"domComplete",start:"fetchStart"},load:{end:"loadEventEnd",start:"fetchStart"},timeToFirstByte:{end:"loadEventEnd",start:"fetchStart"},firstScreen:{custom:function(t,e){var n=(e||{}).endPoint,o=void 0!==n?n:(new Date).valueOf();return Ee&&o-Ee.fetchStart||0}},whiteScreen:{custom:function(t,e){var n=(e||{}).endPoint,o=void 0!==n?n:(new Date).valueOf();return Ee&&o-Ee.fetchStart||0}}},Oe=function(t){function e(e){var n=t.call(this)||this;return n.load=function(){setTimeout((function(){var t=n.collect();t&&["load","documentContentLoaded","dnsLookup","tcpConnection","jsCost","timeToFirstByte"].forEach((function(e){var o;"jsCost"===e&&0===t[e]||n.weblog.collect("CUSTOM",{key:Te[e],value:(o={},o[Te[e]]=t[e],o)})}))}))},Ee?(e&&n.apply(e),n):(P("The Timing Monitor need performance APIs to Support!"),n)}return r(e,t),e.prototype.apply=function(t){this.weblog=t,O(window,"load",this.load)},e.prototype.destroy=function(){T(window,"load",this.load)},e.prototype.calculate=function(t,e){var n=Pe[t];if(!n)throw new Error("The perf key is not correct!");return"function"==typeof n.custom?n.custom(t,e):Ee[Pe[t].end]-Ee[Pe[t].start]},e.prototype.mark=function(t,e){var n,o=this.collect(t,e);o&&this.weblog.collect("CUSTOM",{key:Te[t],value:(n={},n[Te[t]]=o[t],n)})},e.prototype.collect=function(t,e){var n,o=this;if(Ee){if(t)return(n={})[t]=this.calculate(t,e),n;return Object.keys(Pe).reduce((function(t,n){return t[n]=o.calculate(n,e),t}),{})}},e.key="timingMonitor",e}(ge),Te={load:"total_download_cost",documentContentLoaded:"operational_cost",dnsLookup:"dns_query_cost",tcpConnection:"tcp_cost",jsCost:"js_cost",whiteScreen:"white_screen_cost",firstScreen:"first_screen_cost",timeToFirstByte:"ttfb_cost"};!function(t,e){var n;if("undefined"!=typeof window&&void 0!==window._GLOBAL_KS_WEBLOGGER_&&"function"==typeof t){var o=window._GLOBAL_KS_WEBLOGGER_,r=o.weblog,i=o.config,a=e?null===(n=i.plugins[e])||void 0===n?void 0:n.options:void 0;r.addPluginInstance(new t(a))}}(Oe);var Ce=function(){return(Ce=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Le(t,e,n,o){return new(n=n||Promise)((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))}function Ae(t,e){var n,o,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){var c=[a,s];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,(c=r?[2&c[0],r.value]:c)[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(r=0<(r=i.trys).length&&r[r.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(s){c=[6,s],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function Ie(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}function Ne(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||((o=o||Array.prototype.slice.call(e,0,r))[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var Ue,Re,xe="ksurl.cn/csHfgepO",De=console,je=De.log.bind(De,xe+", radar:"),Me=De.warn.bind(De,xe+", radar:"),He=De.error.bind(De,xe+", radar:"),Be=function(){function t(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middlewares=[],(t=this.middlewares).push.apply(t,Ne([],Ie(e),!1))}return t.prototype.use=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=this.middlewares.pop();(t=this.middlewares).push.apply(t,Ne([],Ie(e),!1)),this.middlewares.push(o)},t.prototype.invoke=function(t){return o=this.middlewares,e=t,n=-1,function t(r){if(r<=n)return new Error("`next` 被重复调用");var i=o[n=r];if(i=r===o.length?undefined:i)try{return i(e,t.bind(null,r+1))}catch(r){return r}}(0);var e,n,o},t}(),Ge=((Re=Ue=Ue||{}).LOAD="load",Re.RES="resource",Re.API="api",Re.ERROR="error",Re.SDK_ERROR="sdk_error",Re.CUSTOM="custom",Re.BATCH="batch",Re.EVENT="event",Re.BLOOD="blood",function(){function t(t){void 0===t&&(t={});var e=this;this.broadcastSampleFb=function(){var t=e.getSample(e.baseOptions.sampling);t!==e.sampling&&(e.sampling=t,e.sampling&&(e.isHit=e.samplingControl(e.sampling)))},void 0===t&&bn("100"),t.key||bn("101"),!t.core||"object"==n(t.core.sampleData)&&"function"==typeof t.core.collect||bn("121"),this.baseOptions=t,this.key=t.key,this.version=t.version,this.name=t.name,this.isHit=!1,t.core&&this.updateCore(t.core)}return t.prototype.updateCore=function(t){var e;"object"==n(t.sampleData)&&"function"==typeof t.collect||bn("121"),null!=(e=this.core)&&e.broadcastSample.off(this.broadcastSampleFb),this.core=t,this.sampling=this.getSample(this.baseOptions.sampling),this.sampling&&(this.isHit=this.samplingControl(this.sampling)),null!=(t=null==(e=this.core)?void 0:e.broadcastSample)&&t.on(this.broadcastSampleFb)},t.prototype.getSample=function(t){var e=null!=(e=null==(e=this.core)?void 0:e.sampleData.core)?e:1;if(this.key===Ue.LOAD)return e;if("number"!=typeof(t=void 0===t?1:t)||t<0||1<t)return Me("102","".concat(this.key,"，采用Core的采样率").concat(null==(n=this.core)?void 0:n.sampleData.core)),e;var n=null!=(n=this.core)&&n.isInYoda?void 0===(null==(n=this.core)?void 0:n.sampleData[this.key])?1:this.core.sampleData[this.key]:t;return e&&e<n?(Me("115","".concat(this.key)),e):n},t.prototype.samplingControl=function(t){var e;return!(null==(e=this.core)||!e.sampleData.isHit)&&(null==(e=this.core)?void 0:e.samplingControl(t/this.core.sampleData.core))},t.prototype.baseCollect=function(t){if(this.core){if(this.isHit){var e=t.value||{};e=Object.keys(e).filter((function(t){return null!==e[t]&&void 0!==e[t]})).reduce((function(t,n){return Ce(Ce({},t),((t={})[n]=e[n],t))}),{});try{this.core.collect(t.key||this.key,Ce(Ce({collect_version:this.version,collect_name:this.name},t.dimension),{sample_rate:this.sampling}),e)}catch(t){Me("126")}}}else Me("110","".concat(this.key))},t}());var Ve=["//wlog.kuaishou.com/rest/n/log/web/collect","/rest/wd/common/log/collect/misc2","/rest/wd/common/log/collect/radar","/rest/kd/log/collect"],Fe=window,Je="__radarSeedStore__",Ke="Queue",We="error"+Ke,qe="resource"+Ke,ze="event"+Ke,Qe={start_time:{custom:function(t,e){return Math.round(e.startTime)}},fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0,crossOriginSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0,crossOriginSkip:!0},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0,crossOriginSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0,crossOriginSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0,crossOriginSkip:!0},total:{end:"responseEnd",start:"fetchStart"},size:{custom:function(t,e){return e.encodedBodySize},cachedSkip:!0,crossOriginSkip:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name}},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||0===e.duration||null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart)},crossOriginSkip:!0},has_timing_allow:{custom:function(t,e){return en(e)}}},Ye=/^(https?:)?\/\//;function Xe(t,e){if(!t)return!1;var n=t.replace(Ye,"");return e.some((function(t){return 0<=n.indexOf(t.replace(Ye,""))}))}function $e(t){if("string"!=typeof t)return"";try{var e=t.lastIndexOf(".");return t.substr(e+1)}catch(t){return""}}function Ze(t){return"object"==n(t)&&Object.keys(t).every((function(e){return"number"==typeof t[e]}))}function tn(t){return"function"==typeof t}function en(t){return void 0===t.nextHopProtocol?null:""!==t.nextHopProtocol}function nn(t){return"resource"===t.entryType?"fetch"!==(null==t?void 0:t.initiatorType)&&"xmlhttprequest"!==(null==t?void 0:t.initiatorType)||"js"===$e(t.name)||"css"===$e(t.name)?"resource":"api":"other"}function on(t,e){var n={};return Object.keys(t).forEach((function(o){var r=rn(o,t,e);null!=r&&(n[o]=r)})),n}function rn(t,e,n){var o=e[t];if(o||bn("129，".concat(t)),(!o.crossOriginSkip||en(n))&&(!o.cachedSkip||!rn("cached",e,n)))return"function"==typeof o.custom?o.custom(t,n):(e=o.end,t=o.start,!o.notCatchIfUndefined||void 0!==n[e]&&void 0!==n[t]?(+n[e]||0)-(+n[t]||0):void 0)}function an(t,e,n,o){return t.addEventListener(e,n,o)}function sn(t,e,n,o){return t.removeEventListener(e,n,o)}var cn=["ktrace-str"];function un(t){return"__radar_".concat(t=void 0===t?"":t).concat(Math.random().toString(36).substring(2,8))}var ln=[],pn=["application/json","text/html","text/plain"];function dn(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var r=ln.reduce((function(t,e){return[e].concat(t)}),[]),i="string"==typeof n[0]?new Request(n[0],n[1]):n[0],a=(i.id=un(),r.forEach((function(t){t=t.request,i=t(i)||i})),i.clone()),s=t.apply(void 0,Ne([],Ie(n),!1)),c=null,u=null,l=!1;return s.then((function(t){var e,n=null==(e=t.headers)?void 0:e.get("content-type");return n&&pn.some((function(t){return-1<n.indexOf(t)}))?(l=!0,e=t.clone(),c=e.clone(),e.clone().text()):(c=t,"[object Object]")})).then((function(t){return Le(e,void 0,void 0,(function(){return Ae(this,(function(e){switch(e.label){case 0:u=t,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.text()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,"Radar: Request.text()失败"];case 4:return[2]}}))}))})).then((function(t){i._config=t;var e=null;return l?(e=c.clone()).data=u:e=c,r.forEach((function(t){(t=t.response)&&(e=t(e,i)||e)})),c}),(function(t){throw r.forEach((function(e){(e=e.responseError)&&(t=e(t,i)||t)})),t}))}function fn(){var t=[];function e(e){-1!==(e=t.indexOf(e))&&t.splice(e,1)}function n(n){return t.push(n),e.bind(void 0,n)}return{on:n,off:e,once:function(t){var e=n((function(n){t(n),e()}));return e},emit:function(e){t.forEach((function(t){return t(e)}))}}}function hn(t){return(t=new RegExp("(?:^|; ?)".concat(t,"=(1|0)(;|$)")).exec(document.cookie))&&t[1]}var gn=["radar_init","h5_load","fmp","main_api","h5_custom_metric"];var mn={load:function(t){var e=t.dimension,n=t.value;if(t=e.event_name,gn.indexOf(t)<0)return!1;if(!Ze(n))return!1;switch(t){case"fmp":var o=n.fmp_time;return!(!n.fmp||!o);case"h5_load":return o=n.total,!(!n.load_event_time||!o);case"h5_custom_metric":return o=n.custom_metric_timestamp,!(!e.custom_metric_name||!o)}return!0},api:function(t){var e=t.dimension,n=(t=t.value,e.custom_failed),o=e.api,r=e.status,i=e.res_type,a=e.protocol,s=(e=e.cached,t.duration),c=t.size;return"boolean"==typeof(void 0!==n&&n)&&"string"==typeof(void 0===o?"":o)&&"number"==typeof(void 0===r?0:r)&&"string"==typeof(void 0===i?"":i)&&"string"==typeof(void 0===a?"":a)&&"boolean"==typeof(void 0!==e&&e)&&"number"==typeof(void 0===s?0:s)&&"number"==typeof(void 0===c?0:c)&&Ze(t)},resource:function(t){var e=t.dimension,n=(t=t.value,e.failed);if("boolean"!=typeof n)return!1;if(n){var o=e.res_path;if("string"!=typeof e.file||"string"!=typeof o)return!1}return!!n||"string"==typeof e.file&&Ze(t)},error:function(t){var e=(t=t.dimension).error_type;if([t.error_cons_type,e,t.msg].some((function(t){return null==t})))return!1;e=t.col;var o,r=t.line;return t.sample_rate,t.event_client_timestamp,t=function(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}(t,["col","line","sample_rate","event_client_timestamp"]),!(e&&"number"!=typeof e||r&&"number"!=typeof r)&&"object"==n(o=t)&&Object.keys(o).every((function(t){return void 0===o[t]||"string"==typeof o[t]}))},event:function(t){var e=t.value;return t=t.dimension.name,!(void 0!==e&&!Ze(e)||!t)},blood:function(t){var e=!0;if((t=t.dimension.data)instanceof Array){if(0===t.length)return!1;t.forEach((function(t){"string"!=typeof t.com&&(e=!1)}))}return e}};function vn(t,e){var n;return null!=(n=null==Fe?void 0:Fe[Je])&&n[t],null!=(n=null==Fe?void 0:Fe[Je])&&n.isRuning?Fe[Je][t]:void 0===e?null:e}function yn(t,e){try{Fe[Je][t]=e}catch(t){He("1000")}}function _n(t){return JSON.parse(JSON.stringify(t))}function wn(t){try{var e;if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage)return function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,(e=1e8<(e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0)+1?0:e)+1),e}catch(t){}}function Sn(t){var e,n,o={};t=t.split("&");try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&o>=t.length?void 0:t)&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i=r.next();!i.done;i=r.next()){var a=Ie(i.value.split("="),2),s=a[0],c=a[1];s in o?o[s]instanceof Array?o[s].push(c):o[s]=[o[s],c]:o[s]=c}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return o}function bn(t){throw new Error("radar error "+t)}var kn=function(){return(kn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function En(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}function Pn(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||((o=o||Array.prototype.slice.call(e,0,r))[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var On=["c_dimension1","c_dimension2","c_dimension3","release_tag","product_version","sub_app"],Tn=function(){function t(t){var e,o=this,r=(this.queueConfig={wait:1e3,maxBatchLength:200},this.logQueue=[],this.preStoredLogQueue=[],this.batchTimer=0,this.eventName="onpagehide"in window?"pagehide":"beforeunload",this.customDimension={},this.runtimeIdMap={},this.randomSampling=Math.random(),this.commonDimension={},this.isInYoda=!1,this.sampleData={isHit:!0,core:1},this.ignoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],this.broadcastSample=fn(),this.didRate=void 0,this.collect=function(t,e,n){var r=_n({key:t,dimension:e=void 0===e?{}:e,value:n=void 0===n?{}:n});if(!o.sampleData||!1!==o.sampleData.isHit){if(!function(t){return t?Object.keys(Ue).map((function(t){return Ue[t]})).indexOf(t.key)<0?(He("117"),!1):mn[t.key](t):(He("116"),!1)}(r))return He("107","key: ".concat(r.key)),void o.collect(Ue.EVENT,{sample_rate:e.sample_rate,message:"radar上报日志类型错误",name:"radar_log_error",extra_info:JSON.stringify(r)},{});Object.keys(r.value).forEach((function(t){r.value[t]=r.value[t].toString()})),o.decorateLog(r);var i=o.getCommonData(),a=i.app_version_name;if(delete i.app_version_name,(t=new Be((function(t,e){t.dimension.app_version_name=a,t.dimension.did_rate=o.didRate;var n=(null==(n=null==t?void 0:t.dimension)?void 0:n.event_client_timestamp)||Date.now(),r=(null==(r=null==t?void 0:t.dimension)?void 0:r.radar_session_id)||o.radarSessionId;return kn(kn(kn({},t),i),{event_client_timestamp:n,event_trigger_source:"H5",radar_session_id:r})}))).use((function(t,e){return t.key&&"load"===t.key&&(t.dimension=kn(kn({},t.dimension),{load_device_increase_id:wn("LOAD_DEVICE_INCREASE_ID"),load_session_increase_id:o.genSessionIncreaseId("LOAD_SESSION_INCREASE_ID")})),t.key&&"load"!==t.key&&(t.dimension=kn(kn({},t.dimension),{other_device_increase_id:wn("OTHER_DEVICE_INCREASE_ID"),other_session_increase_id:o.genSessionIncreaseId("OTHER_SESSION_INCREASE_ID")})),e()})),(r=t.invoke(r))instanceof Error)throw r;try{window.dispatchEvent(new CustomEvent("get-radar-next-data",{detail:{kv:_n(r)}}))}catch(t){}if(delete r.dimension.broadcast_info,o.weblog?o.logQueue.push(r):(r.base_href=location.href,o.preStoredLogQueue.push(r)),function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];1==+Sn(location.search.slice(1)).debug&&Me.apply(void 0,Ne(["[radar] ".concat(t,": ")],Ie(e),!1))}("radarLogNext",JSON.parse(JSON.stringify(r))),o.logQueue.length>o.queueConfig.maxBatchLength-1)return o.flush(),clearTimeout(o.batchTimer),void(o.batchTimer=0);o.batchTimer||(o.batchTimer=window.setTimeout((function(){o.flush(),clearTimeout(o.batchTimer),o.batchTimer=0}),o.queueConfig.wait))}},this.flush=function(){var t;o.logQueue.length<=0||(t=null,(t=o.config.httpReportFirst?t:o.reportByBridge())&&!o.config.httpReportFirst||o.reportByHttp(),o.logQueue=[])},"object"==n(t)&&null!==t||bn("108"),"string"!=typeof t.projectId&&bn("109"),vn("radarSessionId"));this.radarSessionId=null!=r?r:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),this.config=t,this.sampling="number"==typeof(e=null!=(r=this.config.sampling)?r:1)&&0<=e&&e<=1?e:(He("110"),1),this.bindWeblogger(t.weblogger),null!=(r=this.config)&&r.ignoreList&&Array.isArray(null==(t=this.config)?void 0:t.ignoreList)&&(this.ignoreList=this.ignoreList.concat(this.config.ignoreList.map((function(t){return t.replace(/^(https?:)?\/\//,"")})))),this.queueConfig=kn(kn({},this.queueConfig),null!=(r=this.config)&&r.queueConfig?this.config.queueConfig:{}),null!=(t=this.config)&&t.customDimensions&&this.setDimensions(null==(r=this.config)?void 0:r.customDimensions),an(window,this.eventName,this.flush),"undefined"!=typeof window&&window.yodaCollectErrorDataDestroy&&window.yodaCollectErrorDataDestroy()}return t.prototype.genSessionIncreaseId=function(t){return this.runtimeIdMap[t]||(this.runtimeIdMap[t]=0),this.runtimeIdMap[t]++},t.prototype.bindWeblogger=function(t){var e,o=this;if(null!=t&&"object"!=n(t))bn("106");else{if(this.weblog)return void Me("122");this.weblog=t,this.updateUrlPackage(),void 0!==(null==(e=null==t?void 0:t.logger)?void 0:e.radarUrl)&&this.ignoreList.push(null==(e=null==t?void 0:t.logger)?void 0:e.radarUrl),void 0!==(null==(e=null==t?void 0:t.logger)?void 0:e.url)&&this.ignoreList.push(null==(e=null==t?void 0:t.logger)?void 0:e.url),this.isInYoda=!(null==(e=null==(t=this.weblog)?void 0:t.Utils)||!e.yoda),this.getSampleData()}0<this.preStoredLogQueue.length&&(this.preStoredLogQueue.forEach((function(t){if(void 0!==(e=o.sampleData["load"===t.key?"core":t.key])&&(t.dimension.sample_rate=e),"load"===t.key?o.sampleData.core:t.dimension.sample_rate*o.sampleData.core>=o.randomSampling){var e=o.getCommonData(),r=(t.dimension.app_version_name=e.app_version_name,t.h5_extra_attr=JSON.stringify(kn(kn({},null==(e=o.weblog.commonPackage)?void 0:e.getH5ExtraAttr()),JSON.parse(t.h5_extra_attr))),function(t){if(-1===(n=(t=void 0===t?location.href:t).lastIndexOf("?")))return{page:t};var e=t.slice(0,n),n=t.slice(n+1);return{url:t,page:e,params:Sn(n)}}(t.base_href)),i=null==(e=o.weblog.logConfig)?void 0:e.urlMap;e={};if("function"==typeof i)try{var a=i(r);"string"==typeof a?e={page:a}:"object"==n(a)&&(e={page:a.page,params:a.params})}catch(t){}else if("object"==n(i)){var s,c="";for(s in i)if(-1<(r.page||r.url||"").indexOf(s)){c=i[s];break}c&&(e={page:c})}t.url_package={page:e&&e.page||r.page},a=o.referUrlPackage&&o.referUrlPackage.toJSON(),t.refer_url_package=a,delete t.base_href,o.logQueue.push(t)}})),this.preStoredLogQueue=[],this.flush())},t.prototype.getSampleData=function(){var t,e,n=this;this.isInYoda?(this.sampleData={isHit:!0,core:this.sampling,api:1,resource:.1,error:1,event:1},e=window.updateYodaSampleRateWithParams,window.updateYodaSampleRateWithParams=function(t){je("104",t),n.updateYodaSampleRate(t),n.broadcastSample.emit(n.sampleData),e&&e(t)},window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.sampleData?(this.updateYodaSampleRate(window.__yodaCommonDataObject__.sampleData),this.collect(Ue.EVENT,{name:"客户端采样率注入成功",event_type:"radar_sample_inject_success"},{})):"function"==typeof(null==(t=null==(t=null==(t=this.weblog)?void 0:t.Utils)?void 0:t.yoda)?void 0:t.getWebviewLoadPerf)&&null!=(t=this.weblog)&&t.Utils.yoda.getWebviewLoadPerf().then((function(t){null!=t&&t.sampleData&&n.updateYodaSampleRate(t.sampleData)}))):this.sampleData={isHit:this.samplingControl(this.sampling),core:this.sampling}},t.prototype.updateYodaSampleRate=function(t){var e=this,n=null;try{var o=t;n="string"==typeof o?JSON.parse(o):o}catch(t){return void je("error: ",t)}n&&Object.keys(n).forEach((function(t){"load"===t?e.sampleData.core=n[t]:"did_rate"===t?e.didRate=n[t]:e.sampleData[t]=n[t]}))},t.prototype.updateUrlPackage=function(){var t;null!=(t=this.weblog)&&t.currentUrlPackage&&(this.currentUrlPackage=this.weblog.currentUrlPackage,this.referUrlPackage=this.weblog.referUrlPackage)},t.prototype.setDimensions=function(t){var e=this,n=Object.keys(t);n.some((function(t){return-1===On.indexOf(t)}))&&He("113","".concat(n.join("、"))),n.forEach((function(n){null==t[n]?delete e.customDimension[n]:e.customDimension[n]=t[n]}))},t.prototype.setCommonDimension=function(t,e,n){this.commonDimension[t]=(n=void 0===n||n)||null==(n=this.commonDimension[t])?e:n},t.prototype.decorateLog=function(t){this.currentUrlPackage||this.updateUrlPackage(),0<Object.keys(this.customDimension).length&&Object.assign(t.dimension,this.customDimension),0<Object.keys(this.commonDimension).length&&Object.assign(t.dimension,this.commonDimension),this.currentUrlPackage&&this.currentUrlPackage.page!==(null==(t=null==(t=this.weblog)?void 0:t.currentUrlPackage)?void 0:t.page)&&(this.flush(),this.updateUrlPackage())},t.prototype.samplingControl=function(t){return null!==t&&"number"==typeof t&&this.randomSampling<t},t.prototype.getCommonData=function(){var t,e=null==(e=null==(e=null==(e=this.weblog)?void 0:e.commonPackage)?void 0:e.app_package)?void 0:e.version_name;e={h5_extra_attr:JSON.stringify(kn(kn({},null==(t=null==(t=this.weblog)?void 0:t.commonPackage)?void 0:t.getH5ExtraAttr()),{app_version_name:e,url:location.href,hash:location.hash,online:null===navigator||void 0===navigator?void 0:navigator.onLine,downlink:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.downlink,rtt:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.rtt})),url_package:this.currentUrlPackage&&this.currentUrlPackage.toJSON(),refer_url_package:this.referUrlPackage&&this.referUrlPackage.toJSON(),app_version_name:e,project_id:null==(t=this.config)?void 0:t.projectId};return"1"===hn("radar_report_test")&&(e.is_report_test=!0),e},t.prototype.reportByHttp=function(){var t=this.getCommonData(),e=(t={project_id:this.config.projectId,radar_session_id:this.radarSessionId,h5_extra_attr:t.h5_extra_attr},this.logQueue.filter((function(t){return"load"===t.key}))),n=this.logQueue.filter((function(t){return"load"!==t.key}));Array.isArray(e)&&e.length&&this.collectLog(t,e,"radarSDK"),Array.isArray(n)&&n.length&&this.collectLog(t,n,"radarSDKSupplement")},t.prototype.collectLog=function(t,e,n){var o;"function"!=typeof(null==(o=this.weblog)?void 0:o.collect)&&"function"!=typeof(null==(o=this.weblog)?void 0:o.sendByHttp)?He("114"):(this.weblog.sendByHttp||this.weblog.collect).call(this.weblog,"RADAR",{name:"radar_log",params:kn(kn({},t),{data:Pn([],En(e),!1)}),serviceName:n})},t.prototype.reportByBridge=function(){var t=null==(n=null==(n=this.weblog)?void 0:n.Utils)?void 0:n.yoda;if(!t)return!1;var e,n=this.logQueue.filter((function(t){return"load"===t.key})),o=this.logQueue.filter((function(t){return"load"!==t.key}));try{return n.forEach((function(e){"function"==typeof(null==(e=t.sendSummarizedLog({key:"h5_load",data:e}))?void 0:e.catch)&&e.catch((function(t){He("123",t)}))})),o.length&&"function"==typeof(null==(e=t.sendRadarLog({data:o}))?void 0:e.catch)&&e.catch((function(t){He("124",t)})),!0}catch(e){return!1}},t}(),Cn=function(t,e){return(Cn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Ln=function(){return(Ln=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function An(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}var In={redirect:{end:"redirectEnd",start:"redirectStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(t,e){return e.redirectCount}},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ssl_start:{custom:function(t,e){return e.secureConnectionStart&&e.navigationStart?e.secureConnectionStart-e.navigationStart:null}},ttfb:{end:"responseStart",start:"requestStart"},request_start:{end:"requestStart",start:"navigationStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domInteractive"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=performance.getEntries().filter((function(t){return"first-paint"===t.name}))[0];return t?Math.ceil(t.startTime+t.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=function(){var t,e="undefined"!=typeof window?window.performance:null;return e&&e.timing?"function"==typeof e.timing.toJSON?((t=e.timing.toJSON())&&!t.redirectStart&&(t.redirectStart=t.navigationStart),t):e.timing:null}(),e=performance.getEntries(),n=performance.getEntries().filter((function(t){return"navigation"===t.initiatorType}))[0];e=e.filter((function(t){return"script"===t.initiatorType}))[0],n=n?n.domComplete:t.domComplete-t.navigationStart;return e&&n?n-e.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(t,e){return e.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document&&void 0!==document.all?document.all.length:null}}},Nn={main_api:{end:"apiEnd",start:"apiStart",notCatchIfUndefined:!0},main_api_offset:{end:"apiStart",start:"responseEnd",notCatchIfUndefined:!0},fmp:{end:"fmp_time",start:"navigationStart",notCatchIfUndefined:!0}},Un={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connectStart",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",connect_end_time:"connectEnd",load_event_end:"loadEventEnd",dom_complete:"domComplete",dom_content_loaded_event_start:"domContentLoadedEventStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",radar_init_time:"radar_init_time",fmp_time:"fmp_time"};function Rn(t,e){if(!Array.isArray(e))return-1;var n=-1;return e.forEach((function(e,o){new RegExp(e).test(t)&&(n=o)})),n}var xn=function(t){function e(e){var n=this;return(n=t.call(this,{core:null==e?void 0:e.core,key:Ue.LOAD,version:"1.2.5",name:"RadarNavigationCollect"})||this).hasFMP=!1,n.syncMetricNum=0,n.customKeys=[],n.custom_metric={},n.optionsMainAPI=[],n.mainAPIList=[],n.radarMainApiList=[],n.mainJSList=[],n.radarMainJSList=[],n.radarTiming={radar_init_time:void 0,fmp_time:void 0,fmp:void 0,apiStart:void 0,apiEnd:void 0},n.h5Load=function(){var t=n.getPerformanceData();n.collect(Ln({event_name:"h5_load"},t))},n.dealAPI=function(t){return n.cacheAndCalculateMainAPI(t),n.addMainApiResult(t),n.mainAPIList.filter((function(t){return!!t.url})).length!==n.mainAPIList.length||void 0===n.radarTiming.fmp},n.addMainJSResult=function(t){if(!n.mainJSList||0===n.mainJSList.length)return!1;var e,o,r,i,a,s,c,u,l,p,d,f,h,g,m,v=Rn((t.file||"").replace(/\?.+$/,""),n.mainJSList);return-1<v&&!n.radarMainJSList[v].file&&(e=t.file,o=t.cached,r=t.size,i=t.failed,a=t.res_type,s=t.protocol,c=t.fb,u=t.dns,l=t.tcp,p=t.ssl,d=t.ttfb,f=t.trans,h=t.total,g=t.fetch_start,m=t.duration,t=t.start_time,n.radarMainJSList[v]={file:e,cached:o,size:r,failed:i,res_type:a,protocol:s,fb:c,dns:u,tcp:l,ssl:p,ttfb:d,trans:f,total:h,fetch_start:g,duration:m,start_time:t,reg:n.mainJSList[v]}),n.radarMainJSList.filter((function(t){return!!t.file})).length!==n.mainJSList.length},e.core||bn("212"),"string"==typeof e.mainApi?(n.optionsMainAPI.push(e.mainApi),n.mainAPIList.push({}),n.radarMainApiList.push({})):Array.isArray(e.mainApi)&&(3<e.mainApi.length&&Me("207"),n.optionsMainAPI=e.mainApi.slice(0,3),n.optionsMainAPI.forEach((function(){n.mainAPIList.push({}),n.radarMainApiList.push({})}))),"string"==typeof e.mainJs?(n.mainJSList.push(e.mainJs),n.radarMainJSList.push({})):Array.isArray(e.mainJs)&&(3<e.mainJs.length&&Me("211"),n.mainJSList=e.mainJs.slice(0,3),n.mainJSList.forEach((function(){return n.radarMainJSList.push({})}))),performance.timing?n.init():(null!=(e=n.core)&&e.collect("event",{name:"radar_error",message:"performance.timing 不存在无法收集数据",category:Ue.LOAD}),He("208")),n}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return Cn(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e.prototype.init=function(){this.radarTiming.radar_init_time=Date.now();var t,e=this.getPerformanceData();this.collect(Ln({event_name:"radar_init"},e)),null!=(t=null==(e=this.core)?void 0:e.setCommonDimension)&&t.call(e,"happen_stage","during_fmp"),0<performance.timing.loadEventStart?this.h5Load():an(window,"load",this.h5Load)},e.prototype.customStage=function(t,e){var n,o;void 0===e&&(e={sendTimeline:!0}),this.isHit?(void 0!==t&&"string"==typeof t&&""!==t||bn("206"),this.isValidTimestamp(e.timestamp,"custom_stage "+t)&&(n=e.timestamp||Date.now(),o=this.customKeys.length-this.syncMetricNum,this.customKeys.includes(t)?He("204",t):e.sendTimeline&&2<this.syncMetricNum||!e.sendTimeline&&5<o?He("205",t):n&&(this.custom_metric[t+"_time"]=n,this.customKeys.push(t),!e||!0!==e.sendTimeline&&null!=e.sendTimeline||(o=this.getPerformanceData(),this.collect(Ln(Ln({},o),{stack:(new Error).stack,event_name:"h5_custom_metric",custom_metric_name:t,custom_metric_timestamp:n})),this.syncMetricNum++)))):He("200")},e.prototype.isValidTimestamp=function(t,e){var n;if(void 0===e&&(e="fmp"),void 0!==t&&"number"!=typeof t)bn("201");else if(void 0!==t&&t<performance.timing.navigationStart)return Me("210","".concat(e)),null!=(n=this.core)&&n.collect("event",{name:"radar_error",message:"【210】".concat(e),extra_info:{timestamp:t,navigationStart:performance.timing.navigationStart}}),!1;return!0},e.prototype.fmp=function(t){var e,n;this.isHit?this.isValidTimestamp(t)&&(t=t||Date.now(),this.hasFMP?Me("202"):t&&performance.timing&&(null!=(n=null==(e=this.core)?void 0:e.setCommonDimension)&&n.call(e,"happen_stage","after_fmp"),this.hasFMP=!0,this.radarTiming.fmp_time=t,performance.timing.radarFmp=t,n=this.getPerformanceData(),performance.timing.fmp=this.radarTiming.fmp=n.fmp,this.collect(Ln({event_name:"fmp",stack:(new Error).stack},n)))):Me("200")},e.prototype.getPerformanceData=function(){var t=Ln(Ln({},_n(performance.timing)),this.radarTiming),e=on(Ln(Ln({},In),Nn),t);return Object.keys(Un).forEach((function(n){0<=t[Un[n]]&&(e[n]=t[Un[n]])})),["radar_main_js_start","lcp","cls","fid","fcp"].forEach((function(t){var n=window.__RADAR_PERFORMANCE_TIMING_&&window.__RADAR_PERFORMANCE_TIMING_[t];!n&&0!==n||(e[t]=n)})),e},e.prototype.cacheAndCalculateMainAPI=function(t){var e;void 0===this.radarTiming.fmp&&(t.before_hook_time&&(e=this.radarTiming.apiStart,this.radarTiming.apiStart=e?Math.min(e,t.before_hook_time):t.before_hook_time),t.after_hook_time&&(e=this.radarTiming.apiEnd,this.radarTiming.apiEnd=e?Math.max(e,t.after_hook_time):t.after_hook_time))},e.prototype.addMainApiResult=function(t){var e,n,o,r,i,a,s,c,u,l,p,d,f,h,g,m,v,y,_=Rn((t.api||"").replace(/\?.+$/,""),this.optionsMainAPI);-1<_&&(null==(y=this.mainAPIList[_])||!y.url)&&(y=t.api,e=t.status,n=t.size,o=t.cached,r=t.method,c=t.perfTime,i=t.protocol,a=t.custom_failed,s=t.res_type,v=An(t,["api","status","size","cached","method","perfTime","protocol","custom_failed","res_type"]),this.mainAPIList[_]=Ln({url:y,status:e,size_radar:n,cached:o,method:r,perfTime:c,protocol:i,res_type:s,custom_failed:a},v),c=v.fb,u=v.dns,l=v.tcp,p=v.ssl,d=v.ttfb,f=v.trans,h=v.total,g=v.fetch_start,m=v.duration,v=v.start_time,this.radarMainApiList[_]={api:y,status:e,size:n,cached:o,method:r,protocol:i,fb:c,dns:u,tcp:l,ssl:p,ttfb:d,trans:f,total:h,fetch_start:g,duration:m,custom_failed:a,res_type:s,reg:this.optionsMainAPI[_],start_time:v},this.radarTiming.fmp_time&&t.after_hook_time&&t.after_hook_time<this.radarTiming.fmp_time&&(y=this.getPerformanceData(),this.collect(Ln({event_name:"main_api"},y))))},e.prototype.destroy=function(){sn(window,"load",this.h5Load),this.customStage=this.fmp=function(){Me("213")}},e.prototype.collect=function(t){var e=t.protocol,n=t.event_name,o=(t.custom_metric,t.custom_metric_name),r=t.stack;t.main_api_list,t=An(t,["protocol","event_name","custom_metric","custom_metric_name","stack","main_api_list"]),this.baseCollect({value:t,dimension:{protocol:e,event_name:n,custom_metric_name:o,custom_metric:JSON.stringify(this.custom_metric),main_api_list:this.mainAPIList,radar_main_api_list:this.radarMainApiList,radar_main_js_list:this.radarMainJSList,is_official:1,stack:r}}),null!=(t=this.core)&&t.flush()},e}(Ge),Dn=function(t,e){return(Dn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},jn=function(){return(jn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Mn(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}var Hn=Qe,Bn={navigation_start:"startTime",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function Gn(t,e){if(t)return"function"==typeof t.get?t.get(e):t[e.toLowerCase()]}function Vn(t){var e="";if("string"==typeof t)e=t;else try{e=JSON.stringify(t)}catch(n){e=String(t)}for(var n=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);n+=r<128?1:r<2048?2:r<65536?3:r<1<<21?4:r<1<<26?5:r<1<<31?6:Number.NaN}return n}function Fn(t){var e=(n=document.location).protocol,n=n.host;return 0===t.indexOf("//")?e+t:0===t.indexOf("/")?"".concat(e,"//").concat(n).concat(t):t}function Jn(t){return t?"function"==typeof t.get?t.get("Content-Type"):t["content-type"]:null}var Kn=function(t){function e(e){var n=t.call(this,{core:null==(e=void 0===e?{}:e)?void 0:e.core,sampling:null==e?void 0:e.sampling,key:Ue.API,version:"1.2.5",name:"RadarAPICollect"})||this;return n.ignoreList=Ve,n.queue=[],n.logList=[],n.perfList=[],n.broadcastApi=fn(),n.initiatorTypeList=[],n.beforeHook=function(t){var e;0===(null==(e=t.url)?void 0:e.indexOf("data:"))||Xe(t.url,n.ignoreList)||Xe(t.url,(null==(e=n.core)?void 0:e.ignoreList)||[])||"js"===$e(t.url)||"css"===$e(t.url)||(e={api:Fn(t.url),method:t.method,request:t,startTime:Date.now()},n.queue.push(e))},n.afterHook=function(t,e){var o=n.queue.find((function(e){return e.request===t}));if(o){delete o.request;var r=o.startTime,i=(o=Mn(o,["startTime"]),Date.now()),a=i-r,s=e.status;if("function"==typeof n.customizeRadarStatus)try{s=n.customizeRadarStatus(e)}catch(e){}var c=n.customHook({request:t,response:e,duration:a}),u=+Gn(e.headers,"Content-Length")||0,l=function(t){function e(){t=t.replace(/^\s*/,"")}function n(n){return e(),t[0]===n&&(t=t.slice(1),1)}function o(){e();var n=/^([^\s,;=\\]+)(.*)/.exec(t);if(n)return t=n[2],n[1]}if(t&&"string"==typeof t){for(var r,i=[];r=o();){for(var a={name:r},s={};n(";");){var c,u,l=void 0;(l=o())&&(c=void 0,n("=")&&(c=function(){if(e(),'"'!==t[0])return o();t=t.slice(1);for(var n="";t.length;){var r=/^([^"\\]*)(.*)/.exec(t);if(r){if(n+=r[1],'"'===r[2][0])return t=r[2].slice(1),n;n+=r[2][1],t=r[2].slice(2)}}}(),u=void 0,(u=/([,;].*)/.exec(t))&&(t=u[1])),s[u=l.toLowerCase()]||(s[u]=1,"dur"===u?a.duration=parseFloat(c)||0:"desc"===u?a.description=c||"":a[l]=c))}if("sec"===a.unit&&a.duration&&(a.duration*=1e3),delete a.unit,i.push(a),!n(","))break}return i.length?i:void 0}}(Gn(e.headers,"Server-Timing"));a=jn(jn(jn({duration:a,logTime:Date.now(),status:s,size:+u,content_type:Jn(e.headers),custom_failed:!(200<=s&&s<300)},o),c),{before_hook_time:r,after_hook_time:i,trace_id:t.trace_id,server_timing:l});2===(null==(s=null==(u=Gn(e.headers,"Intercept-Result"))?void 0:u.split(";"))?void 0:s.length)&&null!=(o=n.core)&&o.setCommonDimension&&(n.core.setCommonDimension("intercept_result",s[0],!1),n.core.setCommonDimension("intercept_result_code",s[1],!1),a.api_intercept_result=s[0],a.api_intercept_result_code=s[1]),e.finalUrl&&(a.api=e.finalUrl),"string"==typeof e.text&&(a.responseData=e.text),0!==jn(jn({},e),{status:a.status}).status||c.intercept_report?n.mergeAPIPerf(void 0,a)||n.logList.push(a):(a.size&&0!=a.size||!a.responseData||(a.size=Vn(a.responseData)),delete a.responseData,delete a.server_timing,n.collect(a)),n.queue=n.queue.filter((function(e){return e.request&&e.request!==t}))}},void 0!==(n.option=e)&&null!=e&&e.core||bn("310"),void 0!==e.ignoreList&&(Array.isArray(e.ignoreList)||bn("309"),e.ignoreList.forEach((function(t){"string"!=typeof t&&bn("309")})),n.ignoreList=n.ignoreList.concat(e.ignoreList)),n.APIHook=e.APIHook,n.customizeRadarStatus=e.customizeRadarStatus,n.init(),n}var o=e,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=o}return Dn(o,r),o.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i),e.prototype.init=function(){var t,e=this;try{this.observer=new PerformanceObserver((function(t){return e.observeAPI(t)})),this.observer.observe({entryTypes:["resource"]}),this.initiatorTypeList=[],!0!==this.option.ignoreXHR&&(this.initiatorTypeList.push("xmlhttprequest"),this.unhookXML=function(t,e){var o=window.XMLHttpRequest;return o?(window.XMLHttpRequest=function(){var r,i,a,s=new o,c=(s._radarRequest={},s._radarResponse={},un()),u=(s._radarRequest.id=c,{});return s.addEventListener("readystatechange",(function(){if(4===s.readyState&&"function"==typeof e){s._radarResponse.status=s.status,s._radarResponse.statusText=s.statusText;var t,o,r,i,a,c=function(t,e){switch(null==e&&(e={}),n(t)){case"object":var o,r=[];for(o in t){var i=t[o],a=o.toLowerCase();r.push("".concat(a,":\t").concat(i))}return r.join("\n")+"\n";case"string":for(var s=0,c=(r=t.split("\n")).length;s<c;s++){var u=r[s];/([^:]+):\s*(.+)/.test(u)&&(u=null!=(u=RegExp.$1)?u.toLowerCase():void 0,i=RegExp.$2,u&&null==e[u]&&(e[u]=i))}return e}}(s.getAllResponseHeaders());for(t in c)r=c[t],s._radarResponse&&s._radarResponse.headers&&!s._radarResponse.headers[t]&&(o=t.toLowerCase(),s._radarResponse.headers[o]=r);if(s.responseType&&"text"!==s.responseType)"document"===s.responseType?(s._radarResponse.xml=s.responseXML,s._radarResponse.data=s.responseXML):s._radarResponse.data=s.response;else{s._radarResponse.text=s.responseText,s._radarResponse.data=s.responseText;try{s._radarResponse.xml=s.responseXML}catch(t){}}"responseURL"in s&&(s._radarResponse.finalUrl=s.responseURL);try{var l=null!=(i=u["ktrace-str"])?i:"";l&&window.parseWedTraceId&&(s._radarRequest.trace_id=window.parseWedTraceId(null!=(a=l.split("|")[1])?a:""))}catch(t){Me("traceId 解析异常")}e(s._radarRequest,s._radarResponse)}})),"function"==typeof s.setRequestHeader&&(r=s.setRequestHeader,s.setRequestHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return cn.includes(t[0])&&(u[t[0]]=t[1]),r.apply(this,t)}),"function"==typeof s.open&&(i=s.open,s.open=function(t,e,n,o,r){var a=[].slice.call(arguments);return this._radarRequest=Ce({method:t,url:e,async:n,user:o,pass:r},this._radarRequest),this._radarResponse.headers={},i.apply(this,a)}),"function"==typeof s.send&&(a=s.send,s.send=function(){var e=[].slice.call(arguments);return"function"==typeof t&&(this._radarRequest._config=e[0],t(this._radarRequest)),a.apply(this,e)}),s},["DONE","HEADERS_RECEIVED","LOADING","OPENED","UNSENT"].forEach((function(t){window.XMLHttpRequest[t]=o[t]})),window.XMLHttpRequest.prototype=o.prototype,function(){o&&(window.XMLHttpRequest=o)}):(He("118"),!1)}((function(t){return e.beforeHook(t)}),(function(t,n){return e.afterHook(t,n)}))),!0!==this.option.ignoreFetch&&(this.initiatorTypeList.push("fetch"),this.unhookFetch=function(t,e){var n=function(t){if("function"!=typeof t.fetch)return null;var e,n=t.fetch;return t.fetch=(e=t.fetch,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return dn.apply(void 0,Ne([e],Ie(t),!1))}),{register:function(t){return ln.push(t),function(){var e=ln.indexOf(t);0<=e&&ln.splice(e,1)}},clear:function(){ln=[]},unRegister:function(){n&&(t.fetch=n)}}}("function"==typeof importScripts?self:window);return n&&n.register({request:function(e,n){"function"==typeof t&&t(e)},response:function(t,n){"function"==typeof e&&e(n,t)},responseError:function(t,n){"function"==typeof e&&e(n,{status:0,statusText:t})}}),null==n?void 0:n.unRegister}((function(t){return e.beforeHook(t)}),(function(t,n){return e.afterHook(t,n)})))}catch(e){He("308"),null!=(t=this.core)&&t.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:Ue.API})}},e.prototype.customHook=function(t){var e={};if(void 0===this.APIHook)return e;if("function"!=typeof this.APIHook)return Me("300"),e;var n={};try{n=this.APIHook(t)}catch(t){return Me("301",t),{}}if(!n)return Me("302"),e;t=n.response_msg;var o=n.response_code,r=n.status,i=n.custom_failed,a=n.intercept_report;n=n.broadcast_info;if(!0===Boolean(a)&&(e.intercept_report=!0),void 0!==t)try{var s=JSON.stringify(t);100<s.length&&Me("307"),e.response_msg=s.slice(0,100)}catch(t){e.response_msg="response_msg返回结果异常",Me("303")}return void 0!==o&&(a=Number(o),isNaN(a)?Me("304"):e.response_code=a),void 0!==r&&(t=Number(r),isNaN(t)?Me("305"):e.status=t),void 0!==i&&(!0===i||!1===i?e.custom_failed=i:Me("306")),e.broadcast_info=n,e},e.prototype.observeAPI=function(t){var e=this;t.getEntriesByType("resource").forEach((function(t){var n,o,r;if(0===(null==(r=t.name)?void 0:r.indexOf("data:"))||Xe(t.name,e.ignoreList)||Xe(t.name,(null==(r=e.core)?void 0:r.ignoreList)||[]))return!1;"api"===nn(t)&&((r=on(Hn,t)).perfTime=Date.now(),null!=(n=null==(n=t.serverTiming)?void 0:n.map((function(t){return{name:t.name,duration:t.duration,description:t.description||void 0}})))&&n.length||(n=void 0),o={encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},Object.keys(Bn).forEach((function(e){o[e]=Number(t[Bn[e]]+performance.timing.navigationStart)})),r=jn(jn(jn(jn({},r),{api:r.file}),o),{server_timing:n}),e.mergeAPIPerf(r)||e.perfList.push(r))}))},e.prototype.destroy=function(){this.unhookXML&&this.unhookXML(),this.unhookFetch&&this.unhookFetch(),this.observer&&this.observer.disconnect()},e.prototype.mergeAPIPerf=function(t,e){if(t?e=this.takeItem(t,this.logList):e&&(t=this.takeItem(e,this.perfList)),!t||!e)return!1;if(!0===e.intercept_report)return!0;var n,o=Object.assign({},e,t,{size:t.size||e.size});return delete o.file,o.size&&0!=o.size||!o.responseData||(o.size=Vn(o.responseData)),delete o.responseData,(e=e.server_timing||t.server_timing)&&(n=null,e.map((function(t){"total-timing"===t.name&&(n=null!=(t=t.duration)?t:null)})),o.total_server_timing=n,o.server_data_list=JSON.stringify(e)),delete o.server_timing,this.collect(o),!0},e.prototype.takeItem=function(t,e){var n,o=(t.api||"").replace(/\?.+$/,"");if(-1!==(t=e.findIndex((function(t){return t=(t.api||"").replace(/\?.+$/,""),o===t}))))return n=e[t],e.splice(t,1),n},e.prototype.collect=function(t){var e=this,n=t.res_type,o=t.protocol,r=t.api,i=t.custom_failed,a=t.status,s=t.cached,c=t.method,u=t.response_code,l=t.response_msg,p=(t.has_fmp,t.server_data_list),d=t.content_type,f=t.broadcast_info,h=t.before_hook_time,g=t.after_hook_time,m=t.api_intercept_result,v=t.api_intercept_result_code,y={dimension:{before_hook_time:h,after_hook_time:g,res_type:n,protocol:o,api:r,custom_failed:i,status:a,cached:s,method:c,response_code:u,response_msg:l,content_type:d,broadcast_info:f,is_official:1,server_data_list:p,trace_id:t.trace_id,api_intercept_result:m,api_intercept_result_code:v,has_timing_allow:t.has_timing_allow},value:Mn(t,["res_type","protocol","api","custom_failed","status","cached","method","response_code","response_msg","has_fmp","server_data_list","content_type","broadcast_info","before_hook_time","after_hook_time","api_intercept_result","api_intercept_result_code","trace_id","has_timing_allow"])};this.broadcastApi.emit(_n(t)),0===a&&tn(this.option.isIgnoreInvalidStatusCode)?new Promise((function(n,o){var r,i;e.option.isIgnoreInvalidStatusCode&&(function(t){return t&&tn(t.then)&&tn(t.catch)}(r=e.option.isIgnoreInvalidStatusCode(t))?(i=setTimeout((function(){return n(!1)}),2e3),r.then((function(t){clearTimeout(i),n(!0===t)}),o)):n(!0===r))})).then((function(t){t?Me("异步拦截日志"):e.baseCollect(y)}),(function(t){e.baseCollect(y),He(t)})):this.baseCollect(y)},e}(Ge),Wn=function(t,e){return(Wn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},qn=function(){return(qn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},zn=Object.assign({},Qe,{duration:{end:"responseEnd",start:"fetchStart"},cached_type:{custom:function(t,e){var n="hit_browser";if(0===e.transferSize||0===e.duration)return n;if(null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart))return n;if(e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name}))){if(e.serverTiming.some((function(t){return"miss"===t.name})))return"miss_cdn";if(e.serverTiming.some((function(t){return"hit"===t.name})))return"hit_cdn"}return"miss_browser"},crossOriginSkip:!0},cdn_duration:{custom:function(t,e){return e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name}))?null==(e=null==(e=e.serverTiming)?void 0:e.find((function(t){return"total-timing"===t.name})))?void 0:e.duration:null},crossOriginSkip:!0,cachedSkip:!0},cdn_ip:{custom:function(t,e){if(e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name})))return null==(e=e.serverTiming.find((function(t){return"miss"===t.name||"hit"===t.name})))?void 0:e.description},crossOriginSkip:!0,cachedSkip:!0}}),Qn={fetch_start_time:"fetchStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function Yn(t){return Array.isArray(t)?t.map((function(t){var e=void 0===(e=t.tagName)?"":e,n=t.id;return t=t.getAttribute?t.getAttribute("class"):t.className||"",e=e.toLowerCase(),n&&(e+="#".concat(n)),t&&(e+=t.split(/\s+/g).map((function(t){return".".concat(t)})).join("")),e})).filter((function(t){return t})).join(","):""}var Xn,$n,Zn,to,eo=function(t){function e(e){var n,o=this;return(o=t.call(this,{core:null==e?void 0:e.core,sampling:null!=(n=null==e?void 0:e.sampling)?n:.1,version:"1.2.5",key:Ue.RES,name:"RadarResourceCollect"})||this).ignoreList=Ve,o.broadcastJs=fn(),o.onResError=function(t,e){var n;(function(t){return t.message||null!=t.lineno})(t)||(n=(t.target.src||t.target.href||"").toString(),n={failed:!0,file:n="function"!=typeof t.target.getAttribute||""!==t.target.getAttribute("src")&&""!==t.target.getAttribute("href")?n:"",res_path:Yn(t&&t.path||t&&t.composedPath&&t.composedPath())},o.collect(n,e),o.broadcastJs.emit(n))},o.observeResource=function(t){t.getEntriesByType("resource").forEach((function(t){var e,n,r;if(0===t.name.indexOf("data:")||Xe(t.name,o.ignoreList)||Xe(t.name,(null==(e=o.core)?void 0:e.ignoreList)||[]))return!1;"resource"===nn(t)&&(e=on(zn,t),n={encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},Object.keys(Qn).forEach((function(e){n[e]=Number(t[Qn[e]]+performance.timing.navigationStart)})),r=qn(qn({failed:!1},e),n),o.collect(r),setTimeout((function(){o.broadcastJs.emit(r)})))}))},o.resourceHook=e.resourceHook,void 0!==e.ignoreList&&(Array.isArray(e.ignoreList)||bn("802"),e.ignoreList.forEach((function(t){"string"!=typeof t&&bn("802")})),o.ignoreList=o.ignoreList.concat(e.ignoreList)),o.init(),o}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return Wn(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e.prototype.init=function(){var t,e=this;try{this.observeResource(performance),this.observer=new PerformanceObserver((function(t){return e.observeResource(t)})),this.observer.observe({entryTypes:["resource"]})}catch(e){He("801"),null!=(t=this.core)&&t.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:Ue.RES})}an(window,"error",(function(t){return e.onResError(t)}),!0),this.parseSeedLog()},e.prototype.parseSeedLog=function(){var t=this,e=vn(qe,[]);e.length&&(e.map((function(e){var n=e.data;e=e.dimension||{},t.onResError(n,e)})),yn(qe,[]))},e.prototype.collect=function(t,e){var n=t.cached,o=t.failed,r=t.file,i=t.protocol,a=t.res_type,s=t.res_path,c=t.cached_type,u=t.cdn_ip,l=t.has_timing_allow;t=function(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}(t,["cached","failed","file","protocol","res_type","res_path","cached_type","cdn_ip","has_timing_allow"]);try{var p=this.resourceHook&&this.resourceHook({file:r,cached:n,protocol:i,res_type:a,failed:o});if(null!=p&&p.intercept_report)return}catch(t){He("803",t)}this.baseCollect({value:t,dimension:qn({cached:n,failed:o,file:r,protocol:i,res_type:a,res_path:s,sample_rate:this.sampling,is_official:1,cached_type:c,cdn_ip:u,has_timing_allow:l},e)})},e.prototype.destroy=function(){this.isHit&&(sn(window,"error",this.onResError,!0),this.observer&&this.observer.disconnect())},e}(Ge),no=function(t,e){return(no=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},oo=function(){return"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)},ro=function(t){return{name:t,value:1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,delta:0,entries:[],id:oo(),isFinal:!1}},io=function(t,e){try{var n;if(PerformanceObserver.supportedEntryTypes.includes(t))return(n=new PerformanceObserver((function(t){return t.getEntries().map(e)}))).observe({type:t,buffered:!0}),n}catch(t){}},ao=!1,so=!1,co=function(t){ao=!t.persisted},uo=function(){addEventListener("pagehide",co),addEventListener("beforeunload",(function(){}))},lo=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];so||(uo(),so=!0),addEventListener("visibilitychange",(function(e){e=e.timeStamp,"hidden"===document.visibilityState&&t({timeStamp:e,isUnloading:ao})}),{capture:!0,once:e})},po=function(t,e,n,o){var r;return function(){n&&e.isFinal&&n.disconnect(),0<=e.value&&(o||e.isFinal||"hidden"===document.visibilityState)&&(e.delta=e.value-(r||0),(e.delta||e.isFinal||void 0===r)&&(t(e),r=e.value))}},fo=function(){return void 0===Xn&&(Xn="hidden"===document.visibilityState?0:1/0,lo((function(t){return t=t.timeStamp,Xn=t}),!0)),{get timeStamp(){return Xn}}},ho=function(){return $n=$n||new Promise((function(t){return["scroll","keydown","pointerdown"].map((function(e){addEventListener(e,t,{once:!0,passive:!0,capture:!0})}))}))},go=[{name:"fid",collectFn:function(t){function e(t){t.startTime<o.timeStamp&&(n.value=t.processingStart-t.startTime,n.entries.push(t),n.isFinal=!0,i())}var n=ro("FID"),o=fo(),r=io("first-input",e),i=po(t,n,r);r?lo((function(){r.takeRecords().map(e),r.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(t,e){e.timeStamp<o.timeStamp&&(n.value=t,n.isFinal=!0,n.entries=[{entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t}],i())}))}},{name:"lcp",collectFn:function(t){function e(t){var e=t.startTime;e<i.timeStamp?(r.value=e,r.entries.push(t)):r.isFinal=!0,n()}var n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=ro("LCP"),i=fo(),a=io("largest-contentful-paint",e);a&&(n=po(t,r,a,o),o=function(){r.isFinal||(a.takeRecords().map(e),r.isFinal=!0,n())},ho().then(o),lo(o,!0))}},{name:"cls",collectFn:function(t){function e(t){t.hadRecentInput||(r.value+=t.value,r.entries.push(t),n())}var n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=ro("CLS",0),i=io("layout-shift",e);i&&(n=po(t,r,i,o),lo((function(t){t=t.isUnloading,i.takeRecords().map(e),t&&(r.isFinal=!0),n()})))}},{name:"fcp",collectFn:function(t){var e,n=ro("FCP"),o=fo(),r=io("paint",(function(t){"first-contentful-paint"===t.name&&t.startTime<o.timeStamp&&(n.value=t.startTime,n.isFinal=!0,n.entries.push(t),e())}));r&&(e=po(t,n,r))}}],mo=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,version:"1.2.5",key:Ue.EVENT,name:"RadarChromeMetricsCollect"})||this;return n.options={lcp:!1,cls:!1,fid:!1,fcp:!1},n.init=function(){var t=n.options;go.forEach((function(e){var o=e.name;t&&!t[o]||e.collectFn((function(t){var e=t.name;t=t.value,function(t,e){null!==window&&void 0!==window&&window.__RADAR_PERFORMANCE_TIMING_||(window.__RADAR_PERFORMANCE_TIMING_={}),window.__RADAR_PERFORMANCE_TIMING_[t]=e}(e.toLocaleLowerCase(),Number(t)),n.baseCollect({dimension:{name:e.toLocaleLowerCase(),is_official:1},value:{duration:Number(t)}})}))}))},Object.assign(n.options,e.options),go.forEach((function(t){var e=hn("radar_"+t.name);e&&(n.options[t.name]="1"===e)})),n.init(),n}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return no(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e}(Ge),vo=function(t,e){return(vo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},yo=function(){return(yo=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},_o=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,key:Ue.EVENT,version:"1.2.5",name:"RadarEventCollect"})||this;return n.action={start:function(t){n._checkActionDimension(t),n.event({name:t.name,extra_info:t.extra_info,event_type:"radar_action_start"})},end:function(t){n._checkActionDimension(t),n.event({name:t.name,extra_info:t.extra_info,result_type:t.result_type,event_type:"radar_action_end"})}},n.parseSeedLog(),n}var o=e,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=o}return vo(o,r),o.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i),e.prototype.parseSeedLog=function(){var t=this,e=vn(ze,[]);e.length&&(e.map((function(e){var n=e.dimension;e=e.value,t.event(n,e)})),yn(ze,[]))},e.prototype.event=function(t,e){var o;this.isHit?(t||bn("402"),void 0!==t.name&&"string"==typeof t.name||bn("402"),127<t.name.length&&(He("403"),t.name=t.name.slice(0,127)),t.is_official=1,e&&void 0!==e.duration&&("number"!=typeof e.duration||e.duration<0)&&bn("404"),e&&void 0!==e.event_count&&("number"!=typeof e.event_count||e.event_count<0)&&bn("405，".concat(e.event_count)),o={dimension:t,value:e},t&&t.extra_info&&"object"==n(t.extra_info)&&(o={dimension:yo(yo({},t),{extra_info:JSON.stringify(t.extra_info)}),value:e}),this.baseCollect(o)):Me("401")},e.prototype.destroy=function(){this.event=function(){Me("407")},this.action={start:function(){Me("407")},end:function(){Me("407")}}},e.prototype._checkActionDimension=function(t){if(!t)throw Error("408");void 0===t.extra_info||t.extra_info instanceof Object||bn("406")},e}(Ge),wo=function(t,e){return(wo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},So=function(){return(So=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function bo(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}(to=Zn=Zn||{}).SCRIPT="script",to.RES="res",to.API="api",to.VIDEO="video";var ko=[];function Eo(t,e,o){var r,i;if(e&&(e instanceof Error||"object"==n(e)&&"string"==typeof e.message)){if("BridgeError"===(r=e.name||"ErrorLikeObject")&&"function"==typeof e.toJSON)try{var a=e.toJSON();delete a.name,delete a.message,i="".concat(e.message," (").concat(JSON.stringify(a),")")}catch(t){i=e.message||""}else i=e.message||"";a=e.stack||void 0}else i=null==e&&"Script error."===(null==o?void 0:o.message)?(r="CrossOriginError","".concat(t," - message: ").concat((null==o?void 0:o.message)||"<UNKNOWN>")):null===e&&null!=o&&o.message&&"Uncaught null"!==o.message?(r="Error","".concat(t," - message: ").concat(o.message)):(r=null==e?"".concat(e):n(e),o=function(t){var e;try{e=t.toString(),t&&"object"==n(t)&&(e=JSON.stringify(t))}catch(t){}return"string"!=typeof e||""===e?e=null===t?"<NULL>":void 0===t?"<UNDEFINED>":""===e?"<EMPTY>":"<UNKNOWN>":2e3<e.length&&(e=e.substring(0,2e3)+"<<< ……"),e}(e),"".concat(t," - value: ").concat(o));return{error_type:Zn.SCRIPT,error_cons_type:r,msg:i,stack:a}}function Po(t){for(var e=0;e<ko.length;e++)if(Oo(ko[e],t))return e;return-1}function Oo(t,e){return t.msg===e.msg&&t.stack===e.stack&&t.file===e.file&&t.line===e.line&&t.col===e.col}var To=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,key:Ue.ERROR,version:"1.2.5",name:"RadarErrorCollect"})||this;return n.onError=function(t,e){var o;!(o=t).message&&null==o.lineno||(t=So(So({},Eo("Global Uncaught Exception",t.error,t)),{file:t.filename,line:t.lineno,col:t.colno}),n.isSameErrorAndReport(t,e))},n.onPromiseError=function(t,e){t=Eo("Unhandled Promise Rejection",t.reason),n.isSameErrorAndReport(t,e)},n.core=e.core,n.init(),n}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return wo(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e.prototype.init=function(){ko.splice(0),an(window,"error",this.onError,!0),an(window,"unhandledrejection",this.onPromiseError),this.parseSeedLog()},e.prototype.destroy=function(){sn(window,"error",this.onError,!0),sn(window,"unhandledrejection",this.onPromiseError),this.captureException=function(){Me("600")}},e.prototype.parseSeedLog=function(){var t=this,e=vn(We,[]);e.length&&(e.map((function(e){var n=e.data;e=e.dimension||{},"unhandledrejection"===(null==n?void 0:n.type)?t.onPromiseError(n,e):t.onError(n,e)})),yn(We,[]))},e.prototype.isSameErrorAndReport=function(t,e){0<=Po(t)||(ko.push(t),setTimeout((function(){ko.splice(Po(t),1)}),2e3),this.collect(t,e))},e.prototype.collect=function(t,e){var n,o,r,i,a,s,c,u;o=(n=t).error_cons_type,r=n.file,i=n.error_type,a=n.msg,s=n.col,c=n.line,u=n.stack,t={key:"error",value:bo(n,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:o,file:r,error_type:i,msg:a,col:s,line:c,stack:u}},e=So(So({},t.dimension),e||{}),this.baseCollect({dimension:e,value:t.value})},e.prototype.captureException=function(t){this.isSameErrorAndReport(Eo("Captured Exception",t))},e}(Ge),Co=function(){function t(t){var e,n=this;this.core=new Tn({weblogger:t.weblog,projectId:t.projectId,sampling:null!=(e=t.sampling)?e:1,httpReportFirst:t.httpReportFirst,customDimensions:t.customDimensions}),this.navigationCollect=new xn({core:this.core,mainApi:t.mainApi,mainJs:t.mainJs}),t.unuseAPIPlugin||(this.apiCollect=new Kn({core:this.core,sampling:t.apiSampling,APIHook:t.APIHook,customizeRadarStatus:t.customizeRadarStatus,ignoreList:t.ignoreList,ignoreXHR:t.ignoreXHR,ignoreFetch:t.ignoreFetch,isIgnoreInvalidStatusCode:t.isIgnoreInvalidStatusCode}),this.apiCollect.broadcastApi.on((function(t){return n.navigationCollect.dealAPI(t)}))),t.unuseResourcePlugin||(this.resourceCollect=new eo({sampling:t.resourceSampling,core:this.core,ignoreList:t.ignoreList,resourceHook:t.resourceHook}),this.resourceCollect.broadcastJs.on((function(t){return n.navigationCollect.addMainJSResult(t)}))),this.chromeMetricsCollect=new mo({core:this.core,options:{lcp:t.lcp,cls:t.cls,fid:t.fid,fcp:t.fcp}}),this.eventCollect=new _o({core:this.core}),this.action=this.eventCollect.action,t.unuseErrorPlugin||(this.errorCollect=new To({core:this.core})),Fe[Je]&&(Fe[Je].isCoreReady=!0)}return t.prototype.apply=function(t){this.bindWeblogger(t)},t.prototype.bindWeblogger=function(t){this.weblogger=t,this.core.bindWeblogger(this.weblogger)},t.prototype.event=function(t,e){this.eventCollect.event(t,e)},t.prototype.customStage=function(t,e){this.navigationCollect.customStage(t,e)},t.prototype.setDimensions=function(t){this.core.setDimensions(t)},t.prototype.fmp=function(t){"number"==typeof t?this.navigationCollect.fmp(t):"object"==n(t)&&t.timestamp?this.navigationCollect.fmp(t.timestamp):this.navigationCollect.fmp()},t.prototype.captureException=function(t){var e;this.errorCollect&&null!=(e=this.errorCollect)&&e.captureException(t)},t.prototype.destroy=function(){var t;null!=(t=this.navigationCollect)&&t.destroy(),null!=(t=this.apiCollect)&&t.destroy(),null!=(t=this.resourceCollect)&&t.destroy(),null!=(t=this.eventCollect)&&t.destroy(),null!=(t=this.errorCollect)&&t.destroy()},t.key="radar",t.version="1.2.5",t}();"undefined"!=typeof window&&"function"!=typeof window.Radar&&(window.Radar=Co);var Lo,Ao=[],Io=function(t){function e(e,n){var o=t.call(this)||this;return o.options=n||e,o.validOption()?((null==e?void 0:e.collect)&&o.apply(e),o):o}return r(e,t),e.prototype.apply=function(t){var e;this.weblog=t,this.radarInstance=new Co(i(i({},this.options),{weblog:t})),this.action=null===(e=this.radarInstance)||void 0===e?void 0:e.action},e.prototype.destroy=function(){var t;null===(t=this.radarInstance)||void 0===t||t.destroy()},e.prototype.collect=function(t,e){var n;0!==t.indexOf("c_")&&Ao.indexOf(t)<0?P("[error 305]","[Radar] 传入的自定义指标 ".concat(t," 必须为 c_ 开头")):(E("[radar]:Radar+之后将不再支持collect方法，请用event方法替代。"),null===(n=this.radarInstance)||void 0===n||n.event({name:t},{duration:e}))},e.prototype.fmp=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.fmp(t)},e.prototype.event=function(t,e){var n;null===(n=this.radarInstance)||void 0===n||n.event(t,e)},e.prototype.customStage=function(t,e){var n;null===(n=this.radarInstance)||void 0===n||n.customStage(t,e)},e.prototype.headlessTestReport=function(){E("[radar]:Radar+已不支持不再支持headlessTestReport方法")},e.prototype.playClicked=function(t){E("[radar]:Radar+已不支持不再支持playClicked方法")},e.prototype.playIDR=function(t){E("[radar]:Radar+已不支持不再支持playIDR方法")},e.prototype.playBlock=function(t){E("[radar]:Radar+已不支持不再支持playBlock方法")},e.prototype.playError=function(t){E("[radar]:Radar+已不支持不再支持playError方法")},e.prototype.setDimensions=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.setDimensions(t)},e.prototype.validOption=function(){var t=this;if(!this.options)return!1;var e=this.options,n=e.sampling,o=void 0===n?1:n;return"string"==typeof e.projectId&&(!(o>1||o<0)&&(["apiSampling","errorSampling","resourceSampling","eventSampling"].forEach((function(e){var n=t.options[e];void 0!==n&&"number"==typeof n&&0===n&&P("[error 304]","[Radar] 采样率 ".concat(e," 不能被设置为 0，将改用默认值"))})),!0))},e.prototype.captureException=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.captureException(t)},e.key="radar",e}(ge),No=!1,Uo="hashchange",Ro=function(t){function e(e,n){var o=t.call(this)||this;return o.beginTime=(new Date).valueOf(),o.oldPushState=history.pushState,o.oldReplaceState=history.replaceState,o.visibilityChange=function(){var t=document.visibilityState;"visible"===t&&(No=!1),o.weblog&&!No&&o.autoPVFilter(location.href,null,t)&&("hidden"!==t&&"visible"!==t||("visible"===t&&(o.beginTime=(new Date).valueOf()),o.weblog.sendImmediately("PV",{type:t,auto:!0,beginTime:o.beginTime})))},o.proxyPushState=function(t,e,n){return o.urlChange(),o.oldPushState.call(history,t,e,n)},o.proxyReplaceState=function(t,e,n){return o.urlChange(),o.oldReplaceState.call(history,t,e,n)},o.urlChange=function(){o.weblog&&setTimeout((function(){var t=U({url:location.href},o.weblog.logConfig.urlMap),e=t.page,n=t.params;e&&e===o.weblog.currentUrlPackage.page?o.weblog.currentUrlPackage.update(e,n):(o.autoPVFilter(location.href,o.weblog.currentUrlPackage.page,"leave")&&o.weblog.sendImmediately("PV",{type:"leave",auto:!0,beginTime:o.beginTime,urlPage:o.weblog.currentUrlPackage.toJSON()}),o.autoPVFilter(location.href,o.weblog.currentUrlPackage.page,"enter")&&(o.weblog.updateReferUrlPackage(o.weblog.currentUrlPackage),o.weblog.updateCurrentUrlPackage(location.href),o.weblog.currentUrlPackage.page.indexOf("http"),o.beginTime=(new Date).valueOf(),o.weblog.sendImmediately("PV",{type:"enter",auto:!0})))}),0)},o.beforeUnload=function(){No=!0,o.weblog&&o.autoPVFilter(location.href,null,"leave")&&o.weblog.sendImmediately("PV",{type:"leave",auto:!0,beginTime:o.beginTime})},o.autoPVFilter=function(){return!0},e&&("function"==typeof e?o.autoPVFilter=e:"function"==typeof(null==e?void 0:e.collect)?((null==n?void 0:n.autoPVFilter)&&(o.autoPVFilter=n.autoPVFilter),o.apply(e)):"autoPVFilter"in e&&"function"==typeof e.autoPVFilter&&(o.autoPVFilter=e.autoPVFilter)),n&&"function"==typeof n.autoPVFilter&&(o.autoPVFilter=n.autoPVFilter),history.pushState=o.proxyPushState,history.replaceState=o.proxyReplaceState,o}return r(e,t),e.prototype.apply=function(t){if(t&&t.sendImmediately){this.weblog=t,this.autoPVFilter(location.href,null,"enter")&&this.weblog.sendImmediately("PV",{type:"enter",auto:!0});var e=t.Utils.ua.supportsPushState;Uo=e()?"popstate":"hashchange",O(window,Uo,this.urlChange),O(document,"visibilitychange",this.visibilityChange)}},e.prototype.destroy=function(){T(window,Uo,this.urlChange),T(document,"visibilitychange",this.visibilityChange),history.pushState=this.oldPushState,history.replaceState=this.oldReplaceState},e.key="autoPV",e}(ge),xo=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.initBuildInPlugins(),o}return r(e,t),e.prototype.initBuildInPlugins=function(){var t=this.logConfig,e=t.autoPV,n=t.radar,o=t.fps,r=t.timing,i=t.crash,a=t.autoPVFilter;o&&this.plug(be),r&&this.plug(Oe),i&&this.plug(ye),n&&this.plug(Io,n),(e||void 0===e)&&this.plug(Ro,{autoPVFilter:a})},e}(he);Lo=xo,void 0!==window._GLOBAL_KS_WEBLOGGER_?window._GLOBAL_KS_WEBLOGGER_.Factory=Lo:window.Weblog=Lo,(null==ie?void 0:ie.constructors)&&Lo&&-1===ie.constructors.indexOf(Lo)&&(Lo._classId=ie.constructors.length,ie.constructors.push(Lo)),function(){if(null==ie?void 0:ie.silence)try{ie._silenced=!!sessionStorage.getItem(ce)}catch(t){}}(),t.BasePlugin=ge,t.Weblog=xo,t.default=xo,Object.defineProperty(t,"__esModule",{value:!0})}));
