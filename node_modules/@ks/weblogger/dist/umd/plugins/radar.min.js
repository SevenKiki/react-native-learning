!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Radar=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};var n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function r(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t,e,n,r){return new(n=n||Promise)((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){var c=[a,s];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,(c=o?[2&c[0],o.value]:c)[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(s){c=[6,s],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function c(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}var l,u,p="ksurl.cn/csHfgepO",d=console,f=d.log.bind(d,p+", radar:"),m=d.warn.bind(d,p+", radar:"),h=d.error.bind(d,p+", radar:"),v=function(){function t(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middlewares=[],(t=this.middlewares).push.apply(t,c([],s(e),!1))}return t.prototype.use=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this.middlewares.pop();(t=this.middlewares).push.apply(t,c([],s(e),!1)),this.middlewares.push(r)},t.prototype.invoke=function(t){return r=this.middlewares,e=t,n=-1,function t(o){if(o<=n)return new Error("`next` 被重复调用");var i=r[n=o];if(i=o===r.length?undefined:i)try{return i(e,t.bind(null,o+1))}catch(o){return o}}(0);var e,n,r},t}(),g=((u=l=l||{}).LOAD="load",u.RES="resource",u.API="api",u.ERROR="error",u.SDK_ERROR="sdk_error",u.CUSTOM="custom",u.BATCH="batch",u.EVENT="event",u.BLOOD="blood",function(){function e(e){void 0===e&&(e={});var n=this;this.broadcastSampleFb=function(){var t=n.getSample(n.baseOptions.sampling);t!==n.sampling&&(n.sampling=t,n.sampling&&(n.isHit=n.samplingControl(n.sampling)))},void 0===e&&G("100"),e.key||G("101"),!e.core||"object"==t(e.core.sampleData)&&"function"==typeof e.core.collect||G("121"),this.baseOptions=e,this.key=e.key,this.version=e.version,this.name=e.name,this.isHit=!1,e.core&&this.updateCore(e.core)}return e.prototype.updateCore=function(e){var n;"object"==t(e.sampleData)&&"function"==typeof e.collect||G("121"),null!=(n=this.core)&&n.broadcastSample.off(this.broadcastSampleFb),this.core=e,this.sampling=this.getSample(this.baseOptions.sampling),this.sampling&&(this.isHit=this.samplingControl(this.sampling)),null!=(e=null==(n=this.core)?void 0:n.broadcastSample)&&e.on(this.broadcastSampleFb)},e.prototype.getSample=function(t){var e=null!=(e=null==(e=this.core)?void 0:e.sampleData.core)?e:1;if(this.key===l.LOAD)return e;if("number"!=typeof(t=void 0===t?1:t)||t<0||1<t)return m("102","".concat(this.key,"，采用Core的采样率").concat(null==(n=this.core)?void 0:n.sampleData.core)),e;var n=null!=(n=this.core)&&n.isInYoda?void 0===(null==(n=this.core)?void 0:n.sampleData[this.key])?1:this.core.sampleData[this.key]:t;return e&&e<n?(m("115","".concat(this.key)),e):n},e.prototype.samplingControl=function(t){var e;return!(null==(e=this.core)||!e.sampleData.isHit)&&(null==(e=this.core)?void 0:e.samplingControl(t/this.core.sampleData.core))},e.prototype.baseCollect=function(t){if(this.core){if(this.isHit){var e=t.value||{};e=Object.keys(e).filter((function(t){return null!==e[t]&&void 0!==e[t]})).reduce((function(t,n){return o(o({},t),((t={})[n]=e[n],t))}),{});try{this.core.collect(t.key||this.key,o(o({collect_version:this.version,collect_name:this.name},t.dimension),{sample_rate:this.sampling}),e)}catch(t){m("126")}}}else m("110","".concat(this.key))},e}());var _=["//wlog.kuaishou.com/rest/n/log/web/collect","/rest/wd/common/log/collect/misc2","/rest/wd/common/log/collect/radar","/rest/kd/log/collect"],y=window,b="__radarSeedStore__",S="Queue",w="error"+S,O="resource"+S,E="event"+S,k={start_time:{custom:function(t,e){return Math.round(e.startTime)}},fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0,crossOriginSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0,crossOriginSkip:!0},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0,crossOriginSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0,crossOriginSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0,crossOriginSkip:!0},total:{end:"responseEnd",start:"fetchStart"},size:{custom:function(t,e){return e.encodedBodySize},cachedSkip:!0,crossOriginSkip:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name}},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||0===e.duration||null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart)},crossOriginSkip:!0},has_timing_allow:{custom:function(t,e){return I(e)}}},L=/^(https?:)?\/\//;function R(t,e){if(!t)return!1;var n=t.replace(L,"");return e.some((function(t){return 0<=n.indexOf(t.replace(L,""))}))}function P(t){if("string"!=typeof t)return"";try{var e=t.lastIndexOf(".");return t.substr(e+1)}catch(t){return""}}function x(e){return"object"==t(e)&&Object.keys(e).every((function(t){return"number"==typeof e[t]}))}function C(t){return"function"==typeof t}function I(t){return void 0===t.nextHopProtocol?null:""!==t.nextHopProtocol}function A(t){return"resource"===t.entryType?"fetch"!==(null==t?void 0:t.initiatorType)&&"xmlhttprequest"!==(null==t?void 0:t.initiatorType)||"js"===P(t.name)||"css"===P(t.name)?"resource":"api":"other"}function D(t,e){var n={};return Object.keys(t).forEach((function(r){var o=T(r,t,e);null!=o&&(n[r]=o)})),n}function T(t,e,n){var r=e[t];if(r||G("129，".concat(t)),(!r.crossOriginSkip||I(n))&&(!r.cachedSkip||!T("cached",e,n)))return"function"==typeof r.custom?r.custom(t,n):(e=r.end,t=r.start,!r.notCatchIfUndefined||void 0!==n[e]&&void 0!==n[t]?(+n[e]||0)-(+n[t]||0):void 0)}function j(t,e,n,r){return t.addEventListener(e,n,r)}function N(t,e,n,r){return t.removeEventListener(e,n,r)}var M=["ktrace-str"];function H(t){return"__radar_".concat(t=void 0===t?"":t).concat(Math.random().toString(36).substring(2,8))}var J=[],q=["application/json","text/html","text/plain"];function U(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=J.reduce((function(t,e){return[e].concat(t)}),[]),l="string"==typeof n[0]?new Request(n[0],n[1]):n[0],u=(l.id=H(),o.forEach((function(t){t=t.request,l=t(l)||l})),l.clone()),p=t.apply(void 0,c([],s(n),!1)),d=null,f=null,m=!1;return p.then((function(t){var e,n=null==(e=t.headers)?void 0:e.get("content-type");return n&&q.some((function(t){return-1<n.indexOf(t)}))?(m=!0,e=t.clone(),d=e.clone(),e.clone().text()):(d=t,"[object Object]")})).then((function(t){return i(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:f=t,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,u.text()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,"Radar: Request.text()失败"];case 4:return[2]}}))}))})).then((function(t){l._config=t;var e=null;return m?(e=d.clone()).data=f:e=d,o.forEach((function(t){(t=t.response)&&(e=t(e,l)||e)})),d}),(function(t){throw o.forEach((function(e){(e=e.responseError)&&(t=e(t,l)||t)})),t}))}function F(){var t=[];function e(e){-1!==(e=t.indexOf(e))&&t.splice(e,1)}function n(n){return t.push(n),e.bind(void 0,n)}return{on:n,off:e,once:function(t){var e=n((function(n){t(n),e()}));return e},emit:function(e){t.forEach((function(t){return t(e)}))}}}function z(t){return(t=new RegExp("(?:^|; ?)".concat(t,"=(1|0)(;|$)")).exec(document.cookie))&&t[1]}var B=["radar_init","h5_load","fmp","main_api","h5_custom_metric"];var Q={load:function(t){var e=t.dimension,n=t.value;if(t=e.event_name,B.indexOf(t)<0)return!1;if(!x(n))return!1;switch(t){case"fmp":var r=n.fmp_time;return!(!n.fmp||!r);case"h5_load":return r=n.total,!(!n.load_event_time||!r);case"h5_custom_metric":return r=n.custom_metric_timestamp,!(!e.custom_metric_name||!r)}return!0},api:function(t){var e=t.dimension,n=(t=t.value,e.custom_failed),r=e.api,o=e.status,i=e.res_type,a=e.protocol,s=(e=e.cached,t.duration),c=t.size;return"boolean"==typeof(void 0!==n&&n)&&"string"==typeof(void 0===r?"":r)&&"number"==typeof(void 0===o?0:o)&&"string"==typeof(void 0===i?"":i)&&"string"==typeof(void 0===a?"":a)&&"boolean"==typeof(void 0!==e&&e)&&"number"==typeof(void 0===s?0:s)&&"number"==typeof(void 0===c?0:c)&&x(t)},resource:function(t){var e=t.dimension,n=(t=t.value,e.failed);if("boolean"!=typeof n)return!1;if(n){var r=e.res_path;if("string"!=typeof e.file||"string"!=typeof r)return!1}return!!n||"string"==typeof e.file&&x(t)},error:function(e){var n=(e=e.dimension).error_type;if([e.error_cons_type,n,e.msg].some((function(t){return null==t})))return!1;n=e.col;var r,o=e.line;return e.sample_rate,e.event_client_timestamp,e=function(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(e,["col","line","sample_rate","event_client_timestamp"]),!(n&&"number"!=typeof n||o&&"number"!=typeof o)&&"object"==t(r=e)&&Object.keys(r).every((function(t){return void 0===r[t]||"string"==typeof r[t]}))},event:function(t){var e=t.value;return t=t.dimension.name,!(void 0!==e&&!x(e)||!t)},blood:function(t){var e=!0;if((t=t.dimension.data)instanceof Array){if(0===t.length)return!1;t.forEach((function(t){"string"!=typeof t.com&&(e=!1)}))}return e}};function X(t,e){var n;return null!=(n=null==y?void 0:y[b])&&n[t],null!=(n=null==y?void 0:y[b])&&n.isRuning?y[b][t]:void 0===e?null:e}function W(t,e){try{y[b][t]=e}catch(t){h("1000")}}function V(t){return JSON.parse(JSON.stringify(t))}function Y(t){try{var e;if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage)return function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,(e=1e8<(e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0)+1?0:e)+1),e}catch(t){}}function K(t){var e,n,r={};t=t.split("&");try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i=o.next();!i.done;i=o.next()){var a=s(i.value.split("="),2),c=a[0],l=a[1];c in r?r[c]instanceof Array?r[c].push(l):r[c]=[r[c],l]:r[c]=l}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function G(t){throw new Error("radar error "+t)}var $=function(){return($=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Z(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function tt(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||((r=r||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}var et=["c_dimension1","c_dimension2","c_dimension3","release_tag","product_version","sub_app"],nt=function(){function e(e){var n,r=this,o=(this.queueConfig={wait:1e3,maxBatchLength:200},this.logQueue=[],this.preStoredLogQueue=[],this.batchTimer=0,this.eventName="onpagehide"in window?"pagehide":"beforeunload",this.customDimension={},this.runtimeIdMap={},this.randomSampling=Math.random(),this.commonDimension={},this.isInYoda=!1,this.sampleData={isHit:!0,core:1},this.ignoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],this.broadcastSample=F(),this.didRate=void 0,this.collect=function(t,e,n){var o=V({key:t,dimension:e=void 0===e?{}:e,value:n=void 0===n?{}:n});if(!r.sampleData||!1!==r.sampleData.isHit){if(!function(t){return t?Object.keys(l).map((function(t){return l[t]})).indexOf(t.key)<0?(h("117"),!1):Q[t.key](t):(h("116"),!1)}(o))return h("107","key: ".concat(o.key)),void r.collect(l.EVENT,{sample_rate:e.sample_rate,message:"radar上报日志类型错误",name:"radar_log_error",extra_info:JSON.stringify(o)},{});Object.keys(o.value).forEach((function(t){o.value[t]=o.value[t].toString()})),r.decorateLog(o);var i=r.getCommonData(),a=i.app_version_name;if(delete i.app_version_name,(t=new v((function(t,e){t.dimension.app_version_name=a,t.dimension.did_rate=r.didRate;var n=(null==(n=null==t?void 0:t.dimension)?void 0:n.event_client_timestamp)||Date.now(),o=(null==(o=null==t?void 0:t.dimension)?void 0:o.radar_session_id)||r.radarSessionId;return $($($({},t),i),{event_client_timestamp:n,event_trigger_source:"H5",radar_session_id:o})}))).use((function(t,e){return t.key&&"load"===t.key&&(t.dimension=$($({},t.dimension),{load_device_increase_id:Y("LOAD_DEVICE_INCREASE_ID"),load_session_increase_id:r.genSessionIncreaseId("LOAD_SESSION_INCREASE_ID")})),t.key&&"load"!==t.key&&(t.dimension=$($({},t.dimension),{other_device_increase_id:Y("OTHER_DEVICE_INCREASE_ID"),other_session_increase_id:r.genSessionIncreaseId("OTHER_SESSION_INCREASE_ID")})),e()})),(o=t.invoke(o))instanceof Error)throw o;try{window.dispatchEvent(new CustomEvent("get-radar-next-data",{detail:{kv:V(o)}}))}catch(t){}if(delete o.dimension.broadcast_info,r.weblog?r.logQueue.push(o):(o.base_href=location.href,r.preStoredLogQueue.push(o)),function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];1==+K(location.search.slice(1)).debug&&m.apply(void 0,c(["[radar] ".concat(t,": ")],s(e),!1))}("radarLogNext",JSON.parse(JSON.stringify(o))),r.logQueue.length>r.queueConfig.maxBatchLength-1)return r.flush(),clearTimeout(r.batchTimer),void(r.batchTimer=0);r.batchTimer||(r.batchTimer=window.setTimeout((function(){r.flush(),clearTimeout(r.batchTimer),r.batchTimer=0}),r.queueConfig.wait))}},this.flush=function(){var t;r.logQueue.length<=0||(t=null,(t=r.config.httpReportFirst?t:r.reportByBridge())&&!r.config.httpReportFirst||r.reportByHttp(),r.logQueue=[])},"object"==t(e)&&null!==e||G("108"),"string"!=typeof e.projectId&&G("109"),X("radarSessionId"));this.radarSessionId=null!=o?o:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),this.config=e,this.sampling="number"==typeof(n=null!=(o=this.config.sampling)?o:1)&&0<=n&&n<=1?n:(h("110"),1),this.bindWeblogger(e.weblogger),null!=(o=this.config)&&o.ignoreList&&Array.isArray(null==(e=this.config)?void 0:e.ignoreList)&&(this.ignoreList=this.ignoreList.concat(this.config.ignoreList.map((function(t){return t.replace(/^(https?:)?\/\//,"")})))),this.queueConfig=$($({},this.queueConfig),null!=(o=this.config)&&o.queueConfig?this.config.queueConfig:{}),null!=(e=this.config)&&e.customDimensions&&this.setDimensions(null==(o=this.config)?void 0:o.customDimensions),j(window,this.eventName,this.flush),"undefined"!=typeof window&&window.yodaCollectErrorDataDestroy&&window.yodaCollectErrorDataDestroy()}return e.prototype.genSessionIncreaseId=function(t){return this.runtimeIdMap[t]||(this.runtimeIdMap[t]=0),this.runtimeIdMap[t]++},e.prototype.bindWeblogger=function(e){var n,r=this;if(null!=e&&"object"!=t(e))G("106");else{if(this.weblog)return void m("122");this.weblog=e,this.updateUrlPackage(),void 0!==(null==(n=null==e?void 0:e.logger)?void 0:n.radarUrl)&&this.ignoreList.push(null==(n=null==e?void 0:e.logger)?void 0:n.radarUrl),void 0!==(null==(n=null==e?void 0:e.logger)?void 0:n.url)&&this.ignoreList.push(null==(n=null==e?void 0:e.logger)?void 0:n.url),this.isInYoda=!(null==(n=null==(e=this.weblog)?void 0:e.Utils)||!n.yoda),this.getSampleData()}0<this.preStoredLogQueue.length&&(this.preStoredLogQueue.forEach((function(e){if(void 0!==(n=r.sampleData["load"===e.key?"core":e.key])&&(e.dimension.sample_rate=n),"load"===e.key?r.sampleData.core:e.dimension.sample_rate*r.sampleData.core>=r.randomSampling){var n=r.getCommonData(),o=(e.dimension.app_version_name=n.app_version_name,e.h5_extra_attr=JSON.stringify($($({},null==(n=r.weblog.commonPackage)?void 0:n.getH5ExtraAttr()),JSON.parse(e.h5_extra_attr))),function(t){if(-1===(n=(t=void 0===t?location.href:t).lastIndexOf("?")))return{page:t};var e=t.slice(0,n),n=t.slice(n+1);return{url:t,page:e,params:K(n)}}(e.base_href)),i=null==(n=r.weblog.logConfig)?void 0:n.urlMap;n={};if("function"==typeof i)try{var a=i(o);"string"==typeof a?n={page:a}:"object"==t(a)&&(n={page:a.page,params:a.params})}catch(e){}else if("object"==t(i)){var s,c="";for(s in i)if(-1<(o.page||o.url||"").indexOf(s)){c=i[s];break}c&&(n={page:c})}e.url_package={page:n&&n.page||o.page},a=r.referUrlPackage&&r.referUrlPackage.toJSON(),e.refer_url_package=a,delete e.base_href,r.logQueue.push(e)}})),this.preStoredLogQueue=[],this.flush())},e.prototype.getSampleData=function(){var t,e,n=this;this.isInYoda?(this.sampleData={isHit:!0,core:this.sampling,api:1,resource:.1,error:1,event:1},e=window.updateYodaSampleRateWithParams,window.updateYodaSampleRateWithParams=function(t){f("104",t),n.updateYodaSampleRate(t),n.broadcastSample.emit(n.sampleData),e&&e(t)},window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.sampleData?(this.updateYodaSampleRate(window.__yodaCommonDataObject__.sampleData),this.collect(l.EVENT,{name:"客户端采样率注入成功",event_type:"radar_sample_inject_success"},{})):"function"==typeof(null==(t=null==(t=null==(t=this.weblog)?void 0:t.Utils)?void 0:t.yoda)?void 0:t.getWebviewLoadPerf)&&null!=(t=this.weblog)&&t.Utils.yoda.getWebviewLoadPerf().then((function(t){null!=t&&t.sampleData&&n.updateYodaSampleRate(t.sampleData)}))):this.sampleData={isHit:this.samplingControl(this.sampling),core:this.sampling}},e.prototype.updateYodaSampleRate=function(t){var e=this,n=null;try{var r=t;n="string"==typeof r?JSON.parse(r):r}catch(t){return void f("error: ",t)}n&&Object.keys(n).forEach((function(t){"load"===t?e.sampleData.core=n[t]:"did_rate"===t?e.didRate=n[t]:e.sampleData[t]=n[t]}))},e.prototype.updateUrlPackage=function(){var t;null!=(t=this.weblog)&&t.currentUrlPackage&&(this.currentUrlPackage=this.weblog.currentUrlPackage,this.referUrlPackage=this.weblog.referUrlPackage)},e.prototype.setDimensions=function(t){var e=this,n=Object.keys(t);n.some((function(t){return-1===et.indexOf(t)}))&&h("113","".concat(n.join("、"))),n.forEach((function(n){null==t[n]?delete e.customDimension[n]:e.customDimension[n]=t[n]}))},e.prototype.setCommonDimension=function(t,e,n){this.commonDimension[t]=(n=void 0===n||n)||null==(n=this.commonDimension[t])?e:n},e.prototype.decorateLog=function(t){this.currentUrlPackage||this.updateUrlPackage(),0<Object.keys(this.customDimension).length&&Object.assign(t.dimension,this.customDimension),0<Object.keys(this.commonDimension).length&&Object.assign(t.dimension,this.commonDimension),this.currentUrlPackage&&this.currentUrlPackage.page!==(null==(t=null==(t=this.weblog)?void 0:t.currentUrlPackage)?void 0:t.page)&&(this.flush(),this.updateUrlPackage())},e.prototype.samplingControl=function(t){return null!==t&&"number"==typeof t&&this.randomSampling<t},e.prototype.getCommonData=function(){var t,e=null==(e=null==(e=null==(e=this.weblog)?void 0:e.commonPackage)?void 0:e.app_package)?void 0:e.version_name;e={h5_extra_attr:JSON.stringify($($({},null==(t=null==(t=this.weblog)?void 0:t.commonPackage)?void 0:t.getH5ExtraAttr()),{app_version_name:e,url:location.href,hash:location.hash,online:null===navigator||void 0===navigator?void 0:navigator.onLine,downlink:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.downlink,rtt:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.rtt})),url_package:this.currentUrlPackage&&this.currentUrlPackage.toJSON(),refer_url_package:this.referUrlPackage&&this.referUrlPackage.toJSON(),app_version_name:e,project_id:null==(t=this.config)?void 0:t.projectId};return"1"===z("radar_report_test")&&(e.is_report_test=!0),e},e.prototype.reportByHttp=function(){var t=this.getCommonData(),e=(t={project_id:this.config.projectId,radar_session_id:this.radarSessionId,h5_extra_attr:t.h5_extra_attr},this.logQueue.filter((function(t){return"load"===t.key}))),n=this.logQueue.filter((function(t){return"load"!==t.key}));Array.isArray(e)&&e.length&&this.collectLog(t,e,"radarSDK"),Array.isArray(n)&&n.length&&this.collectLog(t,n,"radarSDKSupplement")},e.prototype.collectLog=function(t,e,n){var r;"function"!=typeof(null==(r=this.weblog)?void 0:r.collect)&&"function"!=typeof(null==(r=this.weblog)?void 0:r.sendByHttp)?h("114"):(this.weblog.sendByHttp||this.weblog.collect).call(this.weblog,"RADAR",{name:"radar_log",params:$($({},t),{data:tt([],Z(e),!1)}),serviceName:n})},e.prototype.reportByBridge=function(){var t=null==(n=null==(n=this.weblog)?void 0:n.Utils)?void 0:n.yoda;if(!t)return!1;var e,n=this.logQueue.filter((function(t){return"load"===t.key})),r=this.logQueue.filter((function(t){return"load"!==t.key}));try{return n.forEach((function(e){"function"==typeof(null==(e=t.sendSummarizedLog({key:"h5_load",data:e}))?void 0:e.catch)&&e.catch((function(t){h("123",t)}))})),r.length&&"function"==typeof(null==(e=t.sendRadarLog({data:r}))?void 0:e.catch)&&e.catch((function(t){h("124",t)})),!0}catch(e){return!1}},e}(),rt=function(t,e){return(rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},ot=function(){return(ot=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function it(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}var at={redirect:{end:"redirectEnd",start:"redirectStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(t,e){return e.redirectCount}},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ssl_start:{custom:function(t,e){return e.secureConnectionStart&&e.navigationStart?e.secureConnectionStart-e.navigationStart:null}},ttfb:{end:"responseStart",start:"requestStart"},request_start:{end:"requestStart",start:"navigationStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domInteractive"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=performance.getEntries().filter((function(t){return"first-paint"===t.name}))[0];return t?Math.ceil(t.startTime+t.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=function(){var t,e="undefined"!=typeof window?window.performance:null;return e&&e.timing?"function"==typeof e.timing.toJSON?((t=e.timing.toJSON())&&!t.redirectStart&&(t.redirectStart=t.navigationStart),t):e.timing:null}(),e=performance.getEntries(),n=performance.getEntries().filter((function(t){return"navigation"===t.initiatorType}))[0];e=e.filter((function(t){return"script"===t.initiatorType}))[0],n=n?n.domComplete:t.domComplete-t.navigationStart;return e&&n?n-e.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(t,e){return e.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document&&void 0!==document.all?document.all.length:null}}},st={main_api:{end:"apiEnd",start:"apiStart",notCatchIfUndefined:!0},main_api_offset:{end:"apiStart",start:"responseEnd",notCatchIfUndefined:!0},fmp:{end:"fmp_time",start:"navigationStart",notCatchIfUndefined:!0}},ct={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connectStart",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",connect_end_time:"connectEnd",load_event_end:"loadEventEnd",dom_complete:"domComplete",dom_content_loaded_event_start:"domContentLoadedEventStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",radar_init_time:"radar_init_time",fmp_time:"fmp_time"};function lt(t,e){if(!Array.isArray(e))return-1;var n=-1;return e.forEach((function(e,r){new RegExp(e).test(t)&&(n=r)})),n}var ut=function(t){function e(e){var n=this;return(n=t.call(this,{core:null==e?void 0:e.core,key:l.LOAD,version:"1.2.5",name:"RadarNavigationCollect"})||this).hasFMP=!1,n.syncMetricNum=0,n.customKeys=[],n.custom_metric={},n.optionsMainAPI=[],n.mainAPIList=[],n.radarMainApiList=[],n.mainJSList=[],n.radarMainJSList=[],n.radarTiming={radar_init_time:void 0,fmp_time:void 0,fmp:void 0,apiStart:void 0,apiEnd:void 0},n.h5Load=function(){var t=n.getPerformanceData();n.collect(ot({event_name:"h5_load"},t))},n.dealAPI=function(t){return n.cacheAndCalculateMainAPI(t),n.addMainApiResult(t),n.mainAPIList.filter((function(t){return!!t.url})).length!==n.mainAPIList.length||void 0===n.radarTiming.fmp},n.addMainJSResult=function(t){if(!n.mainJSList||0===n.mainJSList.length)return!1;var e,r,o,i,a,s,c,l,u,p,d,f,m,h,v,g=lt((t.file||"").replace(/\?.+$/,""),n.mainJSList);return-1<g&&!n.radarMainJSList[g].file&&(e=t.file,r=t.cached,o=t.size,i=t.failed,a=t.res_type,s=t.protocol,c=t.fb,l=t.dns,u=t.tcp,p=t.ssl,d=t.ttfb,f=t.trans,m=t.total,h=t.fetch_start,v=t.duration,t=t.start_time,n.radarMainJSList[g]={file:e,cached:r,size:o,failed:i,res_type:a,protocol:s,fb:c,dns:l,tcp:u,ssl:p,ttfb:d,trans:f,total:m,fetch_start:h,duration:v,start_time:t,reg:n.mainJSList[g]}),n.radarMainJSList.filter((function(t){return!!t.file})).length!==n.mainJSList.length},e.core||G("212"),"string"==typeof e.mainApi?(n.optionsMainAPI.push(e.mainApi),n.mainAPIList.push({}),n.radarMainApiList.push({})):Array.isArray(e.mainApi)&&(3<e.mainApi.length&&m("207"),n.optionsMainAPI=e.mainApi.slice(0,3),n.optionsMainAPI.forEach((function(){n.mainAPIList.push({}),n.radarMainApiList.push({})}))),"string"==typeof e.mainJs?(n.mainJSList.push(e.mainJs),n.radarMainJSList.push({})):Array.isArray(e.mainJs)&&(3<e.mainJs.length&&m("211"),n.mainJSList=e.mainJs.slice(0,3),n.mainJSList.forEach((function(){return n.radarMainJSList.push({})}))),performance.timing?n.init():(null!=(e=n.core)&&e.collect("event",{name:"radar_error",message:"performance.timing 不存在无法收集数据",category:l.LOAD}),h("208")),n}var n=e,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return rt(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),e.prototype.init=function(){this.radarTiming.radar_init_time=Date.now();var t,e=this.getPerformanceData();this.collect(ot({event_name:"radar_init"},e)),null!=(t=null==(e=this.core)?void 0:e.setCommonDimension)&&t.call(e,"happen_stage","during_fmp"),0<performance.timing.loadEventStart?this.h5Load():j(window,"load",this.h5Load)},e.prototype.customStage=function(t,e){var n,r;void 0===e&&(e={sendTimeline:!0}),this.isHit?(void 0!==t&&"string"==typeof t&&""!==t||G("206"),this.isValidTimestamp(e.timestamp,"custom_stage "+t)&&(n=e.timestamp||Date.now(),r=this.customKeys.length-this.syncMetricNum,this.customKeys.includes(t)?h("204",t):e.sendTimeline&&2<this.syncMetricNum||!e.sendTimeline&&5<r?h("205",t):n&&(this.custom_metric[t+"_time"]=n,this.customKeys.push(t),!e||!0!==e.sendTimeline&&null!=e.sendTimeline||(r=this.getPerformanceData(),this.collect(ot(ot({},r),{stack:(new Error).stack,event_name:"h5_custom_metric",custom_metric_name:t,custom_metric_timestamp:n})),this.syncMetricNum++)))):h("200")},e.prototype.isValidTimestamp=function(t,e){var n;if(void 0===e&&(e="fmp"),void 0!==t&&"number"!=typeof t)G("201");else if(void 0!==t&&t<performance.timing.navigationStart)return m("210","".concat(e)),null!=(n=this.core)&&n.collect("event",{name:"radar_error",message:"【210】".concat(e),extra_info:{timestamp:t,navigationStart:performance.timing.navigationStart}}),!1;return!0},e.prototype.fmp=function(t){var e,n;this.isHit?this.isValidTimestamp(t)&&(t=t||Date.now(),this.hasFMP?m("202"):t&&performance.timing&&(null!=(n=null==(e=this.core)?void 0:e.setCommonDimension)&&n.call(e,"happen_stage","after_fmp"),this.hasFMP=!0,this.radarTiming.fmp_time=t,performance.timing.radarFmp=t,n=this.getPerformanceData(),performance.timing.fmp=this.radarTiming.fmp=n.fmp,this.collect(ot({event_name:"fmp",stack:(new Error).stack},n)))):m("200")},e.prototype.getPerformanceData=function(){var t=ot(ot({},V(performance.timing)),this.radarTiming),e=D(ot(ot({},at),st),t);return Object.keys(ct).forEach((function(n){0<=t[ct[n]]&&(e[n]=t[ct[n]])})),["radar_main_js_start","lcp","cls","fid","fcp"].forEach((function(t){var n=window.__RADAR_PERFORMANCE_TIMING_&&window.__RADAR_PERFORMANCE_TIMING_[t];!n&&0!==n||(e[t]=n)})),e},e.prototype.cacheAndCalculateMainAPI=function(t){var e;void 0===this.radarTiming.fmp&&(t.before_hook_time&&(e=this.radarTiming.apiStart,this.radarTiming.apiStart=e?Math.min(e,t.before_hook_time):t.before_hook_time),t.after_hook_time&&(e=this.radarTiming.apiEnd,this.radarTiming.apiEnd=e?Math.max(e,t.after_hook_time):t.after_hook_time))},e.prototype.addMainApiResult=function(t){var e,n,r,o,i,a,s,c,l,u,p,d,f,m,h,v,g,_,y=lt((t.api||"").replace(/\?.+$/,""),this.optionsMainAPI);-1<y&&(null==(_=this.mainAPIList[y])||!_.url)&&(_=t.api,e=t.status,n=t.size,r=t.cached,o=t.method,c=t.perfTime,i=t.protocol,a=t.custom_failed,s=t.res_type,g=it(t,["api","status","size","cached","method","perfTime","protocol","custom_failed","res_type"]),this.mainAPIList[y]=ot({url:_,status:e,size_radar:n,cached:r,method:o,perfTime:c,protocol:i,res_type:s,custom_failed:a},g),c=g.fb,l=g.dns,u=g.tcp,p=g.ssl,d=g.ttfb,f=g.trans,m=g.total,h=g.fetch_start,v=g.duration,g=g.start_time,this.radarMainApiList[y]={api:_,status:e,size:n,cached:r,method:o,protocol:i,fb:c,dns:l,tcp:u,ssl:p,ttfb:d,trans:f,total:m,fetch_start:h,duration:v,custom_failed:a,res_type:s,reg:this.optionsMainAPI[y],start_time:g},this.radarTiming.fmp_time&&t.after_hook_time&&t.after_hook_time<this.radarTiming.fmp_time&&(_=this.getPerformanceData(),this.collect(ot({event_name:"main_api"},_))))},e.prototype.destroy=function(){N(window,"load",this.h5Load),this.customStage=this.fmp=function(){m("213")}},e.prototype.collect=function(t){var e=t.protocol,n=t.event_name,r=(t.custom_metric,t.custom_metric_name),o=t.stack;t.main_api_list,t=it(t,["protocol","event_name","custom_metric","custom_metric_name","stack","main_api_list"]),this.baseCollect({value:t,dimension:{protocol:e,event_name:n,custom_metric_name:r,custom_metric:JSON.stringify(this.custom_metric),main_api_list:this.mainAPIList,radar_main_api_list:this.radarMainApiList,radar_main_js_list:this.radarMainJSList,is_official:1,stack:o}}),null!=(t=this.core)&&t.flush()},e}(g),pt=function(t,e){return(pt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},dt=function(){return(dt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function ft(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}var mt=k,ht={navigation_start:"startTime",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function vt(t,e){if(t)return"function"==typeof t.get?t.get(e):t[e.toLowerCase()]}function gt(t){var e="";if("string"==typeof t)e=t;else try{e=JSON.stringify(t)}catch(n){e=String(t)}for(var n=0,r=0;r<e.length;r++){var o=e.charCodeAt(r);n+=o<128?1:o<2048?2:o<65536?3:o<1<<21?4:o<1<<26?5:o<1<<31?6:Number.NaN}return n}function _t(t){var e=(n=document.location).protocol,n=n.host;return 0===t.indexOf("//")?e+t:0===t.indexOf("/")?"".concat(e,"//").concat(n).concat(t):t}function yt(t){return t?"function"==typeof t.get?t.get("Content-Type"):t["content-type"]:null}var bt=function(e){function n(t){var n=e.call(this,{core:null==(t=void 0===t?{}:t)?void 0:t.core,sampling:null==t?void 0:t.sampling,key:l.API,version:"1.2.5",name:"RadarAPICollect"})||this;return n.ignoreList=_,n.queue=[],n.logList=[],n.perfList=[],n.broadcastApi=F(),n.initiatorTypeList=[],n.beforeHook=function(t){var e;0===(null==(e=t.url)?void 0:e.indexOf("data:"))||R(t.url,n.ignoreList)||R(t.url,(null==(e=n.core)?void 0:e.ignoreList)||[])||"js"===P(t.url)||"css"===P(t.url)||(e={api:_t(t.url),method:t.method,request:t,startTime:Date.now()},n.queue.push(e))},n.afterHook=function(t,e){var r=n.queue.find((function(e){return e.request===t}));if(r){delete r.request;var o=r.startTime,i=(r=ft(r,["startTime"]),Date.now()),a=i-o,s=e.status;if("function"==typeof n.customizeRadarStatus)try{s=n.customizeRadarStatus(e)}catch(e){}var c=n.customHook({request:t,response:e,duration:a}),l=+vt(e.headers,"Content-Length")||0,u=function(t){function e(){t=t.replace(/^\s*/,"")}function n(n){return e(),t[0]===n&&(t=t.slice(1),1)}function r(){e();var n=/^([^\s,;=\\]+)(.*)/.exec(t);if(n)return t=n[2],n[1]}if(t&&"string"==typeof t){for(var o,i=[];o=r();){for(var a={name:o},s={};n(";");){var c,l,u=void 0;(u=r())&&(c=void 0,n("=")&&(c=function(){if(e(),'"'!==t[0])return r();t=t.slice(1);for(var n="";t.length;){var o=/^([^"\\]*)(.*)/.exec(t);if(o){if(n+=o[1],'"'===o[2][0])return t=o[2].slice(1),n;n+=o[2][1],t=o[2].slice(2)}}}(),l=void 0,(l=/([,;].*)/.exec(t))&&(t=l[1])),s[l=u.toLowerCase()]||(s[l]=1,"dur"===l?a.duration=parseFloat(c)||0:"desc"===l?a.description=c||"":a[u]=c))}if("sec"===a.unit&&a.duration&&(a.duration*=1e3),delete a.unit,i.push(a),!n(","))break}return i.length?i:void 0}}(vt(e.headers,"Server-Timing"));a=dt(dt(dt({duration:a,logTime:Date.now(),status:s,size:+l,content_type:yt(e.headers),custom_failed:!(200<=s&&s<300)},r),c),{before_hook_time:o,after_hook_time:i,trace_id:t.trace_id,server_timing:u});2===(null==(s=null==(l=vt(e.headers,"Intercept-Result"))?void 0:l.split(";"))?void 0:s.length)&&null!=(r=n.core)&&r.setCommonDimension&&(n.core.setCommonDimension("intercept_result",s[0],!1),n.core.setCommonDimension("intercept_result_code",s[1],!1),a.api_intercept_result=s[0],a.api_intercept_result_code=s[1]),e.finalUrl&&(a.api=e.finalUrl),"string"==typeof e.text&&(a.responseData=e.text),0!==dt(dt({},e),{status:a.status}).status||c.intercept_report?n.mergeAPIPerf(void 0,a)||n.logList.push(a):(a.size&&0!=a.size||!a.responseData||(a.size=gt(a.responseData)),delete a.responseData,delete a.server_timing,n.collect(a)),n.queue=n.queue.filter((function(e){return e.request&&e.request!==t}))}},void 0!==(n.option=t)&&null!=t&&t.core||G("310"),void 0!==t.ignoreList&&(Array.isArray(t.ignoreList)||G("309"),t.ignoreList.forEach((function(t){"string"!=typeof t&&G("309")})),n.ignoreList=n.ignoreList.concat(t.ignoreList)),n.APIHook=t.APIHook,n.customizeRadarStatus=t.customizeRadarStatus,n.init(),n}var r=n,i=e;if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function a(){this.constructor=r}return pt(r,i),r.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a),n.prototype.init=function(){var e,n=this;try{this.observer=new PerformanceObserver((function(t){return n.observeAPI(t)})),this.observer.observe({entryTypes:["resource"]}),this.initiatorTypeList=[],!0!==this.option.ignoreXHR&&(this.initiatorTypeList.push("xmlhttprequest"),this.unhookXML=function(e,n){var r=window.XMLHttpRequest;return r?(window.XMLHttpRequest=function(){var i,a,s,c=new r,l=(c._radarRequest={},c._radarResponse={},H()),u=(c._radarRequest.id=l,{});return c.addEventListener("readystatechange",(function(){if(4===c.readyState&&"function"==typeof n){c._radarResponse.status=c.status,c._radarResponse.statusText=c.statusText;var e,r,o,i,a,s=function(e,n){switch(null==n&&(n={}),t(e)){case"object":var r,o=[];for(r in e){var i=e[r],a=r.toLowerCase();o.push("".concat(a,":\t").concat(i))}return o.join("\n")+"\n";case"string":for(var s=0,c=(o=e.split("\n")).length;s<c;s++){var l=o[s];/([^:]+):\s*(.+)/.test(l)&&(l=null!=(l=RegExp.$1)?l.toLowerCase():void 0,i=RegExp.$2,l&&null==n[l]&&(n[l]=i))}return n}}(c.getAllResponseHeaders());for(e in s)o=s[e],c._radarResponse&&c._radarResponse.headers&&!c._radarResponse.headers[e]&&(r=e.toLowerCase(),c._radarResponse.headers[r]=o);if(c.responseType&&"text"!==c.responseType)"document"===c.responseType?(c._radarResponse.xml=c.responseXML,c._radarResponse.data=c.responseXML):c._radarResponse.data=c.response;else{c._radarResponse.text=c.responseText,c._radarResponse.data=c.responseText;try{c._radarResponse.xml=c.responseXML}catch(e){}}"responseURL"in c&&(c._radarResponse.finalUrl=c.responseURL);try{var l=null!=(i=u["ktrace-str"])?i:"";l&&window.parseWedTraceId&&(c._radarRequest.trace_id=window.parseWedTraceId(null!=(a=l.split("|")[1])?a:""))}catch(e){m("traceId 解析异常")}n(c._radarRequest,c._radarResponse)}})),"function"==typeof c.setRequestHeader&&(i=c.setRequestHeader,c.setRequestHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return M.includes(t[0])&&(u[t[0]]=t[1]),i.apply(this,t)}),"function"==typeof c.open&&(a=c.open,c.open=function(t,e,n,r,i){var s=[].slice.call(arguments);return this._radarRequest=o({method:t,url:e,async:n,user:r,pass:i},this._radarRequest),this._radarResponse.headers={},a.apply(this,s)}),"function"==typeof c.send&&(s=c.send,c.send=function(){var t=[].slice.call(arguments);return"function"==typeof e&&(this._radarRequest._config=t[0],e(this._radarRequest)),s.apply(this,t)}),c},["DONE","HEADERS_RECEIVED","LOADING","OPENED","UNSENT"].forEach((function(t){window.XMLHttpRequest[t]=r[t]})),window.XMLHttpRequest.prototype=r.prototype,function(){r&&(window.XMLHttpRequest=r)}):(h("118"),!1)}((function(t){return n.beforeHook(t)}),(function(t,e){return n.afterHook(t,e)}))),!0!==this.option.ignoreFetch&&(this.initiatorTypeList.push("fetch"),this.unhookFetch=function(t,e){var n=function(t){if("function"!=typeof t.fetch)return null;var e,n=t.fetch;return t.fetch=(e=t.fetch,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return U.apply(void 0,c([e],s(t),!1))}),{register:function(t){return J.push(t),function(){var e=J.indexOf(t);0<=e&&J.splice(e,1)}},clear:function(){J=[]},unRegister:function(){n&&(t.fetch=n)}}}("function"==typeof importScripts?self:window);return n&&n.register({request:function(e,n){"function"==typeof t&&t(e)},response:function(t,n){"function"==typeof e&&e(n,t)},responseError:function(t,n){"function"==typeof e&&e(n,{status:0,statusText:t})}}),null==n?void 0:n.unRegister}((function(t){return n.beforeHook(t)}),(function(t,e){return n.afterHook(t,e)})))}catch(t){h("308"),null!=(e=this.core)&&e.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:l.API})}},n.prototype.customHook=function(t){var e={};if(void 0===this.APIHook)return e;if("function"!=typeof this.APIHook)return m("300"),e;var n={};try{n=this.APIHook(t)}catch(t){return m("301",t),{}}if(!n)return m("302"),e;t=n.response_msg;var r=n.response_code,o=n.status,i=n.custom_failed,a=n.intercept_report;n=n.broadcast_info;if(!0===Boolean(a)&&(e.intercept_report=!0),void 0!==t)try{var s=JSON.stringify(t);100<s.length&&m("307"),e.response_msg=s.slice(0,100)}catch(t){e.response_msg="response_msg返回结果异常",m("303")}return void 0!==r&&(a=Number(r),isNaN(a)?m("304"):e.response_code=a),void 0!==o&&(t=Number(o),isNaN(t)?m("305"):e.status=t),void 0!==i&&(!0===i||!1===i?e.custom_failed=i:m("306")),e.broadcast_info=n,e},n.prototype.observeAPI=function(t){var e=this;t.getEntriesByType("resource").forEach((function(t){var n,r,o;if(0===(null==(o=t.name)?void 0:o.indexOf("data:"))||R(t.name,e.ignoreList)||R(t.name,(null==(o=e.core)?void 0:o.ignoreList)||[]))return!1;"api"===A(t)&&((o=D(mt,t)).perfTime=Date.now(),null!=(n=null==(n=t.serverTiming)?void 0:n.map((function(t){return{name:t.name,duration:t.duration,description:t.description||void 0}})))&&n.length||(n=void 0),r={encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},Object.keys(ht).forEach((function(e){r[e]=Number(t[ht[e]]+performance.timing.navigationStart)})),o=dt(dt(dt(dt({},o),{api:o.file}),r),{server_timing:n}),e.mergeAPIPerf(o)||e.perfList.push(o))}))},n.prototype.destroy=function(){this.unhookXML&&this.unhookXML(),this.unhookFetch&&this.unhookFetch(),this.observer&&this.observer.disconnect()},n.prototype.mergeAPIPerf=function(t,e){if(t?e=this.takeItem(t,this.logList):e&&(t=this.takeItem(e,this.perfList)),!t||!e)return!1;if(!0===e.intercept_report)return!0;var n,r=Object.assign({},e,t,{size:t.size||e.size});return delete r.file,r.size&&0!=r.size||!r.responseData||(r.size=gt(r.responseData)),delete r.responseData,(e=e.server_timing||t.server_timing)&&(n=null,e.map((function(t){"total-timing"===t.name&&(n=null!=(t=t.duration)?t:null)})),r.total_server_timing=n,r.server_data_list=JSON.stringify(e)),delete r.server_timing,this.collect(r),!0},n.prototype.takeItem=function(t,e){var n,r=(t.api||"").replace(/\?.+$/,"");if(-1!==(t=e.findIndex((function(t){return t=(t.api||"").replace(/\?.+$/,""),r===t}))))return n=e[t],e.splice(t,1),n},n.prototype.collect=function(t){var e=this,n=t.res_type,r=t.protocol,o=t.api,i=t.custom_failed,a=t.status,s=t.cached,c=t.method,l=t.response_code,u=t.response_msg,p=(t.has_fmp,t.server_data_list),d=t.content_type,f=t.broadcast_info,v=t.before_hook_time,g=t.after_hook_time,_=t.api_intercept_result,y=t.api_intercept_result_code,b={dimension:{before_hook_time:v,after_hook_time:g,res_type:n,protocol:r,api:o,custom_failed:i,status:a,cached:s,method:c,response_code:l,response_msg:u,content_type:d,broadcast_info:f,is_official:1,server_data_list:p,trace_id:t.trace_id,api_intercept_result:_,api_intercept_result_code:y,has_timing_allow:t.has_timing_allow},value:ft(t,["res_type","protocol","api","custom_failed","status","cached","method","response_code","response_msg","has_fmp","server_data_list","content_type","broadcast_info","before_hook_time","after_hook_time","api_intercept_result","api_intercept_result_code","trace_id","has_timing_allow"])};this.broadcastApi.emit(V(t)),0===a&&C(this.option.isIgnoreInvalidStatusCode)?new Promise((function(n,r){var o,i;e.option.isIgnoreInvalidStatusCode&&(function(t){return t&&C(t.then)&&C(t.catch)}(o=e.option.isIgnoreInvalidStatusCode(t))?(i=setTimeout((function(){return n(!1)}),2e3),o.then((function(t){clearTimeout(i),n(!0===t)}),r)):n(!0===o))})).then((function(t){t?m("异步拦截日志"):e.baseCollect(b)}),(function(t){e.baseCollect(b),h(t)})):this.baseCollect(b)},n}(g),St=function(t,e){return(St=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},wt=function(){return(wt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Ot=Object.assign({},k,{duration:{end:"responseEnd",start:"fetchStart"},cached_type:{custom:function(t,e){var n="hit_browser";if(0===e.transferSize||0===e.duration)return n;if(null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart))return n;if(e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name}))){if(e.serverTiming.some((function(t){return"miss"===t.name})))return"miss_cdn";if(e.serverTiming.some((function(t){return"hit"===t.name})))return"hit_cdn"}return"miss_browser"},crossOriginSkip:!0},cdn_duration:{custom:function(t,e){return e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name}))?null==(e=null==(e=e.serverTiming)?void 0:e.find((function(t){return"total-timing"===t.name})))?void 0:e.duration:null},crossOriginSkip:!0,cachedSkip:!0},cdn_ip:{custom:function(t,e){if(e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name})))return null==(e=e.serverTiming.find((function(t){return"miss"===t.name||"hit"===t.name})))?void 0:e.description},crossOriginSkip:!0,cachedSkip:!0}}),Et={fetch_start_time:"fetchStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function kt(t){return Array.isArray(t)?t.map((function(t){var e=void 0===(e=t.tagName)?"":e,n=t.id;return t=t.getAttribute?t.getAttribute("class"):t.className||"",e=e.toLowerCase(),n&&(e+="#".concat(n)),t&&(e+=t.split(/\s+/g).map((function(t){return".".concat(t)})).join("")),e})).filter((function(t){return t})).join(","):""}var Lt,Rt,Pt,xt,Ct=function(t){function e(e){var n,r=this;return(r=t.call(this,{core:null==e?void 0:e.core,sampling:null!=(n=null==e?void 0:e.sampling)?n:.1,version:"1.2.5",key:l.RES,name:"RadarResourceCollect"})||this).ignoreList=_,r.broadcastJs=F(),r.onResError=function(t,e){var n;(function(t){return t.message||null!=t.lineno})(t)||(n=(t.target.src||t.target.href||"").toString(),n={failed:!0,file:n="function"!=typeof t.target.getAttribute||""!==t.target.getAttribute("src")&&""!==t.target.getAttribute("href")?n:"",res_path:kt(t&&t.path||t&&t.composedPath&&t.composedPath())},r.collect(n,e),r.broadcastJs.emit(n))},r.observeResource=function(t){t.getEntriesByType("resource").forEach((function(t){var e,n,o;if(0===t.name.indexOf("data:")||R(t.name,r.ignoreList)||R(t.name,(null==(e=r.core)?void 0:e.ignoreList)||[]))return!1;"resource"===A(t)&&(e=D(Ot,t),n={encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},Object.keys(Et).forEach((function(e){n[e]=Number(t[Et[e]]+performance.timing.navigationStart)})),o=wt(wt({failed:!1},e),n),r.collect(o),setTimeout((function(){r.broadcastJs.emit(o)})))}))},r.resourceHook=e.resourceHook,void 0!==e.ignoreList&&(Array.isArray(e.ignoreList)||G("802"),e.ignoreList.forEach((function(t){"string"!=typeof t&&G("802")})),r.ignoreList=r.ignoreList.concat(e.ignoreList)),r.init(),r}var n=e,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return St(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),e.prototype.init=function(){var t,e=this;try{this.observeResource(performance),this.observer=new PerformanceObserver((function(t){return e.observeResource(t)})),this.observer.observe({entryTypes:["resource"]})}catch(e){h("801"),null!=(t=this.core)&&t.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:l.RES})}j(window,"error",(function(t){return e.onResError(t)}),!0),this.parseSeedLog()},e.prototype.parseSeedLog=function(){var t=this,e=X(O,[]);e.length&&(e.map((function(e){var n=e.data;e=e.dimension||{},t.onResError(n,e)})),W(O,[]))},e.prototype.collect=function(t,e){var n=t.cached,r=t.failed,o=t.file,i=t.protocol,a=t.res_type,s=t.res_path,c=t.cached_type,l=t.cdn_ip,u=t.has_timing_allow;t=function(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(t,["cached","failed","file","protocol","res_type","res_path","cached_type","cdn_ip","has_timing_allow"]);try{var p=this.resourceHook&&this.resourceHook({file:o,cached:n,protocol:i,res_type:a,failed:r});if(null!=p&&p.intercept_report)return}catch(t){h("803",t)}this.baseCollect({value:t,dimension:wt({cached:n,failed:r,file:o,protocol:i,res_type:a,res_path:s,sample_rate:this.sampling,is_official:1,cached_type:c,cdn_ip:l,has_timing_allow:u},e)})},e.prototype.destroy=function(){this.isHit&&(N(window,"error",this.onResError,!0),this.observer&&this.observer.disconnect())},e}(g),It=function(t,e){return(It=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},At=function(){return"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)},Dt=function(t){return{name:t,value:1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,delta:0,entries:[],id:At(),isFinal:!1}},Tt=function(t,e){try{var n;if(PerformanceObserver.supportedEntryTypes.includes(t))return(n=new PerformanceObserver((function(t){return t.getEntries().map(e)}))).observe({type:t,buffered:!0}),n}catch(t){}},jt=!1,Nt=!1,Mt=function(t){jt=!t.persisted},Ht=function(){addEventListener("pagehide",Mt),addEventListener("beforeunload",(function(){}))},Jt=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Nt||(Ht(),Nt=!0),addEventListener("visibilitychange",(function(e){e=e.timeStamp,"hidden"===document.visibilityState&&t({timeStamp:e,isUnloading:jt})}),{capture:!0,once:e})},qt=function(t,e,n,r){var o;return function(){n&&e.isFinal&&n.disconnect(),0<=e.value&&(r||e.isFinal||"hidden"===document.visibilityState)&&(e.delta=e.value-(o||0),(e.delta||e.isFinal||void 0===o)&&(t(e),o=e.value))}},Ut=function(){return void 0===Lt&&(Lt="hidden"===document.visibilityState?0:1/0,Jt((function(t){return t=t.timeStamp,Lt=t}),!0)),{get timeStamp(){return Lt}}},Ft=function(){return Rt=Rt||new Promise((function(t){return["scroll","keydown","pointerdown"].map((function(e){addEventListener(e,t,{once:!0,passive:!0,capture:!0})}))}))},zt=[{name:"fid",collectFn:function(t){function e(t){t.startTime<r.timeStamp&&(n.value=t.processingStart-t.startTime,n.entries.push(t),n.isFinal=!0,i())}var n=Dt("FID"),r=Ut(),o=Tt("first-input",e),i=qt(t,n,o);o?Jt((function(){o.takeRecords().map(e),o.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(t,e){e.timeStamp<r.timeStamp&&(n.value=t,n.isFinal=!0,n.entries=[{entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t}],i())}))}},{name:"lcp",collectFn:function(t){function e(t){var e=t.startTime;e<i.timeStamp?(o.value=e,o.entries.push(t)):o.isFinal=!0,n()}var n,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=Dt("LCP"),i=Ut(),a=Tt("largest-contentful-paint",e);a&&(n=qt(t,o,a,r),r=function(){o.isFinal||(a.takeRecords().map(e),o.isFinal=!0,n())},Ft().then(r),Jt(r,!0))}},{name:"cls",collectFn:function(t){function e(t){t.hadRecentInput||(o.value+=t.value,o.entries.push(t),n())}var n,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=Dt("CLS",0),i=Tt("layout-shift",e);i&&(n=qt(t,o,i,r),Jt((function(t){t=t.isUnloading,i.takeRecords().map(e),t&&(o.isFinal=!0),n()})))}},{name:"fcp",collectFn:function(t){var e,n=Dt("FCP"),r=Ut(),o=Tt("paint",(function(t){"first-contentful-paint"===t.name&&t.startTime<r.timeStamp&&(n.value=t.startTime,n.isFinal=!0,n.entries.push(t),e())}));o&&(e=qt(t,n,o))}}],Bt=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,version:"1.2.5",key:l.EVENT,name:"RadarChromeMetricsCollect"})||this;return n.options={lcp:!1,cls:!1,fid:!1,fcp:!1},n.init=function(){var t=n.options;zt.forEach((function(e){var r=e.name;t&&!t[r]||e.collectFn((function(t){var e=t.name;t=t.value,function(t,e){null!==window&&void 0!==window&&window.__RADAR_PERFORMANCE_TIMING_||(window.__RADAR_PERFORMANCE_TIMING_={}),window.__RADAR_PERFORMANCE_TIMING_[t]=e}(e.toLocaleLowerCase(),Number(t)),n.baseCollect({dimension:{name:e.toLocaleLowerCase(),is_official:1},value:{duration:Number(t)}})}))}))},Object.assign(n.options,e.options),zt.forEach((function(t){var e=z("radar_"+t.name);e&&(n.options[t.name]="1"===e)})),n.init(),n}var n=e,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return It(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),e}(g),Qt=function(t,e){return(Qt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Xt=function(){return(Xt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Wt=function(e){function n(t){var n=e.call(this,{core:t.core,sampling:t.sampling,key:l.EVENT,version:"1.2.5",name:"RadarEventCollect"})||this;return n.action={start:function(t){n._checkActionDimension(t),n.event({name:t.name,extra_info:t.extra_info,event_type:"radar_action_start"})},end:function(t){n._checkActionDimension(t),n.event({name:t.name,extra_info:t.extra_info,result_type:t.result_type,event_type:"radar_action_end"})}},n.parseSeedLog(),n}var r=n,o=e;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=r}return Qt(r,o),r.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i),n.prototype.parseSeedLog=function(){var t=this,e=X(E,[]);e.length&&(e.map((function(e){var n=e.dimension;e=e.value,t.event(n,e)})),W(E,[]))},n.prototype.event=function(e,n){var r;this.isHit?(e||G("402"),void 0!==e.name&&"string"==typeof e.name||G("402"),127<e.name.length&&(h("403"),e.name=e.name.slice(0,127)),e.is_official=1,n&&void 0!==n.duration&&("number"!=typeof n.duration||n.duration<0)&&G("404"),n&&void 0!==n.event_count&&("number"!=typeof n.event_count||n.event_count<0)&&G("405，".concat(n.event_count)),r={dimension:e,value:n},e&&e.extra_info&&"object"==t(e.extra_info)&&(r={dimension:Xt(Xt({},e),{extra_info:JSON.stringify(e.extra_info)}),value:n}),this.baseCollect(r)):m("401")},n.prototype.destroy=function(){this.event=function(){m("407")},this.action={start:function(){m("407")},end:function(){m("407")}}},n.prototype._checkActionDimension=function(t){if(!t)throw Error("408");void 0===t.extra_info||t.extra_info instanceof Object||G("406")},n}(g),Vt=function(t,e){return(Vt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Yt=function(){return(Yt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Kt(t,e){var n={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]]);return n}(xt=Pt=Pt||{}).SCRIPT="script",xt.RES="res",xt.API="api",xt.VIDEO="video";var Gt=[];function $t(e,n,r){var o,i;if(n&&(n instanceof Error||"object"==t(n)&&"string"==typeof n.message)){if("BridgeError"===(o=n.name||"ErrorLikeObject")&&"function"==typeof n.toJSON)try{var a=n.toJSON();delete a.name,delete a.message,i="".concat(n.message," (").concat(JSON.stringify(a),")")}catch(e){i=n.message||""}else i=n.message||"";a=n.stack||void 0}else i=null==n&&"Script error."===(null==r?void 0:r.message)?(o="CrossOriginError","".concat(e," - message: ").concat((null==r?void 0:r.message)||"<UNKNOWN>")):null===n&&null!=r&&r.message&&"Uncaught null"!==r.message?(o="Error","".concat(e," - message: ").concat(r.message)):(o=null==n?"".concat(n):t(n),r=function(e){var n;try{n=e.toString(),e&&"object"==t(e)&&(n=JSON.stringify(e))}catch(e){}return"string"!=typeof n||""===n?n=null===e?"<NULL>":void 0===e?"<UNDEFINED>":""===n?"<EMPTY>":"<UNKNOWN>":2e3<n.length&&(n=n.substring(0,2e3)+"<<< ……"),n}(n),"".concat(e," - value: ").concat(r));return{error_type:Pt.SCRIPT,error_cons_type:o,msg:i,stack:a}}function Zt(t){for(var e=0;e<Gt.length;e++)if(te(Gt[e],t))return e;return-1}function te(t,e){return t.msg===e.msg&&t.stack===e.stack&&t.file===e.file&&t.line===e.line&&t.col===e.col}var ee=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,key:l.ERROR,version:"1.2.5",name:"RadarErrorCollect"})||this;return n.onError=function(t,e){var r;!(r=t).message&&null==r.lineno||(t=Yt(Yt({},$t("Global Uncaught Exception",t.error,t)),{file:t.filename,line:t.lineno,col:t.colno}),n.isSameErrorAndReport(t,e))},n.onPromiseError=function(t,e){t=$t("Unhandled Promise Rejection",t.reason),n.isSameErrorAndReport(t,e)},n.core=e.core,n.init(),n}var n=e,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return Vt(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),e.prototype.init=function(){Gt.splice(0),j(window,"error",this.onError,!0),j(window,"unhandledrejection",this.onPromiseError),this.parseSeedLog()},e.prototype.destroy=function(){N(window,"error",this.onError,!0),N(window,"unhandledrejection",this.onPromiseError),this.captureException=function(){m("600")}},e.prototype.parseSeedLog=function(){var t=this,e=X(w,[]);e.length&&(e.map((function(e){var n=e.data;e=e.dimension||{},"unhandledrejection"===(null==n?void 0:n.type)?t.onPromiseError(n,e):t.onError(n,e)})),W(w,[]))},e.prototype.isSameErrorAndReport=function(t,e){0<=Zt(t)||(Gt.push(t),setTimeout((function(){Gt.splice(Zt(t),1)}),2e3),this.collect(t,e))},e.prototype.collect=function(t,e){var n,r,o,i,a,s,c,l;r=(n=t).error_cons_type,o=n.file,i=n.error_type,a=n.msg,s=n.col,c=n.line,l=n.stack,t={key:"error",value:Kt(n,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:r,file:o,error_type:i,msg:a,col:s,line:c,stack:l}},e=Yt(Yt({},t.dimension),e||{}),this.baseCollect({dimension:e,value:t.value})},e.prototype.captureException=function(t){this.isSameErrorAndReport($t("Captured Exception",t))},e}(g),ne=function(){function e(t){var e,n=this;this.core=new nt({weblogger:t.weblog,projectId:t.projectId,sampling:null!=(e=t.sampling)?e:1,httpReportFirst:t.httpReportFirst,customDimensions:t.customDimensions}),this.navigationCollect=new ut({core:this.core,mainApi:t.mainApi,mainJs:t.mainJs}),t.unuseAPIPlugin||(this.apiCollect=new bt({core:this.core,sampling:t.apiSampling,APIHook:t.APIHook,customizeRadarStatus:t.customizeRadarStatus,ignoreList:t.ignoreList,ignoreXHR:t.ignoreXHR,ignoreFetch:t.ignoreFetch,isIgnoreInvalidStatusCode:t.isIgnoreInvalidStatusCode}),this.apiCollect.broadcastApi.on((function(t){return n.navigationCollect.dealAPI(t)}))),t.unuseResourcePlugin||(this.resourceCollect=new Ct({sampling:t.resourceSampling,core:this.core,ignoreList:t.ignoreList,resourceHook:t.resourceHook}),this.resourceCollect.broadcastJs.on((function(t){return n.navigationCollect.addMainJSResult(t)}))),this.chromeMetricsCollect=new Bt({core:this.core,options:{lcp:t.lcp,cls:t.cls,fid:t.fid,fcp:t.fcp}}),this.eventCollect=new Wt({core:this.core}),this.action=this.eventCollect.action,t.unuseErrorPlugin||(this.errorCollect=new ee({core:this.core})),y[b]&&(y[b].isCoreReady=!0)}return e.prototype.apply=function(t){this.bindWeblogger(t)},e.prototype.bindWeblogger=function(t){this.weblogger=t,this.core.bindWeblogger(this.weblogger)},e.prototype.event=function(t,e){this.eventCollect.event(t,e)},e.prototype.customStage=function(t,e){this.navigationCollect.customStage(t,e)},e.prototype.setDimensions=function(t){this.core.setDimensions(t)},e.prototype.fmp=function(e){"number"==typeof e?this.navigationCollect.fmp(e):"object"==t(e)&&e.timestamp?this.navigationCollect.fmp(e.timestamp):this.navigationCollect.fmp()},e.prototype.captureException=function(t){var e;this.errorCollect&&null!=(e=this.errorCollect)&&e.captureException(t)},e.prototype.destroy=function(){var t;null!=(t=this.navigationCollect)&&t.destroy(),null!=(t=this.apiCollect)&&t.destroy(),null!=(t=this.resourceCollect)&&t.destroy(),null!=(t=this.eventCollect)&&t.destroy(),null!=(t=this.errorCollect)&&t.destroy()},e.key="radar",e.version="1.2.5",e}();"undefined"!=typeof window&&"function"!=typeof window.Radar&&(window.Radar=ne);var re=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}();function oe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.warn;return n&&n.call.apply(n,r([console],t,!1))}catch(t){return}}function ie(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,r([console],t,!1))}catch(t){return}}var ae=[];return function(t){function r(e,n){var r=t.call(this)||this;return r.options=n||e,r.validOption()?((null==e?void 0:e.collect)&&r.apply(e),r):r}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(r,t),r.prototype.apply=function(t){var e;this.weblog=t,this.radarInstance=new ne(n(n({},this.options),{weblog:t})),this.action=null===(e=this.radarInstance)||void 0===e?void 0:e.action},r.prototype.destroy=function(){var t;null===(t=this.radarInstance)||void 0===t||t.destroy()},r.prototype.collect=function(t,e){var n;0!==t.indexOf("c_")&&ae.indexOf(t)<0?ie("[error 305]","[Radar] 传入的自定义指标 ".concat(t," 必须为 c_ 开头")):(oe("[radar]:Radar+之后将不再支持collect方法，请用event方法替代。"),null===(n=this.radarInstance)||void 0===n||n.event({name:t},{duration:e}))},r.prototype.fmp=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.fmp(t)},r.prototype.event=function(t,e){var n;null===(n=this.radarInstance)||void 0===n||n.event(t,e)},r.prototype.customStage=function(t,e){var n;null===(n=this.radarInstance)||void 0===n||n.customStage(t,e)},r.prototype.headlessTestReport=function(){oe("[radar]:Radar+已不支持不再支持headlessTestReport方法")},r.prototype.playClicked=function(t){oe("[radar]:Radar+已不支持不再支持playClicked方法")},r.prototype.playIDR=function(t){oe("[radar]:Radar+已不支持不再支持playIDR方法")},r.prototype.playBlock=function(t){oe("[radar]:Radar+已不支持不再支持playBlock方法")},r.prototype.playError=function(t){oe("[radar]:Radar+已不支持不再支持playError方法")},r.prototype.setDimensions=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.setDimensions(t)},r.prototype.validOption=function(){var t=this;if(!this.options)return!1;var e=this.options,n=e.sampling,r=void 0===n?1:n;return"string"==typeof e.projectId&&(!(r>1||r<0)&&(["apiSampling","errorSampling","resourceSampling","eventSampling"].forEach((function(e){var n=t.options[e];void 0!==n&&"number"==typeof n&&0===n&&ie("[error 304]","[Radar] 采样率 ".concat(e," 不能被设置为 0，将改用默认值"))})),!0))},r.prototype.captureException=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.captureException(t)},r.key="radar",r}(re)}));
