!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Weblog={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function i(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}function a(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))}function s(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function c(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var u,l,p,d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){void 0===d.window&&(d.window={addEventListener:function(){},removeEventListener:function(){},setTimeout:function(){},setInterval:function(){},_WEBLOGGER_MOCKED_WINDOW_:!0,global:d}),void 0===d.document&&(d.document=d.window.document||{cookie:"",addEventListener:function(){},removeEventListener:function(){},querySelector:function(){},querySelectorAll:function(){}},void 0===d.window.document&&(d.window.document=d.document)),void 0===d.navigator&&(d.navigator=d.window.navigator||{userAgent:""},void 0===d.window.navigator&&(d.window.navigator=d.navigator)),void 0===d.screen&&(d.screen=d.window.screen||{},void 0===d.window.screen&&(d.window.screen=d.screen)),void 0===d.history&&(d.history=d.window.history||{},void 0===d.window.history&&(d.window.history=d.history)),void 0===d.location&&(d.location=d.window.location||{hostname:"",search:"",href:"",origin:""},void 0===d.window.location&&(d.window.location=d.location));try{void 0===d.localStorage&&(d.localStorage=d.window.localStorage||{getItem:function(){},setItem:function(){}},void 0===d.window.localStorage&&(d.window.localStorage=d.localStorage))}catch(t){}}(),Object.defineProperty||(Object.defineProperty=function(t,e,n){t[e]="[object Object]"===Object.prototype.toString.call(n)&&n.hasOwnProperty("value")?n.value:n}),Object.assign||Object.defineProperty(Object,"assign",{value:function(t){if(null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!==o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},writable:!0,configurable:!0}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,o=function(){},r=function(){var r=this instanceof o?this:t;return n.apply(r,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(o.prototype=this.prototype),r.prototype=new o,r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),r=o.length>>>0;if(0===r)return-1;var i=+e||0;if(Math.abs(i)===1/0&&(i=0),i>=r)return-1;for(n=Math.max(i>=0?i:r-Math.abs(i),0);n<r;){if(n in o&&o[n]===t)return n;n++}return-1}),Object.keys||(Object.keys=(u=Object.prototype.hasOwnProperty,l=!{toString:null}.propertyIsEnumerable("toString"),p=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var n in t)u.call(t,n)&&e.push(n);if(l)for(var o=0,r=p;o<r.length;o++){var i=r[o];u.call(t,i)&&e.push(i)}return e})),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,o;if(null==this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),o=0;o<i;){var a=void 0;o in r&&(a=r[o],t.call(n,a,o,r)),o++}});var f={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},h=function(){function t(t,e){switch(this.page="",this.identity="",e){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(t.page,t.params)}return t.prototype.update=function(t,e){void 0===t&&(t=""),t&&t!==this.page&&(this.page=t,this.identity=this.generatePageId(t)),e&&(this.params=Object.assign(this.params||{},e))},t.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params),category:this.category}},t.prototype.generatePageId=function(t){return t+(new Date).getTime()},t}(),g=["Kwai","Kwai_Lite","Kwai_Pro","livemate","ksthanos","ksNebula","ksnebula","kwaiying","pearl","kinder","m2u","LOLita","XFunCore","ACVideoCore","ZIKZAK"].concat(["UVideo","Vstatus","Kwaigo","MvMaster"]);function m(t,e,n){var o,r={};if(t.length>0)for(var i=e?decodeURIComponent:function(t){return t},a=t.split(/;\s/g),s=null,c=null,u=null,l=0,p=a.length;l<p;l++){if((u=null===(o=a[l])||void 0===o?void 0:o.match(/([^=]+)=/i))&&null!==u)try{s=decodeURIComponent(u[1]),c=i(a[l].substring(u[1].length+1))}catch(t){}else s=decodeURIComponent(a[l]),c="";null!==s&&(r[s]=c)}return r}var v,y={};function _(t,e,n){void 0===e&&(e={}),void 0===n&&(n=!1);try{if(!n&&t in y)return y[t];if(!(null===window||void 0===window?void 0:window.document))return;var o=document.cookie||"";return o===v?y[t]:(v=o,(y=m(o,!e.raw))[t])}catch(t){}}function w(t,e,n){void 0===n&&(n={});try{document.cookie=function(t,e,n,o){void 0===o&&(o={});var r="".concat(encodeURIComponent(t),"=").concat(n?encodeURIComponent(e):e),i=o.expires,a=o.path||"/",s=o.domain||"";return i instanceof Date&&(r+="; expires=".concat(i.toUTCString())),"number"==typeof i&&(r+="; max-age==".concat(i)),""!==a&&(r+="; path=".concat(a)),""!==s&&(r+="; domain=".concat(s)),!0===o.secure&&(r+="; secure"),r}(t,e,!n.raw,n),y[t]=e}catch(t){}}var S={getCookie:_,setCookie:w,parseCookieString:m};function b(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.warn;return n&&n.call.apply(n,c([console],t,!1))}catch(t){return}}function k(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,c([console],t,!1))}catch(t){return}}function E(t,e,n,o){return"attachEvent"in t?t.attachEvent("on"+e,n):t.addEventListener(e,n,o)}function O(t,e,n,o){return"attachEvent"in t?t.detachEvent("on"+e,n):t.removeEventListener(e,n,o)}function P(t,e,n){if(void 0===n&&(n=" "),(e-=t.length)<=0)return t;for(var o="";e;)1&e&&(o+=n),e>>=1,n+=n;return o+t}var T=function(t){void 0===t&&(t=window.navigator.userAgent.toLowerCase());try{for(var e=0;e<g.length;e++)if(t.indexOf(g[e].toLowerCase())>-1)return!0}catch(t){return!1}};function L(t){for(var e={},n=0,o=t.split("&");n<o.length;n++){var r=o[n].split("="),i=r[0],a=r[1];i in e?e[i]instanceof Array?e[i].push(a):e[i]=[e[i],a]:e[i]=a}return e}function C(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");return-1===e?{page:t}:{page:t.slice(0,e),params:L(t.slice(e+1))}}var A=function(t,e){var n=t.url,o=t.page,r=t.params,i=t.pageId;if(!o&&"string"==typeof n){var a=C(n);o=a.page,r=a.params}if("function"==typeof e)try{var s=e({url:n,page:o,params:r});"string"==typeof s?o=s:"object"==typeof s&&(s.page&&(o=s.page),s.params&&(r=s.params),s.pageId&&(i=s.pageId))}catch(t){}else if("object"==typeof e){var c="";for(var u in e)if((n||o||"").indexOf(u)>-1){c=e[u];break}c&&(o=c)}return{page:o,params:r,pageId:i}},I=function(t){return t&&"object"==typeof t&&!Array.isArray(t)};var N,R=(N="",function(){if(N)return N;try{var t=window.devicePixelRatio||1,e=Math.floor(screen.width*t),n=Math.floor(screen.height*t);return N="".concat(e,"x").concat(n)}catch(t){return""}});var U=function(){return!(!((null===window||void 0===window?void 0:window.Worker)&&(null===window||void 0===window?void 0:window.Uint8Array)&&window.URL&&window.Promise)||function(){var t,e,n=(null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.userAgent)||"",o=/mobile|tablet|ip(ad|hone|od)|android|(windows phone)/i.test(n),r="MacIntel"===(null===window||void 0===window?void 0:window.navigator.platform)&&(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.maxTouchPoints)>1;return o||r}())},x=function(t){try{return Math.abs(Math.floor(t))}catch(e){return t}},D=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var n;e&&"function"==typeof e&&(this.events[t]=this.events[t]||[],null===(n=this.events[t])||void 0===n||n.push(e))},t.prototype.off=function(t,e){if(this.events[t]){if(e&&"function"==typeof e){var n=this.events[t];n&&(r=e,(i=(o=n).indexOf(r))>-1&&o.splice(i,1))}var o,r,i;e||(this.events[t]=[])}},t.prototype.emit=function(t){for(var e,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.events[t]&&(null===(e=this.events[t])||void 0===e||e.forEach((function(t){t.apply(void 0,n)})))},t}(),j=0,M=function(t){function e(n,o){var i,a=t.call(this)||this;return a.version="3.10.23",a.plugins={},a.flush=function(){a.logger.flush()},a.baseOption=r({},o),a.logConfig=(i=n,r({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda,forbidV2HttpUrlPage:!0},i||{})),a.initUrlPackage(),e.__instance||(e.__instance=a),a}return o(e,t),Object.defineProperty(e.prototype,"sessionId",{get:function(){return f.sessionId},enumerable:!1,configurable:!0}),e.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e="web"),"object"==typeof t&&t.page&&this.currentUrlPackage&&t.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(t.page,t.params);this.currentUrlPackage=new h(t,e)},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof h?t:new h(t,e)},e.prototype.updateBase=function(t){this.updateCommonPackage(t)},e.prototype.updateCommonPackage=function(t){"object"==typeof t&&this.commonPackage.update(t)},e.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},e.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(j++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},e.prototype.plug=function(t,e){if(this.plugins[t.key])return k("[code 301]","".concat(t.key," 插件重复加载！"));this.addPluginInstance(new t(this,e))},e.prototype.unplug=function(t){var e=this.plugins[t];e&&(e.destroy(),delete this.plugins[t])},e.prototype.unplugAll=function(){for(var t in this.plugins)this.plugins[t]&&this.unplug(t)},e.prototype.generateLog=function(t,e){return{}},e.prototype.send=function(t,e,n){var o=this.generateLog(t.toUpperCase(),e);return"function"==typeof this.beforeSend&&this.beforeSend(t,e,o),this.logger.send(o,!!n,e.callback)},e.prototype.collect=function(t,e){this.send(t,e)},e.prototype.sendImmediately=function(t,e){this.send(t,e,!0)},e.prototype.sendPackage=function(t,e){this.logger.sendPackage(t,e)},e.prototype.destroy=function(){this.unplugAll()},e}(D);function H(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function G(t){if(void 0===t&&(t="undefined"!=typeof location?location.hostname:""),!t)return"";var e=t.split("."),n=e.length;return n<=2?"":".".concat(e[n-2],".").concat(e[n-1])}function V(){try{var t=_("did")||_("_did");if(!t){t="web_".concat(function(){for(var t=1e9*Math.random()>>>0,e=[],n=0;n<7;n++)e.push("0123456789ABCDEF".charAt(16*Math.random()));return t+e.join("")}());var e=new Date;e.setFullYear(e.getFullYear()+1),w("_did",t,{expires:e,domain:G(),path:"/"})}return t}catch(t){return""}}var F="WEBLOGGER_SESSIONID",B=function(t){function e(e,n,o){var r=t.call(this,{},n)||this;if("string"==typeof e){var i=C(e);r.page=i.page,r.params=i.params}else r.page=(e||{}).page||"",r.params=(e||{}).params||void 0;return r.identity=r.generatePageId(),o&&"string"==typeof e&&r.init(e,o),r}return o(e,t),e.prototype.init=function(t,e){void 0===e&&(e={});var n=A({url:t,page:this.page,params:this.params},e),o=n.page,r=n.params;this.update(o,r)},e.prototype.attachUrl=function(){if(this.params||(this.params={}),null===location||void 0===location?void 0:location.href){this.params.origin_url=this.params.origin_url||(null===location||void 0===location?void 0:location.href);var t=C(location.href).page,e=void 0===t?"":t;this.params.origin_pathname=e}},e.prototype.getRealUrlPackage=function(){var t=C(location.href),e=t.page,n=t.params;return{page:e,params:JSON.stringify(r({page_code:this.page,url:location.href,query:n},n)),page_type:this.page_type,identity:this.identity}},e.prototype.generatePageId=function(){return H()},e}(h),W="https://data-track.corp.kuaishou.com",J=W+"/",K="production",q="logger",z="logger-oversea",Q="rest/wd/common/log/collect/",Y=[K,"test","development",q,"oversea"],X="https://logsdk.kwai-pro.com/",$={v2:"rest/kd/log/collect?_json=1&biz=",v3:"".concat(Q,"misc2"),radar:"".concat(Q,"radar")},Z={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:J,test:J,oversea:X},v3:{production:"https://log-sdk.ksapisrv.com/",development:J,test:J,oversea:X}},tt=function(t,e,n){return void 0===t&&(t=K),void 0===e&&(e=!1),void 0===n&&(n="v3"),-1===Y.indexOf(t)?t+$[n]:e&&Z.v3[t]?Z.v3[t]+$.radar:Z[n][t]&&$[n]?Z[n][t]+$[n]:Z.v3.production+$.v3},et=function(t,e){if(!e)return t;try{return/\?(.+?)$/.test(t)?t.replace(/\?(.+?)$/,"?".concat(e,"&$1")):t+"?".concat(e)}catch(e){return t}},nt=function(){function t(t,e){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.isSetSamplingResult=!1,this.sendingYield=null,this.flush=function(t){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),t),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=t,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=e,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,this.updateUrls()}return t.prototype.sendData=function(t,e){return"function"==typeof this.config.sender?this.config.sender(t,e):this.baseSendData(t,e)},Object.defineProperty(t.prototype,"responseSamplingStorageKey",{get:function(){var t=this.commonPackage.app_package,e=t.product_name,n=t.product,o=this.commonPackage.identity_package.device_id;return"RESPONSE_SAMPLING_STORAGE_KEY_".concat(e||n,"_").concat(o)},enumerable:!1,configurable:!0}),t.prototype.updateUrls=function(){var t=this.config.env;t&&/^(https?:)?\/\//.test(t)?this.url=t:this.url=tt(t),this.formatUrl()},t.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf($.v2)?$.v2:$.v3,$.radar),-1!==this.radarUrl.indexOf(Z.v2.production||"")&&this.radarUrl.replace(Z.v2.production||"",Z.v3.production));var t=this.commonPackage.app_package,e=t.product_name,n=t.product,o="v=3.10.23&kpn=".concat(e||n);this.url=et(this.url,o),this.radarUrl=et(this.radarUrl,o)},t.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},t.prototype.send=function(t,e,n){if(void 0===e&&(e=!1),n||this.drained)return this.sendLogs([t],n);e?this.sendAsync(t,n):this.sendThrottle(t)},t.prototype.sendAsync=function(t,e){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.asyncQueue.push(t),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:e.sent(),this.sendingYield=null,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return e.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},t.prototype.sendThrottle=function(t){var e=this;this.throttleQueue.push(t),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){e.flush()}),this.config.wait))},t.prototype.sendLogs=function(t,e){var n=this;if(!t||!t.length)return"function"==typeof e&&e();var o=this.buildLogPackage(t,this.url);this.sendPackage(o,(function(t){t?n.errHandler(o):n.flushErrorLogs(),"function"==typeof e&&e(t)}))},t.prototype.sendPackage=function(t,e){var n=this.config.timeout;try{this.sendData(r(r({},t),{isDebug:this.isDebug,isDrained:this.drained,timeout:n}),e)}catch(t){"function"==typeof e&&e(t)}},t.prototype.buildLogPackage=function(t,e){return this.isV2?this.buildV2Package(t,e):this.buildV3Package(t,e)},t.prototype.buildV2Package=function(t,e){return{url:e,data:{log:{event:t}}}},t.prototype.buildV3Package=function(t,e,n){var o=this.getCommonPackageJSON();return n&&Object.assign(o,n),{url:e,data:{common:o,logs:t}}},t.prototype.errHandler=function(t){var e;if(this.isV2)this.errorQueue.unshift(t);else{var n=t.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var o=!1,r=0;r<this.errorQueue.length;r++){var i=this.errorQueue[r];if(i.url===t.url&&i.data.logs.length+n.logs.length<=100&&JSON.stringify(i.data.common)===JSON.stringify(n.common)){o=!0,(e=i.data.logs).push.apply(e,n.logs);break}}o||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(t))}}},t.prototype.flushErrorLogs=function(){var t=this;this.errorQueue.forEach((function(e){t.sendPackage(e)})),this.errorQueue=[]},t.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},t.prototype.sendRadar=function(t,e){var n=e?{service_name:e}:void 0,o=this.buildV3Package([t],this.radarUrl||this.url,n);this.sendPackage(o)},t}(),ot=function(t,e,n){return k("[error 400]","埋点上报接口请求报错","\nurl:",e,"\ndata",n,"\nerror:",t||"server decode log failed")};function rt(t,e){var n=t.url,o=t.data,r=t.timeout;return new Promise((function(t){var i=new XMLHttpRequest;return i.open("POST",n),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),"object"!=typeof o||o instanceof Uint8Array||(o=JSON.stringify(o)),r&&(i.timeout=r),i.onload=function(){var r=function(t,e,n,o){var r;if(t<200||t>=300&&304!==t);else try{var i=JSON.parse(e),a=i.exception,s=i.result,c=i.error_msg;a&&(r=a),1!==s&&(r=c||"result is ".concat(s))}catch(t){r=t.message}return r&&ot(r,n,o),r}(i.status,i.response,n,o);e&&e(r),t({error:r,response:r?void 0:i.response})},i.ontimeout=i.onerror=function(r){r&&ot(r,n,o),e&&e(r?"networkTimeout":""),t({error:"networkTimeout"})},i.send(o),i}))}var it=function(t){var e=function(e){return k("[error 401]","GET 请求出错 url: ".concat(t),e)};try{var n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(),n.onerror=e}catch(t){e(t)}},at=null===window||void 0===window?void 0:window.navigator,st=at&&-1!==at.userAgent.indexOf("Chrome"),ct="function"==typeof at.sendBeacon;function ut(t,e){var n=t.url,o=t.data,r=t.timeout;t.isDebug;var i=t.isDrained,c=t.forceSendBeacon;return a(this,void 0,void 0,(function(){var t;return s(this,(function(a){switch(a.label){case 0:return o=JSON.stringify(o),i&&function(t){var e=t.url,n=t.data,o=t.forceSendBeacon;if(!st&&!o||!ct)return!1;"object"==typeof n&&n.fd&&(n=n.fd);try{return at.sendBeacon(e,n)}catch(t){return k("[error 403]","navigator.sendBeacon 报错",t),!1}}({url:n,data:o,forceSendBeacon:c})?(e&&e(),[2]):[4,rt({url:n,data:o,timeout:r},e)];case 1:return[2,(t=a.sent()).error?void 0:t.response]}}))}))}var lt,pt=function(t,e,n){void 0===t&&(t=W);var o="".concat(t,"/#/logger/index?sessionId=").concat(n);return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.log;n&&n.call.apply(n,c([console],t,!1))}catch(t){return}}("%c埋点抓包校验: %c".concat(o),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),"".concat(e,"/").concat(n,"/")};!function(t){t.loading="loading",t.loaded="loaded"}(lt||(lt={}));var dt,ft,ht,gt=Object.create(null),mt="weblogger_switch",vt=function(t){var e=function(){try{var t=_(mt)||"undefined"!=typeof sessionStorage&&sessionStorage.getItem(mt);if(!t)return;var e=JSON.parse(t),n=e.loggerSessionId,o=e.reportHost,r=e.loggerHost,i=e.handshakeApi;return n?(it(i||"".concat(o,"/").concat(n)),pt(r,o,n)):""}catch(t){return""}}()||function(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");if(-1===e)return"";var n=L(t.slice(e+1)).webloggerSwitch;if(!n)return"";try{var o=decodeURIComponent(n),r=JSON.parse(o),i=r.loggerSessionId,a=r.reportHost,s=r.loggerHost,c=r.handshakeApi;return i?("undefined"!=typeof sessionStorage&&sessionStorage.setItem(mt,o),it(c||"".concat(a,"/").concat(i)),pt(s,a,i)):""}catch(t){return""}}();if(e)return tt(e,!1,t)},yt=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.baseSendData=o.sendLog,o.getResponseSamplingStorage(),o}return o(e,t),e.prototype.getResponseSamplingStorage=function(){return a(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Promise.resolve()];case 1:return e.sent(),(t=Number(localStorage.getItem(this.responseSamplingStorageKey)))&&Date.now()<t?this.sendEffectiveTime=t:t&&localStorage.removeItem(this.responseSamplingStorageKey),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.isResponseSampling=function(){return!!(this.sendEffectiveTime&&Date.now()<this.sendEffectiveTime)},e.prototype.setResponseSamplingConfig=function(t){var e=this;this.isSetSamplingResult||(this.isSetSamplingResult=!0,null==t||t.then((function(t){var n;try{n=t&&JSON.parse(t)}catch(t){n={result:1,hostName:""}}var o=null==n?void 0:n.expireSeconds;if(o){var r=Date.now()+1e3*o;e.sendEffectiveTime=r,localStorage.setItem(e.responseSamplingStorageKey,String(r))}})))},e.prototype.updateUrls=function(){var t=this.config,e=t.env,n=void 0===e?K:e,o=t.logger,r=t.proto,i=t.isBridge,a=t.disableCompress,s=vt(r);if(s)this.url=s,this.isDebug=!0;else if(o||n===q||n===z){var c=function(t,e){void 0===t&&(t=V()),void 0===e&&(e=!1);var n=e?"https://data-track-sgp.corp.kuaishou.com":W;return it("".concat(n,"/rest/").concat(t)),pt(n,"".concat(n,"/rest"),t)}(this.commonPackage.identity_package.device_id,n===z);this.url=tt(c,!1,r),this.isDebug=!0}else n&&/^(https?:)?\/\//.test(n)?this.url=n:(this.isDebug=n!==K,this.url=tt(n,!1,r),this.radarUrl=tt(n,!0,r));this.enableAsyncGzip=!a&&"v3"===r&&!i&&U()&&n===K&&!s&&!o,this.enableAsyncGzip&&function(t,e,n){if(void 0===e&&(e=!0),gt[t])return n&&n("".concat(t," load repeat"));var o=gt[t]={state:lt.loading},r=document.createElement("script");r.crossOrigin="anonymous",r.src=t,e&&(r.async=!0);var i=document.getElementsByTagName("script")[0];i&&i.parentNode?i.parentNode.insertBefore(r,i):document.head.appendChild(r),r.onload=function(){o.state=lt.loaded,n&&n()},r.onerror=function(e){o.state=lt.loaded,n&&n("".concat(t," loaded failed, ").concat(e))}}("https://static.yximgs.com/udata/pkg/ks-track-platform-new/weblogger/3.10.23/async/gzipper.min.js"),this.formatUrl()},e.prototype.sendLog=function(t,e){var n=this.config.forceSendBeacon;!this.isV2&&this.isResponseSampling()||!this.drained&&this.enableAsyncGzip&&this.sendGzip(t,e)||this.setResponseSamplingConfig(ut(r(r({},t),{forceSendBeacon:n}),e))},e.prototype.sendGzip=function(t,n){var o,r=this;if(!(null===(o=e.Gzipper)||void 0===o?void 0:o.sendData))return!1;var i=e.Gzipper.sendData(t,(function(e){e&&r.setResponseSamplingConfig(ut(t,n))}));return this.setResponseSamplingConfig(i),!!i},e.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},e.prototype.send=function(e,n,o){void 0===n&&(n=!1),this.isV2&&(this.commonPackage.setAdditionalSeqIdPackage(e.getEventType()),e.common_package=this.getCommonPackageJSON()),t.prototype.send.call(this,e,n,o)},e}(nt);!function(t){var e,n,o,r,i,a,s,c;(e=t.ElementStatus||(t.ElementStatus={}))[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.CHECKED=1]="CHECKED",e[e.UNCHECKED=2]="UNCHECKED",(n=t.PageShowAction||(t.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(o=t.ActionStatus||(t.ActionStatus={}))[o.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",o[o.SUCCESS=1]="SUCCESS",o[o.FAIL=2]="FAIL",(r=t.ActionType||(t.ActionType={}))[r.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",r[r.CLICK=1]="CLICK",r[r.LEFT_PULL=2]="LEFT_PULL",r[r.RIGHT_PULL=3]="RIGHT_PULL",r[r.UP_PULL=4]="UP_PULL",r[r.DOWN_PULL=5]="DOWN_PULL",(i=t.SubAction||(t.SubAction={}))[i.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",i[i.PAGE_ENTER=1]="PAGE_ENTER",i[i.PAGE_LEAVE=2]="PAGE_LEAVE",i[i.PAGE_RESUME=3]="PAGE_RESUME",i[i.PAGE_PAUSE=4]="PAGE_PAUSE",(a=t.Direction||(t.Direction={}))[a.UNKNOWN2=0]="UNKNOWN2",a[a.UP=1]="UP",a[a.DOWN=2]="DOWN",a[a.LEFT=3]="LEFT",a[a.RIGHT=4]="RIGHT",(s=t.TaskStatus||(t.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=t.OperationType||(t.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(dt||(dt={})),function(t){var e,n;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT",(n=t.TaskEventType||(t.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(ft||(ft={})),function(t){var e;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN2=0]="UNKNOWN2",e[e.PAGE=1]="PAGE"}(ht||(ht={}));var _t,wt,St,bt=!0,kt=(new Date).valueOf(),Et=function(t,e){var n,o;void 0===e&&(e=!1);var i=t.type,a=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=void 0===c?"":c,l=t.action,p=t.beginTime,d=t.params,f=t.contentPackage,h=t.status,g=t.actionType,m=t.auto,v=((n={status:h?dt.ActionStatus[h]||dt.ActionStatus.UNKNOWN_STATUS:dt.ActionStatus.SUCCESS})[e?"show_type":"action_type"]=g?dt.ActionType[g]||dt.ActionType.UNKNOWN_ACTION_TYPE:dt.ActionType.CLICK,n.url_package=a,n.refer_url_package=s,n[e?"content_wrapper":"content_package"]=f,n);if("PV"===i){var y=dt.SubAction.PAGE_ENTER,_=dt.PageShowAction.ENTER,w=bt,S=0;switch(bt=!1,l){case"leave":_=dt.PageShowAction.LEAVE,y=dt.SubAction.PAGE_LEAVE,S=x((new Date).valueOf()-(p||kt));break;case"enter":_=dt.PageShowAction.ENTER,y=dt.SubAction.PAGE_ENTER,kt=(new Date).valueOf();break;case"visible":_=dt.PageShowAction.RESUME,y=dt.SubAction.PAGE_RESUME,kt=(new Date).valueOf();break;case"hidden":_=dt.PageShowAction.LEAVE,y=dt.SubAction.PAGE_PAUSE,S=x((new Date).valueOf()-(p||kt))}var b=m?ft.ShowType.PAGE_AUTO:ft.ShowType.PAGE_CUSTOM;return e&&(w=void 0,b=ht.ShowType.PAGE),{show_event:r({action:_,sub_action:y,type:b,first_load:w,time_cost:0,stay_length:S},v)}}return{show_event:r({action:e?0:dt.PageShowAction.ENTER,type:e?0:ft.ShowType.ELEMENT,sub_action:e?0:dt.SubAction.PAGE_ENTER,element_package:(o={},o[e?"action2":"action"]=u,o.params=JSON.stringify(d),o)},v)}},Ot=function(t,e){var n,o;void 0===e&&(e=!1);var i=t.sessionId,a=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=t.params,l=t.type,p=t.contentPackage,d=t.status,f=t.taskType,h=t.operationDirection,g=((n={url_package:a,refer_url_package:s,element_package:(o={},o[e?"action2":"action"]=c,o.params=JSON.stringify(u),o)})[e?"content_wrapper":"content_package"]=p,n);if(e){var m="USER_OPERATION"===f||"CLICK"===l&&!f,v=l&&dt.OperationType[l]||dt.OperationType.CLICK;return m?{click_event:r({type:v,direction:h&&dt.Direction[h]||dt.Direction.UNKNOWN2},g)}:{task_event:r({action2:c,status:d&&dt.TaskStatus[d]||dt.TaskStatus.UNKNOWN_STATUS},g)}}return{task_event:r({type:f&&ft.TaskEventType[f]||ft.TaskEventType.USER_OPERATION,status:d&&dt.TaskStatus[d]||dt.TaskStatus.UNKNOWN_STATUS,operation_type:dt.OperationType[l]||dt.OperationType.CLICK,operation_direction:h&&dt.Direction[h]||dt.Direction.UNKNOWN2,session_id:i},g)}},Pt=function(t){var e=t.name,n=t.params,o=t.currentUrlPackage,a=t.referUrlPackage,s=i(t,["name","params","currentUrlPackage","referUrlPackage"]);return{key:e,value:JSON.stringify(r(r({url_package:o,refer_url_package:a},n),s))}},Tt=function(t){var e=t.currentUrlPackage,n=t.referUrlPackage,o=t.options;return{video_stat_event:r(r({},o),{url_package:e,refer_url_package:n})}},Lt={},Ct=function(t){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0;return e+1>1e8&&(e=0),function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,e+1),e}}catch(t){}return Lt[t]||(Lt[t]=0),Lt[t]++},At=(_t=(new Date).getTimezoneOffset()/60)<=0?"GMT+".concat(P(-_t+"",2,"0"),":00"):"GMT-".concat(P(_t+"",2,"0"),":00"),It=function(){function t(t,e){void 0===e&&(e=!1),this.client_timestamp=x((new Date).valueOf()),this.client_increment_id=0,this.session_id=f.sessionId,this.event_id="",e||(this.time_zone=At),Object.assign(this,t),this.genIncrementId()}return t.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?Ct("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):Ct("WEBLOGGER_INCREAMENT_ID_KEY")},t.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},t.prototype.getEventType=function(){if(this.event_package){var t=this.event_package,e=t.task_event,n=t.show_event,o=t.click_event,r=t.custom_event;if(n)return"showEvent";if(o)return"clickEvent";if(e)return"taskEvent";if(r)return"customEvent"}return"customEvent"},t}();function Nt(t,e,n){var o;void 0===n&&(n=!1);var r,a=e.eventId,s=e.currentUrlPackage,c=e.referUrlPackage,u=e.contentPackage,l=e.name,p=e.params;switch(n&&"RADAR"!==t&&"CUSTOM"!==t&&(s&&(s.page2=s.page,delete s.page),c&&(c.page2=c.page,delete c.page)),t){case"PV":case"SHOW":return new It({event_package:Et({type:t,status:e.status,currentUrlPackage:s,referUrlPackage:c,action:e.type,beginTime:e.beginTime,actionType:e.actionType,name:l,params:p,contentPackage:u,operationDirection:e.operationDirection,auto:e.auto},n),event_id:a},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var d=Pt({name:l,params:p,currentUrlPackage:s,referUrlPackage:c});return new It(n?{event_package:{custom_event:d},event_id:a}:{stat_package:{custom_stat_event:d},event_id:a},n);case"RADAR":return new It({stat_package:{custom_stat_event:Pt({name:l,params:p,currentUrlPackage:s,referUrlPackage:c})},event_id:a},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new It({stat_package:(o={},o[t.toLowerCase()]=(r=e,r.currentUrlPackage,r.referUrlPackage,r.taskType,i(r,["currentUrlPackage","referUrlPackage","taskType"])),o)},n);case"VIDEO":return new It(n?{stat_package:Tt({currentUrlPackage:s,referUrlPackage:c,options:p.params}),event_id:a}:{event_package:Ot({type:t,status:e.status,taskType:e.taskType,sessionId:f.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:p.params,contentPackage:u},n),event_id:a},n);default:return new It({event_package:Ot({type:t,status:e.status,taskType:e.taskType,sessionId:f.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:p,contentPackage:u},n),event_id:a},n)}}var Rt,Ut=(null===(wt=null===window||void 0===window?void 0:window.navigator)||void 0===wt?void 0:wt.userAgent)||"",xt=function(t){var e,n,o,r;if(void 0===t&&(t=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent),St&&t===Ut)return St;var i="unknow",a=/android/i,s="Mac OS",c="Windows",u="Android",l="iPhone",p="iPhone",d="Windows Phone",f="Linux";St={os:{name:i,version:i},model:i};try{var h=t.match(/\((.*?)\)/);if(!h)return a.test(t)&&(St.os.name=u),St;var g=h[1]+")",m=g.split(";").map((function(t){return t.trim()})),v=void 0,y=void 0,_=void 0;if(t.indexOf(d)>-1)_=v=d,(b=g.match(/Windows\sPhone\s(.*?)[;\)\s]/))&&(y=b[1]),_=null===(n=m[m.length-1])||void 0===n?void 0:n.replace(")","");else if(a.test(t)){v=u;var w=g.match(/android.*?;(.*?)build\//i);w&&(_=(_=null===(o=w[1])||void 0===o?void 0:o.split(";").pop())&&_.trim());for(var S=0;S<m.length;S++)if(a.test(m[S])){y=null===(r=m[S])||void 0===r?void 0:r.replace(a,""),_||(_=m[S+1]);break}}else if(t.indexOf(l)>-1||t.indexOf(p)>-1){_=t.indexOf(l)>-1?l:p,v="iOS",(b=g.match(/OS\s(.*?)\slike/))&&(y=b[1])}else if(t.indexOf(s)>-1){_=v=s,(b=g.match(/OS\sX\s(.*?)[;\)\s]/))&&(y=b[1])}else if(t.indexOf(c)>-1){var b;_=v=c,(b=g.match(/Windows\s(.*?)[;\)]/))&&(y=b[1])}else if(t.indexOf("Nokia")>-1){v="Symbian";var k=t.match(/Symbian.*?\/(.*?);/);k&&(y=k[1]);var E=t.match(/Nokia(.*?)\//);E&&(_=E[1])}else g.indexOf(f)>-1&&(v=_=f);St={os:{name:v||i,version:y&&y.replace(/_/g,".").trim()||i},model:_||i}}catch(t){}return St};function Dt(){return void 0===Rt&&(Rt=T()&&_("kpn")||function(){if("undefined"==typeof window)return"";for(var t=window.navigator.userAgent,e=[[/ Kwai\//,"KUAISHOU"],[/ ksthanos\//,"THANOS"],[/ ksNebula\//i,"NEBULA"]],n=0;n<e.length;n++){var o=e[n],r=o[0],i=o[1];if(r.exec(t))return i}return""}()||""),Rt}var jt,Mt,Ht,Gt={supportsPushState:function(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},getUAInfo:xt,getDefaultKpn:Dt},Vt=function(){var t;return"function"==typeof(null===(t=null===window||void 0===window?void 0:window.__yodaBridge__)||void 0===t?void 0:t.invoke)},Ft=function(t,e){return void 0===e&&(e="tool"),a(void 0,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return void 0===jt?[2,!1]:[4,jt("tool.canIUse",{namespace:e,name:t})];case 1:return[2,(null==(n=o.sent())?void 0:n.canUse)||!1]}}))}))},Bt={setClientLog:function(t,e){return a(void 0,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,jt("tool.setClientLog",{type:t,data:e})];case 1:return[2,o.sent()];case 2:return n=o.sent(),k("[error 206]","yoda.tool.setClientLog() 报错: ".concat(n.message)),[3,3];case 3:return[2]}}))}))},sendRadarLog:function(t){return a(void 0,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,jt("tool.sendRadarLog",t)];case 1:return[2,n.sent()];case 2:return e=n.sent(),k("[error 207]","yoda.tool.sendRadarLog() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))}))},sendWebLog:function(t){return a(void 0,void 0,void 0,(function(){return s(this,(function(e){try{return[2,jt("tool.sendWebLog",t)]}catch(t){k("[error 214]","yoda.tool.sendWebLog() 报错: ".concat(t.message))}return[2]}))}))},sendSummarizedLog:function(t){return a(void 0,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,jt("tool.sendSummarizedLog",t)];case 1:return[2,n.sent()];case 2:return e=n.sent(),k("[error 208]","yoda.tool.sendSummarizedLog() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))}))},getWebviewLoadPerf:function(t,e){return void 0===t&&(t={}),a(void 0,void 0,void 0,(function(){var n;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,jt("webview.getPageLoadData",t,e)];case 1:return[2,o.sent()];case 2:return n=o.sent(),k("[error 209]","yoda.webview.getPageLoadData() 报错: ".concat(n.message)),[3,3];case 3:return[2]}}))}))},getKDSWebviewLoadPerf:function(t){return void 0===t&&(t={}),a(void 0,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,jt("system.getPageLoadData",t)];case 1:return[2,n.sent()];case 2:return e=n.sent(),k("[error 209]","yoda.system.getPageLoadData() 报错: ".concat(e.message)),[3,3];case 3:return[2]}}))}))},isSupportBridgeLog:function(){return Ft("setClientLog")},isSupportBridge:Ft,invoke:jt},Wt={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(t){t.CLICK="CLICK",t.DOUBLE_CLICK="DOUBLE_CLICK",t.TRIPLE_CLICK="TRIPLE_CLICK",t.LONG_PRESS="LONG_PRESS",t.PULL="PULL",t.DRAG="DRAG",t.SCALE="SCALE",t.PULL_DOWN="PULL_DOWN",t.PULL_UP="PULL_UP",t.AUTO="AUTO"}(Mt||(Mt={})),function(t){t.PV="PV",t.SHOW="SHOW",t.VIDEO="VIDEO",t.CUSTOM="CUSTOM",t.CUSTOM_EVENT="CUSTOM_EVENT",t.RADAR="RADAR"}(Ht||(Ht={}));var Jt=function(){function t(t){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:Wt.unknown},this.h5_extra_attr={sdk_name:"webLogger",sdk_version:"3.10.23",sdk_bundle:"log.browser-full.js"},this.global_attr={entry_tag:[]},this.location_package={country:void 0,province:void 0,city:void 0,county:void 0,street:void 0,latitude:void 0,longitude:void 0},this.update(t),this.app_package.version_name){var e=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(e+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return t.prototype.getH5ExtraAttr=function(t){return Object.assign({},this.h5_extra_attr,t)},t.prototype.update=function(t){if("object"==typeof t){!function(t,e){if(I(t)&&I(e)){var n=function(t,e,n){I(t[n])&&I(e[n])?Object.assign(t[n],e[n]):I(t[n])||I(e[n])||(t[n]=e[n])};for(var o in e)if(t.hasOwnProperty(o))n(t,e,o);else for(var r in t)I(t[r])&&t[r].hasOwnProperty(o)&&n(t[r],e,o)}}(this,t);var e=t.network_type;e&&Wt[e]&&(this.network_package.type=Wt[e])}},t.prototype.updateGlobalAttr=function(t){Object.assign(this.global_attr||{},t)},t.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var t=r(r({},this),{toJSON:function(){return r(r({},t),{h5_extra_attr:JSON.stringify(t.h5_extra_attr),global_attr:JSON.stringify(t.global_attr)})}});t.global_attr=r({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?t.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete t.global_attr.entry_tag,Object.keys(this.global_attr).length||delete t.global_attr;var e=this.location_package;return e&&Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t]})),t},t}(),Kt=[["a7","640x1136",["iPhone 5","iPhone 5s"]],["a7","1536x2048",["iPad Air","iPad Mini 2","iPad Mini 3"]],["a8","640x1136",["iPod touch (6th gen)"]],["a8","750x1334",["iPhone 6"]],["a8","1242x2208",["iPhone 6 Plus"]],["a8","1536x2048",["iPad Air 2","iPad Mini 4"]],["a9","640x1136",["iPhone SE"]],["a9","750x1334",["iPhone 6s"]],["a9","1242x2208",["iPhone 6s Plus"]],["a9x","1536x2048",["iPad Pro (1st gen 9.7-inch)"]],["a9x","2048x2732",["iPad Pro (1st gen 12.9-inch)"]],["a10","750x1334",["iPhone 7"]],["a10","1242x2208",["iPhone 7 Plus"]],["a10x","1668x2224",["iPad Pro (2th gen 10.5-inch)"]],["a10x","2048x2732",["iPad Pro (2th gen 12.9-inch)"]],["a11","750x1334",["iPhone 8"]],["a11","1242x2208",["iPhone 8 Plus"]],["a11","1125x2436",["iPhone X"]],["a12","828x1792",["iPhone Xr"]],["a12","1125x2436",["iPhone Xs"]],["a12","1242x2688",["iPhone Xs Max"]],["a12x","1668x2388",["iPad Pro (3rd gen 11-inch)"]],["a12x","2048x2732",["iPad Pro (3rd gen 12.9-inch)"]]],qt=function(){try{var t=xt(),e=T(),n=t.model||t.os.name||"unknown";if("iOS"!==t.os.name||e)return n;var o=function(){for(var t=R(),e=[],n=0,o=Kt;n<o.length;n++){var r=o[n];t===r[1]&&(e=e.concat(r[2]))}return e.length&&e}();return o?o.join(" or "):n}catch(t){return"unknown"}},zt=0;function Qt(){try{var t=xt().os.name;return zt=t?"Android"===t?T()?6:8:"iOS"===t?T()?7:9:10:0}catch(t){return 0}}function Yt(){var t="unknown",e=null===window||void 0===window?void 0:window.navigator,n=(null==e?void 0:e.connection)||(null==e?void 0:e.mozConnection)||(null==e?void 0:e.webkitConnection);return n&&(t=n.type||n.effectiveType),t}var Xt,$t=function(t){function e(e){var n=t.call(this,r({platform:Qt(),container:10===zt?"WEB":"H5",version_name:T()&&_("appver",void 0,!0)||"",network_type:Yt(),device_id:V(),user_id:_("userId"),global_id:T()&&_("egid")||"",app_package:{language:navigator.language},device_package:{os_version:xt().os.version,model:qt(),ua:navigator.userAgent}},e))||this;return Object.assign(n.h5_extra_attr,{host_product:Dt(),resolution:R(),screen_width:x(screen.width),screen_height:x(screen.height),device_pixel_ratio:window.devicePixelRatio||1,domain:window.location.origin,fromIframe:(null===window||void 0===window?void 0:window.self)!==(null===window||void 0===window?void 0:window.top)},e.h5_extra_attr),delete n.location_package,n}return o(e,t),e.prototype.getVersionName=function(){return this.app_package.version_name},e.prototype.update=function(e){t.prototype.update.call(this,e);var n=this.app_package.version_name;if("string"==typeof n){var o=n.lastIndexOf(".");this.app_package.version_code=+n.slice(o+1)||0,this.h5_extra_attr.app_version_name=n}},e.prototype.setAdditionalSeqIdPackage=function(t){var e,n;this.additional_seq_id_package={channel:3,channel_seq_id:(n="NORMAL",void 0===n&&(n=""),Ct("".concat("WEBLOGGER_CHANNEL_SEQ_ID","_").concat(n))),custom_type:t,custom_seq_id:(e=t,Ct("".concat("WEBLOGGER_V2_SEQ_ID","_").concat(e)))}},e.prototype.increaseH5SeqId=function(t){this.h5_extra_attr.client_timestamp=x((new Date).valueOf()),this.h5_extra_attr.seq_id=Ct(t?"WEBLOGGER_H5_CUSTOM_SEQ_ID":"WEBLOGGER_H5_SEQ_ID")},e}(Jt),Zt=function(t,e,n,o){var r;void 0===e&&(e={}),"string"!=typeof t&&(r=t.type),r=t.toUpperCase();var i={};if("string"==typeof e)i.contentPackage=o,"CUSTOM"===t?(i.key=e,i.value=n):(i.params=n,"PV"===t?i.page=e:i.action=e);else if(i=e,["CUSTOM","CUSTOM_EVENT"].includes(r)){var a=e;a.action&&!a.key&&(i.key=a.action),a.params&&!a.value&&(i.value=a.params)}return[r,i]},te="WEBLOGGER_SILENCED";"undefined"!=typeof window&&("object"!=typeof window._WEBLOGGER&&(window._WEBLOGGER={_silenced:!1,constructors:[],instances:[],silence:function(t){try{t?sessionStorage.setItem(te,"1"):sessionStorage.removeItem(te),window._WEBLOGGER.instances.forEach((function(e){null==e||e.silence(t)}))}catch(t){}}}),Xt=window._WEBLOGGER);var ee=!1,ne=Math.random(),oe=function(t){function e(e,n){void 0===e&&(e={});var o,r,i=t.call(this,e,n)||this;return i.beforeUnload=function(t){if(!ee){for(var e in i.logger.drain(),i.plugins){var n=i.plugins[e];"function"==typeof n.beforeUnload&&n.beforeUnload(t)}ee=!0,setTimeout((function(){ee=!1}),2e3)}},i.isBridge=e.bridgeMode&&e.yoda&&Vt(),i.logConfig.isBridge=i.isBridge,o="sessionId",r=n&&n.session_id||_("sid")||function(){var t="";try{if(T()){if(t=_("session_id")||_("sid"))return t}else"undefined"!=typeof sessionStorage&&((t=sessionStorage.getItem(F)||"")||(t=H(),sessionStorage.setItem(F,t)))}catch(e){t=H()}return t||H()}(),f[o]=r,i.isV2="v2"===i.logConfig.proto,i.getSampled(i.logConfig),i.presetBaseOption(i.baseOption),i.commonPackage=new $t(i.baseOption),i.logger=new yt(i.logConfig,i.commonPackage),i.initYoda(),i.addPlugins(),E(window,"pagehide",i.beforeUnload),E(window,"beforeunload",i.beforeUnload),function(t){(null==Xt?void 0:Xt.instances)&&t&&-1===Xt.instances.indexOf(t)&&(Xt.instances.push(t),Xt._silenced&&(null==t||t.silence(!0)))}(i),i}return o(e,t),e.prototype.getSampled=function(t){var e=t||{},n=e.sampleRateFn,o=e.sampleRate;"function"==typeof n?this.sampled=!!n():void 0!==o&&(this.sampled=ne<Number(o))},e.prototype.presetBaseOption=function(t){this.isBridge||(this.isV2?("number"!=typeof t.product&&k("[error 101]","请设置有效的 product 值，值类型为 number!"),delete t.product_name):(t.product_name&&"string"==typeof t.product_name||k("[error 100]","请设置有效的 product_name 值，值类型为 string!"),delete t.product),t.user_id||(t.user_id=_("userId")||_("userName")||void 0,t.user_id||b("[warn 102]","user_id 为空，请确定是否传入，如果是异步通过 updateCommonPackage 接口传入，可以忽略该提示!")),t.device_id||(t.device_id=V(),t.device_id||k("[error 103]","device_id 为空，请设置有效的设备 id!")),!t.global_id&&T()&&(t.global_id=_("egid")||""))},Object.defineProperty(e.prototype,"yoda",{get:function(){return this.logConfig.yoda||(null===window||void 0===window?void 0:window.KSYoda)||(null===window||void 0===window?void 0:window.yoda)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Utils",{get:function(){return{yoda:Vt()&&this.yoda?Bt:null,cookie:S,ua:Gt,io:{sendData:ut}}},enumerable:!1,configurable:!0}),e.prototype.initYoda=function(){var t,e=this;Vt()&&this.yoda&&(t=this.yoda,jt="function"==typeof t?t:t.invoke,a(void 0,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,jt("system.getDeviceInfo")];case 1:return[2,e.sent()];case 2:return t=e.sent(),k("[error 209]","yoda.system.getDeviceInfo() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))})).then((function(t){(null==t?void 0:t.mod)&&(e.commonPackage.device_package.model=t.mod)})),a(void 0,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,jt("system.getAppInfo")];case 1:return[2,e.sent()];case 2:return t=e.sent(),k("[error 209]","yoda.system.getAppInfo() 报错: ".concat(t.message)),[3,3];case 3:return[2]}}))})).then((function(t){if("object"==typeof t){var n=t.did,o=t.userId,r=t.appver;n&&(e.commonPackage.identity_package.device_id=n),o&&!e.commonPackage.identity_package.user_id&&(e.commonPackage.identity_package.user_id=o),r&&(e.commonPackage.app_package.version_name=r)}})))},e.prototype.initUrlPackage=function(){t.prototype.initUrlPackage.call(this);var e,n=this.logConfig.referer,o="web";n?(e=n.value,o=n.type&&n.type||o):"undefined"!=typeof document&&document.referrer&&(e=document.referrer),e&&this.updateReferUrlPackage(e,o)},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=(null===location||void 0===location?void 0:location.href)||""),void 0===e&&(e="web"),"object"==typeof t&&!t.force&&this.currentUrlPackage){var n=t.page,o=void 0===n?this.currentUrlPackage.page:n,r=t.params,i=void 0===r?{}:r;if(o===this.currentUrlPackage.page)return this.currentUrlPackage.update(o,i)}this.currentUrlPackage=new B(t,e,this.logConfig.urlMap),this.logConfig.attachUrl&&this.currentUrlPackage.attachUrl()},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof B?t:new B(t,e,this.logConfig.urlMap)},Object.defineProperty(e.prototype,"isSendSampled",{get:function(){return void 0===this.sampled||this.sampled||this.logger.isDebug},enumerable:!1,configurable:!0}),e.prototype.generateLog=function(t,e,n){void 0===n&&(n=Nt);var o,i=e,a=i.action,s=i.params,c=i.status,u=i.type,l=i.eventId,p=i.contentPackage,d=i.urlPage;p&&(p="string"==typeof p?p:JSON.stringify(p));var f="PV"===t;if(f){var h=e,g=h.page,m=h.type;m||(e.type=m="enter"),"enter"===m&&g?this.updateCurrentUrlPackage({page:g,params:s}):this.currentUrlPackage.update(g,s)}else d&&d.page&&(o={page:d.page,identity:d.identity||H(),params:JSON.stringify(d.params),page_type:this.currentUrlPackage.page_type});var v={currentUrlPackage:o||this.currentUrlPackage.toJSON(),referUrlPackage:this.referUrlPackage?this.referUrlPackage.toJSON():void 0,contentPackage:p};if("RADAR"!==t&&(null==o||o.page.indexOf("http")),f){var y=e.type;return n(t,r(r(r({},e),{type:y}),v),this.isV2)}if("SHOW"===t)return n(t,r(r(r({},e),{name:a}),v),this.isV2);if("VIDEO"===t)return n(t,r({params:e,name:"VIDEO"},v),this.isV2);if("RADAR"===t)return n(t,e,this.isV2);if(-1!==["CUSTOM","RADAR","CUSTOM_EVENT"].indexOf(t)){var _=e,w=_.key,S=_.value;return n("CUSTOM",r(r(r({},e),{params:S,name:w}),v),this.isV2)}return n(t,r(r(r({},e),{params:s,status:c,taskType:u,eventId:l,name:a}),v),this.isV2)},e.prototype.collect=function(t,e,n,o){var r=Zt(t,e,n,o),i=r[0],a=r[1];return this.send(i,a,!1)},e.prototype.sendImmediately=function(t,e,n,o){var r=Zt(t,e,n,o),i=r[0],a=r[1];return this.send(i,a,!0)},e.prototype.send=function(t,e,n){if(!this._silenced){var o,r=this.generateLog(t,e);if(this.emit("event",{type:t,action:null==e?void 0:e.action,log:r}),"RADAR"===t)return this.logger.sendRadar(r,null==e?void 0:e.serviceName);if(!(this.isV2&&this.logConfig.forbidV2HttpUrlPage&&(o=this.currentUrlPackage.page,o&&/^(https?:)?\/\//.test(o)&&(k("[error 108]","请注意当前埋点页面信息为 ".concat(o,"，不符合规范，上报失败！")),1))))if(this.isSendSampled){var i="object"==typeof e&&e.callback||void 0;this.logger.send(r,!!n,i)}}},e.prototype.destroy=function(){t.prototype.destroy.call(this),O(window,"pagehide",this.beforeUnload),O(window,"beforeunload",this.beforeUnload),function(t){if(null==Xt?void 0:Xt.instances){var e=Xt.instances.indexOf(t);-1!==e&&Xt.instances.splice(e,1)}}(this)},e.prototype.silence=function(t){this._silenced=t},e.Logger=yt,e}(M),re=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}(),ie={updateInterval:2e4,crashThreshold:1e4},ae="@ks.monitor.crash_",se=function(t){function e(e){var n=t.call(this)||this;return n.eventName="onpagehide"in window?"pagehide":"beforeunload",n.options=r({},ie),n.historyMoniorInfo=null,n.stop=function(){clearInterval(n.updateIntervalId);try{localStorage.removeItem(n.monitorId)}catch(t){}},(null==e?void 0:e.collect)&&n.apply(e),E(window,n.eventName,n.stop),n}return o(e,t),e.prototype.apply=function(t){t&&(this.weblog=t,this.monitorId=ae+this.weblog.sessionId,this.start())},e.prototype.destroy=function(){this.stop(),O(window,this.eventName,this.stop)},e.prototype.pickHistoryInfo=function(){for(var t in localStorage)if(0===t.indexOf(ae))try{var e=localStorage.getItem(t),n=JSON.parse(e);this.checkHistoryCrash(n)}catch(t){}},e.prototype.checkHistoryCrash=function(t){var e=(new Date).valueOf();t&&t.time&&e-t.time>this.options.crashThreshold&&this.weblog.collect("CUSTOM",{key:"crash",value:t})},e.prototype.start=function(){var t=this;this.pickHistoryInfo(),this.updateIntervalId=window.setInterval((function(){t.update()}),this.options.updateInterval),this.update()},e.prototype.update=function(){var t,e;if(window.performance&&window.performance.memory){var n={time:(new Date).valueOf(),memory:{limit:Math.floor(window.performance.memory.jsHeapSizeLimit/1024),total:Math.floor(window.performance.memory.totalJSHeapSize/1024),used:Math.floor(window.performance.memory.usedJSHeapSize/1024)},href:null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href,sessionId:null===(e=this.weblog)||void 0===e?void 0:e.sessionId};try{localStorage.setItem(this.monitorId,JSON.stringify(n))}catch(t){}}},e.key="crachMonitor",e}(re),ce={interval:1e4,decimals:2};function ue(t){return setTimeout(t,62.5)}var le=clearTimeout,pe=function(t){function e(e,n){var o=t.call(this)||this;return o.options=r({},ce),o.count=0,o.visibilityChange=function(){var t=document.visibilityState;"visible"===t?o.start():"hidden"===t&&o.stop()},n||e&&(null==e?void 0:e.collect)&&o.apply(e),Object.assign(o.options,n),E(window,"visibilitychange",o.visibilityChange),o.start(),o}return o(e,t),e.prototype.destroy=function(){this.stop(),O(window,"visibilitychange",this.visibilityChange)},e.prototype.start=function(){this.loopId||this.fpsTickId||(this.loop(),this.fpsTick())},e.prototype.fpsTick=function(){var t=this;this.fpsTickId=function(t){return(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||ue).call(this,t)}((function(){t.count++,t.fpsTick()}))},e.prototype.loop=function(){var t=this;this.loopBeginTime=(new Date).valueOf(),this.loopId=window.setTimeout((function(){t.loopEndTime=(new Date).valueOf();var e=t.calculate();t.weblog.collect("CUSTOM",{key:"fps",value:{key:"fps",value:e}}),t.count=0,t.loop()}),this.options.interval)},e.prototype.stop=function(){!function(t){(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||le).call(this,t)}(this.fpsTickId),window.clearTimeout(this.loopId),this.loopId=0,this.fpsTickId=0},e.prototype.calculate=function(){return+(1e3/((this.loopEndTime-this.loopBeginTime)/this.count)).toFixed(this.options.decimals)},e.key="fpsMonitor",e}(re),de="undefined"!=typeof window?window.performance:null,fe=de&&de.timing||null;de&&de.getEntriesByType&&de.getEntriesByType("navigation")[0];var he={dnsLookup:{end:"domainLookupEnd",start:"domainLookupStart"},tcpConnection:{end:"connectEnd",start:"connectStart"},resourceLoad:{end:"responseEnd",start:"requestStart"},jsCost:{custom:function(){if("function"!=typeof performance.getEntries)return 0;var t=performance.getEntries(),e=t[0],n=t.filter((function(t){return"script"===t.initiatorType}))[0];return n&&e?e.domComplete-n.fetchStart:0}},documentContentLoaded:{end:"domComplete",start:"fetchStart"},load:{end:"loadEventEnd",start:"fetchStart"},timeToFirstByte:{end:"loadEventEnd",start:"fetchStart"},firstScreen:{custom:function(t,e){var n=(e||{}).endPoint,o=void 0!==n?n:(new Date).valueOf();return fe&&o-fe.fetchStart||0}},whiteScreen:{custom:function(t,e){var n=(e||{}).endPoint,o=void 0!==n?n:(new Date).valueOf();return fe&&o-fe.fetchStart||0}}},ge=function(t){function e(e){var n=t.call(this)||this;return n.load=function(){setTimeout((function(){var t=n.collect();t&&["load","documentContentLoaded","dnsLookup","tcpConnection","jsCost","timeToFirstByte"].forEach((function(e){var o;"jsCost"===e&&0===t[e]||n.weblog.collect("CUSTOM",{key:me[e],value:(o={},o[me[e]]=t[e],o)})}))}))},fe?(e&&n.apply(e),n):(k("The Timing Monitor need performance APIs to Support!"),n)}return o(e,t),e.prototype.apply=function(t){this.weblog=t,E(window,"load",this.load)},e.prototype.destroy=function(){O(window,"load",this.load)},e.prototype.calculate=function(t,e){var n=he[t];if(!n)throw new Error("The perf key is not correct!");return"function"==typeof n.custom?n.custom(t,e):fe[he[t].end]-fe[he[t].start]},e.prototype.mark=function(t,e){var n,o=this.collect(t,e);o&&this.weblog.collect("CUSTOM",{key:me[t],value:(n={},n[me[t]]=o[t],n)})},e.prototype.collect=function(t,e){var n,o=this;if(fe){if(t)return(n={})[t]=this.calculate(t,e),n;return Object.keys(he).reduce((function(t,n){return t[n]=o.calculate(n,e),t}),{})}},e.key="timingMonitor",e}(re),me={load:"total_download_cost",documentContentLoaded:"operational_cost",dnsLookup:"dns_query_cost",tcpConnection:"tcp_cost",jsCost:"js_cost",whiteScreen:"white_screen_cost",firstScreen:"first_screen_cost",timeToFirstByte:"ttfb_cost"};!function(t,e){var n;if("undefined"!=typeof window&&void 0!==window._GLOBAL_KS_WEBLOGGER_&&"function"==typeof t){var o=window._GLOBAL_KS_WEBLOGGER_,r=o.weblog,i=o.config,a=e?null===(n=i.plugins[e])||void 0===n?void 0:n.options:void 0;r.addPluginInstance(new t(a))}}(ge);var ve=function(){return(ve=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function ye(t,e,n,o){return new(n=n||Promise)((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))}function _e(t,e){var n,o,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){var c=[a,s];if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,(c=r?[2&c[0],r.value]:c)[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(r=0<(r=i.trys).length&&r[r.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(s){c=[6,s],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function we(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}function Se(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||((o=o||Array.prototype.slice.call(e,0,r))[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var be,ke,Ee="ksurl.cn/csHfgepO",Oe=console,Pe=Oe.log.bind(Oe,Ee+", radar:"),Te=Oe.warn.bind(Oe,Ee+", radar:"),Le=Oe.error.bind(Oe,Ee+", radar:"),Ce=function(){function t(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middlewares=[],(t=this.middlewares).push.apply(t,Se([],we(e),!1))}return t.prototype.use=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=this.middlewares.pop();(t=this.middlewares).push.apply(t,Se([],we(e),!1)),this.middlewares.push(o)},t.prototype.invoke=function(t){return o=this.middlewares,e=t,n=-1,function t(r){if(r<=n)return new Error("`next` 被重复调用");var i=o[n=r];if(i=r===o.length?undefined:i)try{return i(e,t.bind(null,r+1))}catch(r){return r}}(0);var e,n,o},t}(),Ae=((ke=be=be||{}).LOAD="load",ke.RES="resource",ke.API="api",ke.ERROR="error",ke.SDK_ERROR="sdk_error",ke.CUSTOM="custom",ke.BATCH="batch",ke.EVENT="event",ke.BLOOD="blood",function(){function t(t){void 0===t&&(t={});var n=this;this.broadcastSampleFb=function(){var t=n.getSample(n.baseOptions.sampling);t!==n.sampling&&(n.sampling=t,n.sampling&&(n.isHit=n.samplingControl(n.sampling)))},void 0===t&&pn("100"),t.key||pn("101"),!t.core||"object"==e(t.core.sampleData)&&"function"==typeof t.core.collect||pn("121"),this.baseOptions=t,this.key=t.key,this.version=t.version,this.name=t.name,this.isHit=!1,t.core&&this.updateCore(t.core)}return t.prototype.updateCore=function(t){var n;"object"==e(t.sampleData)&&"function"==typeof t.collect||pn("121"),null!=(n=this.core)&&n.broadcastSample.off(this.broadcastSampleFb),this.core=t,this.sampling=this.getSample(this.baseOptions.sampling),this.sampling&&(this.isHit=this.samplingControl(this.sampling)),null!=(t=null==(n=this.core)?void 0:n.broadcastSample)&&t.on(this.broadcastSampleFb)},t.prototype.getSample=function(t){var e=null!=(e=null==(e=this.core)?void 0:e.sampleData.core)?e:1;if(this.key===be.LOAD)return e;if("number"!=typeof(t=void 0===t?1:t)||t<0||1<t)return Te("102","".concat(this.key,"，采用Core的采样率").concat(null==(n=this.core)?void 0:n.sampleData.core)),e;var n=null!=(n=this.core)&&n.isInYoda?void 0===(null==(n=this.core)?void 0:n.sampleData[this.key])?1:this.core.sampleData[this.key]:t;return e&&e<n?(Te("115","".concat(this.key)),e):n},t.prototype.samplingControl=function(t){var e;return!(null==(e=this.core)||!e.sampleData.isHit)&&(null==(e=this.core)?void 0:e.samplingControl(t/this.core.sampleData.core))},t.prototype.baseCollect=function(t){if(this.core){if(this.isHit){var e=t.value||{};e=Object.keys(e).filter((function(t){return null!==e[t]&&void 0!==e[t]})).reduce((function(t,n){return ve(ve({},t),((t={})[n]=e[n],t))}),{});try{this.core.collect(t.key||this.key,ve(ve({collect_version:this.version,collect_name:this.name},t.dimension),{sample_rate:this.sampling}),e)}catch(t){Te("126")}}}else Te("110","".concat(this.key))},t}());var Ie=["//wlog.kuaishou.com/rest/n/log/web/collect","/rest/wd/common/log/collect/misc2","/rest/wd/common/log/collect/radar","/rest/kd/log/collect"],Ne=window,Re="__radarSeedStore__",Ue="Queue",xe="error"+Ue,De="resource"+Ue,je="event"+Ue,Me={start_time:{custom:function(t,e){return Math.round(e.startTime)}},fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0,crossOriginSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0,crossOriginSkip:!0},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0,crossOriginSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0,crossOriginSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0,crossOriginSkip:!0},total:{end:"responseEnd",start:"fetchStart"},size:{custom:function(t,e){return e.encodedBodySize},cachedSkip:!0,crossOriginSkip:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name}},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||0===e.duration||null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart)},crossOriginSkip:!0},has_timing_allow:{custom:function(t,e){return We(e)}}},He=/^(https?:)?\/\//;function Ge(t,e){if(!t)return!1;var n=t.replace(He,"");return e.some((function(t){return 0<=n.indexOf(t.replace(He,""))}))}function Ve(t){if("string"!=typeof t)return"";try{var e=t.lastIndexOf(".");return t.substr(e+1)}catch(t){return""}}function Fe(t){return"object"==e(t)&&Object.keys(t).every((function(e){return"number"==typeof t[e]}))}function Be(t){return"function"==typeof t}function We(t){return void 0===t.nextHopProtocol?null:""!==t.nextHopProtocol}function Je(t){return"resource"===t.entryType?"fetch"!==(null==t?void 0:t.initiatorType)&&"xmlhttprequest"!==(null==t?void 0:t.initiatorType)||"js"===Ve(t.name)||"css"===Ve(t.name)?"resource":"api":"other"}function Ke(t,e){var n={};return Object.keys(t).forEach((function(o){var r=qe(o,t,e);null!=r&&(n[o]=r)})),n}function qe(t,e,n){var o=e[t];if(o||pn("129，".concat(t)),(!o.crossOriginSkip||We(n))&&(!o.cachedSkip||!qe("cached",e,n)))return"function"==typeof o.custom?o.custom(t,n):(e=o.end,t=o.start,!o.notCatchIfUndefined||void 0!==n[e]&&void 0!==n[t]?(+n[e]||0)-(+n[t]||0):void 0)}function ze(t,e,n,o){return t.addEventListener(e,n,o)}function Qe(t,e,n,o){return t.removeEventListener(e,n,o)}var Ye=["ktrace-str"];function Xe(t){return"__radar_".concat(t=void 0===t?"":t).concat(Math.random().toString(36).substring(2,8))}var $e=[],Ze=["application/json","text/html","text/plain"];function tn(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var r=$e.reduce((function(t,e){return[e].concat(t)}),[]),i="string"==typeof n[0]?new Request(n[0],n[1]):n[0],a=(i.id=Xe(),r.forEach((function(t){t=t.request,i=t(i)||i})),i.clone()),s=t.apply(void 0,Se([],we(n),!1)),c=null,u=null,l=!1;return s.then((function(t){var e,n=null==(e=t.headers)?void 0:e.get("content-type");return n&&Ze.some((function(t){return-1<n.indexOf(t)}))?(l=!0,e=t.clone(),c=e.clone(),e.clone().text()):(c=t,"[object Object]")})).then((function(t){return ye(e,void 0,void 0,(function(){return _e(this,(function(e){switch(e.label){case 0:u=t,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.text()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,"Radar: Request.text()失败"];case 4:return[2]}}))}))})).then((function(t){i._config=t;var e=null;return l?(e=c.clone()).data=u:e=c,r.forEach((function(t){(t=t.response)&&(e=t(e,i)||e)})),c}),(function(t){throw r.forEach((function(e){(e=e.responseError)&&(t=e(t,i)||t)})),t}))}function en(){var t=[];function e(e){-1!==(e=t.indexOf(e))&&t.splice(e,1)}function n(n){return t.push(n),e.bind(void 0,n)}return{on:n,off:e,once:function(t){var e=n((function(n){t(n),e()}));return e},emit:function(e){t.forEach((function(t){return t(e)}))}}}function nn(t){return(t=new RegExp("(?:^|; ?)".concat(t,"=(1|0)(;|$)")).exec(document.cookie))&&t[1]}var on=["radar_init","h5_load","fmp","main_api","h5_custom_metric"];var rn={load:function(t){var e=t.dimension,n=t.value;if(t=e.event_name,on.indexOf(t)<0)return!1;if(!Fe(n))return!1;switch(t){case"fmp":var o=n.fmp_time;return!(!n.fmp||!o);case"h5_load":return o=n.total,!(!n.load_event_time||!o);case"h5_custom_metric":return o=n.custom_metric_timestamp,!(!e.custom_metric_name||!o)}return!0},api:function(t){var e=t.dimension,n=(t=t.value,e.custom_failed),o=e.api,r=e.status,i=e.res_type,a=e.protocol,s=(e=e.cached,t.duration),c=t.size;return"boolean"==typeof(void 0!==n&&n)&&"string"==typeof(void 0===o?"":o)&&"number"==typeof(void 0===r?0:r)&&"string"==typeof(void 0===i?"":i)&&"string"==typeof(void 0===a?"":a)&&"boolean"==typeof(void 0!==e&&e)&&"number"==typeof(void 0===s?0:s)&&"number"==typeof(void 0===c?0:c)&&Fe(t)},resource:function(t){var e=t.dimension,n=(t=t.value,e.failed);if("boolean"!=typeof n)return!1;if(n){var o=e.res_path;if("string"!=typeof e.file||"string"!=typeof o)return!1}return!!n||"string"==typeof e.file&&Fe(t)},error:function(t){var n=(t=t.dimension).error_type;if([t.error_cons_type,n,t.msg].some((function(t){return null==t})))return!1;n=t.col;var o,r=t.line;return t.sample_rate,t.event_client_timestamp,t=function(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}(t,["col","line","sample_rate","event_client_timestamp"]),!(n&&"number"!=typeof n||r&&"number"!=typeof r)&&"object"==e(o=t)&&Object.keys(o).every((function(t){return void 0===o[t]||"string"==typeof o[t]}))},event:function(t){var e=t.value;return t=t.dimension.name,!(void 0!==e&&!Fe(e)||!t)},blood:function(t){var e=!0;if((t=t.dimension.data)instanceof Array){if(0===t.length)return!1;t.forEach((function(t){"string"!=typeof t.com&&(e=!1)}))}return e}};function an(t,e){var n;return null!=(n=null==Ne?void 0:Ne[Re])&&n[t],null!=(n=null==Ne?void 0:Ne[Re])&&n.isRuning?Ne[Re][t]:void 0===e?null:e}function sn(t,e){try{Ne[Re][t]=e}catch(t){Le("1000")}}function cn(t){return JSON.parse(JSON.stringify(t))}function un(t){try{var e;if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage)return function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,(e=1e8<(e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0)+1?0:e)+1),e}catch(t){}}function ln(t){var e,n,o={};t=t.split("&");try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&o>=t.length?void 0:t)&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i=r.next();!i.done;i=r.next()){var a=we(i.value.split("="),2),s=a[0],c=a[1];s in o?o[s]instanceof Array?o[s].push(c):o[s]=[o[s],c]:o[s]=c}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return o}function pn(t){throw new Error("radar error "+t)}var dn=function(){return(dn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function fn(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}function hn(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||((o=o||Array.prototype.slice.call(e,0,r))[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var gn=["c_dimension1","c_dimension2","c_dimension3","release_tag","product_version","sub_app"],mn=function(){function t(t){var n,o=this,r=(this.queueConfig={wait:1e3,maxBatchLength:200},this.logQueue=[],this.preStoredLogQueue=[],this.batchTimer=0,this.eventName="onpagehide"in window?"pagehide":"beforeunload",this.customDimension={},this.runtimeIdMap={},this.randomSampling=Math.random(),this.commonDimension={},this.isInYoda=!1,this.sampleData={isHit:!0,core:1},this.ignoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],this.broadcastSample=en(),this.didRate=void 0,this.collect=function(t,e,n){var r=cn({key:t,dimension:e=void 0===e?{}:e,value:n=void 0===n?{}:n});if(!o.sampleData||!1!==o.sampleData.isHit){if(!function(t){return t?Object.keys(be).map((function(t){return be[t]})).indexOf(t.key)<0?(Le("117"),!1):rn[t.key](t):(Le("116"),!1)}(r))return Le("107","key: ".concat(r.key)),void o.collect(be.EVENT,{sample_rate:e.sample_rate,message:"radar上报日志类型错误",name:"radar_log_error",extra_info:JSON.stringify(r)},{});Object.keys(r.value).forEach((function(t){r.value[t]=r.value[t].toString()})),o.decorateLog(r);var i=o.getCommonData(),a=i.app_version_name;if(delete i.app_version_name,(t=new Ce((function(t,e){t.dimension.app_version_name=a,t.dimension.did_rate=o.didRate;var n=(null==(n=null==t?void 0:t.dimension)?void 0:n.event_client_timestamp)||Date.now(),r=(null==(r=null==t?void 0:t.dimension)?void 0:r.radar_session_id)||o.radarSessionId;return dn(dn(dn({},t),i),{event_client_timestamp:n,event_trigger_source:"H5",radar_session_id:r})}))).use((function(t,e){return t.key&&"load"===t.key&&(t.dimension=dn(dn({},t.dimension),{load_device_increase_id:un("LOAD_DEVICE_INCREASE_ID"),load_session_increase_id:o.genSessionIncreaseId("LOAD_SESSION_INCREASE_ID")})),t.key&&"load"!==t.key&&(t.dimension=dn(dn({},t.dimension),{other_device_increase_id:un("OTHER_DEVICE_INCREASE_ID"),other_session_increase_id:o.genSessionIncreaseId("OTHER_SESSION_INCREASE_ID")})),e()})),(r=t.invoke(r))instanceof Error)throw r;try{window.dispatchEvent(new CustomEvent("get-radar-next-data",{detail:{kv:cn(r)}}))}catch(t){}if(delete r.dimension.broadcast_info,o.weblog?o.logQueue.push(r):(r.base_href=location.href,o.preStoredLogQueue.push(r)),function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];1==+ln(location.search.slice(1)).debug&&Te.apply(void 0,Se(["[radar] ".concat(t,": ")],we(e),!1))}("radarLogNext",JSON.parse(JSON.stringify(r))),o.logQueue.length>o.queueConfig.maxBatchLength-1)return o.flush(),clearTimeout(o.batchTimer),void(o.batchTimer=0);o.batchTimer||(o.batchTimer=window.setTimeout((function(){o.flush(),clearTimeout(o.batchTimer),o.batchTimer=0}),o.queueConfig.wait))}},this.flush=function(){var t;o.logQueue.length<=0||(t=null,(t=o.config.httpReportFirst?t:o.reportByBridge())&&!o.config.httpReportFirst||o.reportByHttp(),o.logQueue=[])},"object"==e(t)&&null!==t||pn("108"),"string"!=typeof t.projectId&&pn("109"),an("radarSessionId"));this.radarSessionId=null!=r?r:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),this.config=t,this.sampling="number"==typeof(n=null!=(r=this.config.sampling)?r:1)&&0<=n&&n<=1?n:(Le("110"),1),this.bindWeblogger(t.weblogger),null!=(r=this.config)&&r.ignoreList&&Array.isArray(null==(t=this.config)?void 0:t.ignoreList)&&(this.ignoreList=this.ignoreList.concat(this.config.ignoreList.map((function(t){return t.replace(/^(https?:)?\/\//,"")})))),this.queueConfig=dn(dn({},this.queueConfig),null!=(r=this.config)&&r.queueConfig?this.config.queueConfig:{}),null!=(t=this.config)&&t.customDimensions&&this.setDimensions(null==(r=this.config)?void 0:r.customDimensions),ze(window,this.eventName,this.flush),"undefined"!=typeof window&&window.yodaCollectErrorDataDestroy&&window.yodaCollectErrorDataDestroy()}return t.prototype.genSessionIncreaseId=function(t){return this.runtimeIdMap[t]||(this.runtimeIdMap[t]=0),this.runtimeIdMap[t]++},t.prototype.bindWeblogger=function(t){var n,o=this;if(null!=t&&"object"!=e(t))pn("106");else{if(this.weblog)return void Te("122");this.weblog=t,this.updateUrlPackage(),void 0!==(null==(n=null==t?void 0:t.logger)?void 0:n.radarUrl)&&this.ignoreList.push(null==(n=null==t?void 0:t.logger)?void 0:n.radarUrl),void 0!==(null==(n=null==t?void 0:t.logger)?void 0:n.url)&&this.ignoreList.push(null==(n=null==t?void 0:t.logger)?void 0:n.url),this.isInYoda=!(null==(n=null==(t=this.weblog)?void 0:t.Utils)||!n.yoda),this.getSampleData()}0<this.preStoredLogQueue.length&&(this.preStoredLogQueue.forEach((function(t){if(void 0!==(n=o.sampleData["load"===t.key?"core":t.key])&&(t.dimension.sample_rate=n),"load"===t.key?o.sampleData.core:t.dimension.sample_rate*o.sampleData.core>=o.randomSampling){var n=o.getCommonData(),r=(t.dimension.app_version_name=n.app_version_name,t.h5_extra_attr=JSON.stringify(dn(dn({},null==(n=o.weblog.commonPackage)?void 0:n.getH5ExtraAttr()),JSON.parse(t.h5_extra_attr))),function(t){if(-1===(n=(t=void 0===t?location.href:t).lastIndexOf("?")))return{page:t};var e=t.slice(0,n),n=t.slice(n+1);return{url:t,page:e,params:ln(n)}}(t.base_href)),i=null==(n=o.weblog.logConfig)?void 0:n.urlMap;n={};if("function"==typeof i)try{var a=i(r);"string"==typeof a?n={page:a}:"object"==e(a)&&(n={page:a.page,params:a.params})}catch(t){}else if("object"==e(i)){var s,c="";for(s in i)if(-1<(r.page||r.url||"").indexOf(s)){c=i[s];break}c&&(n={page:c})}t.url_package={page:n&&n.page||r.page},a=o.referUrlPackage&&o.referUrlPackage.toJSON(),t.refer_url_package=a,delete t.base_href,o.logQueue.push(t)}})),this.preStoredLogQueue=[],this.flush())},t.prototype.getSampleData=function(){var t,e,n=this;this.isInYoda?(this.sampleData={isHit:!0,core:this.sampling,api:1,resource:.1,error:1,event:1},e=window.updateYodaSampleRateWithParams,window.updateYodaSampleRateWithParams=function(t){Pe("104",t),n.updateYodaSampleRate(t),n.broadcastSample.emit(n.sampleData),e&&e(t)},window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.sampleData?(this.updateYodaSampleRate(window.__yodaCommonDataObject__.sampleData),this.collect(be.EVENT,{name:"客户端采样率注入成功",event_type:"radar_sample_inject_success"},{})):"function"==typeof(null==(t=null==(t=null==(t=this.weblog)?void 0:t.Utils)?void 0:t.yoda)?void 0:t.getWebviewLoadPerf)&&null!=(t=this.weblog)&&t.Utils.yoda.getWebviewLoadPerf().then((function(t){null!=t&&t.sampleData&&n.updateYodaSampleRate(t.sampleData)}))):this.sampleData={isHit:this.samplingControl(this.sampling),core:this.sampling}},t.prototype.updateYodaSampleRate=function(t){var e=this,n=null;try{var o=t;n="string"==typeof o?JSON.parse(o):o}catch(t){return void Pe("error: ",t)}n&&Object.keys(n).forEach((function(t){"load"===t?e.sampleData.core=n[t]:"did_rate"===t?e.didRate=n[t]:e.sampleData[t]=n[t]}))},t.prototype.updateUrlPackage=function(){var t;null!=(t=this.weblog)&&t.currentUrlPackage&&(this.currentUrlPackage=this.weblog.currentUrlPackage,this.referUrlPackage=this.weblog.referUrlPackage)},t.prototype.setDimensions=function(t){var e=this,n=Object.keys(t);n.some((function(t){return-1===gn.indexOf(t)}))&&Le("113","".concat(n.join("、"))),n.forEach((function(n){null==t[n]?delete e.customDimension[n]:e.customDimension[n]=t[n]}))},t.prototype.setCommonDimension=function(t,e,n){this.commonDimension[t]=(n=void 0===n||n)||null==(n=this.commonDimension[t])?e:n},t.prototype.decorateLog=function(t){this.currentUrlPackage||this.updateUrlPackage(),0<Object.keys(this.customDimension).length&&Object.assign(t.dimension,this.customDimension),0<Object.keys(this.commonDimension).length&&Object.assign(t.dimension,this.commonDimension),this.currentUrlPackage&&this.currentUrlPackage.page!==(null==(t=null==(t=this.weblog)?void 0:t.currentUrlPackage)?void 0:t.page)&&(this.flush(),this.updateUrlPackage())},t.prototype.samplingControl=function(t){return null!==t&&"number"==typeof t&&this.randomSampling<t},t.prototype.getCommonData=function(){var t,e=null==(e=null==(e=null==(e=this.weblog)?void 0:e.commonPackage)?void 0:e.app_package)?void 0:e.version_name;e={h5_extra_attr:JSON.stringify(dn(dn({},null==(t=null==(t=this.weblog)?void 0:t.commonPackage)?void 0:t.getH5ExtraAttr()),{app_version_name:e,url:location.href,hash:location.hash,online:null===navigator||void 0===navigator?void 0:navigator.onLine,downlink:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.downlink,rtt:null==(t=null===navigator||void 0===navigator?void 0:navigator.connection)?void 0:t.rtt})),url_package:this.currentUrlPackage&&this.currentUrlPackage.toJSON(),refer_url_package:this.referUrlPackage&&this.referUrlPackage.toJSON(),app_version_name:e,project_id:null==(t=this.config)?void 0:t.projectId};return"1"===nn("radar_report_test")&&(e.is_report_test=!0),e},t.prototype.reportByHttp=function(){var t=this.getCommonData(),e=(t={project_id:this.config.projectId,radar_session_id:this.radarSessionId,h5_extra_attr:t.h5_extra_attr},this.logQueue.filter((function(t){return"load"===t.key}))),n=this.logQueue.filter((function(t){return"load"!==t.key}));Array.isArray(e)&&e.length&&this.collectLog(t,e,"radarSDK"),Array.isArray(n)&&n.length&&this.collectLog(t,n,"radarSDKSupplement")},t.prototype.collectLog=function(t,e,n){var o;"function"!=typeof(null==(o=this.weblog)?void 0:o.collect)&&"function"!=typeof(null==(o=this.weblog)?void 0:o.sendByHttp)?Le("114"):(this.weblog.sendByHttp||this.weblog.collect).call(this.weblog,"RADAR",{name:"radar_log",params:dn(dn({},t),{data:hn([],fn(e),!1)}),serviceName:n})},t.prototype.reportByBridge=function(){var t=null==(n=null==(n=this.weblog)?void 0:n.Utils)?void 0:n.yoda;if(!t)return!1;var e,n=this.logQueue.filter((function(t){return"load"===t.key})),o=this.logQueue.filter((function(t){return"load"!==t.key}));try{return n.forEach((function(e){"function"==typeof(null==(e=t.sendSummarizedLog({key:"h5_load",data:e}))?void 0:e.catch)&&e.catch((function(t){Le("123",t)}))})),o.length&&"function"==typeof(null==(e=t.sendRadarLog({data:o}))?void 0:e.catch)&&e.catch((function(t){Le("124",t)})),!0}catch(e){return!1}},t}(),vn=function(t,e){return(vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},yn=function(){return(yn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function _n(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}var wn={redirect:{end:"redirectEnd",start:"redirectStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(t,e){return e.redirectCount}},ssl:{custom:function(t,e){return e.connectEnd&&e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:null}},ssl_start:{custom:function(t,e){return e.secureConnectionStart&&e.navigationStart?e.secureConnectionStart-e.navigationStart:null}},ttfb:{end:"responseStart",start:"requestStart"},request_start:{end:"requestStart",start:"navigationStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domInteractive"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=performance.getEntries().filter((function(t){return"first-paint"===t.name}))[0];return t?Math.ceil(t.startTime+t.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=function(){var t,e="undefined"!=typeof window?window.performance:null;return e&&e.timing?"function"==typeof e.timing.toJSON?((t=e.timing.toJSON())&&!t.redirectStart&&(t.redirectStart=t.navigationStart),t):e.timing:null}(),e=performance.getEntries(),n=performance.getEntries().filter((function(t){return"navigation"===t.initiatorType}))[0];e=e.filter((function(t){return"script"===t.initiatorType}))[0],n=n?n.domComplete:t.domComplete-t.navigationStart;return e&&n?n-e.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(t,e){return e.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document&&void 0!==document.all?document.all.length:null}}},Sn={main_api:{end:"apiEnd",start:"apiStart",notCatchIfUndefined:!0},main_api_offset:{end:"apiStart",start:"responseEnd",notCatchIfUndefined:!0},fmp:{end:"fmp_time",start:"navigationStart",notCatchIfUndefined:!0}},bn={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connectStart",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",connect_end_time:"connectEnd",load_event_end:"loadEventEnd",dom_complete:"domComplete",dom_content_loaded_event_start:"domContentLoadedEventStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",radar_init_time:"radar_init_time",fmp_time:"fmp_time"};function kn(t,e){if(!Array.isArray(e))return-1;var n=-1;return e.forEach((function(e,o){new RegExp(e).test(t)&&(n=o)})),n}var En=function(t){function e(e){var n=this;return(n=t.call(this,{core:null==e?void 0:e.core,key:be.LOAD,version:"1.2.5",name:"RadarNavigationCollect"})||this).hasFMP=!1,n.syncMetricNum=0,n.customKeys=[],n.custom_metric={},n.optionsMainAPI=[],n.mainAPIList=[],n.radarMainApiList=[],n.mainJSList=[],n.radarMainJSList=[],n.radarTiming={radar_init_time:void 0,fmp_time:void 0,fmp:void 0,apiStart:void 0,apiEnd:void 0},n.h5Load=function(){var t=n.getPerformanceData();n.collect(yn({event_name:"h5_load"},t))},n.dealAPI=function(t){return n.cacheAndCalculateMainAPI(t),n.addMainApiResult(t),n.mainAPIList.filter((function(t){return!!t.url})).length!==n.mainAPIList.length||void 0===n.radarTiming.fmp},n.addMainJSResult=function(t){if(!n.mainJSList||0===n.mainJSList.length)return!1;var e,o,r,i,a,s,c,u,l,p,d,f,h,g,m,v=kn((t.file||"").replace(/\?.+$/,""),n.mainJSList);return-1<v&&!n.radarMainJSList[v].file&&(e=t.file,o=t.cached,r=t.size,i=t.failed,a=t.res_type,s=t.protocol,c=t.fb,u=t.dns,l=t.tcp,p=t.ssl,d=t.ttfb,f=t.trans,h=t.total,g=t.fetch_start,m=t.duration,t=t.start_time,n.radarMainJSList[v]={file:e,cached:o,size:r,failed:i,res_type:a,protocol:s,fb:c,dns:u,tcp:l,ssl:p,ttfb:d,trans:f,total:h,fetch_start:g,duration:m,start_time:t,reg:n.mainJSList[v]}),n.radarMainJSList.filter((function(t){return!!t.file})).length!==n.mainJSList.length},e.core||pn("212"),"string"==typeof e.mainApi?(n.optionsMainAPI.push(e.mainApi),n.mainAPIList.push({}),n.radarMainApiList.push({})):Array.isArray(e.mainApi)&&(3<e.mainApi.length&&Te("207"),n.optionsMainAPI=e.mainApi.slice(0,3),n.optionsMainAPI.forEach((function(){n.mainAPIList.push({}),n.radarMainApiList.push({})}))),"string"==typeof e.mainJs?(n.mainJSList.push(e.mainJs),n.radarMainJSList.push({})):Array.isArray(e.mainJs)&&(3<e.mainJs.length&&Te("211"),n.mainJSList=e.mainJs.slice(0,3),n.mainJSList.forEach((function(){return n.radarMainJSList.push({})}))),performance.timing?n.init():(null!=(e=n.core)&&e.collect("event",{name:"radar_error",message:"performance.timing 不存在无法收集数据",category:be.LOAD}),Le("208")),n}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return vn(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e.prototype.init=function(){this.radarTiming.radar_init_time=Date.now();var t,e=this.getPerformanceData();this.collect(yn({event_name:"radar_init"},e)),null!=(t=null==(e=this.core)?void 0:e.setCommonDimension)&&t.call(e,"happen_stage","during_fmp"),0<performance.timing.loadEventStart?this.h5Load():ze(window,"load",this.h5Load)},e.prototype.customStage=function(t,e){var n,o;void 0===e&&(e={sendTimeline:!0}),this.isHit?(void 0!==t&&"string"==typeof t&&""!==t||pn("206"),this.isValidTimestamp(e.timestamp,"custom_stage "+t)&&(n=e.timestamp||Date.now(),o=this.customKeys.length-this.syncMetricNum,this.customKeys.includes(t)?Le("204",t):e.sendTimeline&&2<this.syncMetricNum||!e.sendTimeline&&5<o?Le("205",t):n&&(this.custom_metric[t+"_time"]=n,this.customKeys.push(t),!e||!0!==e.sendTimeline&&null!=e.sendTimeline||(o=this.getPerformanceData(),this.collect(yn(yn({},o),{stack:(new Error).stack,event_name:"h5_custom_metric",custom_metric_name:t,custom_metric_timestamp:n})),this.syncMetricNum++)))):Le("200")},e.prototype.isValidTimestamp=function(t,e){var n;if(void 0===e&&(e="fmp"),void 0!==t&&"number"!=typeof t)pn("201");else if(void 0!==t&&t<performance.timing.navigationStart)return Te("210","".concat(e)),null!=(n=this.core)&&n.collect("event",{name:"radar_error",message:"【210】".concat(e),extra_info:{timestamp:t,navigationStart:performance.timing.navigationStart}}),!1;return!0},e.prototype.fmp=function(t){var e,n;this.isHit?this.isValidTimestamp(t)&&(t=t||Date.now(),this.hasFMP?Te("202"):t&&performance.timing&&(null!=(n=null==(e=this.core)?void 0:e.setCommonDimension)&&n.call(e,"happen_stage","after_fmp"),this.hasFMP=!0,this.radarTiming.fmp_time=t,performance.timing.radarFmp=t,n=this.getPerformanceData(),performance.timing.fmp=this.radarTiming.fmp=n.fmp,this.collect(yn({event_name:"fmp",stack:(new Error).stack},n)))):Te("200")},e.prototype.getPerformanceData=function(){var t=yn(yn({},cn(performance.timing)),this.radarTiming),e=Ke(yn(yn({},wn),Sn),t);return Object.keys(bn).forEach((function(n){0<=t[bn[n]]&&(e[n]=t[bn[n]])})),["radar_main_js_start","lcp","cls","fid","fcp"].forEach((function(t){var n=window.__RADAR_PERFORMANCE_TIMING_&&window.__RADAR_PERFORMANCE_TIMING_[t];!n&&0!==n||(e[t]=n)})),e},e.prototype.cacheAndCalculateMainAPI=function(t){var e;void 0===this.radarTiming.fmp&&(t.before_hook_time&&(e=this.radarTiming.apiStart,this.radarTiming.apiStart=e?Math.min(e,t.before_hook_time):t.before_hook_time),t.after_hook_time&&(e=this.radarTiming.apiEnd,this.radarTiming.apiEnd=e?Math.max(e,t.after_hook_time):t.after_hook_time))},e.prototype.addMainApiResult=function(t){var e,n,o,r,i,a,s,c,u,l,p,d,f,h,g,m,v,y,_=kn((t.api||"").replace(/\?.+$/,""),this.optionsMainAPI);-1<_&&(null==(y=this.mainAPIList[_])||!y.url)&&(y=t.api,e=t.status,n=t.size,o=t.cached,r=t.method,c=t.perfTime,i=t.protocol,a=t.custom_failed,s=t.res_type,v=_n(t,["api","status","size","cached","method","perfTime","protocol","custom_failed","res_type"]),this.mainAPIList[_]=yn({url:y,status:e,size_radar:n,cached:o,method:r,perfTime:c,protocol:i,res_type:s,custom_failed:a},v),c=v.fb,u=v.dns,l=v.tcp,p=v.ssl,d=v.ttfb,f=v.trans,h=v.total,g=v.fetch_start,m=v.duration,v=v.start_time,this.radarMainApiList[_]={api:y,status:e,size:n,cached:o,method:r,protocol:i,fb:c,dns:u,tcp:l,ssl:p,ttfb:d,trans:f,total:h,fetch_start:g,duration:m,custom_failed:a,res_type:s,reg:this.optionsMainAPI[_],start_time:v},this.radarTiming.fmp_time&&t.after_hook_time&&t.after_hook_time<this.radarTiming.fmp_time&&(y=this.getPerformanceData(),this.collect(yn({event_name:"main_api"},y))))},e.prototype.destroy=function(){Qe(window,"load",this.h5Load),this.customStage=this.fmp=function(){Te("213")}},e.prototype.collect=function(t){var e=t.protocol,n=t.event_name,o=(t.custom_metric,t.custom_metric_name),r=t.stack;t.main_api_list,t=_n(t,["protocol","event_name","custom_metric","custom_metric_name","stack","main_api_list"]),this.baseCollect({value:t,dimension:{protocol:e,event_name:n,custom_metric_name:o,custom_metric:JSON.stringify(this.custom_metric),main_api_list:this.mainAPIList,radar_main_api_list:this.radarMainApiList,radar_main_js_list:this.radarMainJSList,is_official:1,stack:r}}),null!=(t=this.core)&&t.flush()},e}(Ae),On=function(t,e){return(On=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Pn=function(){return(Pn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Tn(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}var Ln=Me,Cn={navigation_start:"startTime",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function An(t,e){if(t)return"function"==typeof t.get?t.get(e):t[e.toLowerCase()]}function In(t){var e="";if("string"==typeof t)e=t;else try{e=JSON.stringify(t)}catch(n){e=String(t)}for(var n=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);n+=r<128?1:r<2048?2:r<65536?3:r<1<<21?4:r<1<<26?5:r<1<<31?6:Number.NaN}return n}function Nn(t){var e=(n=document.location).protocol,n=n.host;return 0===t.indexOf("//")?e+t:0===t.indexOf("/")?"".concat(e,"//").concat(n).concat(t):t}function Rn(t){return t?"function"==typeof t.get?t.get("Content-Type"):t["content-type"]:null}var Un=function(t){function n(e){var n=t.call(this,{core:null==(e=void 0===e?{}:e)?void 0:e.core,sampling:null==e?void 0:e.sampling,key:be.API,version:"1.2.5",name:"RadarAPICollect"})||this;return n.ignoreList=Ie,n.queue=[],n.logList=[],n.perfList=[],n.broadcastApi=en(),n.initiatorTypeList=[],n.beforeHook=function(t){var e;0===(null==(e=t.url)?void 0:e.indexOf("data:"))||Ge(t.url,n.ignoreList)||Ge(t.url,(null==(e=n.core)?void 0:e.ignoreList)||[])||"js"===Ve(t.url)||"css"===Ve(t.url)||(e={api:Nn(t.url),method:t.method,request:t,startTime:Date.now()},n.queue.push(e))},n.afterHook=function(t,e){var o=n.queue.find((function(e){return e.request===t}));if(o){delete o.request;var r=o.startTime,i=(o=Tn(o,["startTime"]),Date.now()),a=i-r,s=e.status;if("function"==typeof n.customizeRadarStatus)try{s=n.customizeRadarStatus(e)}catch(e){}var c=n.customHook({request:t,response:e,duration:a}),u=+An(e.headers,"Content-Length")||0,l=function(t){function e(){t=t.replace(/^\s*/,"")}function n(n){return e(),t[0]===n&&(t=t.slice(1),1)}function o(){e();var n=/^([^\s,;=\\]+)(.*)/.exec(t);if(n)return t=n[2],n[1]}if(t&&"string"==typeof t){for(var r,i=[];r=o();){for(var a={name:r},s={};n(";");){var c,u,l=void 0;(l=o())&&(c=void 0,n("=")&&(c=function(){if(e(),'"'!==t[0])return o();t=t.slice(1);for(var n="";t.length;){var r=/^([^"\\]*)(.*)/.exec(t);if(r){if(n+=r[1],'"'===r[2][0])return t=r[2].slice(1),n;n+=r[2][1],t=r[2].slice(2)}}}(),u=void 0,(u=/([,;].*)/.exec(t))&&(t=u[1])),s[u=l.toLowerCase()]||(s[u]=1,"dur"===u?a.duration=parseFloat(c)||0:"desc"===u?a.description=c||"":a[l]=c))}if("sec"===a.unit&&a.duration&&(a.duration*=1e3),delete a.unit,i.push(a),!n(","))break}return i.length?i:void 0}}(An(e.headers,"Server-Timing"));a=Pn(Pn(Pn({duration:a,logTime:Date.now(),status:s,size:+u,content_type:Rn(e.headers),custom_failed:!(200<=s&&s<300)},o),c),{before_hook_time:r,after_hook_time:i,trace_id:t.trace_id,server_timing:l});2===(null==(s=null==(u=An(e.headers,"Intercept-Result"))?void 0:u.split(";"))?void 0:s.length)&&null!=(o=n.core)&&o.setCommonDimension&&(n.core.setCommonDimension("intercept_result",s[0],!1),n.core.setCommonDimension("intercept_result_code",s[1],!1),a.api_intercept_result=s[0],a.api_intercept_result_code=s[1]),e.finalUrl&&(a.api=e.finalUrl),"string"==typeof e.text&&(a.responseData=e.text),0!==Pn(Pn({},e),{status:a.status}).status||c.intercept_report?n.mergeAPIPerf(void 0,a)||n.logList.push(a):(a.size&&0!=a.size||!a.responseData||(a.size=In(a.responseData)),delete a.responseData,delete a.server_timing,n.collect(a)),n.queue=n.queue.filter((function(e){return e.request&&e.request!==t}))}},void 0!==(n.option=e)&&null!=e&&e.core||pn("310"),void 0!==e.ignoreList&&(Array.isArray(e.ignoreList)||pn("309"),e.ignoreList.forEach((function(t){"string"!=typeof t&&pn("309")})),n.ignoreList=n.ignoreList.concat(e.ignoreList)),n.APIHook=e.APIHook,n.customizeRadarStatus=e.customizeRadarStatus,n.init(),n}var o=n,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=o}return On(o,r),o.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i),n.prototype.init=function(){var t,n=this;try{this.observer=new PerformanceObserver((function(t){return n.observeAPI(t)})),this.observer.observe({entryTypes:["resource"]}),this.initiatorTypeList=[],!0!==this.option.ignoreXHR&&(this.initiatorTypeList.push("xmlhttprequest"),this.unhookXML=function(t,n){var o=window.XMLHttpRequest;return o?(window.XMLHttpRequest=function(){var r,i,a,s=new o,c=(s._radarRequest={},s._radarResponse={},Xe()),u=(s._radarRequest.id=c,{});return s.addEventListener("readystatechange",(function(){if(4===s.readyState&&"function"==typeof n){s._radarResponse.status=s.status,s._radarResponse.statusText=s.statusText;var t,o,r,i,a,c=function(t,n){switch(null==n&&(n={}),e(t)){case"object":var o,r=[];for(o in t){var i=t[o],a=o.toLowerCase();r.push("".concat(a,":\t").concat(i))}return r.join("\n")+"\n";case"string":for(var s=0,c=(r=t.split("\n")).length;s<c;s++){var u=r[s];/([^:]+):\s*(.+)/.test(u)&&(u=null!=(u=RegExp.$1)?u.toLowerCase():void 0,i=RegExp.$2,u&&null==n[u]&&(n[u]=i))}return n}}(s.getAllResponseHeaders());for(t in c)r=c[t],s._radarResponse&&s._radarResponse.headers&&!s._radarResponse.headers[t]&&(o=t.toLowerCase(),s._radarResponse.headers[o]=r);if(s.responseType&&"text"!==s.responseType)"document"===s.responseType?(s._radarResponse.xml=s.responseXML,s._radarResponse.data=s.responseXML):s._radarResponse.data=s.response;else{s._radarResponse.text=s.responseText,s._radarResponse.data=s.responseText;try{s._radarResponse.xml=s.responseXML}catch(t){}}"responseURL"in s&&(s._radarResponse.finalUrl=s.responseURL);try{var l=null!=(i=u["ktrace-str"])?i:"";l&&window.parseWedTraceId&&(s._radarRequest.trace_id=window.parseWedTraceId(null!=(a=l.split("|")[1])?a:""))}catch(t){Te("traceId 解析异常")}n(s._radarRequest,s._radarResponse)}})),"function"==typeof s.setRequestHeader&&(r=s.setRequestHeader,s.setRequestHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ye.includes(t[0])&&(u[t[0]]=t[1]),r.apply(this,t)}),"function"==typeof s.open&&(i=s.open,s.open=function(t,e,n,o,r){var a=[].slice.call(arguments);return this._radarRequest=ve({method:t,url:e,async:n,user:o,pass:r},this._radarRequest),this._radarResponse.headers={},i.apply(this,a)}),"function"==typeof s.send&&(a=s.send,s.send=function(){var e=[].slice.call(arguments);return"function"==typeof t&&(this._radarRequest._config=e[0],t(this._radarRequest)),a.apply(this,e)}),s},["DONE","HEADERS_RECEIVED","LOADING","OPENED","UNSENT"].forEach((function(t){window.XMLHttpRequest[t]=o[t]})),window.XMLHttpRequest.prototype=o.prototype,function(){o&&(window.XMLHttpRequest=o)}):(Le("118"),!1)}((function(t){return n.beforeHook(t)}),(function(t,e){return n.afterHook(t,e)}))),!0!==this.option.ignoreFetch&&(this.initiatorTypeList.push("fetch"),this.unhookFetch=function(t,e){var n=function(t){if("function"!=typeof t.fetch)return null;var e,n=t.fetch;return t.fetch=(e=t.fetch,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return tn.apply(void 0,Se([e],we(t),!1))}),{register:function(t){return $e.push(t),function(){var e=$e.indexOf(t);0<=e&&$e.splice(e,1)}},clear:function(){$e=[]},unRegister:function(){n&&(t.fetch=n)}}}("function"==typeof importScripts?self:window);return n&&n.register({request:function(e,n){"function"==typeof t&&t(e)},response:function(t,n){"function"==typeof e&&e(n,t)},responseError:function(t,n){"function"==typeof e&&e(n,{status:0,statusText:t})}}),null==n?void 0:n.unRegister}((function(t){return n.beforeHook(t)}),(function(t,e){return n.afterHook(t,e)})))}catch(e){Le("308"),null!=(t=this.core)&&t.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:be.API})}},n.prototype.customHook=function(t){var e={};if(void 0===this.APIHook)return e;if("function"!=typeof this.APIHook)return Te("300"),e;var n={};try{n=this.APIHook(t)}catch(t){return Te("301",t),{}}if(!n)return Te("302"),e;t=n.response_msg;var o=n.response_code,r=n.status,i=n.custom_failed,a=n.intercept_report;n=n.broadcast_info;if(!0===Boolean(a)&&(e.intercept_report=!0),void 0!==t)try{var s=JSON.stringify(t);100<s.length&&Te("307"),e.response_msg=s.slice(0,100)}catch(t){e.response_msg="response_msg返回结果异常",Te("303")}return void 0!==o&&(a=Number(o),isNaN(a)?Te("304"):e.response_code=a),void 0!==r&&(t=Number(r),isNaN(t)?Te("305"):e.status=t),void 0!==i&&(!0===i||!1===i?e.custom_failed=i:Te("306")),e.broadcast_info=n,e},n.prototype.observeAPI=function(t){var e=this;t.getEntriesByType("resource").forEach((function(t){var n,o,r;if(0===(null==(r=t.name)?void 0:r.indexOf("data:"))||Ge(t.name,e.ignoreList)||Ge(t.name,(null==(r=e.core)?void 0:r.ignoreList)||[]))return!1;"api"===Je(t)&&((r=Ke(Ln,t)).perfTime=Date.now(),null!=(n=null==(n=t.serverTiming)?void 0:n.map((function(t){return{name:t.name,duration:t.duration,description:t.description||void 0}})))&&n.length||(n=void 0),o={encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},Object.keys(Cn).forEach((function(e){o[e]=Number(t[Cn[e]]+performance.timing.navigationStart)})),r=Pn(Pn(Pn(Pn({},r),{api:r.file}),o),{server_timing:n}),e.mergeAPIPerf(r)||e.perfList.push(r))}))},n.prototype.destroy=function(){this.unhookXML&&this.unhookXML(),this.unhookFetch&&this.unhookFetch(),this.observer&&this.observer.disconnect()},n.prototype.mergeAPIPerf=function(t,e){if(t?e=this.takeItem(t,this.logList):e&&(t=this.takeItem(e,this.perfList)),!t||!e)return!1;if(!0===e.intercept_report)return!0;var n,o=Object.assign({},e,t,{size:t.size||e.size});return delete o.file,o.size&&0!=o.size||!o.responseData||(o.size=In(o.responseData)),delete o.responseData,(e=e.server_timing||t.server_timing)&&(n=null,e.map((function(t){"total-timing"===t.name&&(n=null!=(t=t.duration)?t:null)})),o.total_server_timing=n,o.server_data_list=JSON.stringify(e)),delete o.server_timing,this.collect(o),!0},n.prototype.takeItem=function(t,e){var n,o=(t.api||"").replace(/\?.+$/,"");if(-1!==(t=e.findIndex((function(t){return t=(t.api||"").replace(/\?.+$/,""),o===t}))))return n=e[t],e.splice(t,1),n},n.prototype.collect=function(t){var e=this,n=t.res_type,o=t.protocol,r=t.api,i=t.custom_failed,a=t.status,s=t.cached,c=t.method,u=t.response_code,l=t.response_msg,p=(t.has_fmp,t.server_data_list),d=t.content_type,f=t.broadcast_info,h=t.before_hook_time,g=t.after_hook_time,m=t.api_intercept_result,v=t.api_intercept_result_code,y={dimension:{before_hook_time:h,after_hook_time:g,res_type:n,protocol:o,api:r,custom_failed:i,status:a,cached:s,method:c,response_code:u,response_msg:l,content_type:d,broadcast_info:f,is_official:1,server_data_list:p,trace_id:t.trace_id,api_intercept_result:m,api_intercept_result_code:v,has_timing_allow:t.has_timing_allow},value:Tn(t,["res_type","protocol","api","custom_failed","status","cached","method","response_code","response_msg","has_fmp","server_data_list","content_type","broadcast_info","before_hook_time","after_hook_time","api_intercept_result","api_intercept_result_code","trace_id","has_timing_allow"])};this.broadcastApi.emit(cn(t)),0===a&&Be(this.option.isIgnoreInvalidStatusCode)?new Promise((function(n,o){var r,i;e.option.isIgnoreInvalidStatusCode&&(function(t){return t&&Be(t.then)&&Be(t.catch)}(r=e.option.isIgnoreInvalidStatusCode(t))?(i=setTimeout((function(){return n(!1)}),2e3),r.then((function(t){clearTimeout(i),n(!0===t)}),o)):n(!0===r))})).then((function(t){t?Te("异步拦截日志"):e.baseCollect(y)}),(function(t){e.baseCollect(y),Le(t)})):this.baseCollect(y)},n}(Ae),xn=function(t,e){return(xn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Dn=function(){return(Dn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},jn=Object.assign({},Me,{duration:{end:"responseEnd",start:"fetchStart"},cached_type:{custom:function(t,e){var n="hit_browser";if(0===e.transferSize||0===e.duration)return n;if(null==e.transferSize&&(0===e.domainLookupStart||e.responseStart===e.fetchStart))return n;if(e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name}))){if(e.serverTiming.some((function(t){return"miss"===t.name})))return"miss_cdn";if(e.serverTiming.some((function(t){return"hit"===t.name})))return"hit_cdn"}return"miss_browser"},crossOriginSkip:!0},cdn_duration:{custom:function(t,e){return e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name}))?null==(e=null==(e=e.serverTiming)?void 0:e.find((function(t){return"total-timing"===t.name})))?void 0:e.duration:null},crossOriginSkip:!0,cachedSkip:!0},cdn_ip:{custom:function(t,e){if(e.serverTiming&&e.serverTiming.some((function(t){return"cdn"===t.name})))return null==(e=e.serverTiming.find((function(t){return"miss"===t.name||"hit"===t.name})))?void 0:e.description},crossOriginSkip:!0,cachedSkip:!0}}),Mn={fetch_start_time:"fetchStart",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"};function Hn(t){return Array.isArray(t)?t.map((function(t){var e=void 0===(e=t.tagName)?"":e,n=t.id;return t=t.getAttribute?t.getAttribute("class"):t.className||"",e=e.toLowerCase(),n&&(e+="#".concat(n)),t&&(e+=t.split(/\s+/g).map((function(t){return".".concat(t)})).join("")),e})).filter((function(t){return t})).join(","):""}var Gn,Vn,Fn,Bn,Wn=function(t){function e(e){var n,o=this;return(o=t.call(this,{core:null==e?void 0:e.core,sampling:null!=(n=null==e?void 0:e.sampling)?n:.1,version:"1.2.5",key:be.RES,name:"RadarResourceCollect"})||this).ignoreList=Ie,o.broadcastJs=en(),o.onResError=function(t,e){var n;(function(t){return t.message||null!=t.lineno})(t)||(n=(t.target.src||t.target.href||"").toString(),n={failed:!0,file:n="function"!=typeof t.target.getAttribute||""!==t.target.getAttribute("src")&&""!==t.target.getAttribute("href")?n:"",res_path:Hn(t&&t.path||t&&t.composedPath&&t.composedPath())},o.collect(n,e),o.broadcastJs.emit(n))},o.observeResource=function(t){t.getEntriesByType("resource").forEach((function(t){var e,n,r;if(0===t.name.indexOf("data:")||Ge(t.name,o.ignoreList)||Ge(t.name,(null==(e=o.core)?void 0:e.ignoreList)||[]))return!1;"resource"===Je(t)&&(e=Ke(jn,t),n={encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},Object.keys(Mn).forEach((function(e){n[e]=Number(t[Mn[e]]+performance.timing.navigationStart)})),r=Dn(Dn({failed:!1},e),n),o.collect(r),setTimeout((function(){o.broadcastJs.emit(r)})))}))},o.resourceHook=e.resourceHook,void 0!==e.ignoreList&&(Array.isArray(e.ignoreList)||pn("802"),e.ignoreList.forEach((function(t){"string"!=typeof t&&pn("802")})),o.ignoreList=o.ignoreList.concat(e.ignoreList)),o.init(),o}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return xn(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e.prototype.init=function(){var t,e=this;try{this.observeResource(performance),this.observer=new PerformanceObserver((function(t){return e.observeResource(t)})),this.observer.observe({entryTypes:["resource"]})}catch(e){Le("801"),null!=(t=this.core)&&t.collect("event",{name:"radar_error",message:"PerformanceObserver 不存在无法收集数据",category:be.RES})}ze(window,"error",(function(t){return e.onResError(t)}),!0),this.parseSeedLog()},e.prototype.parseSeedLog=function(){var t=this,e=an(De,[]);e.length&&(e.map((function(e){var n=e.data;e=e.dimension||{},t.onResError(n,e)})),sn(De,[]))},e.prototype.collect=function(t,e){var n=t.cached,o=t.failed,r=t.file,i=t.protocol,a=t.res_type,s=t.res_path,c=t.cached_type,u=t.cdn_ip,l=t.has_timing_allow;t=function(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}(t,["cached","failed","file","protocol","res_type","res_path","cached_type","cdn_ip","has_timing_allow"]);try{var p=this.resourceHook&&this.resourceHook({file:r,cached:n,protocol:i,res_type:a,failed:o});if(null!=p&&p.intercept_report)return}catch(t){Le("803",t)}this.baseCollect({value:t,dimension:Dn({cached:n,failed:o,file:r,protocol:i,res_type:a,res_path:s,sample_rate:this.sampling,is_official:1,cached_type:c,cdn_ip:u,has_timing_allow:l},e)})},e.prototype.destroy=function(){this.isHit&&(Qe(window,"error",this.onResError,!0),this.observer&&this.observer.disconnect())},e}(Ae),Jn=function(t,e){return(Jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},Kn=function(){return"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)},qn=function(t){return{name:t,value:1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,delta:0,entries:[],id:Kn(),isFinal:!1}},zn=function(t,e){try{var n;if(PerformanceObserver.supportedEntryTypes.includes(t))return(n=new PerformanceObserver((function(t){return t.getEntries().map(e)}))).observe({type:t,buffered:!0}),n}catch(t){}},Qn=!1,Yn=!1,Xn=function(t){Qn=!t.persisted},$n=function(){addEventListener("pagehide",Xn),addEventListener("beforeunload",(function(){}))},Zn=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Yn||($n(),Yn=!0),addEventListener("visibilitychange",(function(e){e=e.timeStamp,"hidden"===document.visibilityState&&t({timeStamp:e,isUnloading:Qn})}),{capture:!0,once:e})},to=function(t,e,n,o){var r;return function(){n&&e.isFinal&&n.disconnect(),0<=e.value&&(o||e.isFinal||"hidden"===document.visibilityState)&&(e.delta=e.value-(r||0),(e.delta||e.isFinal||void 0===r)&&(t(e),r=e.value))}},eo=function(){return void 0===Gn&&(Gn="hidden"===document.visibilityState?0:1/0,Zn((function(t){return t=t.timeStamp,Gn=t}),!0)),{get timeStamp(){return Gn}}},no=function(){return Vn=Vn||new Promise((function(t){return["scroll","keydown","pointerdown"].map((function(e){addEventListener(e,t,{once:!0,passive:!0,capture:!0})}))}))},oo=[{name:"fid",collectFn:function(t){function e(t){t.startTime<o.timeStamp&&(n.value=t.processingStart-t.startTime,n.entries.push(t),n.isFinal=!0,i())}var n=qn("FID"),o=eo(),r=zn("first-input",e),i=to(t,n,r);r?Zn((function(){r.takeRecords().map(e),r.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(t,e){e.timeStamp<o.timeStamp&&(n.value=t,n.isFinal=!0,n.entries=[{entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t}],i())}))}},{name:"lcp",collectFn:function(t){function e(t){var e=t.startTime;e<i.timeStamp?(r.value=e,r.entries.push(t)):r.isFinal=!0,n()}var n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=qn("LCP"),i=eo(),a=zn("largest-contentful-paint",e);a&&(n=to(t,r,a,o),o=function(){r.isFinal||(a.takeRecords().map(e),r.isFinal=!0,n())},no().then(o),Zn(o,!0))}},{name:"cls",collectFn:function(t){function e(t){t.hadRecentInput||(r.value+=t.value,r.entries.push(t),n())}var n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=qn("CLS",0),i=zn("layout-shift",e);i&&(n=to(t,r,i,o),Zn((function(t){t=t.isUnloading,i.takeRecords().map(e),t&&(r.isFinal=!0),n()})))}},{name:"fcp",collectFn:function(t){var e,n=qn("FCP"),o=eo(),r=zn("paint",(function(t){"first-contentful-paint"===t.name&&t.startTime<o.timeStamp&&(n.value=t.startTime,n.isFinal=!0,n.entries.push(t),e())}));r&&(e=to(t,n,r))}}],ro=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,version:"1.2.5",key:be.EVENT,name:"RadarChromeMetricsCollect"})||this;return n.options={lcp:!1,cls:!1,fid:!1,fcp:!1},n.init=function(){var t=n.options;oo.forEach((function(e){var o=e.name;t&&!t[o]||e.collectFn((function(t){var e=t.name;t=t.value,function(t,e){null!==window&&void 0!==window&&window.__RADAR_PERFORMANCE_TIMING_||(window.__RADAR_PERFORMANCE_TIMING_={}),window.__RADAR_PERFORMANCE_TIMING_[t]=e}(e.toLocaleLowerCase(),Number(t)),n.baseCollect({dimension:{name:e.toLocaleLowerCase(),is_official:1},value:{duration:Number(t)}})}))}))},Object.assign(n.options,e.options),oo.forEach((function(t){var e=nn("radar_"+t.name);e&&(n.options[t.name]="1"===e)})),n.init(),n}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return Jn(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e}(Ae),io=function(t,e){return(io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},ao=function(){return(ao=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},so=function(t){function n(e){var n=t.call(this,{core:e.core,sampling:e.sampling,key:be.EVENT,version:"1.2.5",name:"RadarEventCollect"})||this;return n.action={start:function(t){n._checkActionDimension(t),n.event({name:t.name,extra_info:t.extra_info,event_type:"radar_action_start"})},end:function(t){n._checkActionDimension(t),n.event({name:t.name,extra_info:t.extra_info,result_type:t.result_type,event_type:"radar_action_end"})}},n.parseSeedLog(),n}var o=n,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=o}return io(o,r),o.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i),n.prototype.parseSeedLog=function(){var t=this,e=an(je,[]);e.length&&(e.map((function(e){var n=e.dimension;e=e.value,t.event(n,e)})),sn(je,[]))},n.prototype.event=function(t,n){var o;this.isHit?(t||pn("402"),void 0!==t.name&&"string"==typeof t.name||pn("402"),127<t.name.length&&(Le("403"),t.name=t.name.slice(0,127)),t.is_official=1,n&&void 0!==n.duration&&("number"!=typeof n.duration||n.duration<0)&&pn("404"),n&&void 0!==n.event_count&&("number"!=typeof n.event_count||n.event_count<0)&&pn("405，".concat(n.event_count)),o={dimension:t,value:n},t&&t.extra_info&&"object"==e(t.extra_info)&&(o={dimension:ao(ao({},t),{extra_info:JSON.stringify(t.extra_info)}),value:n}),this.baseCollect(o)):Te("401")},n.prototype.destroy=function(){this.event=function(){Te("407")},this.action={start:function(){Te("407")},end:function(){Te("407")}}},n.prototype._checkActionDimension=function(t){if(!t)throw Error("408");void 0===t.extra_info||t.extra_info instanceof Object||pn("406")},n}(Ae),co=function(t,e){return(co=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},uo=function(){return(uo=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function lo(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}(Bn=Fn=Fn||{}).SCRIPT="script",Bn.RES="res",Bn.API="api",Bn.VIDEO="video";var po=[];function fo(t,n,o){var r,i;if(n&&(n instanceof Error||"object"==e(n)&&"string"==typeof n.message)){if("BridgeError"===(r=n.name||"ErrorLikeObject")&&"function"==typeof n.toJSON)try{var a=n.toJSON();delete a.name,delete a.message,i="".concat(n.message," (").concat(JSON.stringify(a),")")}catch(t){i=n.message||""}else i=n.message||"";a=n.stack||void 0}else i=null==n&&"Script error."===(null==o?void 0:o.message)?(r="CrossOriginError","".concat(t," - message: ").concat((null==o?void 0:o.message)||"<UNKNOWN>")):null===n&&null!=o&&o.message&&"Uncaught null"!==o.message?(r="Error","".concat(t," - message: ").concat(o.message)):(r=null==n?"".concat(n):e(n),o=function(t){var n;try{n=t.toString(),t&&"object"==e(t)&&(n=JSON.stringify(t))}catch(t){}return"string"!=typeof n||""===n?n=null===t?"<NULL>":void 0===t?"<UNDEFINED>":""===n?"<EMPTY>":"<UNKNOWN>":2e3<n.length&&(n=n.substring(0,2e3)+"<<< ……"),n}(n),"".concat(t," - value: ").concat(o));return{error_type:Fn.SCRIPT,error_cons_type:r,msg:i,stack:a}}function ho(t){for(var e=0;e<po.length;e++)if(go(po[e],t))return e;return-1}function go(t,e){return t.msg===e.msg&&t.stack===e.stack&&t.file===e.file&&t.line===e.line&&t.col===e.col}var mo=function(t){function e(e){var n=t.call(this,{core:e.core,sampling:e.sampling,key:be.ERROR,version:"1.2.5",name:"RadarErrorCollect"})||this;return n.onError=function(t,e){var o;!(o=t).message&&null==o.lineno||(t=uo(uo({},fo("Global Uncaught Exception",t.error,t)),{file:t.filename,line:t.lineno,col:t.colno}),n.isSameErrorAndReport(t,e))},n.onPromiseError=function(t,e){t=fo("Unhandled Promise Rejection",t.reason),n.isSameErrorAndReport(t,e)},n.core=e.core,n.init(),n}var n=e,o=t;if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=n}return co(n,o),n.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r),e.prototype.init=function(){po.splice(0),ze(window,"error",this.onError,!0),ze(window,"unhandledrejection",this.onPromiseError),this.parseSeedLog()},e.prototype.destroy=function(){Qe(window,"error",this.onError,!0),Qe(window,"unhandledrejection",this.onPromiseError),this.captureException=function(){Te("600")}},e.prototype.parseSeedLog=function(){var t=this,e=an(xe,[]);e.length&&(e.map((function(e){var n=e.data;e=e.dimension||{},"unhandledrejection"===(null==n?void 0:n.type)?t.onPromiseError(n,e):t.onError(n,e)})),sn(xe,[]))},e.prototype.isSameErrorAndReport=function(t,e){0<=ho(t)||(po.push(t),setTimeout((function(){po.splice(ho(t),1)}),2e3),this.collect(t,e))},e.prototype.collect=function(t,e){var n,o,r,i,a,s,c,u;o=(n=t).error_cons_type,r=n.file,i=n.error_type,a=n.msg,s=n.col,c=n.line,u=n.stack,t={key:"error",value:lo(n,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:o,file:r,error_type:i,msg:a,col:s,line:c,stack:u}},e=uo(uo({},t.dimension),e||{}),this.baseCollect({dimension:e,value:t.value})},e.prototype.captureException=function(t){this.isSameErrorAndReport(fo("Captured Exception",t))},e}(Ae),vo=function(){function t(t){var e,n=this;this.core=new mn({weblogger:t.weblog,projectId:t.projectId,sampling:null!=(e=t.sampling)?e:1,httpReportFirst:t.httpReportFirst,customDimensions:t.customDimensions}),this.navigationCollect=new En({core:this.core,mainApi:t.mainApi,mainJs:t.mainJs}),t.unuseAPIPlugin||(this.apiCollect=new Un({core:this.core,sampling:t.apiSampling,APIHook:t.APIHook,customizeRadarStatus:t.customizeRadarStatus,ignoreList:t.ignoreList,ignoreXHR:t.ignoreXHR,ignoreFetch:t.ignoreFetch,isIgnoreInvalidStatusCode:t.isIgnoreInvalidStatusCode}),this.apiCollect.broadcastApi.on((function(t){return n.navigationCollect.dealAPI(t)}))),t.unuseResourcePlugin||(this.resourceCollect=new Wn({sampling:t.resourceSampling,core:this.core,ignoreList:t.ignoreList,resourceHook:t.resourceHook}),this.resourceCollect.broadcastJs.on((function(t){return n.navigationCollect.addMainJSResult(t)}))),this.chromeMetricsCollect=new ro({core:this.core,options:{lcp:t.lcp,cls:t.cls,fid:t.fid,fcp:t.fcp}}),this.eventCollect=new so({core:this.core}),this.action=this.eventCollect.action,t.unuseErrorPlugin||(this.errorCollect=new mo({core:this.core})),Ne[Re]&&(Ne[Re].isCoreReady=!0)}return t.prototype.apply=function(t){this.bindWeblogger(t)},t.prototype.bindWeblogger=function(t){this.weblogger=t,this.core.bindWeblogger(this.weblogger)},t.prototype.event=function(t,e){this.eventCollect.event(t,e)},t.prototype.customStage=function(t,e){this.navigationCollect.customStage(t,e)},t.prototype.setDimensions=function(t){this.core.setDimensions(t)},t.prototype.fmp=function(t){"number"==typeof t?this.navigationCollect.fmp(t):"object"==e(t)&&t.timestamp?this.navigationCollect.fmp(t.timestamp):this.navigationCollect.fmp()},t.prototype.captureException=function(t){var e;this.errorCollect&&null!=(e=this.errorCollect)&&e.captureException(t)},t.prototype.destroy=function(){var t;null!=(t=this.navigationCollect)&&t.destroy(),null!=(t=this.apiCollect)&&t.destroy(),null!=(t=this.resourceCollect)&&t.destroy(),null!=(t=this.eventCollect)&&t.destroy(),null!=(t=this.errorCollect)&&t.destroy()},t.key="radar",t.version="1.2.5",t}();"undefined"!=typeof window&&"function"!=typeof window.Radar&&(window.Radar=vo);var yo,_o=[],wo=function(t){function e(e,n){var o=t.call(this)||this;return o.options=n||e,o.validOption()?((null==e?void 0:e.collect)&&o.apply(e),o):o}return o(e,t),e.prototype.apply=function(t){var e;this.weblog=t,this.radarInstance=new vo(r(r({},this.options),{weblog:t})),this.action=null===(e=this.radarInstance)||void 0===e?void 0:e.action},e.prototype.destroy=function(){var t;null===(t=this.radarInstance)||void 0===t||t.destroy()},e.prototype.collect=function(t,e){var n;0!==t.indexOf("c_")&&_o.indexOf(t)<0?k("[error 305]","[Radar] 传入的自定义指标 ".concat(t," 必须为 c_ 开头")):(b("[radar]:Radar+之后将不再支持collect方法，请用event方法替代。"),null===(n=this.radarInstance)||void 0===n||n.event({name:t},{duration:e}))},e.prototype.fmp=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.fmp(t)},e.prototype.event=function(t,e){var n;null===(n=this.radarInstance)||void 0===n||n.event(t,e)},e.prototype.customStage=function(t,e){var n;null===(n=this.radarInstance)||void 0===n||n.customStage(t,e)},e.prototype.headlessTestReport=function(){b("[radar]:Radar+已不支持不再支持headlessTestReport方法")},e.prototype.playClicked=function(t){b("[radar]:Radar+已不支持不再支持playClicked方法")},e.prototype.playIDR=function(t){b("[radar]:Radar+已不支持不再支持playIDR方法")},e.prototype.playBlock=function(t){b("[radar]:Radar+已不支持不再支持playBlock方法")},e.prototype.playError=function(t){b("[radar]:Radar+已不支持不再支持playError方法")},e.prototype.setDimensions=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.setDimensions(t)},e.prototype.validOption=function(){var t=this;if(!this.options)return!1;var e=this.options,n=e.sampling,o=void 0===n?1:n;return"string"==typeof e.projectId&&(!(o>1||o<0)&&(["apiSampling","errorSampling","resourceSampling","eventSampling"].forEach((function(e){var n=t.options[e];void 0!==n&&"number"==typeof n&&0===n&&k("[error 304]","[Radar] 采样率 ".concat(e," 不能被设置为 0，将改用默认值"))})),!0))},e.prototype.captureException=function(t){var e;null===(e=this.radarInstance)||void 0===e||e.captureException(t)},e.key="radar",e}(re),So=!1,bo="hashchange",ko=function(t){function e(e,n){var o=t.call(this)||this;return o.beginTime=(new Date).valueOf(),o.oldPushState=history.pushState,o.oldReplaceState=history.replaceState,o.visibilityChange=function(){var t=document.visibilityState;"visible"===t&&(So=!1),o.weblog&&!So&&o.autoPVFilter(location.href,null,t)&&("hidden"!==t&&"visible"!==t||("visible"===t&&(o.beginTime=(new Date).valueOf()),o.weblog.sendImmediately("PV",{type:t,auto:!0,beginTime:o.beginTime})))},o.proxyPushState=function(t,e,n){return o.urlChange(),o.oldPushState.call(history,t,e,n)},o.proxyReplaceState=function(t,e,n){return o.urlChange(),o.oldReplaceState.call(history,t,e,n)},o.urlChange=function(){o.weblog&&setTimeout((function(){var t=A({url:location.href},o.weblog.logConfig.urlMap),e=t.page,n=t.params;e&&e===o.weblog.currentUrlPackage.page?o.weblog.currentUrlPackage.update(e,n):(o.autoPVFilter(location.href,o.weblog.currentUrlPackage.page,"leave")&&o.weblog.sendImmediately("PV",{type:"leave",auto:!0,beginTime:o.beginTime,urlPage:o.weblog.currentUrlPackage.toJSON()}),o.autoPVFilter(location.href,o.weblog.currentUrlPackage.page,"enter")&&(o.weblog.updateReferUrlPackage(o.weblog.currentUrlPackage),o.weblog.updateCurrentUrlPackage(location.href),o.weblog.currentUrlPackage.page.indexOf("http"),o.beginTime=(new Date).valueOf(),o.weblog.sendImmediately("PV",{type:"enter",auto:!0})))}),0)},o.beforeUnload=function(){So=!0,o.weblog&&o.autoPVFilter(location.href,null,"leave")&&o.weblog.sendImmediately("PV",{type:"leave",auto:!0,beginTime:o.beginTime})},o.autoPVFilter=function(){return!0},e&&("function"==typeof e?o.autoPVFilter=e:"function"==typeof(null==e?void 0:e.collect)?((null==n?void 0:n.autoPVFilter)&&(o.autoPVFilter=n.autoPVFilter),o.apply(e)):"autoPVFilter"in e&&"function"==typeof e.autoPVFilter&&(o.autoPVFilter=e.autoPVFilter)),n&&"function"==typeof n.autoPVFilter&&(o.autoPVFilter=n.autoPVFilter),history.pushState=o.proxyPushState,history.replaceState=o.proxyReplaceState,o}return o(e,t),e.prototype.apply=function(t){if(t&&t.sendImmediately){this.weblog=t,this.autoPVFilter(location.href,null,"enter")&&this.weblog.sendImmediately("PV",{type:"enter",auto:!0});var e=t.Utils.ua.supportsPushState;bo=e()?"popstate":"hashchange",E(window,bo,this.urlChange),E(document,"visibilitychange",this.visibilityChange)}},e.prototype.destroy=function(){O(window,bo,this.urlChange),O(document,"visibilitychange",this.visibilityChange),history.pushState=this.oldPushState,history.replaceState=this.oldReplaceState},e.key="autoPV",e}(re),Eo=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.initBuildInPlugins(),o}return o(e,t),e.prototype.initBuildInPlugins=function(){var t=this.logConfig,e=t.autoPV,n=t.radar,o=t.fps,r=t.timing,i=t.crash,a=t.autoPVFilter;o&&this.plug(pe),r&&this.plug(ge),i&&this.plug(se),n&&this.plug(wo,n),(e||void 0===e)&&this.plug(ko,{autoPVFilter:a})},e}(oe);yo=Eo,void 0!==window._GLOBAL_KS_WEBLOGGER_?window._GLOBAL_KS_WEBLOGGER_.Factory=yo:window.Weblog=yo,(null==Xt?void 0:Xt.constructors)&&yo&&-1===Xt.constructors.indexOf(yo)&&(yo._classId=Xt.constructors.length,Xt.constructors.push(yo)),function(){if(null==Xt?void 0:Xt.silence)try{Xt._silenced=!!sessionStorage.getItem(te)}catch(t){}}(),t.BasePlugin=re,t.Weblog=Eo,t.default=Eo,Object.defineProperty(t,"__esModule",{value:!0})}));
