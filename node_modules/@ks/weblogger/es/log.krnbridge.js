import{NativeModules as t,AppState as e,Platform as a}from"react-native";var r=function(){return(r=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function n(t,e,a){if(a||2===arguments.length)for(var r,n=0,i=e.length;n<i;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}var i;function o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var a=null===console||void 0===console?void 0:console.log;return a&&a.call.apply(a,n([console],t,!1))}catch(t){return}}function s(t){return"string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""}var c="REACT_NATIVE";function g(){return c}var u=function(t){t.data.container=c,t.data.page_type="NATIVE";try{i(t,(function(t,e){1!==t&&o("setClientLog error",t,e)}))}catch(t){o("yoda invoke error")}},l=function(t,e,a,r){var n;void 0===e&&(e={}),"string"!=typeof t&&(n=t.type),n=t.toUpperCase();var i={};if("string"==typeof e)i.contentPackage=r,"CUSTOM"===t?(i.key=e,i.value=a):(i.params=a,"PV"===t?i.page=e:i.action=e);else if(i=e,["CUSTOM","CUSTOM_EVENT"].includes(n)){var o=e;o.action&&!o.key&&(i.key=o.action),o.params&&!o.value&&(i.value=o.params)}return[n,i]},p=0,d=function(){function t(t,e){this.h5ExtraAttr={sdk_name:"webLogger_krn",sdk_version:"3.10.23",sdk_bundle:"log.krnbridge.js",coPage:!1},this.version=this.h5ExtraAttr.sdk_version,this.currentUrlPackage={page:"",params:{},identity:"",coPage:!1},this.plugins={},this.entered="",this.logConfig=r({},t),Object.assign(this.h5ExtraAttr,null==e?void 0:e.h5_extra_attr),this.addPlugins()}return Object.defineProperty(t.prototype,"commonPackage",{get:function(){return{h5_extra_attr:this.h5ExtraAttr}},enumerable:!1,configurable:!0}),t.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},t.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(p++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},t.prototype.plug=function(t,e){if(this.plugins[t.key])throw new Error("There is a duplex plugin called ".concat(t.key));this.addPluginInstance(new t(this,e))},t.prototype.send=function(e,a,n){e=e.toUpperCase();var i,o=this.h5ExtraAttr,c=a,l=c.action,p=c.contentPackage,d=c.params,f=c.areaPackage,h=c.type,P=c.feedLogCtx,y=c.status,v=c.disablePV,k=c.urlPage,x=c.bridgeFields;if("PV"===e){if(this.logConfig.disablePV)return;var m=a,E=m.page,C=void 0===E?this.currentUrlPackage.page:E,b=m.type,A=void 0===b?"enter":b,T=m.coPage,U=m.timeCost,_=m.status,O=m.category,N=t.kdsUtils.appVersion;if("leave"===A&&this.currentUrlPackage.coPage&&N&&function(t,e){if(!e)return!1;if(-1!==e.indexOf("alpha"))return!1;if(-1!==e.indexOf("beta"))return!1;try{var a=t.match(/\d+\.\d+\.\d+/);if(!(t=(null==a?void 0:a[0])||""))return!0;if(a=e.match(/\d+\.\d+\.\d+/),!(e=(null==a?void 0:a[0])||""))return!1;var r=t.split(".").map((function(t){return Number(t)})),n=r[0],i=r[1],o=r[2],s=e.split(".").map((function(t){return Number(t)})),c=s[0],g=s[1],u=s[2];return!(c<n||!(c>n)&&(g<i||!(g>i)&&u<o))}catch(t){return!1}}("10.8.30",N))return void function(t){u({type:"closeCoPage",data:t})}(r(r({},this.currentUrlPackage),a));if("enter"!==A&&"visible"!==A)return;if("enter"===A&&(C&&(this.currentUrlPackage={page:C,coPage:!1,params:d,identity:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},this.entered=C),T&&(this.currentUrlPackage.coPage=T,this.h5ExtraAttr.coPage=T),O&&(this.currentUrlPackage.category=O)),this.currentUrlPackage.params=r(r({},this.currentUrlPackage.params||{}),d),!this.currentUrlPackage.page)return;return function(t,e){var a=e||{},r=a.params,n=a.contentPackage,i=a.identity,o=a.h5ExtraAttr,c=a.coPage,g=a.feedLogCtx,l=a.status,p=a.timeCost,d=void 0===p?0:p;u({type:"setCurrentPage",data:{page:t,identity:i,params:s(r),contentPackage:s(n),h5ExtraAttr:JSON.stringify(o),action:"PV",pageType:"NATIVE",coPage:c,feedLogCtx:g,status:l,timeCost:d}})}(this.currentUrlPackage.page,r(r({},this.currentUrlPackage),{contentPackage:p,feedLogCtx:P,h5ExtraAttr:o,status:_,timeCost:U,bridgeFields:x}))}if(null==k?void 0:k.page)i={page:k.page,identity:k.identity,params:"REACT_NATIVE"===g()?k.params:s(k.params)};else{var V="REACT_NATIVE"===g()?this.currentUrlPackage:r(r({},this.currentUrlPackage),{params:s(this.currentUrlPackage.params)});i=this.logConfig.disablePV||v||!this.currentUrlPackage.page?void 0:V}if("SHOW"===e)return function(t,e){var a=e||{},n=a.params,i=a.contentPackage,o=a.areaPackage,c=a.urlPage,g=a.h5ExtraAttr,l=a.feedLogCtx,p=a.status,d=a.bridgeFields;u({type:"addElementShowEvent",data:r(r({},d),{action:t,params:s(n),urlPage:c,areaPackage:o,contentPackage:s(i),h5ExtraAttr:JSON.stringify(g),feedLogCtx:l,status:p})})}(l,{urlPage:i,params:d,contentPackage:p,areaPackage:f,h5ExtraAttr:o,feedLogCtx:P,status:y,bridgeFields:x});if("CLICK"===e&&(!h||"USER_OPERATION"===h)){var S=a.entryTag;return function(t,e){var a=e||{},n=a.params,i=a.contentPackage,o=a.areaPackage,c=a.urlPage,g=a.entryTag,l=a.h5ExtraAttr,p=a.feedLogCtx;a.status;var d=a.bridgeFields;u({type:"addTaskEvent",data:r(r({},d),{action:t,params:s(n),urlPage:c,areaPackage:o,contentPackage:s(i),entryTagInfo:g,h5ExtraAttr:JSON.stringify(l),feedLogCtx:p,type:"USER_OPERATION"})})}(l,{urlPage:i,params:d,areaPackage:f,contentPackage:p,entryTag:S?r({page_name:this.currentUrlPackage.page,element_action:l},S):void 0,h5ExtraAttr:o,feedLogCtx:P,status:y,bridgeFields:x})}if(["CUSTOM_EVENT","CUSTOM"].includes(e)){var I=a,L=I.key,R=I.value,j=I.biz,w="CUSTOM_EVENT"===e;return function(t,e,a){void 0===a&&(a=!1);var n=e||{},i=n.value,o=n.biz,c=n.contentPackage,g=n.areaPackage,l=n.urlPage,p=n.h5ExtraAttr,d=n.bridgeFields;u({type:a?"addCustomEvent":"addCustomStatEvent",data:r(r({},d),{key:t,value:s(i),urlPage:l,areaPackage:g,contentPackage:s(c),h5ExtraAttr:JSON.stringify(p),biz:o})})}(L||l,{urlPage:i,value:r(r({},R||d),{url_package:i}),biz:j||this.logConfig.biz,areaPackage:f,contentPackage:p,h5ExtraAttr:o,feedLogCtx:P,bridgeFields:x},w)}return function(t,e){var a=e||{},n=a.params,i=a.contentPackage,o=a.areaPackage,c=a.urlPage,g=a.entryTag,l=a.type,p=a.h5ExtraAttr,d=a.feedLogCtx,f=a.status,h=a.bridgeFields;u({type:"addTaskEvent",data:r(r({},h),{action:t,params:s(n),urlPage:c,areaPackage:o,contentPackage:s(i),entryTagInfo:g,h5ExtraAttr:JSON.stringify(p),feedLogCtx:d,type:l||"BACKGROUND_TASK_EVENT",status:f})})}(l,{urlPage:i,params:d,areaPackage:f,contentPackage:p,h5ExtraAttr:o,type:h,feedLogCtx:P,bridgeFields:x,status:y})},t.prototype.collect=function(t,e,a,r){var n=l(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!1)},t.prototype.sendImmediately=function(t,e,a,r){var n=l(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!0)},t.prototype.flush=function(){},t.prototype.updateCommonPackage=function(t){(null==t?void 0:t.h5_extra_attr)&&Object.assign(this.h5ExtraAttr,t.h5_extra_attr)},t.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=""),"object"==typeof t&&t){var a=t.page,r=void 0===a?this.currentUrlPackage.page:a,n=t.params,i=void 0===n?{}:n;if(!(this.entered===r))return void(this.currentUrlPackage.params=Object.assign(this.currentUrlPackage.params||{},i));this.send("PV",{type:"visible",params:t.params})}},t.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage)},t}(),f=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}(),h={NativeModules:t,AppState:e,deviceInfo:function(){var e,n,i=(null===(e=null==t?void 0:t.KSRCTBridge)||void 0===e?void 0:e.deviceInfo)||(null===(n=null==t?void 0:t.KRNBasic)||void 0===n?void 0:n.deviceInfo);if(i){var o="string"==typeof i?JSON.parse(i):i,s=o.data;if(1===o.result){var c=a.OS,g=a.Version;return r(r({},s),{os:c,osVersion:g})}}return{appVersion:"",locale:"",uuid:"",systemVersion:"",networkType:"",manufacturer:"",model:"",screenWidth:0,screenHeight:0,statusBarHeight:0,titleBarHeight:0,os:"",osVersion:""}}(),Platform:a};i=function(e,a){t.yoda.invoke("tool","setClientLog",JSON.stringify(e),a)},c="REACT_NATIVE"||"REACT_NATIVE",d.kdsUtils={appVersion:h.deviceInfo.appVersion};export{f as BasePlugin,d as Weblog,d as default};
//# sourceMappingURL=log.krnbridge.js.map
