import{NativeModules as t,AppState as e,Platform as n}from"react-native";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function i(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n}function s(t,e,n,r){return new(n||(n=Promise))((function(a,o){function i(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,s)}c((r=r.apply(t,e||[])).next())}))}function c(t,e){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(t,e,n){if(n||2===arguments.length)for(var r,a=0,o=e.length;a<o;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}var p={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},l=function(){function t(t,e){switch(this.page="",this.identity="",e){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(t.page,t.params)}return t.prototype.update=function(t,e){void 0===t&&(t=""),t&&t!==this.page&&(this.page=t,this.identity=this.generatePageId(t)),e&&(this.params=Object.assign(this.params||{},e))},t.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params),category:this.category}},t.prototype.generatePageId=function(t){return t+(new Date).getTime()},t}();function g(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.log;return n&&n.call.apply(n,u([console],t,!1))}catch(t){return}}function h(t,e,n){if(void 0===n&&(n=" "),(e-=t.length)<=0)return t;for(var r="";e;)1&e&&(r+=n),e>>=1,n+=n;return r+t}function f(t){for(var e={},n=0,r=t.split("&");n<r.length;n++){var a=r[n].split("="),o=a[0],i=a[1];o in e?e[o]instanceof Array?e[o].push(i):e[o]=[e[o],i]:e[o]=i}return e}function d(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");return-1===e?{page:t}:{page:t.slice(0,e),params:f(t.slice(e+1))}}var v=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},_=function(t){try{return Math.abs(Math.floor(t))}catch(e){return t}},y=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var n;e&&"function"==typeof e&&(this.events[t]=this.events[t]||[],null===(n=this.events[t])||void 0===n||n.push(e))},t.prototype.off=function(t,e){if(this.events[t]){if(e&&"function"==typeof e){var n=this.events[t];n&&(a=e,(o=(r=n).indexOf(a))>-1&&r.splice(o,1))}var r,a,o;e||(this.events[t]=[])}},t.prototype.emit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.events[t]&&(null===(e=this.events[t])||void 0===e||e.forEach((function(t){t.apply(void 0,n)})))},t}(),m=0,E=function(t){function e(n,r){var a,i=t.call(this)||this;return i.version="3.10.23",i.plugins={},i.flush=function(){i.logger.flush()},i.baseOption=o({},r),i.logConfig=(a=n,o({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda,forbidV2HttpUrlPage:!0},a||{})),i.initUrlPackage(),e.__instance||(e.__instance=i),i}return a(e,t),Object.defineProperty(e.prototype,"sessionId",{get:function(){return p.sessionId},enumerable:!1,configurable:!0}),e.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e="web"),"object"==typeof t&&t.page&&this.currentUrlPackage&&t.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(t.page,t.params);this.currentUrlPackage=new l(t,e)},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof l?t:new l(t,e)},e.prototype.updateBase=function(t){this.updateCommonPackage(t)},e.prototype.updateCommonPackage=function(t){"object"==typeof t&&this.commonPackage.update(t)},e.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},e.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(m++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},e.prototype.plug=function(t,e){if(this.plugins[t.key])return g("[code 301]","".concat(t.key," 插件重复加载！"));this.addPluginInstance(new t(this,e))},e.prototype.unplug=function(t){var e=this.plugins[t];e&&(e.destroy(),delete this.plugins[t])},e.prototype.unplugAll=function(){for(var t in this.plugins)this.plugins[t]&&this.unplug(t)},e.prototype.generateLog=function(t,e){return{}},e.prototype.send=function(t,e,n){var r=this.generateLog(t.toUpperCase(),e);return"function"==typeof this.beforeSend&&this.beforeSend(t,e,r),this.logger.send(r,!!n,e.callback)},e.prototype.collect=function(t,e){this.send(t,e)},e.prototype.sendImmediately=function(t,e){this.send(t,e,!0)},e.prototype.sendPackage=function(t,e){this.logger.sendPackage(t,e)},e.prototype.destroy=function(){this.unplugAll()},e}(y),P={NativeModules:t,AppState:e,deviceInfo:function(){var e,r,a=(null===(e=null==t?void 0:t.KSRCTBridge)||void 0===e?void 0:e.deviceInfo)||(null===(r=null==t?void 0:t.KRNBasic)||void 0===r?void 0:r.deviceInfo);if(a){var i="string"==typeof a?JSON.parse(a):a,s=i.data;if(1===i.result){var c=n.OS,u=n.Version;return o(o({},s),{os:c,osVersion:u})}}return{appVersion:"",locale:"",uuid:"",systemVersion:"",networkType:"",manufacturer:"",model:"",screenWidth:0,screenHeight:0,statusBarHeight:0,titleBarHeight:0,os:"",osVersion:""}}(),Platform:n};function k(){var t;return s(this,void 0,void 0,(function(){var e,n,r,a,o;return c(this,(function(i){switch(i.label){case 0:e=P.NativeModules,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,null===(t=e.WebLoggerDebugger)||void 0===t?void 0:t.getLoggerDebugConfig()];case 2:return"string"==typeof(n=i.sent())?(r=JSON.parse(n).host,(a=void 0===r?"":r)?(o=a.match(/([^\/]+)/g)||[],o[o.length-1]||""?[2,a]:[2,""]):[2]):[2,""];case 3:return i.sent(),[2,""];case 4:return[2]}}))}))}function S(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}var T,U,N=function(t){function e(e,n,r){var a=t.call(this,{},n)||this;if("string"==typeof e){var o=d(e);a.page=o.page,a.params=o.params}else a.page=(e||{}).page||"",a.params=(e||{}).params||void 0;return a.identity=a.generatePageId(),r&&"string"==typeof e&&a.init(e,r),a}return a(e,t),e.prototype.generatePageId=function(){return S()},e.prototype.init=function(t,e){void 0===e&&(e={});var n=function(t,e){var n=t.url,r=t.page,a=t.params,o=t.pageId;if(!r&&"string"==typeof n){var i=d(n);r=i.page,a=i.params}if("function"==typeof e)try{var s=e({url:n,page:r,params:a});"string"==typeof s?r=s:"object"==typeof s&&(s.page&&(r=s.page),s.params&&(a=s.params),s.pageId&&(o=s.pageId))}catch(t){}else if("object"==typeof e){var c="";for(var u in e)if((n||r||"").indexOf(u)>-1){c=e[u];break}c&&(r=c)}return{page:r,params:a,pageId:o}}({url:t,page:this.page,params:this.params},e),r=n.page,a=n.params;this.update(r,a)},e}(l),O={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(t){t.CLICK="CLICK",t.DOUBLE_CLICK="DOUBLE_CLICK",t.TRIPLE_CLICK="TRIPLE_CLICK",t.LONG_PRESS="LONG_PRESS",t.PULL="PULL",t.DRAG="DRAG",t.SCALE="SCALE",t.PULL_DOWN="PULL_DOWN",t.PULL_UP="PULL_UP",t.AUTO="AUTO"}(T||(T={})),function(t){t.PV="PV",t.SHOW="SHOW",t.VIDEO="VIDEO",t.CUSTOM="CUSTOM",t.CUSTOM_EVENT="CUSTOM_EVENT",t.RADAR="RADAR"}(U||(U={}));var A=function(e){function n(n){var r=e.call(this,o({identity_package:{device_id:P.deviceInfo.uuid,global_id:P.deviceInfo.globalId},app_package:{language:P.deviceInfo.locale,platform:("ios"===P.Platform.OS?3:"android"===P.Platform.OS&&1)||"web"===P.Platform.OS&&10||0,container:"REACT_NATIVE",version_name:P.deviceInfo.appVersion},device_package:{os_version:String(P.Platform.Version)||"unknown",model:P.deviceInfo.manufacturer||P.deviceInfo.model},network_package:{type:"WIFI"===P.deviceInfo.networkType?O.wifi:O.unknown}},n))||this,a=P.deviceInfo,i=a.product_name,s=a.screenWidth,c=a.screenHeight;return Object.assign(r.h5_extra_attr,{host_product:i,resolution:"".concat(s,"x").concat(c)},n.h5_extra_attr),r.identity_package.user_id||new Promise((function(e){try{(null==t?void 0:t.KSUserInfo)?t.KSUserInfo.getUserInfo((function(t){e(t&&t.userId)})):e("")}catch(t){e("")}})).then((function(t){Object.assign(r.identity_package,{user_id:t})})),r}return a(n,e),n}(function(){function t(t){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:O.unknown},this.h5_extra_attr={sdk_name:"webLogger_krn",sdk_version:"3.10.23",sdk_bundle:"log.krn.js"},this.global_attr={entry_tag:[]},this.location_package={country:void 0,province:void 0,city:void 0,county:void 0,street:void 0,latitude:void 0,longitude:void 0},this.update(t),this.app_package.version_name){var e=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(e+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return t.prototype.getH5ExtraAttr=function(t){return Object.assign({},this.h5_extra_attr,t)},t.prototype.update=function(t){if("object"==typeof t){!function(t,e){if(v(t)&&v(e)){var n=function(t,e,n){v(t[n])&&v(e[n])?Object.assign(t[n],e[n]):v(t[n])||v(e[n])||(t[n]=e[n])};for(var r in e)if(t.hasOwnProperty(r))n(t,e,r);else for(var a in t)v(t[a])&&t[a].hasOwnProperty(r)&&n(t[a],e,r)}}(this,t);var e=t.network_type;e&&O[e]&&(this.network_package.type=O[e])}},t.prototype.updateGlobalAttr=function(t){Object.assign(this.global_attr||{},t)},t.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var t=o(o({},this),{toJSON:function(){return o(o({},t),{h5_extra_attr:JSON.stringify(t.h5_extra_attr),global_attr:JSON.stringify(t.global_attr)})}});t.global_attr=o({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?t.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete t.global_attr.entry_tag,Object.keys(this.global_attr).length||delete t.global_attr;var e=this.location_package;return e&&Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t]})),t},t}()),b="https://data-track.corp.kuaishou.com",w=b+"/",C="rest/wd/common/log/collect/",L=["production","test","development","logger","oversea"],I={v2:"rest/kd/log/collect?_json=1&biz=",v3:"".concat(C,"misc2"),radar:"".concat(C,"radar")},R={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:w,test:w,oversea:"https://logsdk.kwai-pro.com/"},v3:{production:"https://log-sdk.ksapisrv.com/",development:w,test:w,oversea:"https://logsdk.kwai-pro.com/"}},x=function(t,e,n){return void 0===t&&(t="production"),void 0===e&&(e=!1),void 0===n&&(n="v3"),-1===L.indexOf(t)?t+I[n]:e&&R.v3[t]?R.v3[t]+I.radar:R[n][t]&&I[n]?R[n][t]+I[n]:R.v3.production+I.v3},D=function(t,e){if(!e)return t;try{return/\?(.+?)$/.test(t)?t.replace(/\?(.+?)$/,"?".concat(e,"&$1")):t+"?".concat(e)}catch(e){return t}},K=function(){function t(t,e){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.isSetSamplingResult=!1,this.sendingYield=null,this.flush=function(t){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),t),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=t,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=e,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,this.updateUrls()}return t.prototype.sendData=function(t,e){return"function"==typeof this.config.sender?this.config.sender(t,e):this.baseSendData(t,e)},Object.defineProperty(t.prototype,"responseSamplingStorageKey",{get:function(){var t=this.commonPackage.app_package,e=t.product_name,n=t.product,r=this.commonPackage.identity_package.device_id;return"RESPONSE_SAMPLING_STORAGE_KEY_".concat(e||n,"_").concat(r)},enumerable:!1,configurable:!0}),t.prototype.updateUrls=function(){var t=this.config.env;t&&/^(https?:)?\/\//.test(t)?this.url=t:this.url=x(t),this.formatUrl()},t.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf(I.v2)?I.v2:I.v3,I.radar),-1!==this.radarUrl.indexOf(R.v2.production||"")&&this.radarUrl.replace(R.v2.production||"",R.v3.production));var t=this.commonPackage.app_package,e=t.product_name,n=t.product,r="v=3.10.23&kpn=".concat(e||n);this.url=D(this.url,r),this.radarUrl=D(this.radarUrl,r)},t.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},t.prototype.send=function(t,e,n){if(void 0===e&&(e=!1),n||this.drained)return this.sendLogs([t],n);e?this.sendAsync(t,n):this.sendThrottle(t)},t.prototype.sendAsync=function(t,e){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.asyncQueue.push(t),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:e.sent(),this.sendingYield=null,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return e.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},t.prototype.sendThrottle=function(t){var e=this;this.throttleQueue.push(t),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){e.flush()}),this.config.wait))},t.prototype.sendLogs=function(t,e){var n=this;if(!t||!t.length)return"function"==typeof e&&e();var r=this.buildLogPackage(t,this.url);this.sendPackage(r,(function(t){t?n.errHandler(r):n.flushErrorLogs(),"function"==typeof e&&e(t)}))},t.prototype.sendPackage=function(t,e){var n=this.config.timeout;try{this.sendData(o(o({},t),{isDebug:this.isDebug,isDrained:this.drained,timeout:n}),e)}catch(t){"function"==typeof e&&e(t)}},t.prototype.buildLogPackage=function(t,e){return this.isV2?this.buildV2Package(t,e):this.buildV3Package(t,e)},t.prototype.buildV2Package=function(t,e){return{url:e,data:{log:{event:t}}}},t.prototype.buildV3Package=function(t,e,n){var r=this.getCommonPackageJSON();return n&&Object.assign(r,n),{url:e,data:{common:r,logs:t}}},t.prototype.errHandler=function(t){var e;if(this.isV2)this.errorQueue.unshift(t);else{var n=t.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var r=!1,a=0;a<this.errorQueue.length;a++){var o=this.errorQueue[a];if(o.url===t.url&&o.data.logs.length+n.logs.length<=100&&JSON.stringify(o.data.common)===JSON.stringify(n.common)){r=!0,(e=o.data.logs).push.apply(e,n.logs);break}}r||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(t))}}},t.prototype.flushErrorLogs=function(){var t=this;this.errorQueue.forEach((function(e){t.sendPackage(e)})),this.errorQueue=[]},t.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},t.prototype.sendRadar=function(t,e){var n=e?{service_name:e}:void 0,r=this.buildV3Package([t],this.radarUrl||this.url,n);this.sendPackage(r)},t}(),G=function(t,e,n){return g("[error 400]","埋点上报接口请求报错","\nurl:",e,"\ndata",n,"\nerror:",t||"server decode log failed")};function V(t,e){var n=t.url,r=t.data,a=t.timeout;return new Promise((function(t){var o=new XMLHttpRequest;return o.open("POST",n),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),"object"!=typeof r||r instanceof Uint8Array||(r=JSON.stringify(r)),a&&(o.timeout=a),o.onload=function(){var a=function(t,e,n,r){var a;if(t<200||t>=300&&304!==t);else try{var o=JSON.parse(e),i=o.exception,s=o.result,c=o.error_msg;i&&(a=i),1!==s&&(a=c||"result is ".concat(s))}catch(t){a=t.message}return a&&G(a,n,r),a}(o.status,o.response,n,r);e&&e(a),t({error:a,response:a?void 0:o.response})},o.ontimeout=o.onerror=function(a){a&&G(a,n,r),e&&e(a?"networkTimeout":""),t({error:"networkTimeout"})},o.send(r),o}))}var W,M,H,j=function(t,e,n){void 0===t&&(t=b);var r="".concat(t,"/#/logger/index?sessionId=").concat(n);return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{var n=null===console||void 0===console?void 0:console.log;n&&n.call.apply(n,u([console],t,!1))}catch(t){return}}("%c埋点抓包校验: %c".concat(r),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),"".concat(e,"/").concat(n,"/")},J=function(t){return void 0===t&&(t="krnlogger"),function(t){var e=function(e){return g("[error 401]","GET 请求出错 url: ".concat(t),e)};try{var n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(),n.onerror=e}catch(t){e(t)}}("".concat(b,"/rest/").concat(t)),j(b,"".concat(b,"/rest"),t)},B=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.radarUrl="",r.baseSendData=V,r}return a(e,t),e.prototype.updateUrls=function(){var t=this.config,e=t.env,n=t.logger;if(this.getKrnWebloggerSwitch(),n||"logger"===e){var r=J(this.commonPackage.identity_package.device_id);this.url=x(r)}else e&&/^(https?:)?\/\//.test(e)?this.url=e:(this.url=x(e),this.radarUrl=x(e,!0));this.formatUrl()},e.prototype.getKrnWebloggerSwitch=function(){return s(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return[4,k()];case 1:return(t=e.sent())&&(this.config.logger=!0,this.url=x(t),this.radarUrl=this.url.replace(-1!==this.url.indexOf(I.v2)?I.v2:I.v3,I.radar)),[2]}}))}))},e}(K);!function(t){var e,n,r,a,o,i,s,c;(e=t.ElementStatus||(t.ElementStatus={}))[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.CHECKED=1]="CHECKED",e[e.UNCHECKED=2]="UNCHECKED",(n=t.PageShowAction||(t.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(r=t.ActionStatus||(t.ActionStatus={}))[r.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",r[r.SUCCESS=1]="SUCCESS",r[r.FAIL=2]="FAIL",(a=t.ActionType||(t.ActionType={}))[a.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",a[a.CLICK=1]="CLICK",a[a.LEFT_PULL=2]="LEFT_PULL",a[a.RIGHT_PULL=3]="RIGHT_PULL",a[a.UP_PULL=4]="UP_PULL",a[a.DOWN_PULL=5]="DOWN_PULL",(o=t.SubAction||(t.SubAction={}))[o.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",o[o.PAGE_ENTER=1]="PAGE_ENTER",o[o.PAGE_LEAVE=2]="PAGE_LEAVE",o[o.PAGE_RESUME=3]="PAGE_RESUME",o[o.PAGE_PAUSE=4]="PAGE_PAUSE",(i=t.Direction||(t.Direction={}))[i.UNKNOWN2=0]="UNKNOWN2",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i[i.LEFT=3]="LEFT",i[i.RIGHT=4]="RIGHT",(s=t.TaskStatus||(t.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=t.OperationType||(t.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(W||(W={})),function(t){var e,n;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT",(n=t.TaskEventType||(t.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(M||(M={})),function(t){var e;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN2=0]="UNKNOWN2",e[e.PAGE=1]="PAGE"}(H||(H={}));var Q,Y=!0,F=(new Date).valueOf(),z=function(t,e){var n,r;void 0===e&&(e=!1);var a=t.type,i=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=void 0===c?"":c,p=t.action,l=t.beginTime,g=t.params,h=t.contentPackage,f=t.status,d=t.actionType,v=t.auto,y=((n={status:f?W.ActionStatus[f]||W.ActionStatus.UNKNOWN_STATUS:W.ActionStatus.SUCCESS})[e?"show_type":"action_type"]=d?W.ActionType[d]||W.ActionType.UNKNOWN_ACTION_TYPE:W.ActionType.CLICK,n.url_package=i,n.refer_url_package=s,n[e?"content_wrapper":"content_package"]=h,n);if("PV"===a){var m=W.SubAction.PAGE_ENTER,E=W.PageShowAction.ENTER,P=Y,k=0;switch(Y=!1,p){case"leave":E=W.PageShowAction.LEAVE,m=W.SubAction.PAGE_LEAVE,k=_((new Date).valueOf()-(l||F));break;case"enter":E=W.PageShowAction.ENTER,m=W.SubAction.PAGE_ENTER,F=(new Date).valueOf();break;case"visible":E=W.PageShowAction.RESUME,m=W.SubAction.PAGE_RESUME,F=(new Date).valueOf();break;case"hidden":E=W.PageShowAction.LEAVE,m=W.SubAction.PAGE_PAUSE,k=_((new Date).valueOf()-(l||F))}var S=v?M.ShowType.PAGE_AUTO:M.ShowType.PAGE_CUSTOM;return e&&(P=void 0,S=H.ShowType.PAGE),{show_event:o({action:E,sub_action:m,type:S,first_load:P,time_cost:0,stay_length:k},y)}}return{show_event:o({action:e?0:W.PageShowAction.ENTER,type:e?0:M.ShowType.ELEMENT,sub_action:e?0:W.SubAction.PAGE_ENTER,element_package:(r={},r[e?"action2":"action"]=u,r.params=JSON.stringify(g),r)},y)}},q=function(t,e){var n,r;void 0===e&&(e=!1);var a=t.sessionId,i=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=t.params,p=t.type,l=t.contentPackage,g=t.status,h=t.taskType,f=t.operationDirection,d=((n={url_package:i,refer_url_package:s,element_package:(r={},r[e?"action2":"action"]=c,r.params=JSON.stringify(u),r)})[e?"content_wrapper":"content_package"]=l,n);if(e){var v="USER_OPERATION"===h||"CLICK"===p&&!h,_=p&&W.OperationType[p]||W.OperationType.CLICK;return v?{click_event:o({type:_,direction:f&&W.Direction[f]||W.Direction.UNKNOWN2},d)}:{task_event:o({action2:c,status:g&&W.TaskStatus[g]||W.TaskStatus.UNKNOWN_STATUS},d)}}return{task_event:o({type:h&&M.TaskEventType[h]||M.TaskEventType.USER_OPERATION,status:g&&W.TaskStatus[g]||W.TaskStatus.UNKNOWN_STATUS,operation_type:W.OperationType[p]||W.OperationType.CLICK,operation_direction:f&&W.Direction[f]||W.Direction.UNKNOWN2,session_id:a},d)}},X=function(t){var e=t.name,n=t.params,r=t.currentUrlPackage,a=t.referUrlPackage,s=i(t,["name","params","currentUrlPackage","referUrlPackage"]);return{key:e,value:JSON.stringify(o(o({url_package:r,refer_url_package:a},n),s))}},$=function(t){var e=t.currentUrlPackage,n=t.referUrlPackage,r=t.options;return{video_stat_event:o(o({},r),{url_package:e,refer_url_package:n})}},Z={},tt=function(t){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0;return e+1>1e8&&(e=0),function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,e+1),e}}catch(t){}return Z[t]||(Z[t]=0),Z[t]++},et=(Q=(new Date).getTimezoneOffset()/60)<=0?"GMT+".concat(h(-Q+"",2,"0"),":00"):"GMT-".concat(h(Q+"",2,"0"),":00"),nt=function(){function t(t,e){void 0===e&&(e=!1),this.client_timestamp=_((new Date).valueOf()),this.client_increment_id=0,this.session_id=p.sessionId,this.event_id="",e||(this.time_zone=et),Object.assign(this,t),this.genIncrementId()}return t.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?tt("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):tt("WEBLOGGER_INCREAMENT_ID_KEY")},t.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},t.prototype.getEventType=function(){if(this.event_package){var t=this.event_package,e=t.task_event,n=t.show_event,r=t.click_event,a=t.custom_event;if(n)return"showEvent";if(r)return"clickEvent";if(e)return"taskEvent";if(a)return"customEvent"}return"customEvent"},t}();function rt(t,e,n){var r;void 0===n&&(n=!1);var a,o=e.eventId,s=e.currentUrlPackage,c=e.referUrlPackage,u=e.contentPackage,l=e.name,g=e.params;switch(n&&"RADAR"!==t&&"CUSTOM"!==t&&(s&&(s.page2=s.page,delete s.page),c&&(c.page2=c.page,delete c.page)),t){case"PV":case"SHOW":return new nt({event_package:z({type:t,status:e.status,currentUrlPackage:s,referUrlPackage:c,action:e.type,beginTime:e.beginTime,actionType:e.actionType,name:l,params:g,contentPackage:u,operationDirection:e.operationDirection,auto:e.auto},n),event_id:o},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var h=X({name:l,params:g,currentUrlPackage:s,referUrlPackage:c});return new nt(n?{event_package:{custom_event:h},event_id:o}:{stat_package:{custom_stat_event:h},event_id:o},n);case"RADAR":return new nt({stat_package:{custom_stat_event:X({name:l,params:g,currentUrlPackage:s,referUrlPackage:c})},event_id:o},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new nt({stat_package:(r={},r[t.toLowerCase()]=(a=e,a.currentUrlPackage,a.referUrlPackage,a.taskType,i(a,["currentUrlPackage","referUrlPackage","taskType"])),r)},n);case"VIDEO":return new nt(n?{stat_package:$({currentUrlPackage:s,referUrlPackage:c,options:g.params}),event_id:o}:{event_package:q({type:t,status:e.status,taskType:e.taskType,sessionId:p.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:g.params,contentPackage:u},n),event_id:o},n);default:return new nt({event_package:q({type:t,status:e.status,taskType:e.taskType,sessionId:p.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:g,contentPackage:u},n),event_id:o},n)}}var at=function(t,e,n,r){var a;void 0===e&&(e={}),"string"!=typeof t&&(a=t.type),a=t.toUpperCase();var o={};if("string"==typeof e)o.contentPackage=r,"CUSTOM"===t?(o.key=e,o.value=n):(o.params=n,"PV"===t?o.page=e:o.action=e);else if(o=e,["CUSTOM","CUSTOM_EVENT"].includes(a)){var i=e;i.action&&!i.key&&(o.key=i.action),i.params&&!i.value&&(o.value=i.params)}return[a,o]},ot=function(e){function n(t,n){var r,a,o,i=this;return(i=e.call(this,t,n)||this).appStateChange=function(t){var e;"active"!==t&&i.flush(),"destroy"===t&&(null===(e=P.AppState)||void 0===e||e.removeEventListener("change",i.appStateChange),i.destroy())},null===(r=P.AppState)||void 0===r||r.addEventListener("change",i.appStateChange),a="sessionId",o=n&&n.session_id||S(),p[a]=o,i.commonPackage=new A(i.baseOption),i.logger=new B(i.logConfig,i.commonPackage),i.addPlugins(),i}return a(n,e),n.prototype.initUrlPackage=function(){return s(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return this.updateCurrentUrlPackage(),[4,(r=this.logConfig.rootTag,new Promise((function(e){var n;try{(null===(n=null==t?void 0:t.RootViewPageBridge)||void 0===n?void 0:n.rootViewSignatureWith)&&"number"==typeof r?t.RootViewPageBridge.rootViewSignatureWith(r,(function(t){var n="string"==typeof t?JSON.parse(t):t;e(o({},n))})):e({})}catch(t){e({})}})))];case 1:return e=n.sent(),this.commonPackage.update({h5_extra_attr:e}),[2]}var r}))}))},n.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e="native"),"object"==typeof t&&!t.force&&this.currentUrlPackage){var n=t.page,r=void 0===n?this.currentUrlPackage.page:n,a=t.params,o=void 0===a?{}:a;if(r===this.currentUrlPackage.page)return this.currentUrlPackage.update(r,o)}this.currentUrlPackage=new N(t,e,this.logConfig.urlMap)},n.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="native"),this.referUrlPackage=t instanceof N?t:new N(t,e,this.logConfig.urlMap)},n.prototype.generateLog=function(t,e,n){void 0===n&&(n=rt);var r,a=e,i=a.action,s=a.params,c=a.status,u=a.type,p=a.eventId,l=a.contentPackage,g=a.urlPage;if(l&&(l="string"==typeof l?l:JSON.stringify(l)),"PV"===t){var h=e.page;this.currentUrlPackage.update(h,s)}else g&&g.page&&(r={page:g.page,identity:g.identity||S(),params:JSON.stringify(g.params),page_type:this.currentUrlPackage.page_type});var f={currentUrlPackage:r||this.currentUrlPackage.toJSON(),referUrlPackage:this.referUrlPackage?this.referUrlPackage.toJSON():void 0,contentPackage:l};if("PV"===t){var d=e.type;return n(t,o(o(o({},e),{type:d,name:t}),f))}if("SHOW"===t)return n(t,o(o(o({},e),{name:i}),f));if("VIDEO"===t)return n(t,o({params:e,name:"VIDEO"},f));if("RADAR"===t)return n(t,e);if("CUSTOM"===t){var v=e,_=v.key,y=v.value;return n(t,o(o(o({},e),{params:y,name:_}),f))}return n(t,o(o(o({},e),{params:s,status:c,taskType:u,eventId:p,name:i}),f))},n.prototype.collect=function(t,e,n,r){var a=at(t,e,n,r),o=a[0],i=a[1];return this.send(o,i,!1)},n.prototype.sendImmediately=function(t,e,n,r){var a=at(t,e,n,r),o=a[0],i=a[1];return this.send(o,i,!0)},n}(E),it=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}();export{it as BasePlugin,ot as Weblog,ot as default};
//# sourceMappingURL=log.krn.js.map
