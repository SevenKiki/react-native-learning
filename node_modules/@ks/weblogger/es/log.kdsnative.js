var t=function(){return(t=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function e(t,e,a){if(a||2===arguments.length)for(var r,n=0,i=e.length;n<i;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}var a;function r(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];try{var r=null===console||void 0===console?void 0:console.error;return r&&r.call.apply(r,e([console],t,!1))}catch(t){return}}function n(t){return"string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""}var i="REACT_NATIVE";function o(){return i}var c,s=function(t){t.data.container=i,t.data.page_type="NATIVE";try{a(t,(function(t,e){1!==t&&r("setClientLog error",t,e)}))}catch(t){r("yoda invoke error")}},g=function(t,e,a,r){var n;void 0===e&&(e={}),"string"!=typeof t&&(n=t.type),n=t.toUpperCase();var i={};if("string"==typeof e)i.contentPackage=r,"CUSTOM"===t?(i.key=e,i.value=a):(i.params=a,"PV"===t?i.page=e:i.action=e);else if(i=e,["CUSTOM","CUSTOM_EVENT"].includes(n)){var o=e;o.action&&!o.key&&(i.key=o.action),o.params&&!o.value&&(i.value=o.params)}return[n,i]},u=0,l=function(){function e(e,a){this.h5ExtraAttr={sdk_name:"weblogger_kds_native",sdk_version:"3.10.23",sdk_bundle:"log.kdsnative.js",coPage:!1},this.version=this.h5ExtraAttr.sdk_version,this.currentUrlPackage={page:"",params:{},identity:"",coPage:!1},this.plugins={},this.entered="",this.logConfig=t({},e),Object.assign(this.h5ExtraAttr,null==a?void 0:a.h5_extra_attr),this.addPlugins()}return Object.defineProperty(e.prototype,"commonPackage",{get:function(){return{h5_extra_attr:this.h5ExtraAttr}},enumerable:!1,configurable:!0}),e.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},e.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_".concat(u++);"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},e.prototype.plug=function(t,e){if(this.plugins[t.key])throw new Error("There is a duplex plugin called ".concat(t.key));this.addPluginInstance(new t(this,e))},e.prototype.send=function(a,r,i){a=a.toUpperCase();var c,g=this.h5ExtraAttr,u=r,l=u.action,p=u.contentPackage,d=u.params,f=u.areaPackage,h=u.type,P=u.feedLogCtx,y=u.status,v=u.disablePV,k=u.urlPage,x=u.bridgeFields;if("PV"===a){if(this.logConfig.disablePV)return;var m=r,E=m.page,C=void 0===E?this.currentUrlPackage.page:E,b=m.type,A=void 0===b?"enter":b,T=m.coPage,U=m.timeCost,_=m.status,O=m.category,N=e.kdsUtils.appVersion;if("leave"===A&&this.currentUrlPackage.coPage&&N&&function(t,e){if(!e)return!1;if(-1!==e.indexOf("alpha"))return!1;if(-1!==e.indexOf("beta"))return!1;try{var a=t.match(/\d+\.\d+\.\d+/);if(!(t=(null==a?void 0:a[0])||""))return!0;if(a=e.match(/\d+\.\d+\.\d+/),!(e=(null==a?void 0:a[0])||""))return!1;var r=t.split(".").map((function(t){return Number(t)})),n=r[0],i=r[1],o=r[2],c=e.split(".").map((function(t){return Number(t)})),s=c[0],g=c[1],u=c[2];return!(s<n||!(s>n)&&(g<i||!(g>i)&&u<o))}catch(t){return!1}}("10.8.30",N))return void function(t){s({type:"closeCoPage",data:t})}(t(t({},this.currentUrlPackage),r));if("enter"!==A&&"visible"!==A)return;if("enter"===A&&(C&&(this.currentUrlPackage={page:C,coPage:!1,params:d,identity:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},this.entered=C),T&&(this.currentUrlPackage.coPage=T,this.h5ExtraAttr.coPage=T),O&&(this.currentUrlPackage.category=O)),this.currentUrlPackage.params=t(t({},this.currentUrlPackage.params||{}),d),!this.currentUrlPackage.page)return;return function(t,e){var a=e||{},r=a.params,i=a.contentPackage,o=a.identity,c=a.h5ExtraAttr,g=a.coPage,u=a.feedLogCtx,l=a.status,p=a.timeCost,d=void 0===p?0:p;s({type:"setCurrentPage",data:{page:t,identity:o,params:n(r),contentPackage:n(i),h5ExtraAttr:JSON.stringify(c),action:"PV",pageType:"NATIVE",coPage:g,feedLogCtx:u,status:l,timeCost:d}})}(this.currentUrlPackage.page,t(t({},this.currentUrlPackage),{contentPackage:p,feedLogCtx:P,h5ExtraAttr:g,status:_,timeCost:U,bridgeFields:x}))}if(null==k?void 0:k.page)c={page:k.page,identity:k.identity,params:"REACT_NATIVE"===o()?k.params:n(k.params)};else{var S="REACT_NATIVE"===o()?this.currentUrlPackage:t(t({},this.currentUrlPackage),{params:n(this.currentUrlPackage.params)});c=this.logConfig.disablePV||v||!this.currentUrlPackage.page?void 0:S}if("SHOW"===a)return function(e,a){var r=a||{},i=r.params,o=r.contentPackage,c=r.areaPackage,g=r.urlPage,u=r.h5ExtraAttr,l=r.feedLogCtx,p=r.status,d=r.bridgeFields;s({type:"addElementShowEvent",data:t(t({},d),{action:e,params:n(i),urlPage:g,areaPackage:c,contentPackage:n(o),h5ExtraAttr:JSON.stringify(u),feedLogCtx:l,status:p})})}(l,{urlPage:c,params:d,contentPackage:p,areaPackage:f,h5ExtraAttr:g,feedLogCtx:P,status:y,bridgeFields:x});if("CLICK"===a&&(!h||"USER_OPERATION"===h)){var V=r.entryTag;return function(e,a){var r=a||{},i=r.params,o=r.contentPackage,c=r.areaPackage,g=r.urlPage,u=r.entryTag,l=r.h5ExtraAttr,p=r.feedLogCtx;r.status;var d=r.bridgeFields;s({type:"addTaskEvent",data:t(t({},d),{action:e,params:n(i),urlPage:g,areaPackage:c,contentPackage:n(o),entryTagInfo:u,h5ExtraAttr:JSON.stringify(l),feedLogCtx:p,type:"USER_OPERATION"})})}(l,{urlPage:c,params:d,areaPackage:f,contentPackage:p,entryTag:V?t({page_name:this.currentUrlPackage.page,element_action:l},V):void 0,h5ExtraAttr:g,feedLogCtx:P,status:y,bridgeFields:x})}if(["CUSTOM_EVENT","CUSTOM"].includes(a)){var L=r,I=L.key,w=L.value,j=L.biz,F="CUSTOM_EVENT"===a;return function(e,a,r){void 0===r&&(r=!1);var i=a||{},o=i.value,c=i.biz,g=i.contentPackage,u=i.areaPackage,l=i.urlPage,p=i.h5ExtraAttr,d=i.bridgeFields;s({type:r?"addCustomEvent":"addCustomStatEvent",data:t(t({},d),{key:e,value:n(o),urlPage:l,areaPackage:u,contentPackage:n(g),h5ExtraAttr:JSON.stringify(p),biz:c})})}(I||l,{urlPage:c,value:t(t({},w||d),{url_package:c}),biz:j||this.logConfig.biz,areaPackage:f,contentPackage:p,h5ExtraAttr:g,feedLogCtx:P,bridgeFields:x},F)}return function(e,a){var r=a||{},i=r.params,o=r.contentPackage,c=r.areaPackage,g=r.urlPage,u=r.entryTag,l=r.type,p=r.h5ExtraAttr,d=r.feedLogCtx,f=r.status,h=r.bridgeFields;s({type:"addTaskEvent",data:t(t({},h),{action:e,params:n(i),urlPage:g,areaPackage:c,contentPackage:n(o),entryTagInfo:u,h5ExtraAttr:JSON.stringify(p),feedLogCtx:d,type:l||"BACKGROUND_TASK_EVENT",status:f})})}(l,{urlPage:c,params:d,areaPackage:f,contentPackage:p,h5ExtraAttr:g,type:h,feedLogCtx:P,bridgeFields:x,status:y})},e.prototype.collect=function(t,e,a,r){var n=g(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!1)},e.prototype.sendImmediately=function(t,e,a,r){var n=g(t,e,a,r),i=n[0],o=n[1];return this.send(i,o,!0)},e.prototype.flush=function(){},e.prototype.updateCommonPackage=function(t){(null==t?void 0:t.h5_extra_attr)&&Object.assign(this.h5ExtraAttr,t.h5_extra_attr)},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=""),"object"==typeof t&&t){var a=t.page,r=void 0===a?this.currentUrlPackage.page:a,n=t.params,i=void 0===n?{}:n;if(!(this.entered===r))return void(this.currentUrlPackage.params=Object.assign(this.currentUrlPackage.params||{},i));this.send("PV",{type:"visible",params:t.params})}},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage)},e}(),p=function(){function t(){}return t.prototype.apply=function(t){this.weblog=t},t}();a=function(t,e){var a;null===KwaiBridgeCenter||void 0===KwaiBridgeCenter||KwaiBridgeCenter.commonBridge(JSON.stringify({nameSpace:"tool",methodName:"iOS"===(null===(a=null===Tachikoma||void 0===Tachikoma?void 0:Tachikoma.env)||void 0===a?void 0:a.platform)?"setClientLog":"setClientLogAsync",params:t}),(function(t,a){var r=JSON.parse(t);e&&e(r.result,a)}))},i="KDS_NATIVE"||"REACT_NATIVE",l.kdsUtils={appVersion:null===(c=null===Tachikoma||void 0===Tachikoma?void 0:Tachikoma.env)||void 0===c?void 0:c.appVersion};export{p as BasePlugin,l as Weblog,l as default};
//# sourceMappingURL=log.kdsnative.js.map
