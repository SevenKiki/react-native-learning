{"version":3,"file":"log.krnbridge.js","sources":["../node_modules/tslib/tslib.es6.js","../src/util/console.ts","../src/platform/krn/yoda.ts","../src/util/index.ts","../src/util/history-polyfill.ts","../src/platform/krn/bridge.ts","../src/util/uuid.ts","../src/plugins/base.ts","../src/platform/krn/krn.ts","../src/entries/krnbridge.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","export function log(...args: any[]) {\n    try {\n        const log = console?.log;\n        return log && log.call(console, ...args);\n    } catch (e) {\n        return;\n    }\n}\n\nexport function warn(...args: any[]) {\n    try {\n        const warn = console?.warn;\n        return warn && warn.call(console, ...args);\n    } catch (e) {\n        return;\n    }\n}\nconst sdkName: string = '__SDK_NAME__';\nexport function error(...args: any[]) {\n    try {\n        const error = sdkName === 'webLogger_krn' ? console?.log : console?.error;\n        return error && error.call(console, ...args);\n    } catch (e) {\n        return;\n    }\n}\n","\nimport { error } from '@/util/console';\nimport { stringifyParams } from '@/util';\n\ntype Invoke = (json: string, callback?: (result: any, message: string) => void) => void;\n\nlet bridgeInvoke: Invoke;\nlet container: string = 'REACT_NATIVE';\n\nexport function setBridgeInvoke(invoke: Invoke, injectContainer: string) {\n    bridgeInvoke = invoke;\n    container = injectContainer || 'REACT_NATIVE';\n}\n\nexport function getContainer() {\n    return container;\n}\n\nconst setClientLog = (log: any) => {\n    log.data.container = container;\n    log.data.page_type = 'NATIVE';\n    try {\n        bridgeInvoke(\n            log,\n            (result: any, message: string) => {\n                if (result !== 1) {\n                    error('setClientLog error', result, message);\n                }\n            }\n        )\n    } catch (err) {\n        error('yoda invoke error');\n    }\n};\n\n\nexport const sendPV = (page: string, options: any) => {\n    const { params, contentPackage, identity, h5ExtraAttr, coPage, feedLogCtx, status, timeCost = 0  } = options || {};\n    setClientLog({\n        type: 'setCurrentPage',\n        data: {\n            page,\n            identity,\n            params: stringifyParams(params),\n            contentPackage: stringifyParams(contentPackage),\n            h5ExtraAttr: JSON.stringify(h5ExtraAttr),\n            action: 'PV',\n            pageType: 'NATIVE',\n            coPage,\n            feedLogCtx,\n            status,\n            timeCost,\n        },\n    });\n};\n\nexport const closeCoPage = (options: any) => {\n    setClientLog({\n        type: 'closeCoPage',\n        data: options,\n    });\n};\n\nexport const sendShow = (action: string, options?: any) => {\n    const { params, contentPackage, areaPackage, urlPage, h5ExtraAttr, feedLogCtx, status, bridgeFields } = options || {};\n    setClientLog({\n        type: 'addElementShowEvent',\n        data: {\n            ...bridgeFields,\n            action,\n            params: stringifyParams(params),\n            urlPage,\n            areaPackage,\n            contentPackage: stringifyParams(contentPackage),\n            h5ExtraAttr: JSON.stringify(h5ExtraAttr),\n            feedLogCtx,\n            status,\n        },\n    });\n};\n\nexport const sendClick = (action: string, options: any) => {\n    const { params, contentPackage, areaPackage, urlPage, entryTag, h5ExtraAttr, feedLogCtx, status, bridgeFields } = options || {};\n    setClientLog({\n        type: 'addTaskEvent',\n        data: {\n            ...bridgeFields,\n            action,\n            params: stringifyParams(params),\n            urlPage,\n            areaPackage,\n            contentPackage: stringifyParams(contentPackage),\n            entryTagInfo: entryTag,\n            h5ExtraAttr: JSON.stringify(h5ExtraAttr),\n            feedLogCtx,\n            type: 'USER_OPERATION',\n        }\n    })\n};\n\nexport const sendTask = (action: string, options: any) => {\n    const { params, contentPackage, areaPackage, urlPage, entryTag, type, h5ExtraAttr, feedLogCtx, status, bridgeFields } = options || {};\n    setClientLog({\n        type: 'addTaskEvent',\n        data: {\n            ...bridgeFields,\n            action,\n            params: stringifyParams(params),\n            urlPage,\n            areaPackage,\n            contentPackage: stringifyParams(contentPackage),\n            entryTagInfo: entryTag,\n            h5ExtraAttr: JSON.stringify(h5ExtraAttr),\n            feedLogCtx,\n            type: type || 'BACKGROUND_TASK_EVENT',\n            status,\n        }\n    })\n};\n// noStat为true时上报变成custom_event，否则为正常的custom_stat_event\nexport const sendCustom = (key: string, options: any, noStat: boolean = false) => {\n    const { value, biz, contentPackage, areaPackage, urlPage, h5ExtraAttr, bridgeFields } = options || {};\n    setClientLog({\n        type: noStat ? 'addCustomEvent' : 'addCustomStatEvent',\n        data: {\n            ...bridgeFields,\n            key,\n            value: stringifyParams(value),\n            urlPage,\n            areaPackage,\n            contentPackage: stringifyParams(contentPackage),\n            h5ExtraAttr: JSON.stringify(h5ExtraAttr),\n            biz,\n        }\n    })\n};\n","import { ksAppList } from './const';\nimport { getCookie } from '@/util/cookie';\nimport type { UrlMapFn, UrlMap, UrlMapFnParam } from '../config/types';\nimport { error } from './console';\n\n/**\n * 获取 localStorage 缓存\n */\nexport function getLocalStorageItem(key: string) {\n    try {\n        if (window && window.localStorage) {\n            const value = window.localStorage.getItem(key);\n            if (value) {\n                try {\n                    return JSON.parse(value);\n                } catch (err) {\n                    return value;\n                }\n            }\n        }\n    } catch (err) {\n        return null;\n    }\n    return null;\n\n}\n/**\n * 设置 localStorage 缓存\n */\nexport function setLocalStorageItem(key: string, value: any) {\n    try {\n        if (window && window.localStorage) {\n            window.localStorage.setItem(key, JSON.stringify(value));\n            return true;\n        }\n    } catch (err) {\n        return false;\n    }\n    return false;\n}\n\n/**\n * 判断item是否在目标数组arr中\n * @param {*} arr   目标数组\n * @param {*} item  item\n */\nexport function inArray(arr: any[], item: any) {\n    return arr.indexOf(item) > -1;\n}\n/**\n * 从目标arr中删除item\n * @param {*} arr  目标数组\n * @param {*} item  item\n */\nexport function deleteArray(arr: any[], item: any) {\n    const index = arr.indexOf(item);\n\n    if (index > -1) {\n        arr.splice(index, 1);\n    }\n}\n\n/**\n * 事件监听兼容处理\n * @param {*} evtTarget  事件监听目标\n * @param {*} evtName   事件名\n * @param {*} callback  回调函数\n * @param {*} options  相关参数设置\n */\nexport function addMonitor(\n    evtTarget: Element | Window | Document,\n    evtName: string,\n    callback: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n) {\n    if ('attachEvent' in evtTarget) {\n        return evtTarget.attachEvent('on' + evtName, callback);\n    }\n    return evtTarget.addEventListener(evtName, callback, options);\n}\n\n/**\n * 事件监听解绑兼容处理\n * @param {*} evtTarget  事件监听目标\n * @param {*} evtName   事件名\n * @param {*} callback  事件回调\n */\nexport function removeMonitor(\n    evtTarget: Element | Window | Document,\n    evtName: string,\n    callback: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n) {\n    if ('attachEvent' in evtTarget) {\n        return evtTarget.detachEvent('on' + evtName, callback);\n    }\n    return evtTarget.removeEventListener(evtName, callback, options);\n}\n\nexport function leftPad(str: string, len: number, ch = ' ') {\n    len = len - str.length;\n    if (len <= 0) {\n        return str;\n    }\n    let pad = '';\n    while (len) {\n        if (len & 1) {\n            pad += ch;\n        }\n        len >>= 1;\n        ch += ch;\n    }\n    return pad + str;\n}\n\n/**\n * 是否是快手系APP\n */\nexport const isInApp = (ua = window.navigator.userAgent.toLowerCase()) => {\n    try {\n        for (let i = 0; i < ksAppList.length; i++) {\n            if (ua.indexOf(ksAppList[i]!.toLowerCase()) > -1) {\n                return true;\n            }\n        }\n    } catch (err) {\n        return false;\n    }\n};\n\nexport function parseQueryString(queryString: string) {\n    const result: any = {};\n    const queries = queryString.split('&');\n    for (const query of queries) {\n        const [key, value] = query.split('=');\n        if (!(key! in result)) {\n            result[key!] = value;\n            continue;\n        }\n        if (result[key!] instanceof Array) {\n            result[key!].push(value);\n            continue;\n        }\n        result[key!] = [result[key!], value];\n    }\n    return result;\n}\n\nexport function stringifyQuery(paramsString: any) {\n    const params = typeof paramsString === 'string' ? JSON.parse(paramsString) : paramsString;\n    const queries: string[] = [];\n    Object.keys(params).forEach(key => {\n        if (params[key] instanceof Array) {\n            for (const val of params[key]) {\n                queries.push(`${key}=${val}`);\n            }\n        } else if (typeof params[key] === 'object' && params[key] !== null) {\n            queries.push(`${key}=${JSON.stringify(params[key])}`);\n        } else {\n            queries.push(`${key}=${params[key]}`);\n        }\n    });\n    return queries.join('&');\n}\n\n// 参考：https://codereview.stackexchange.com/questions/37512/count-byte-length-of-string\nexport function getStringBytes(data: any) {\n    let dataStr = '';\n\n    // Force string type\n    if (typeof data === 'string') {\n        dataStr = data;\n    } else {\n        try {\n            dataStr = JSON.stringify(data);\n        } catch (e) {\n            dataStr = String(data);\n        }\n    }\n\n    let byteLen = 0;\n    for (let i = 0; i < dataStr.length; i++) {\n        const c = dataStr.charCodeAt(i);\n        byteLen += c < (1 << 7) ? 1 :\n            c < (1 << 11) ? 2 :\n                c < (1 << 16) ? 3 :\n                    c < (1 << 21) ? 4 :\n                        c < (1 << 26) ? 5 :\n                            c < (1 << 31) ? 6 : Number.NaN;\n    }\n    return byteLen;\n}\n\n/**\n * lodash 的 pick 方法\n */\nexport function pick(data: any, paths: string[]) {\n    let index = -1;\n    const length = paths.length;\n    const result: any = {};\n\n    while (++index < length) {\n        const path = paths[index];\n        const value = data[path!];\n        result[path!] = value;\n    }\n\n    return result;\n}\n\n/**\n * lodash的omit方法\n * @param data\n * @param paths\n */\nexport function omit(data: any, paths: string[]) {\n    const result: any = {};\n\n    for (const i in data) {\n        if (data.hasOwnProperty(i)) {\n            if (Array.isArray(paths) && paths.indexOf(i) === -1) {\n                result[i] = data[i];\n            }\n        }\n    }\n\n    return result;\n}\n\n/**\n * 检查依赖版本号是否不小于推荐版本\n */\nexport function checkVersion(recommendVersion: string, version: string) {\n    if (!version) return false;\n    if (version.indexOf('alpha') !== -1) return false;\n    if (version.indexOf('beta') !== -1) return false;\n    try {\n        let matches = recommendVersion.match(/\\d+\\.\\d+\\.\\d+/);\n        recommendVersion = matches?.[0] || '';\n        if (!recommendVersion) return true;\n\n        matches = version.match(/\\d+\\.\\d+\\.\\d+/);\n        version = matches?.[0] || '';\n        if (!version) return false;\n\n        const [rMajor, rMinor, rPatch] = recommendVersion.split('.').map((i: string) => Number(i));\n        const [major, minor, patch] = version.split('.').map((i: string) => Number(i));\n\n        if (major! < rMajor!) return false;\n        if (major! > rMajor!) return true;\n\n        if (minor! < rMinor!) return false;\n        if (minor! > rMinor!) return true;\n\n        if (patch! < rPatch!) return false;\n\n        return true;\n    } catch (err) {\n        return false;\n    }\n}\n\nexport function checkSupportCloseCoPage() {\n    const version = getCookie('appver', undefined, true);\n    return version && checkVersion('10.8.30', version);\n}\n/**\n * 获取元素xpath\n * @param element 元素\n */\nexport function getXpathFromNode(element: HTMLElement): string {\n    // if (element && element.id !== '')\n    //     return 'id(\"' + element.id + '\")';\n    if (element === document.body)\n        return 'HTML/' + element.tagName;\n\n    let ix = 0;\n    if (element && element.parentNode) {\n        const siblings = element.parentNode.childNodes;\n        for (let i = 0; i < siblings.length; i++) {\n            const sibling = siblings[i] as HTMLElement;\n            if (sibling === element)\n                return getXpathFromNode(element.parentNode as HTMLElement) + '/' + element.tagName + '[' + (ix + 1) + ']';\n            if (sibling.nodeType === 1 && sibling.tagName === element.tagName)\n                ix++;\n        }\n    }\n    return '';\n}\n\n/**\n * url中获取path和query\n */\nexport function getPathAndQueryFromUrl() {\n    const { protocol, host, pathname, search, href } = window.location;\n    const pageUrl = href;\n    const pagePath = protocol + host + pathname;\n    const pageParams = parseQueryString(search.slice(1));\n    return { pageUrl, pagePath, pageParams };\n}\n\nexport function getUrlAndQueryFromUrl(url = location.href) {\n    const queryIndex = url.lastIndexOf('?');\n    if (queryIndex === -1) {\n        return {\n            page: url\n        };\n    }\n    const page = url.slice(0, queryIndex);\n    const queryString = url.slice(queryIndex + 1);\n    return {\n        page,\n        params: parseQueryString(queryString),\n    };\n};\n\nexport const getMappingPage = (urlPackage: UrlMapFnParam, urlMap?: UrlMap | UrlMapFn) => {\n    let { url, page, params, pageId } = urlPackage;\n    if (!page && typeof url === 'string') {\n        const parsed = getUrlAndQueryFromUrl(url);\n        page = parsed.page;\n        params = parsed.params;\n    }\n    if (typeof urlMap === 'function') {\n        try {\n            const res = urlMap({ url, page, params });\n            if (typeof res === 'string') {\n                page = res;\n            } else if (typeof res === 'object') {\n                if (res.page) {\n                    page = res.page;\n                }\n                if (res.params) {\n                    params = res.params;\n                }\n                if (res.pageId) {\n                    pageId = res.pageId;\n                }\n            }\n        } catch (err) { }\n    } else if (typeof urlMap === 'object') {\n        let mappingPage = '';\n        for (const key in urlMap) {\n            if ((url || page || '').indexOf(key) > -1) {\n                mappingPage = urlMap[key]!;\n                break;\n            }\n        }\n        if (mappingPage) {\n            page = mappingPage;\n        }\n    }\n    return {\n        page,\n        params,\n        pageId\n    };\n};\n\nexport function cloneDeep(obj: [] | {}): [] | {} {\n    if (typeof obj !== 'object') return {};\n    const newObj = obj instanceof Array ? [] : {};\n    for (const key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            // @ts-ignore\n            newObj[key] = typeof obj[key] === 'object' ? cloneDeep(obj[key]) : obj[key];\n        }\n    }\n    return newObj;\n}\n\n/**\n * 非空纯对象判定\n * @param obj\n * @returns\n */\n const isObj = (obj: any) => obj && typeof obj === 'object' && !Array.isArray(obj);\n /**\n  * 对象打平赋值\n  * @param target\n  * @param options\n  * @returns\n  */\n export const flattenAssign = (target: any, options: any) => {\n    if (!isObj(target) || !isObj(options)) return;\n    const merge = (obj1: any, obj2: any, key: string) => {\n        if (isObj(obj1[key]) && isObj(obj2[key])) {\n            Object.assign(obj1[key], obj2[key]);\n        } else if (!isObj(obj1[key]) && !isObj(obj2[key])){\n            obj1[key] = obj2[key];\n        }\n    }\n    for (const key in options) {\n        if (target.hasOwnProperty(key)) {\n            merge(target, options, key);\n            continue;\n        }\n        for (const deepKey in target) {\n            if (isObj(target[deepKey]) && target[deepKey].hasOwnProperty(key)) {\n                merge(target[deepKey], options, key);\n            }\n        }\n    }\n}\n\nexport function pageUrlValidate(page: string) {\n    // 对于上报到v2，page为url的埋点，给予警告\n    if (page && /^(https?:)?\\/\\//.test(page)) {\n        error('[error 108]',`请注意当前埋点页面信息为 ${page}，不符合规范，上报失败！`);\n        return false;\n    }\n    return true;\n}\n\nexport const getResolution = (() => {\n    let resolution = '';\n    return () => {\n        if (resolution) {\n            return resolution;\n        }\n        try {\n            const ratio = window.devicePixelRatio || 1;\n            const width = Math.floor(screen.width * ratio); // 有的devicePixelRatio为小数，在此转为整数\n            const height = Math.floor(screen.height * ratio);\n            resolution = `${width}x${height}`;\n            return resolution;\n        } catch (err) {\n            return '';\n        }\n    };\n})();\n\n// 从vue-router里面拿的……\nexport function supportsPushState() {\n    const ua = window.navigator.userAgent;\n    if (\n        (ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1)\n        && ua.indexOf('Mobile Safari') !== -1\n        && ua.indexOf('Chrome') === -1\n        && ua.indexOf('Windows Phone') === -1\n    ) {\n        return false;\n    }\n    return window.history && 'pushState' in window.history;\n}\n\nexport function deleteUrlQueryAndReturnFullUrl(url: string, deleteKeyArray: string[]) {\n    const { page, params } = getUrlAndQueryFromUrl(url);\n    if (Array.isArray(deleteKeyArray) && deleteKeyArray.length) {\n        deleteKeyArray.forEach(key => {\n            delete params[key];\n        });\n        let paramsString = '';\n        for (const i in params) {\n            if (params.hasOwnProperty(i)) {\n                paramsString += paramsString ? '&' : '';\n                paramsString += `${i}=${params[i]}`;\n            }\n        }\n        return paramsString ? `${page}?${paramsString}` : page;\n    }\n    return url;\n}\n\ninterface TypeQueryMap {\n    [key: string]: string | number;\n}\n\n/**\n * 设置url中的参数，并返回完整url\n * @param url\n * @param configQueryMap\n */\nexport function setUrlQueryAndReturnFullUrl(url: string, configQueryMap: TypeQueryMap): string {\n    if (typeof configQueryMap !== 'object') {\n        return url;\n    }\n    let paramsString = '';\n    for (const i in configQueryMap) {\n        if (configQueryMap.hasOwnProperty(i)) {\n            const paramString = `${i}=${configQueryMap[i]}`;\n            paramsString += paramsString ? `&${paramString}` : paramString;\n        }\n    }\n    let partUrl;\n    const lastChar = url[url.length - 1];\n    if (url.indexOf('?') === -1) {\n        // 不存在变量\n        partUrl = `?${paramsString}`;\n    } else if (lastChar === '?' || lastChar === '&') {\n        // 处理最后一个字符是 ? 以及 & 的特殊情况\n        partUrl = paramsString;\n    } else {\n        // 正常添加变量\n        partUrl = `&${paramsString}`;\n    }\n    return url + partUrl;\n}\n\nexport function isMobileAndIpad() {\n    const ua = window?.navigator?.userAgent || '';\n    const isMobile = /mobile|tablet|ip(ad|hone|od)|android|(windows phone)/i.test(ua);\n    // 兼容最新版本 ipad 版本 ua 判断\n    const isiPad = window?.navigator.platform === 'MacIntel' && window?.navigator?.maxTouchPoints > 1;\n    return isMobile || isiPad;\n}\n\n/**\n * 是否支持 worker gzip 压缩\n * @returns\n */\nexport const enableAsyncGzip = () => !!(\n    window?.Worker // 可以新建 worker\n    && window?.Uint8Array // 支持二进制存储\n    && window.URL // 可以创建文件路径\n    && window.Promise // 可以使用 promise\n    && !isMobileAndIpad() // 移动端禁止使用压缩\n);\n\n/**\n * 返回正整数数值\n * @param value\n */\nexport const getPositiveInteger = (value: number) => {\n    try {\n        return Math.abs(Math.floor(value));\n    } catch (e) {\n        return value;\n    }\n};\n\nexport function stringifyParams(params: string | any) {\n    return typeof params === 'string' ? params : typeof params === 'object' ? JSON.stringify(params) : '';\n}\n","import type {\n    EventType as IEventType,\n    EventOptions as IEventOptions,\n    DangerCunstomEventOption\n} from '@/types/event';\n\nexport const oldApiTransformer = <T extends IEventType>(\n    type: T | { type: T },\n    name: string | IEventOptions<T> = {},\n    params?: any,\n    contentPackage?: {[key: string]: any} | string\n): [T, IEventOptions<T>] => {\n    let realType: T;\n    if (typeof type !== 'string') {\n        realType = type.type;\n    }\n    realType = (type as T).toUpperCase() as T;\n    let options: any = {};\n    if (typeof name === 'string') {\n        console.warn('[warn 105]', '接口参数为旧式，后续版本将不再兼容，推荐使用新的参数形式');\n        options.contentPackage = contentPackage;\n        if (type === 'CUSTOM') {\n            options.key = name;\n            options.value = params;\n        } else {\n            options.params = params;\n            if (type === 'PV') {\n                options.page = name;\n            }else {\n                options.action = name;\n            }\n        }\n    } else {\n        options = name;\n        if (['CUSTOM', 'CUSTOM_EVENT'].includes(realType)) {\n            const customParams = name as DangerCunstomEventOption & { key?: string; value?: any };\n            if (customParams.action && !customParams.key) {\n                options.key = customParams.action;\n            }\n            if (customParams.params && !customParams.value) {\n                options.value = customParams.params;\n            }\n        }\n    }\n    return [\n        realType,\n        options\n    ];\n};","/**\n * KRN 纯桥接版本\n */\n import type { BasePlugin, BasePluginConstructor } from '@/plugins/base';\n import type {\n    EventType as IEventType,\n    EventOptions as IEventOptions,\n} from '@/types/event';\nimport type { UrlObj, PageTypeKey } from '@/types/configuration';\nimport { uuid } from '@/util/uuid';\nimport { sendPV, sendClick, sendShow, sendTask, sendCustom, closeCoPage, getContainer } from './yoda';\nimport { checkVersion, stringifyParams } from '@/util';\nimport { oldApiTransformer } from '@/util/history-polyfill';\n\ntype KrnEventOptions<T extends IEventType> = IEventOptions<T> & {\n    /**\n     * 位置信息\n     */\n    areaPackage?: any;\n    /**\n     * 染色信息，CLICK 事件时可以按需设置\n     */\n    entryTag?: any;\n};\ninterface KrnConfig {\n    plugins?: BasePlugin[];\n    /**\n     * 是否作为元素，不需要上报 PV\n     */\n    disablePV?: boolean;\n    /**\n     * 业务线标识\n     */\n    biz?: string;\n};\n\nexport interface UrlPage {\n    page: string; // url_package.page 当前 page 的 name\n    identity?: string;\n    params?: any;\n    coPage?: boolean;\n}\n\ntype BaseOptions = { h5_extra_attr: any };\n\nlet pluginIndex = 0;\nexport default class Weblogger {\n    static kdsUtils: {\n        appVersion: string;\n    }\n    h5ExtraAttr = {\n        sdk_name: '__SDK_NAME__',\n        sdk_version: '__VERSION__',\n        sdk_bundle: '__SDK_BUNDLE__',\n        coPage: false,\n    };\n    version = this.h5ExtraAttr.sdk_version;\n    currentUrlPackage: {\n        page: string;\n        params?: {[key: string]: any};\n        identity: string;\n        coPage?: boolean;\n        category?: string;\n    } = {\n        page: '',\n        params: {},\n        identity: '',\n        coPage: false,\n    };\n    logConfig: KrnConfig;\n    // 插件\n    plugins: {\n        [key: string]: BasePlugin | any;\n    } = {};\n    // 记录页面是否已发送过 enter pv;\n    entered: String = '';\n    constructor(logConfig: KrnConfig, base?: BaseOptions) {\n        this.logConfig = { ...logConfig };\n        Object.assign(this.h5ExtraAttr, base?.h5_extra_attr);\n        this.addPlugins();\n    }\n    get commonPackage() {\n        return {\n            h5_extra_attr: this.h5ExtraAttr\n        }\n    }\n    /**\n     * 初始化插件\n     * @param plugins\n     */\n    addPlugins() {\n        if (!this.logConfig.plugins || !this.logConfig.plugins.length) return;\n        // 类似 webpack plugins 的实例数组\n        this.logConfig.plugins.forEach((plugin: any) => {\n            if (typeof plugin === 'object' && typeof plugin.apply === 'function') {\n                this.addPluginInstance(plugin);\n            }\n        });\n    }\n    /**\n     * 加载插件实例\n     */\n    addPluginInstance(pluginInstance: any) {\n        if (pluginInstance) {\n            const key = pluginInstance.key || pluginInstance.constructor && pluginInstance.constructor.key || `plugin_auto_key_${pluginIndex++}`;\n            if (typeof pluginInstance.apply === 'function'\n                && (!pluginInstance.weblog || pluginInstance.weblog !== this)\n            ) {\n                pluginInstance.apply(this);\n            }\n            this.plugins[key] = pluginInstance;\n        }\n    }\n    /**\n     * 加载插件构造函数\n     * @param plugin\n     * @param pluginOptions\n     */\n    plug(plugin: BasePluginConstructor, pluginOptions?: any) {\n        if (this.plugins[plugin.key]) {\n            throw new Error(`There is a duplex plugin called ${plugin.key}`);\n        }\n        this.addPluginInstance(new plugin(this, pluginOptions));\n    }\n\n    send<T extends IEventType>(\n        eventType: T,\n        options: KrnEventOptions<T>,\n        immediately?: boolean\n    ) {\n        eventType = eventType.toUpperCase() as T;\n        let h5ExtraAttr = this.h5ExtraAttr;\n        const { action, contentPackage, params, areaPackage, type, feedLogCtx, status, disablePV, urlPage, bridgeFields } = options as KrnEventOptions<'CLICK'>;\n        if (eventType === 'PV') {\n            if (this.logConfig.disablePV) return;\n            const { page = this.currentUrlPackage.page, type = 'enter', coPage, timeCost, status, category  } = options as KrnEventOptions<'PV'>;\n            // @ts-ignore\n            const appVersion = Weblogger.kdsUtils.appVersion;\n            if (\n                type === 'leave'\n                && this.currentUrlPackage.coPage\n                && appVersion\n                && checkVersion('10.8.30', appVersion)\n            ) {\n                closeCoPage({\n                    ...this.currentUrlPackage,\n                    ...options,\n                });\n                return;\n            }\n            // 目前 RN 只接受 pv 事件下enter和visible类型\n            if (type !== 'enter' && type !== 'visible') {\n                console.warn('[webLogger] 目前 RN 桥接的 PV 事件仅支持 type 为 enter 或 visible!');\n                return;\n            }\n            if (type === 'enter') {\n                if (page) {\n                    this.currentUrlPackage = {\n                        page,\n                        coPage: false,\n                        params,\n                        identity: uuid(),\n                    };\n                    this.entered = page;\n                }\n                if (coPage) {\n                    this.currentUrlPackage.coPage = coPage;\n                    this.h5ExtraAttr.coPage = coPage;\n                }\n                if (category) {\n                    this.currentUrlPackage.category = category;\n                }\n            }\n            this.currentUrlPackage.params = { ...(this.currentUrlPackage.params || {}), ...params };\n            if (!this.currentUrlPackage.page) return;\n            return sendPV(this.currentUrlPackage.page, {\n                ...this.currentUrlPackage,\n                contentPackage,\n                feedLogCtx,\n                h5ExtraAttr,\n                status,\n                timeCost,\n                bridgeFields,\n            });\n        }\n        let localUrlPage: UrlPage | undefined;\n        if (urlPage?.page) {\n            localUrlPage = {\n                page: urlPage.page,\n                identity: urlPage.identity,\n                params: getContainer() === 'REACT_NATIVE' ? urlPage.params : stringifyParams(urlPage.params),\n            };\n        } else {\n            const currentUrlPackage = getContainer() === 'REACT_NATIVE' ? this.currentUrlPackage : {\n                ...this.currentUrlPackage,\n                params: stringifyParams(this.currentUrlPackage.params),\n            }\n            localUrlPage = (this.logConfig.disablePV || disablePV || !this.currentUrlPackage.page)\n                ? undefined\n                : currentUrlPackage;\n        }\n        if (eventType === 'SHOW') {\n            return sendShow(action, {\n                urlPage: localUrlPage,\n                params,\n                contentPackage,\n                areaPackage,\n                h5ExtraAttr,\n                feedLogCtx,\n                status,\n                bridgeFields,\n            });\n        }\n        if (eventType === 'CLICK' && (!type || type === 'USER_OPERATION')) {\n            const { entryTag } = options as KrnEventOptions<'CLICK'>;\n            return sendClick(action, {\n                urlPage: localUrlPage,\n                params,\n                areaPackage,\n                contentPackage,\n                entryTag: entryTag ? {\n                    page_name: this.currentUrlPackage.page,\n                    element_action: action,\n                    ...entryTag,\n                } : undefined,\n                h5ExtraAttr,\n                feedLogCtx,\n                status,\n                bridgeFields,\n            });\n        }\n        if (['CUSTOM_EVENT', 'CUSTOM'].includes(eventType)) {\n            const { key, value, biz } = options as KrnEventOptions<'CUSTOM'>;\n            let noStat = eventType === 'CUSTOM_EVENT';\n            const customValue = value || params;\n            return sendCustom(key || action, {\n                urlPage: localUrlPage,\n                value: {\n                    ...customValue,\n                    url_package: localUrlPage,\n                },\n                biz: biz || this.logConfig.biz,\n                areaPackage,\n                contentPackage,\n                h5ExtraAttr,\n                feedLogCtx,\n                bridgeFields,\n            }, noStat);\n        }\n        return sendTask(action, {\n            urlPage: localUrlPage,\n            params,\n            areaPackage,\n            contentPackage,\n            h5ExtraAttr,\n            type,\n            feedLogCtx,\n            bridgeFields,\n            status,\n        });\n    }\n\n    collect<T extends IEventType>(type: T, options: KrnEventOptions<T>): void;\n    collect<T extends IEventType>(type: T, name: string, params?: any, contentPackage?: { [keys: string]: any } | string): void;\n    collect<T extends IEventType>(\n        type: T,\n        name: string | KrnEventOptions<T>,\n        params?: any,\n        contentPackage?: { [keys: string]: any } | string,\n    ) {\n        const [logType, logParams] = oldApiTransformer(type, name, params, contentPackage);\n        return this.send(logType, logParams, false);\n    }\n\n    sendImmediately<T extends IEventType>(type: T, options: KrnEventOptions<T>): void;\n    sendImmediately<T extends IEventType>(type: T, name: string, params?: any, contentPackage?: { [keys: string]: any } | string): void;\n    sendImmediately<T extends IEventType>(\n        type: T,\n        name: string | KrnEventOptions<T>,\n        params?: any,\n        contentPackage?: { [keys: string]: any } | string,\n    ) {\n        const [logType, logParams] = oldApiTransformer(type, name, params, contentPackage);\n        return this.send(logType, logParams, true);\n    }\n    flush() {}\n    updateCommonPackage(options: any) {\n        if (options?.h5_extra_attr) {\n            Object.assign(this.h5ExtraAttr, options.h5_extra_attr);\n        }\n    }\n    updateCurrentUrlPackage(url: string | UrlObj = '', type: PageTypeKey = 'native') {\n        if (typeof url === 'object' && url) {\n            const { page = this.currentUrlPackage.page, params = {} } = url;\n            const isPageEntered =  this.entered === page;\n            if (!isPageEntered) {\n                this.currentUrlPackage.params = Object.assign(this.currentUrlPackage.params || {}, params);\n                return;\n            }\n            this.send('PV', {\n                type: 'visible',\n                params: url.params,\n            });\n        }\n    }\n    updateReferUrlPackage(url: string | UrlObj = this.currentUrlPackage, type: PageTypeKey = 'native') {\n        // 为兼容 krn 一码多端，加一个空方法，因为桥接里使用这个方法实际上是对安卓无效的\n    }\n}\n","import { isInApp } from '.';\nimport { getCookie, setCookie } from './cookie';\n\nexport function uuid() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n/**\n * 生成nano id\n * @return {string} 16长度的字符串\n */\nexport function nanoId() {\n    const ts = ((Math.random() * 1e9) >>> 0);\n    const randomer = [];\n    const seed = '0123456789ABCDEF';\n    for (let i = 0; i < 7; i++) {\n        randomer.push(seed.charAt(Math.random() * 16));\n    }\n\n    return ts + randomer.join('');\n}\n/**\n * 提取顶级域名\n * @param {?string=} hostname\n * @return {string} 返回顶级域名\n */\nfunction resolveTopLevelDomain(hostname: string = typeof location !== 'undefined' ? location.hostname : '') {\n    if (!hostname) {\n        return '';\n    }\n\n    const ret = hostname.split('.');\n    const len = ret.length;\n    return (len <= 2 ? '' : `.${ret[len - 2]}.${ret[len - 1]}`);\n}\nconst didKey: string = 'did';\n/**\n * 生成did\n * @return {string}\n */\nexport function generateDID() {\n    try {\n        // 兼容一下原下发的did逻辑，如果能从did获取，那么就走did\n        // 如果不能，那就通过log sdk自行维护的_did来搞\n        let did = getCookie(didKey) || getCookie('_did');\n        if (!did) {\n            did = `web_${nanoId()}`;\n            const expires = new Date();\n            expires.setFullYear(expires.getFullYear() + 1);\n            setCookie('_did', did, {\n                expires,\n                domain: resolveTopLevelDomain(),\n                path: '/',\n            });\n        }\n        return did;\n    } catch (err) {\n        return '';\n    }\n}\nconst sessionKey = 'WEBLOGGER_SESSIONID';\n// session_id 用来串联在一次打开 App 期间跳转不同页面的用户行为\nexport const getSessionId = () => {\n    let sessionId: string = '';\n    const defaultKey = 'session_id';\n    try {\n        if (isInApp()) {\n            sessionId = getCookie(defaultKey) || getCookie('sid'); // 端内从 cookie 中获取客户端传来的 session_id\n            if (sessionId) return sessionId;\n        } else if (typeof sessionStorage !== 'undefined') {\n            sessionId = sessionStorage.getItem(sessionKey) || '';\n            if (!sessionId) {\n                sessionId = uuid();\n                sessionStorage.setItem(sessionKey, sessionId);\n            }\n        }\n    } catch (err) {\n        sessionId = uuid();\n    }\n    return sessionId || uuid();\n};\n","import type { BaseWeblogInstance } from '@/types/index';\n\nexport abstract class BasePlugin {\n    declare weblog: BaseWeblogInstance;\n    abstract destroy(): void;\n    apply(weblog: BaseWeblogInstance) {\n        this.weblog = weblog;\n    }\n    /**\n     * 统一由 weblog 在页面关闭前调用的生命周期函数\n     */\n    beforeUnload?: (event: Event) => void;\n    static key: string;\n}\n\nexport interface BasePluginConstructor {\n    new(options?: any): any;\n    new(weblogger?: any, options?: any): any;\n    key: string;\n}\n/**\n * 在 bootstrap 环境下自动注册插件\n * @param Plugin\n * @param optionKey\n */\nexport const autoRegister = (Plugin: any, optionKey?: string) => {\n    if (\n        typeof window === 'undefined' ||\n        typeof window._GLOBAL_KS_WEBLOGGER_ === 'undefined' ||\n        typeof Plugin !== 'function') return;\n    const { weblog, config } = window._GLOBAL_KS_WEBLOGGER_;\n    let option = optionKey ? config.plugins[optionKey]?.options : undefined;\n    weblog.addPluginInstance(new Plugin(option));\n}\n","import { NativeModules, AppState, Platform } from 'react-native';\n\nexport interface KrnDeviceInfo {\n    appVersion: string;\n    locale: string;\n    uuid: string;\n    systemVersion: string;\n    networkType: string;\n    manufacturer: string;\n    model: string;\n    screenWidth: number;\n    screenHeight: number;\n    statusBarHeight: number;\n    titleBarHeight: number;\n    os: string;\n    osVersion: string;\n    androidId?: string;\n    product_name?: string;\n    idfa?: string;\n    imei?: string;\n    globalId?: string;\n};\nexport interface KrnPageInfo {\n    RNVersion?: string;\n    SDKVersion?: string;\n    BundleId?: string;\n    BundleVersion?: string;\n    BundleVersionCode?: string;\n    ComponentName?: string;\n    TaskId?: string; // keep 发布的 task id\n}\n\nexport interface KrnLoggerDebug {\n    host: string;\n    duration: number;\n}\n\nexport interface KrnPlatform {\n    OS: string;\n    Version: number;\n}\n\nconst Krn: {\n    NativeModules: any;\n    AppState: any;\n    deviceInfo: KrnDeviceInfo;\n    Platform: typeof Platform;\n} = {\n    NativeModules,\n    AppState,\n    deviceInfo: getKrnDeviceInfo(),\n    Platform\n};\n\n/**\n * 获取 krn 的 page 信息\n * @param rootTag\n * @returns\n */\nexport const getCurrentPage = (rootTag: number): Promise<KrnPageInfo | {}> => {\n    return new Promise(resolve => {\n        try {\n            // debug 模式下获取不到页面信息\n            if (NativeModules?.RootViewPageBridge?.rootViewSignatureWith && typeof rootTag === 'number') {\n                NativeModules.RootViewPageBridge.rootViewSignatureWith(rootTag, (data: any) => {\n                    const resultData = typeof data === 'string' ? JSON.parse(data) : data;\n                    resolve({\n                        ...resultData,\n                    });\n                });\n            } else {\n                resolve({});\n            }\n        } catch (err) {\n            resolve({});\n        }\n    });\n};\n/**\n * 获取端内用户 id\n * @returns\n */\nexport const getUserId = (): Promise<string> => {\n    return new Promise(resolve => {\n        try {\n            if (NativeModules?.KSUserInfo) {\n                NativeModules.KSUserInfo.getUserInfo((res: any) => {\n                    resolve(res && res.userId);\n                });\n            } else {\n                resolve('');\n            }\n        } catch (err) {\n            resolve('');\n        }\n    })\n}\n\n/**\n * 获取 krn 设备信息\n */\nfunction getKrnDeviceInfo(): KrnDeviceInfo {\n    // ios/android 8.2.20版本新增\n    const deviceInfo = NativeModules?.KSRCTBridge?.deviceInfo || NativeModules?.KRNBasic?.deviceInfo;\n    if (deviceInfo) {\n        const dataJSON = typeof deviceInfo === 'string' ? JSON.parse(deviceInfo) : deviceInfo;\n        const { data, result } = dataJSON;\n        if (result === 1) {\n            const os = Platform.OS;\n            const osVersion = Platform.Version;\n            return {\n                ...data,\n                os,\n                osVersion\n            };\n        }\n    }\n    return {\n        appVersion: '',\n        locale: '',\n        uuid: '',\n        systemVersion: '',\n        networkType: '',\n        manufacturer: '',\n        model: '',\n        screenWidth: 0,\n        screenHeight: 0,\n        statusBarHeight: 0,\n        titleBarHeight: 0,\n        os: '',\n        osVersion: '',\n    };\n}\n\n/**\n * 通过bridge获取值切换发送地址\n */\nexport async function getKrnWebloggerSwitch() {\n    const NativeModules = Krn.NativeModules;\n    try {\n        const res = await NativeModules.WebLoggerDebugger?.getLoggerDebugConfig();\n        if (typeof res === 'string') {\n            const { host = '' } = JSON.parse(res);\n            if (!host) return;\n            const hostArr = host.match(/([^\\/]+)/g) || [];\n            const loggerSessionId = hostArr[hostArr.length - 1] || '';\n            if (!loggerSessionId) {\n                return '';\n            }\n            // const reportHost = host.split(loggerSessionId)[0] || '';\n            // get(`${reportHost}/${loggerSessionId}`);\n            return host;\n        }\n        return '';\n    } catch {\n        return '';\n    }\n}\n\nexport default Krn;","/**\n * 用于 React Native 等非浏览器环境\n */\n\nimport Weblog from '../platform/krn/bridge';\nimport { BasePlugin } from '../plugins/base';\nimport { setBridgeInvoke } from '@/platform/krn/yoda';\nimport { NativeModules } from 'react-native';\nimport Krn from '@/platform/krn/krn';\n\nexport type { BridgeConfig as LoggerConfigByUser } from '@/types/configuration';\nexport type { SupportTypes, SendConfig, PVOptions, ShowOptions, TaskOptions, CustomOptions, BaseOptions } from './types';\n\nsetBridgeInvoke((log: any, callback) => {\n    NativeModules.yoda.invoke(\n        'tool',\n        'setClientLog',\n        JSON.stringify(log),\n        callback);\n}, 'REACT_NATIVE')\n\n\nWeblog.kdsUtils = { appVersion: Krn.deviceInfo.appVersion };\n\nexport {\n    Weblog,\n    BasePlugin\n};\n\nexport default Weblog;\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__spreadArray","to","from","pack","ar","l","Array","slice","concat","bridgeInvoke","error","args","_i","error_1","console","log","e","stringifyParams","params","JSON","stringify","container","getContainer","setClientLog","data","page_type","result","message","err","oldApiTransformer","type","name","contentPackage","realType","toUpperCase","options","key","value","page","action","includes","customParams","pluginIndex","Weblogger","logConfig","base","h5ExtraAttr","sdk_name","sdk_version","sdk_bundle","coPage","version","currentUrlPackage","identity","plugins","entered","h5_extra_attr","addPlugins","defineProperty","get","_this","forEach","plugin","addPluginInstance","pluginInstance","constructor","weblog","plug","pluginOptions","Error","send","eventType","immediately","localUrlPage","_a","areaPackage","feedLogCtx","status","disablePV","urlPage","bridgeFields","_b","_c","_d","type_1","timeCost","status_1","category","appVersion","kdsUtils","recommendVersion","indexOf","matches","match","split","map","Number","rMajor","rMinor","rPatch","major","minor","patch","checkVersion","closeCoPage","replace","c","r","Math","random","toString","pageType","sendPV","undefined","sendShow","entryTag","entryTagInfo","sendClick","page_name","element_action","_e","biz","noStat","sendCustom","url_package","sendTask","collect","logType","logParams","sendImmediately","flush","updateCommonPackage","updateCurrentUrlPackage","url","updateReferUrlPackage","BasePlugin","Krn","NativeModules","AppState","deviceInfo","KSRCTBridge","KRNBasic","dataJSON","parse","os","Platform","OS","osVersion","Version","locale","uuid","systemVersion","networkType","manufacturer","model","screenWidth","screenHeight","statusBarHeight","titleBarHeight","getKrnDeviceInfo","callback","yoda","invoke","Weblog"],"mappings":"yEA+BO,IAAIA,EAAW,WAQlB,OAPAA,EAAWC,OAAOC,QAAU,SAAkBC,GAC1C,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAEvC,IAAA,IAAII,KADTL,EAAIG,UAAUF,GACOJ,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,KAAIN,EAAEM,GAAKL,EAAEK,IAE9E,OAAON,IAEKU,MAAMC,KAAMP,YAiIzB,SAASQ,EAAcC,EAAIC,EAAMC,GACpC,GAAIA,GAA6B,IAArBX,UAAUC,OAAc,IAAK,IAA4BW,EAAxBd,EAAI,EAAGe,EAAIH,EAAKT,OAAYH,EAAIe,EAAGf,KACxEc,GAAQd,KAAKY,IACRE,IAAIA,EAAKE,MAAMX,UAAUY,MAAMV,KAAKK,EAAM,EAAGZ,IAClDc,EAAGd,GAAKY,EAAKZ,IAGrB,OAAOW,EAAGO,OAAOJ,GAAME,MAAMX,UAAUY,MAAMV,KAAKK,IC9JtD,ICXIO,WDYYC,QAAM,IAAcC,EAAA,GAAAC,EAAA,EAAdA,EAAcpB,UAAAC,OAAdmB,IAAAD,EAAcC,GAAApB,UAAAoB,GAChC,IACI,IAAMC,EAA6C,OAAPC,cAAO,IAAPA,aAAO,EAAPA,QAASC,IACrD,OAAOF,GAASA,EAAMhB,KAAIC,MAAVe,EAAKb,EAAA,CAAMc,SAAYH,GAAI,IAC7C,MAAOK,GACL,QE4fF,SAAUC,EAAgBC,GAC5B,MAAyB,iBAAXA,EAAsBA,EAA2B,iBAAXA,EAAsBC,KAAKC,UAAUF,GAAU,GD7gBvG,IAAIG,EAAoB,wBAORC,IACZ,OAAOD,EAGX,IAAME,EAAe,SAACR,GAClBA,EAAIS,KAAKH,UAAYA,EACrBN,EAAIS,KAAKC,UAAY,SACrB,IACIhB,EACIM,GACA,SAACW,EAAaC,GACK,IAAXD,GACAhB,EAAM,qBAAsBgB,EAAQC,MAIlD,MAAOC,GACLlB,EAAM,uBEzBDmB,EAAoB,SAC7BC,EACAC,EACAb,EACAc,GAEA,IAAIC,OAJJ,IAAAF,IAAAA,EAAoC,IAKhB,iBAATD,IACPG,EAAWH,EAAKA,MAEpBG,EAAYH,EAAWI,cACvB,IAAIC,EAAe,GACnB,GAAoB,iBAATJ,EAEPI,EAAQH,eAAiBA,EACZ,WAATF,GACAK,EAAQC,IAAML,EACdI,EAAQE,MAAQnB,IAEhBiB,EAAQjB,OAASA,EACJ,OAATY,EACAK,EAAQG,KAAOP,EAEfI,EAAQI,OAASR,QAKzB,GADAI,EAAUJ,EACN,CAAC,SAAU,gBAAgBS,SAASP,GAAW,CAC/C,IAAMQ,EAAeV,EACjBU,EAAaF,SAAWE,EAAaL,MACrCD,EAAQC,IAAMK,EAAaF,QAE3BE,EAAavB,SAAWuB,EAAaJ,QACrCF,EAAQE,MAAQI,EAAavB,QAIzC,MAAO,CACHe,EACAE,ICDJO,EAAc,EAClBC,EAAA,WA8BI,SAAYA,EAAAC,EAAsBC,GA1BlC9C,KAAA+C,YAAc,CACVC,SAAU,gBACVC,YAAa,UACbC,WAAY,mBACZC,QAAQ,GAEZnD,KAAAoD,QAAUpD,KAAK+C,YAAYE,YAC3BjD,KAAAqD,kBAMI,CACAd,KAAM,GACNpB,OAAQ,GACRmC,SAAU,GACVH,QAAQ,GAIZnD,KAAOuD,QAEH,GAEJvD,KAAOwD,QAAW,GAEdxD,KAAK6C,UAAiB3D,EAAA,GAAA2D,GACtB1D,OAAOC,OAAOY,KAAK+C,YAAaD,MAAAA,OAAA,EAAAA,EAAMW,eACtCzD,KAAK0D,aAqOb,OAnOIvE,OAAAwE,eAAIf,EAAahD,UAAA,gBAAA,CAAjBgE,IAAA,WACI,MAAO,CACHH,cAAezD,KAAK+C,8CAO5BH,EAAAhD,UAAA8D,WAAA,WAAA,IAQCG,EAAA7D,KAPQA,KAAK6C,UAAUU,SAAYvD,KAAK6C,UAAUU,QAAQ7D,QAEvDM,KAAK6C,UAAUU,QAAQO,SAAQ,SAACC,GACN,iBAAXA,GAA+C,mBAAjBA,EAAOhE,OAC5C8D,EAAKG,kBAAkBD,OAOnCnB,EAAiBhD,UAAAoE,kBAAjB,SAAkBC,GACd,GAAIA,EAAgB,CAChB,IAAM5B,EAAM4B,EAAe5B,KAAO4B,EAAeC,aAAeD,EAAeC,YAAY7B,KAAO,0BAAmBM,KACjF,mBAAzBsB,EAAelE,OACjBkE,EAAeE,QAAUF,EAAeE,SAAWnE,MAExDiE,EAAelE,MAAMC,MAEzBA,KAAKuD,QAAQlB,GAAO4B,IAQ5BrB,EAAAhD,UAAAwE,KAAA,SAAKL,EAA+BM,GAChC,GAAIrE,KAAKuD,QAAQQ,EAAO1B,KACpB,MAAM,IAAIiC,MAAM,mCAAA7D,OAAmCsD,EAAO1B,MAE9DrC,KAAKgE,kBAAkB,IAAID,EAAO/D,KAAMqE,KAG5CzB,EAAAhD,UAAA2E,KAAA,SACIC,EACApC,EACAqC,GAEAD,EAAYA,EAAUrC,cACtB,IAsDIuC,EAtDA3B,EAAc/C,KAAK+C,YACjB4B,EAA8GvC,EAA5GI,WAAQP,EAAc0C,EAAA1C,eAAEd,EAAMwD,EAAAxD,OAAEyD,gBAAa7C,EAAI4C,EAAA5C,KAAE8C,EAAUF,EAAAE,WAAEC,WAAQC,EAASJ,EAAAI,UAAEC,EAAOL,EAAAK,QAAEC,iBACnG,GAAkB,OAAdT,EAAoB,CACpB,GAAIxE,KAAK6C,UAAUkC,UAAW,OACxB,IAAAG,EAA8F9C,EAA5F+C,EAAAD,EAAA3C,KAAAA,OAAI,IAAA4C,EAAGnF,KAAKqD,kBAAkBd,KAAI4C,EAAEC,EAAcF,EAAAnD,KAAdsD,OAAI,IAAAD,EAAG,QAAOA,EAAEjC,WAAQmC,EAAQJ,EAAAI,SAAEC,EAAML,EAAAJ,OAAEU,aAEhFC,EAAa7C,EAAU8C,SAASD,WACtC,GACa,UAATJ,GACGrF,KAAKqD,kBAAkBF,QACvBsC,GF2FH,SAAaE,EAA0BvC,GACnD,IAAKA,EAAS,OAAO,EACrB,IAAkC,IAA9BA,EAAQwC,QAAQ,SAAiB,OAAO,EAC5C,IAAiC,IAA7BxC,EAAQwC,QAAQ,QAAgB,OAAO,EAC3C,IACI,IAAIC,EAAUF,EAAiBG,MAAM,iBAErC,KADAH,GAAmBE,MAAAA,OAAO,EAAPA,EAAU,KAAM,IACZ,OAAO,EAI9B,GAFAA,EAAUzC,EAAQ0C,MAAM,mBACxB1C,GAAUyC,MAAAA,OAAO,EAAPA,EAAU,KAAM,IACZ,OAAO,EAEf,IAAAlB,EAA2BgB,EAAiBI,MAAM,KAAKC,KAAI,SAACzG,GAAc,OAAA0G,OAAO1G,MAAhF2G,EAAMvB,EAAA,GAAEwB,EAAMxB,EAAA,GAAEyB,OACjBlB,EAAwB9B,EAAQ2C,MAAM,KAAKC,KAAI,SAACzG,GAAc,OAAA0G,OAAO1G,MAApE8G,EAAKnB,EAAA,GAAEoB,EAAKpB,EAAA,GAAEqB,OAErB,QAAIF,EAASH,KACTG,EAASH,KAETI,EAASH,KACTG,EAASH,IAETI,EAASH,IAGf,MAAOvE,GACL,OAAO,GEpHI2E,CAAa,UAAWf,GAM3B,YH5FW,SAACrD,GACxBZ,EAAa,CACTO,KAAM,cACNN,KAAMW,IGqFEqE,QACOzG,KAAKqD,mBACLjB,IAKX,GAAa,UAATiD,GAA6B,YAATA,EAEpB,OAqBJ,GAnBa,UAATA,IACI9C,IACAvC,KAAKqD,kBAAoB,CACrBd,KAAIA,EACJY,QAAQ,EACRhC,OAAMA,EACNmC,SC7Jf,uCAAuCoD,QAAQ,SAAS,SAASC,GACtE,IAAIC,EAAoB,GAAhBC,KAAKC,SAAgB,EAC7B,OADyC,KAALH,EAAWC,EAAS,EAAJA,EAAU,GACrDG,SAAS,QD6JF/G,KAAKwD,QAAUjB,GAEfY,IACAnD,KAAKqD,kBAAkBF,OAASA,EAChCnD,KAAK+C,YAAYI,OAASA,GAE1BqC,IACAxF,KAAKqD,kBAAkBmC,SAAWA,IAG1CxF,KAAKqD,kBAAkBlC,OAAMjC,EAAAA,EAAA,GAASc,KAAKqD,kBAAkBlC,QAAU,IAAQA,IAC1EnB,KAAKqD,kBAAkBd,KAAM,OAClC,OH3IU,SAACA,EAAcH,GAC3B,IAAAuC,EAA+FvC,GAAW,GAAxGjB,EAAMwD,EAAAxD,OAAEc,EAAc0C,EAAA1C,eAAEqB,EAAQqB,EAAArB,SAAEP,EAAW4B,EAAA5B,YAAEI,EAAMwB,EAAAxB,OAAE0B,EAAUF,EAAAE,WAAEC,EAAMH,EAAAG,OAAEI,EAAAP,EAAAW,SAAAA,OAAW,IAAAJ,EAAA,IAC9F1D,EAAa,CACTO,KAAM,iBACNN,KAAM,CACFc,KAAIA,EACJe,SAAQA,EACRnC,OAAQD,EAAgBC,GACxBc,eAAgBf,EAAgBe,GAChCc,YAAa3B,KAAKC,UAAU0B,GAC5BP,OAAQ,KACRwE,SAAU,SACV7D,OAAMA,EACN0B,WAAUA,EACVC,OAAMA,EACNQ,SAAQA,KG4HD2B,CAAOjH,KAAKqD,kBAAkBd,KAAIrD,EAAAA,EAAA,GAClCc,KAAKqD,mBAAiB,CACzBpB,eAAcA,EACd4C,WAAUA,EACV9B,YAAWA,EACX+B,OAAMS,EACND,SAAQA,EACRL,aAAYA,KAIpB,GAAID,MAAAA,SAAAA,EAASzC,KACTmC,EAAe,CACXnC,KAAMyC,EAAQzC,KACde,SAAU0B,EAAQ1B,SAClBnC,OAA2B,iBAAnBI,IAAoCyD,EAAQ7D,OAASD,EAAgB8D,EAAQ7D,aAEtF,CACH,IAAMkC,EAAuC,iBAAnB9B,IAAoCvB,KAAKqD,kBAAmBnE,EAAAA,EAAA,GAC/Ec,KAAKqD,mBAAiB,CACzBlC,OAAQD,EAAgBlB,KAAKqD,kBAAkBlC,UAEnDuD,EAAgB1E,KAAK6C,UAAUkC,WAAaA,IAAc/E,KAAKqD,kBAAkBd,UAC3E2E,EACA7D,EAEV,GAAkB,SAAdmB,EACA,OH3IY,SAAChC,EAAgBJ,GAC/B,IAAAuC,EAAkGvC,GAAW,GAA3GjB,EAAMwD,EAAAxD,OAAEc,EAAc0C,EAAA1C,eAAE2C,EAAWD,EAAAC,YAAEI,EAAOL,EAAAK,QAAEjC,EAAW4B,EAAA5B,YAAE8B,EAAUF,EAAAE,WAAEC,EAAMH,EAAAG,OAAEG,EAAYN,EAAAM,aACnGzD,EAAa,CACTO,KAAM,sBACNN,YACOwD,GAAY,CACfzC,OAAMA,EACNrB,OAAQD,EAAgBC,GACxB6D,UACAJ,cACA3C,eAAgBf,EAAgBe,GAChCc,YAAa3B,KAAKC,UAAU0B,GAC5B8B,aACAC,aG8HOqC,CAAS3E,EAAQ,CACpBwC,QAASN,EACTvD,OAAMA,EACNc,eAAcA,EACd2C,YAAWA,EACX7B,YAAWA,EACX8B,WAAUA,EACVC,OAAMA,EACNG,aAAYA,IAGpB,GAAkB,UAAdT,KAA2BzC,GAAiB,mBAATA,GAA4B,CACvD,IAAAqF,EAAahF,EAAmCgF,SACxD,OHtIa,SAAC5E,EAAgBJ,GAChC,IAAAuC,EAA4GvC,GAAW,GAArHjB,EAAMwD,EAAAxD,OAAEc,EAAc0C,EAAA1C,eAAE2C,gBAAaI,EAAOL,EAAAK,QAAEoC,EAAQzC,EAAAyC,SAAErE,gBAAa8B,EAAUF,EAAAE,WAAQF,EAAAG,OAAE,IAAAG,iBACjGzD,EAAa,CACTO,KAAM,eACNN,KAAIvC,EAAAA,EAAA,GACG+F,GACH,CAAAzC,SACArB,OAAQD,EAAgBC,GACxB6D,QAAOA,EACPJ,YAAWA,EACX3C,eAAgBf,EAAgBe,GAChCoF,aAAcD,EACdrE,YAAa3B,KAAKC,UAAU0B,GAC5B8B,aACA9C,KAAM,qBGwHCuF,CAAU9E,EAAQ,CACrBwC,QAASN,EACTvD,OAAMA,EACNyD,YAAWA,EACX3C,eAAcA,EACdmF,SAAUA,KACNG,UAAWvH,KAAKqD,kBAAkBd,KAClCiF,eAAgBhF,GACb4E,QACHF,EACJnE,YAAWA,EACX8B,WAAUA,EACVC,OAAMA,EACNG,aAAYA,IAGpB,GAAI,CAAC,eAAgB,UAAUxC,SAAS+B,GAAY,CAC1C,IAAAiD,EAAsBrF,EAApBC,EAAGoF,EAAApF,IAAEC,EAAKmF,EAAAnF,MAAEoF,EAAGD,EAAAC,IACnBC,EAAuB,iBAAdnD,EAEb,OHnHc,SAACnC,EAAaD,EAAcuF,QAAA,IAAAA,IAAAA,GAAuB,GACnE,IAAAhD,EAAkFvC,GAAW,GAA3FE,EAAKqC,EAAArC,MAAEoF,EAAG/C,EAAA+C,IAAEzF,mBAAgB2C,EAAWD,EAAAC,YAAEI,EAAOL,EAAAK,QAAEjC,EAAW4B,EAAA5B,YAAEkC,EAAYN,EAAAM,aACnFzD,EAAa,CACTO,KAAM4F,EAAS,iBAAmB,qBAClClG,YACOwD,GAAY,CACf5C,IAAGA,EACHC,MAAOpB,EAAgBoB,GACvB0C,QAAOA,EACPJ,YAAWA,EACX3C,eAAgBf,EAAgBe,GAChCc,YAAa3B,KAAKC,UAAU0B,GAC5B2E,UGuGOE,CAAWvF,GAAOG,EAAQ,CAC7BwC,QAASN,EACTpC,aAHgBA,GAASnB,GAIP,CACd0G,YAAanD,IAEjBgD,IAAKA,GAAO1H,KAAK6C,UAAU6E,IAC3B9C,YAAWA,EACX3C,eAAcA,EACdc,YAAWA,EACX8B,WAAUA,EACVI,aAAYA,GACb0C,GAEP,OHrJgB,SAACnF,EAAgBJ,GAC/B,IAAAuC,EAAkHvC,GAAW,GAA3HjB,EAAMwD,EAAAxD,OAAEc,mBAAgB2C,EAAWD,EAAAC,YAAEI,EAAOL,EAAAK,QAAEoC,EAAQzC,EAAAyC,SAAErF,EAAI4C,EAAA5C,KAAEgB,EAAW4B,EAAA5B,YAAE8B,EAAUF,EAAAE,WAAEC,EAAMH,EAAAG,OAAEG,iBACvGzD,EAAa,CACTO,KAAM,eACNN,KAAIvC,EAAAA,EAAA,GACG+F,GACH,CAAAzC,SACArB,OAAQD,EAAgBC,GACxB6D,QAAOA,EACPJ,YAAWA,EACX3C,eAAgBf,EAAgBe,GAChCoF,aAAcD,EACdrE,YAAa3B,KAAKC,UAAU0B,GAC5B8B,WAAUA,EACV9C,KAAMA,GAAQ,wBACd+C,OAAMA,MGsIHgD,CAAStF,EAAQ,CACpBwC,QAASN,EACTvD,OAAMA,EACNyD,YAAWA,EACX3C,eAAcA,EACdc,YAAWA,EACXhB,KAAIA,EACJ8C,WAAUA,EACVI,aAAYA,EACZH,OAAMA,KAMdlC,EAAOhD,UAAAmI,QAAP,SACIhG,EACAC,EACAb,EACAc,GAEM,IAAA0C,EAAuB7C,EAAkBC,EAAMC,EAAMb,EAAQc,GAA5D+F,OAASC,OAChB,OAAOjI,KAAKuE,KAAKyD,EAASC,GAAW,IAKzCrF,EAAehD,UAAAsI,gBAAf,SACInG,EACAC,EACAb,EACAc,GAEM,IAAA0C,EAAuB7C,EAAkBC,EAAMC,EAAMb,EAAQc,GAA5D+F,OAASC,OAChB,OAAOjI,KAAKuE,KAAKyD,EAASC,GAAW,IAEzCrF,EAAKhD,UAAAuI,MAAL,aACAvF,EAAmBhD,UAAAwI,oBAAnB,SAAoBhG,IACZA,MAAAA,SAAAA,EAASqB,gBACTtE,OAAOC,OAAOY,KAAK+C,YAAaX,EAAQqB,gBAGhDb,EAAAhD,UAAAyI,wBAAA,SAAwBC,EAA2BvG,GAC/C,QADoB,IAAAuG,IAAAA,EAAyB,IAC1B,iBAARA,GAAoBA,EAAK,CACxB,IAAA3D,EAAoD2D,EAAlB/F,KAAlCA,OAAO,IAAAoC,EAAA3E,KAAKqD,kBAAkBd,KAAIoC,EAAEO,EAAgBoD,EAAGnH,OAAnBA,OAAM,IAAA+D,EAAG,GAAEA,EAEvD,KADuBlF,KAAKwD,UAAYjB,GAGpC,YADAvC,KAAKqD,kBAAkBlC,OAAShC,OAAOC,OAAOY,KAAKqD,kBAAkBlC,QAAU,GAAIA,IAGvFnB,KAAKuE,KAAK,KAAM,CACZxC,KAAM,UACNZ,OAAQmH,EAAInH,WAIxByB,EAAAhD,UAAA2I,sBAAA,SAAsBD,EAA+CvG,QAA/C,IAAAuG,IAAAA,EAAuBtI,KAAKqD,oBAGrDT,KElTD4F,EAAA,WAAA,SAAAA,KAWA,OARIA,EAAK5I,UAAAG,MAAL,SAAMoE,GACFnE,KAAKmE,OAASA,GAOrBqE,KC6BKC,EAKF,CACAC,cAAaA,EACbC,SAAQA,EACRC,WAmDJ,mBAEUA,GAAuC,QAA1BjE,EAAA+D,MAAAA,OAAa,EAAbA,EAAeG,mBAAW,IAAAlE,OAAA,EAAAA,EAAEiE,cAAqC,QAAvB1D,EAAAwD,MAAAA,OAAa,EAAbA,EAAeI,gBAAQ,IAAA5D,OAAA,EAAAA,EAAE0D,YACtF,GAAIA,EAAY,CACZ,IAAMG,EAAiC,iBAAfH,EAA0BxH,KAAK4H,MAAMJ,GAAcA,EACnEnH,EAAiBsH,EAAQtH,KACjC,GAAe,IADUsH,EAAQpH,OACf,CACd,IAAMsH,EAAKC,EAASC,GACdC,EAAYF,EAASG,QAC3B,OAAAnK,EAAAA,EAAA,GACOuC,GACH,CAAAwH,KACAG,eAIZ,MAAO,CACH3D,WAAY,GACZ6D,OAAQ,GACRC,KAAM,GACNC,cAAe,GACfC,YAAa,GACbC,aAAc,GACdC,MAAO,GACPC,YAAa,EACbC,aAAc,EACdC,gBAAiB,EACjBC,eAAgB,EAChBd,GAAI,GACJG,UAAW,IAhFHY,GACZd,SAAQA,GNzCRxI,EOGY,SAACM,EAAUiJ,GACvBvB,EAAcwB,KAAKC,OACf,OACA,eACA/I,KAAKC,UAAUL,GACfiJ,IPPJ3I,EOQD,gBPRgC,eOWnC8I,EAAO1E,SAAW,CAAED,WAAYgD,EAAIG,WAAWnD"}